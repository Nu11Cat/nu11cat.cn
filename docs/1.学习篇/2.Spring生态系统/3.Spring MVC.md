---
title: 3.Spring MVC
---

# Spring MVC ç›®å½•

## ä¸€ã€Spring MVC æ¦‚è¿°

- ä»€ä¹ˆæ˜¯ Spring MVCï¼Ÿ
- Spring MVC ä¸ Servlet çš„å…³ç³»
- Spring MVC åœ¨ Spring ç”Ÿæ€ç³»ç»Ÿä¸­çš„è§’è‰²

## äºŒã€è¯·æ±‚å¤„ç†æµç¨‹æ ¸å¿ƒåŸç†

- ä»æµè§ˆå™¨è¯·æ±‚åˆ° Controller çš„å¤„ç†æµç¨‹
- DispatcherServlet çš„å·¥ä½œæœºåˆ¶
- HandlerMappingã€HandlerAdapterã€ViewResolver è¯¦è§£
- å¸¸è§æ‰§è¡Œé“¾æ¡ä¸æ‹¦æˆªç‚¹åˆ†æ

## ä¸‰ã€Controller å¼€å‘ä¸æ³¨è§£è¯¦è§£

- `@Controller` ä¸ `@RestController` çš„åŒºåˆ«
- è¯·æ±‚æ˜ å°„æ³¨è§£è¯¦è§£ï¼š`@RequestMapping`ã€`@GetMapping`ã€`@PostMapping` ç­‰
- å‚æ•°ç»‘å®šï¼š`@RequestParam`ã€`@PathVariable`ã€`@RequestBody`ã€`@ModelAttribute`
- å“åº”å¤„ç†ï¼š`@ResponseBody`ã€è¿”å› JSONã€è¿”å›è§†å›¾
- æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½å¤„ç†

## å››ã€æ•°æ®ç»‘å®šä¸ç±»å‹è½¬æ¢æœºåˆ¶

- å±æ€§ç»‘å®šçš„åº•å±‚æœºåˆ¶ï¼š`WebDataBinder`
- è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨ï¼š`Converter`ã€`Formatter`
- è¡¨å•å¯¹è±¡ç»‘å®šä¸éªŒè¯æµç¨‹
- `@Valid`ã€`@Validated` ä¸å¼‚å¸¸å¤„ç†è”åŠ¨

## äº”ã€å¼‚å¸¸å¤„ç†æœºåˆ¶

- å±€éƒ¨å¼‚å¸¸å¤„ç†ï¼š`@ExceptionHandler`
- å…¨å±€å¼‚å¸¸å¤„ç†ï¼š`@ControllerAdvice`
- å¼‚å¸¸å“åº”æ ¼å¼è®¾è®¡ä¸ç»Ÿä¸€å°è£…
- è‡ªå®šä¹‰å¼‚å¸¸ç»“æ„çš„è®¾è®¡å®è·µ

## å…­ã€è§†å›¾è§£æä¸æ¨¡æ¿å¼•æ“

- Spring MVC è§†å›¾è§£ææœºåˆ¶åŸç†
- å¸¸ç”¨æ¨¡æ¿å¼•æ“ï¼šThymeleafã€Freemarkerã€JSP
- è§†å›¾ä¸æ•°æ®æ¨¡å‹çš„äº¤äº’ï¼š`Model`ã€`ModelAndView`

## ä¸ƒã€æ‹¦æˆªå™¨ä¸è¿‡æ»¤å™¨æœºåˆ¶

- æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰ä¸ Filter çš„åŒºåˆ«ä¸åº”ç”¨åœºæ™¯
- å®ç° HandlerInterceptor æ¥å£çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•
- æ³¨å†Œä¸é…ç½®å¤šä¸ªæ‹¦æˆªå™¨çš„é¡ºåº
- å®æˆ˜ï¼šç”¨æˆ·æƒé™æ ¡éªŒã€æ¥å£ç­¾åæ ¡éªŒç­‰

## å…«ã€å¼‚æ­¥è¯·æ±‚ä¸å“åº”å¤„ç†

- ä½¿ç”¨ `@Async` ä¸ `Callable` å®ç°å¼‚æ­¥æ§åˆ¶å™¨
- ä½¿ç”¨ `DeferredResult`ã€`WebAsyncTask` å®ç°é•¿è½®è¯¢
- å¼‚æ­¥å¤„ç†åŸç†ä¸çº¿ç¨‹æ¨¡å‹

## ä¹ã€è·¨åŸŸè¯·æ±‚ä¸ CORS æ”¯æŒ

- ä»€ä¹ˆæ˜¯è·¨åŸŸåŠå…¶æœ¬è´¨
- Spring MVC ä¸­é…ç½®è·¨åŸŸæ”¯æŒçš„ä¸‰ç§æ–¹å¼
- ä½¿ç”¨ `@CrossOrigin` æ³¨è§£å¤„ç†è·¨åŸŸ
- è·¨åŸŸè¯·æ±‚ä¸è®¤è¯å®‰å…¨æ€§é£é™©é˜²èŒƒ

## åã€Spring MVC æ€§èƒ½ä¼˜åŒ–ä¸è°ƒè¯•æŠ€å·§

- è¯·æ±‚å¤„ç†é“¾è°ƒä¼˜å»ºè®®
- JSON è½¬æ¢æ€§èƒ½ä¼˜åŒ–
- é™æ€èµ„æºä¼˜åŒ–ä¸ç¼“å­˜é…ç½®
- å¸¸è§æ€§èƒ½é—®é¢˜è¯Šæ–­æŠ€å·§ï¼ˆå¦‚è¯·æ±‚é˜»å¡ã€è§†å›¾æ¸²æŸ“æ…¢ï¼‰

## åä¸€ã€æµ‹è¯•ä¸è°ƒè¯•æ”¯æŒ

- å•å…ƒæµ‹è¯•ä¸æ§åˆ¶å™¨ Mock æµ‹è¯•ï¼ˆMockMvcï¼‰
- æ¨¡æ‹Ÿè¯·æ±‚å‚æ•°ä¸çŠ¶æ€æ ¡éªŒ
- Spring MVC æµ‹è¯•ä¸­å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

## åäºŒã€Spring MVC å¸¸è§é¢è¯•é¢˜ä¸è®¾è®¡é¢˜

- Spring MVC æ‰§è¡Œæµç¨‹èƒ½å¦è¯¦ç»†æè¿°ï¼Ÿ
- DispatcherServlet æ˜¯å¦‚ä½•è°ƒåº¦è¯·æ±‚çš„ï¼Ÿ
- å‚æ•°ç»‘å®šåº•å±‚åŸç†ä¸è‡ªå®šä¹‰ç»‘å®šï¼Ÿ
- å¦‚ä½•ä¼˜é›…åœ°å¤„ç†å…¨å±€å¼‚å¸¸ï¼Ÿæ˜¯å¦å¯ä»¥æŒ‰æ¨¡å—åˆ‡åˆ†ï¼Ÿ
- å¦‚ä½•åº”å¯¹é«˜å¹¶å‘ä¸‹ Controller æ€§èƒ½ç“¶é¢ˆï¼Ÿ

## åä¸‰ã€æœ€ä½³å®è·µä¸æ¶æ„å»ºè®®

- åˆ†å±‚ Controller è®¾è®¡ï¼šAPI å±‚ã€ä¸šåŠ¡å±‚è§£è€¦
- ç»Ÿä¸€è¿”å›å€¼ç»“æ„ä¸å“åº”å°è£…æ–¹æ¡ˆ
- æ¨¡å—åŒ– MVC æ¶æ„å»ºè®®ï¼ˆå¦‚å¤šæ¨¡å—æ§åˆ¶å™¨æ³¨å†Œï¼‰
- å¦‚ä½•åˆç†ä½¿ç”¨æ‹¦æˆªå™¨ä¸ AOP åšåˆ‡é¢é€»è¾‘å¤„ç†

------

# ä¸€ã€Spring MVC æ¦‚è¿°

Spring MVC æ˜¯ Spring Framework æä¾›çš„ä¸€ä¸ªå¼ºå¤§è€Œçµæ´»çš„ Web æ¡†æ¶ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯å¯¹ Servlet çš„æŠ½è±¡å’Œå°è£…ï¼ŒåŸºäºå‰ç«¯æ§åˆ¶å™¨ï¼ˆFront Controllerï¼‰æ¨¡å¼ï¼Œå®ç°äº†è¯·æ±‚çš„ç»Ÿä¸€è°ƒåº¦ã€å‚æ•°ç»‘å®šã€æ•°æ®è¿”å›ã€è§†å›¾æ¸²æŸ“ç­‰åŠŸèƒ½ï¼Œæ˜¯æ„å»ºç°ä»£ Java Web åº”ç”¨çš„ä¸»æµæ–¹æ¡ˆä¹‹ä¸€ã€‚

------

## 1. ä»€ä¹ˆæ˜¯ Spring MVCï¼Ÿ

Spring MVCï¼ˆModel-View-Controllerï¼‰æ˜¯ä¸€ä¸ª Web å±‚æ¡†æ¶ï¼Œæ„å»ºåœ¨ Servlet API ä¹‹ä¸Šï¼Œæ—¨åœ¨å®ç°è¯·æ±‚é©±åŠ¨çš„ Web åº”ç”¨å¼€å‘ã€‚

å®ƒå…·å¤‡ä»¥ä¸‹æ ¸å¿ƒç‰¹æ€§ï¼š

- åŸºäº DispatcherServlet å®ç°è¯·æ±‚é›†ä¸­åˆ†å‘
- æ”¯æŒæ³¨è§£é©±åŠ¨çš„ Controller å¼€å‘
- å‚æ•°è‡ªåŠ¨ç»‘å®šä¸æ•°æ®éªŒè¯
- çµæ´»çš„è§†å›¾è§£æï¼ˆæ”¯æŒ JSPã€Thymeleafã€JSON ç­‰ï¼‰
- ä¸°å¯Œçš„æ‰©å±•æ¥å£ï¼šæ‹¦æˆªå™¨ã€æ¶ˆæ¯è½¬æ¢å™¨ã€å¼‚å¸¸å¤„ç†å™¨ç­‰

Spring MVC å¹¶éâ€œé‡é‡çº§æ¡†æ¶â€ï¼Œè€Œæ˜¯é€šè¿‡é«˜åº¦æ¨¡å—åŒ–ã€æŒ‰éœ€åŠ è½½çš„æ–¹å¼ï¼Œæå‡å¼€å‘æ•ˆç‡å’Œæ‰©å±•èƒ½åŠ›ã€‚

> âœ… æ‰¹åˆ¤æ€§æ€è€ƒï¼šSpring MVC æœ€å¤§ä¼˜åŠ¿æ˜¯ä¸ Spring å®¹å™¨çš„æ— ç¼é›†æˆï¼Œå½¢æˆå®Œæ•´çš„ IoC + AOP + MVC å…¨å®¶æ¡¶ï¼›ä½†ç¼ºç‚¹æ˜¯å­¦ä¹ æ›²çº¿ç›¸å¯¹é™¡å³­ã€é…ç½®é¡¹å¤šã€å¯¹ Servlet æœ¬èº«æŠ½è±¡å±‚æ¬¡è¾ƒé«˜ï¼Œè°ƒè¯•éš¾åº¦ä¸Šå‡ã€‚

------

## 2. Spring MVC ä¸ Servlet çš„å…³ç³»

Spring MVC æœ¬è´¨ä¸Šæ˜¯ Servlet çš„é«˜çº§å°è£…ã€‚ä¸‹é¢æ˜¯ä¸¤è€…çš„ç»“æ„å¯¹åº”å…³ç³»ï¼š

| Servlet API æ¦‚å¿µ              | Spring MVC å¯¹åº”å°è£…                |
| ----------------------------- | ---------------------------------- |
| `HttpServlet`                 | `DispatcherServlet`                |
| `doGet()/doPost()`            | `@RequestMapping` æ§åˆ¶å™¨æ–¹æ³•       |
| `ServletRequest`              | è‡ªåŠ¨å‚æ•°ç»‘å®šï¼ˆ`@RequestParam` ç­‰ï¼‰ |
| `RequestDispatcher.forward()` | `ViewResolver` è§†å›¾è§£æ            |

**å…³é”®ç‚¹ï¼š**

- æ‰€æœ‰ HTTP è¯·æ±‚æœ€ç»ˆç”± `DispatcherServlet` ç»Ÿä¸€å¤„ç†ï¼Œè¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ Servletã€‚
- `DispatcherServlet` æœ¬è´¨æ˜¯ Servletï¼Œå®ƒç»§æ‰¿è‡ª `HttpServlet`ï¼Œå¹¶é€šè¿‡ Spring çš„é…ç½®æœºåˆ¶æ³¨å†Œåˆ° Web å®¹å™¨ä¸­ã€‚
- `DispatcherServlet` å†…éƒ¨é€šè¿‡ HandlerMappingã€HandlerAdapterã€ViewResolver ç­‰ç­–ç•¥ç»„ä»¶è§£è€¦è¯·æ±‚åˆ†å‘ã€æ§åˆ¶å™¨æ‰§è¡Œã€ç»“æœè¿”å›ã€‚

> âš ï¸ æ³¨æ„ï¼šSpring MVC ä¸ç­‰äº Spring Bootï¼Œåè€…æ˜¯å¯¹ Spring MVC çš„è‡ªåŠ¨åŒ–å°è£…ï¼Œä½†åº•å±‚ä¾èµ–ä¾ç„¶æ˜¯ DispatcherServletã€‚

------

## 3. Spring MVC åœ¨ Spring ç”Ÿæ€ç³»ç»Ÿä¸­çš„è§’è‰²

Spring MVC åœ¨æ•´ä¸ª Spring æŠ€æœ¯ä½“ç³»ä¸­çš„å®šä½å¦‚ä¸‹ï¼š

```
          Web å±‚ï¼ˆSpring MVCï¼‰
               â†“
          Service å±‚ï¼ˆSpringï¼‰
               â†“
          DAO å±‚ï¼ˆSpring JDBC / MyBatisï¼‰
               â†“
          æ•°æ®æºï¼ˆHikariCP / DBCPï¼‰
```

åœ¨å¾®æœåŠ¡æ—¶ä»£ï¼ŒSpring MVC ä»ç„¶æ˜¯ï¼š

- Spring Boot Web çš„æ ¸å¿ƒç»„ä»¶ï¼ˆspring-boot-starter-webï¼‰
- Spring Cloud Gatewayã€Feignã€RestTemplate çš„åŸºç¡€æ„å»ºå—
- å‰åç«¯äº¤äº’ä¸­ï¼ŒRESTful API çš„ä¸»è¦è¾“å‡ºè€…

Spring MVC ä¹Ÿä¸å…¶ä»– Spring ç”Ÿæ€ä¸­çš„æ¨¡å—é…åˆç´§å¯†ï¼š

| æ¨¡å—              | ä½œç”¨                                   |
| ----------------- | -------------------------------------- |
| Spring AOP        | æ—¥å¿—ã€æƒé™ã€äº‹åŠ¡ç­‰åˆ‡é¢ç¼–ç¨‹æ”¯æŒ         |
| Spring Validation | å‚æ•°æ ¡éªŒæ¡†æ¶ï¼Œé…åˆ `@Valid` ä½¿ç”¨       |
| Spring Security   | ä¸ MVC æ‹¦æˆªå™¨ã€Filter æ·±åº¦èåˆ         |
| Spring Data       | æ”¯æŒ JSON è¯·æ±‚ â†’ å¯¹è±¡ç»‘å®š â†’ æŒä¹…åŒ–æµç¨‹ |
| Thymeleaf         | MVC çš„ä¸»æµæ¨¡æ¿å¼•æ“                     |

> ğŸ¯ æ€»ç»“ï¼šSpring MVC æ˜¯è¿æ¥ Web å±‚ä¸æ ¸å¿ƒä¸šåŠ¡é€»è¾‘çš„æ¡¥æ¢ã€‚è™½ç„¶å¾®æœåŠ¡æ¶æ„æ·¡åŒ–äº† Web å±‚é‡é‡ï¼Œä½† Spring MVC ä¾æ—§æ˜¯æœ€å¹¿æ³›ä½¿ç”¨ã€æœ€æˆç†Ÿçš„ Web æ¡†æ¶ä¹‹ä¸€ã€‚åœ¨ä»¥ REST ä¸ºä¸­å¿ƒçš„æ¶æ„è®¾è®¡ä¸­ï¼Œå®ƒä»æ˜¯æ ¸å¿ƒè§’è‰²ã€‚

------

å¥½çš„ï¼Œä¸‹é¢æ˜¯**ç¬¬äºŒç« ï¼šè¯·æ±‚å¤„ç†æµç¨‹æ ¸å¿ƒåŸç†**çš„è¯¦ç»†å†…å®¹ï¼Œä¾ç„¶ä¿æŒä½ è¦æ±‚çš„é€»è¾‘æ¸…æ™°ã€åˆ†ç‚¹æ·±å…¥ã€ç»“æ„ä¸€è‡´çš„é£æ ¼ï¼š

------

# äºŒã€è¯·æ±‚å¤„ç†æµç¨‹æ ¸å¿ƒåŸç†

Spring MVC ä¹‹æ‰€ä»¥å¼ºå¤§ï¼Œå…³é”®åœ¨äºå®ƒå¯¹ HTTP è¯·æ±‚ç”Ÿå‘½å‘¨æœŸçš„å…¨é¢æ¥ç®¡å’Œçµæ´»è°ƒåº¦ã€‚ç†è§£ DispatcherServlet çš„è°ƒåº¦æœºåˆ¶ï¼Œæ˜¯æŒæ¡ Spring MVC çš„åŸºç¡€ã€‚

------

## 1. ä»æµè§ˆå™¨è¯·æ±‚åˆ° Controller çš„å¤„ç†æµç¨‹

ä¸€ä¸ªå…¸å‹çš„ HTTP è¯·æ±‚åœ¨ Spring MVC ä¸­çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š

```
æµè§ˆå™¨å‘é€è¯·æ±‚ â†’ DispatcherServlet â†’ HandlerMapping â†’ HandlerAdapter â†’ Controller â†’ è¿”å› ModelAndView â†’ ViewResolver â†’ æ¸²æŸ“è§†å›¾
```

æµç¨‹ç»†åŒ–å¦‚ä¸‹ï¼š

1. **æµè§ˆå™¨å‘èµ·è¯·æ±‚**ï¼Œåˆ°è¾¾ Web å®¹å™¨ï¼ˆTomcatã€Jettyï¼‰
2. **DispatcherServlet** æ‹¦æˆªè¯·æ±‚ï¼ˆç”± web.xml æˆ– Spring Boot è‡ªåŠ¨æ³¨å†Œï¼‰
3. **æŸ¥æ‰¾ HandlerMapping**ï¼šæ ¹æ® URL å’Œæ–¹æ³•åŒ¹é…å¯¹åº”çš„ Controller å¤„ç†å™¨
4. **è°ƒç”¨ HandlerAdapter**ï¼šæ‰¾åˆ°åˆé€‚çš„é€‚é…å™¨æ‰§è¡Œå¤„ç†å™¨æ–¹æ³•
5. **æ‰§è¡Œ Controller æ–¹æ³•**ï¼šå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œè¿”å› ModelAndView æˆ–æ•°æ®
6. **è¿”å›ç»“æœäº¤ç”± ViewResolver**ï¼šæ ¹æ®é€»è¾‘è§†å›¾åè§£æä¸ºç‰©ç†è§†å›¾è·¯å¾„
7. **æ¸²æŸ“è§†å›¾å¹¶å“åº”**ï¼šå°† HTML æˆ– JSON è¾“å‡ºåˆ°æµè§ˆå™¨

> ğŸ§  åæ€ï¼šè™½ç„¶ Spring MVC çš„å¤„ç†é“¾çœ‹ä¼¼å¤æ‚ï¼Œä½†æœ¬è´¨æ˜¯â€œè¯·æ±‚è°ƒåº¦ â†’ æ§åˆ¶å™¨æ‰§è¡Œ â†’ ç»“æœæ¸²æŸ“â€ä¸‰æ®µå¼ç»“æ„ï¼Œä¸”é€šè¿‡ç­–ç•¥æ¥å£è§£è€¦æ¯ä¸€ç¯ï¼Œåˆ©äºæ‰©å±•ä¸æ›¿æ¢ã€‚

------

## 2. DispatcherServlet çš„å·¥ä½œæœºåˆ¶

`DispatcherServlet` æ˜¯ Spring MVC çš„æ ¸å¿ƒï¼Œå®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ Servletï¼Œèµ·åˆ°â€œå‰ç«¯æ§åˆ¶å™¨â€çš„ä½œç”¨ï¼Œè´Ÿè´£æ•´ä¸ªè¯·æ±‚æµç¨‹çš„åˆ†å‘ã€åè°ƒã€æ‰§è¡Œã€‚

å…¶ç”Ÿå‘½å‘¨æœŸä¸æ™®é€š Servlet ä¸€è‡´ï¼š

- **åˆå§‹åŒ–é˜¶æ®µ**ï¼ˆinitï¼‰ï¼š
  - åŠ è½½ Spring å®¹å™¨ï¼ˆæˆ–å­å®¹å™¨ï¼‰
  - åˆå§‹åŒ–æ‰€æœ‰æ ¸å¿ƒç»„ä»¶ï¼šHandlerMappingã€HandlerAdapterã€ViewResolver ç­‰
- **è¯·æ±‚å¤„ç†é˜¶æ®µ**ï¼ˆservice/doDispatchï¼‰ï¼š
  - æ ¹æ®è¯·æ±‚æŸ¥æ‰¾æ§åˆ¶å™¨ â†’ æ‰§è¡Œ â†’ æ¸²æŸ“ â†’ è¿”å›å“åº”

æºç å…¥å£ï¼š

```java
protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception {
    HandlerExecutionChain mappedHandler = getHandler(request); // 1. æ‰¾å¤„ç†å™¨
    HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler()); // 2. æ‰¾é€‚é…å™¨
    ModelAndView mv = ha.handle(request, response, mappedHandler.getHandler()); // 3. è°ƒç”¨å¤„ç†å™¨
    render(mv, request, response); // 4. è§†å›¾è§£æ
}
```

> ğŸ¯ å…³é”®è§‚ç‚¹ï¼šDispatcherServlet çš„è®¾è®¡å……åˆ†ä½“ç°äº†â€œå¼€é—­åŸåˆ™â€ï¼šé€šè¿‡ç­–ç•¥æ¥å£å¼€æ”¾æ‰©å±•ç‚¹ï¼Œè€Œæ ¸å¿ƒæµç¨‹ä¿æŒç¨³å®šã€‚

------

## 3. HandlerMappingã€HandlerAdapterã€ViewResolver è¯¦è§£

### HandlerMappingï¼ˆè¯·æ±‚è·¯å¾„æ˜ å°„å™¨ï¼‰

- ä½œç”¨ï¼šå°†è¯·æ±‚è·¯å¾„æ˜ å°„åˆ°å¯¹åº”çš„ Handlerï¼ˆä¸€èˆ¬æ˜¯ Controller æ–¹æ³•ï¼‰
- å¸¸è§å®ç°ç±»ï¼š
  - `RequestMappingHandlerMapping`ï¼ˆåŸºäºæ³¨è§£ï¼‰
  - `SimpleUrlHandlerMapping`ï¼ˆåŸºäº XMLï¼‰

### HandlerAdapterï¼ˆå¤„ç†å™¨é€‚é…å™¨ï¼‰

- ä½œç”¨ï¼šè´Ÿè´£â€œå¦‚ä½•æ‰§è¡Œâ€Handler
- è®¾è®¡è§£è€¦ Controller çš„ç±»å‹å’Œæ‰§è¡Œæ–¹å¼
- å…¸å‹å®ç°ï¼š
  - `RequestMappingHandlerAdapter`ï¼šæ”¯æŒ `@RequestMapping` æ³¨è§£çš„æ–¹æ³•
  - `HttpRequestHandlerAdapter`ï¼šé€‚é…å®ç° `HttpRequestHandler` æ¥å£çš„å¤„ç†å™¨

### ViewResolverï¼ˆè§†å›¾è§£æå™¨ï¼‰

- ä½œç”¨ï¼šæ ¹æ® Controller è¿”å›çš„é€»è¾‘è§†å›¾åï¼Œè§£æå‡ºå®é™…çš„ç‰©ç†è§†å›¾è·¯å¾„
- å¸¸è§å®ç°ï¼š
  - `InternalResourceViewResolver`ï¼šç”¨äº JSP
  - `ThymeleafViewResolver`ï¼šç”¨äº Thymeleaf
  - `MappingJackson2JsonView`ï¼šè¿”å› JSON æ•°æ®

é…ç½®ç¤ºä¾‹ï¼š

```java
@Bean
public InternalResourceViewResolver viewResolver() {
    InternalResourceViewResolver resolver = new InternalResourceViewResolver();
    resolver.setPrefix("/WEB-INF/views/");
    resolver.setSuffix(".jsp");
    return resolver;
}
```

> ğŸ’¡ æ€è€ƒï¼šä¸‰å¤§ç»„ä»¶çš„ç­–ç•¥æ¨¡å¼è®¾è®¡ï¼Œä¿è¯äº† MVC å¤„ç†é“¾çš„é«˜åº¦çµæ´»ä¸å¯å®šåˆ¶æ€§ â€”â€” ä½ å¯ä»¥è½»æ¾æ›¿æ¢é»˜è®¤å®ç°ï¼Œè‡ªå®šä¹‰é€‚åˆä½ çš„è¯·æ±‚å¤„ç†é€»è¾‘ã€‚

------

## 4. å¸¸è§æ‰§è¡Œé“¾æ¡ä¸æ‹¦æˆªç‚¹åˆ†æ

Spring MVC çš„è¯·æ±‚ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæœ‰å¤šä¸ªå¯æ’æ‹”çš„â€œæ‹¦æˆªç‚¹â€ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡æ‰©å±•æ¥å£æˆ–æ³¨è§£ä»‹å…¥è¯·æ±‚æµç¨‹ï¼Œå…¸å‹åŒ…æ‹¬ï¼š

| æ‹¦æˆªç‚¹         | å¯¹åº”ç»„ä»¶                                 | åº”ç”¨åœºæ™¯                       |
| -------------- | ---------------------------------------- | ------------------------------ |
| è¯·æ±‚è¿›å…¥       | `HandlerInterceptor.preHandle`           | ç™»å½•æ ¡éªŒã€ç­¾åæ ¡éªŒ             |
| æ§åˆ¶å™¨æ‰§è¡Œå‰   | `@InitBinder`ã€AOP Before                | å‚æ•°é¢„å¤„ç†ã€æ—¥å¿—è®°å½•           |
| æ§åˆ¶å™¨æ‰§è¡Œå   | `HandlerInterceptor.postHandle`          | ä¿®æ”¹å“åº”å¯¹è±¡ã€è¿½åŠ å…¬å…±æ¨¡å‹æ•°æ® |
| è§†å›¾æ¸²æŸ“å®Œæˆå | `HandlerInterceptor.afterCompletion`     | èµ„æºæ¸…ç†ã€è€—æ—¶ç»Ÿè®¡ã€å¼‚å¸¸è®°å½•   |
| å¼‚å¸¸å‘ç”Ÿ       | `@ExceptionHandler`ã€`@ControllerAdvice` | è‡ªå®šä¹‰é”™è¯¯å“åº”ã€ç»Ÿä¸€å¼‚å¸¸å¤„ç†   |

æ‹¦æˆªå™¨é“¾æ¡æ‰§è¡Œé¡ºåºï¼š

1. preHandle â†’ Controller â†’ postHandle â†’ è§†å›¾æ¸²æŸ“ â†’ afterCompletion

> âš ï¸ è­¦æƒ•ï¼šæ‹¦æˆªå™¨é“¾é¡ºåºå’Œè¿”å›å€¼ä¼šå½±å“æ•´ä¸ªè¯·æ±‚æ˜¯å¦ç»§ç»­æ‰§è¡Œï¼Œå°¤å…¶æ˜¯è®¤è¯æ‹¦æˆªã€æƒé™æ ¡éªŒç±»æ‹¦æˆªå™¨ä¸­ï¼Œè¦åˆç†æ§åˆ¶é€»è¾‘åˆ†æ”¯ã€‚

------

# ä¸‰ã€Controller å¼€å‘ä¸æ³¨è§£è¯¦è§£

Controller æ˜¯ Spring MVC ä¸­æœ€æ ¸å¿ƒçš„ç»„ä»¶ä¹‹ä¸€ï¼Œæ‰¿æ‹…äº† Web å±‚çš„è·¯ç”±å…¥å£ã€å‚æ•°è§£æã€å“åº”å¤„ç†ç­‰èŒè´£ã€‚æœ¬ç« é‡ç‚¹è®²è§£å¸¸ç”¨æ§åˆ¶å™¨æ³¨è§£åŠå…¶ä½¿ç”¨åœºæ™¯ã€‚

------

## 1. `@Controller` ä¸ `@RestController` çš„åŒºåˆ«

| æ³¨è§£              | å«ä¹‰                              | é»˜è®¤è¡Œä¸º                                |
| ----------------- | --------------------------------- | --------------------------------------- |
| `@Controller`     | æ ‡è®°ç±»ä¸ºæ§åˆ¶å™¨ç»„ä»¶                | æ–¹æ³•é»˜è®¤è¿”å›è§†å›¾ï¼ˆé€»è¾‘è§†å›¾åï¼‰          |
| `@RestController` | `@Controller + @ResponseBody`ç»„åˆ | æ‰€æœ‰æ–¹æ³•é»˜è®¤è¿”å› JSONï¼ˆæˆ–å…¶ä»–å¯¹è±¡ï¼‰å“åº” |

ç¤ºä¾‹å¯¹æ¯”ï¼š

```
@Controller
public class ViewController {
    @GetMapping("/hello")
    public String hello() {
        return "hello"; // è¿”å›é€»è¾‘è§†å›¾åï¼ˆhello.jspï¼‰
    }
}

@RestController
public class ApiController {
    @GetMapping("/hello")
    public String hello() {
        return "Hello JSON"; // è¿”å›å­—ç¬¦ä¸²ï¼ˆJSON å“åº”ä½“ï¼‰
    }
}
```

> ğŸ¯ å®è·µå»ºè®®ï¼š
>
> - Web é¡µé¢å¼€å‘ â†’ ä½¿ç”¨ `@Controller`
> - REST API å¼€å‘ â†’ ä½¿ç”¨ `@RestController`

------

## 2. è¯·æ±‚æ˜ å°„æ³¨è§£è¯¦è§£ï¼š`@RequestMapping`ã€`@GetMapping`ã€`@PostMapping` ç­‰

### @RequestMappingï¼ˆé€šç”¨æ˜ å°„ï¼‰

- å¯ç”¨äºç±»æˆ–æ–¹æ³•çº§åˆ«
- æ”¯æŒè®¾ç½®è·¯å¾„ã€æ–¹æ³•ã€å‚æ•°ã€è¯·æ±‚å¤´ç­‰å±æ€§

```
@RequestMapping(value = "/user", method = RequestMethod.GET)
public String getUser() { ... }
```

### ç®€åŒ–æ˜ å°„æ³¨è§£ï¼ˆæ¨èä½¿ç”¨ï¼‰

- `@GetMapping`ï¼šä»…å¤„ç† GET è¯·æ±‚
- `@PostMapping`ï¼šä»…å¤„ç† POST è¯·æ±‚
- `@PutMapping`ã€`@DeleteMapping`ã€`@PatchMapping`ï¼šç”¨äº REST é£æ ¼æ¥å£

```
@GetMapping("/user/{id}")
public User getUser(@PathVariable Long id) { ... }
```

> âš ï¸ æ³¨æ„ï¼šç±»ä¸Šçš„æ˜ å°„ä¸æ–¹æ³•ä¸Šçš„æ˜ å°„è·¯å¾„ä¼šæ‹¼æ¥å½¢æˆå®Œæ•´çš„è·¯å¾„ã€‚

------

## 3. å‚æ•°ç»‘å®šï¼š`@RequestParam`ã€`@PathVariable`ã€`@RequestBody`ã€`@ModelAttribute`

### `@RequestParam`ï¼šç»‘å®š URL æŸ¥è¯¢å‚æ•°æˆ–è¡¨å•å‚æ•°

```
@GetMapping("/search")
public String search(@RequestParam("q") String query) { ... }
```

- æ”¯æŒé»˜è®¤å€¼ï¼š`@RequestParam(defaultValue = "all")`
- å¯è®¾ä¸ºå¯é€‰ï¼š`required = false`

### `@PathVariable`ï¼šç»‘å®š URL è·¯å¾„å˜é‡

```
@GetMapping("/user/{id}")
public User getUser(@PathVariable Long id) { ... }
```

- è·¯å¾„å˜é‡åå¿…é¡»ä¸ URL åŒ¹é…ï¼Œé™¤éä½¿ç”¨ `@PathVariable("urlName")`

### `@RequestBody`ï¼šç»‘å®šè¯·æ±‚ä½“ï¼ˆä¸€èˆ¬ä¸º JSONï¼‰

```
@PostMapping("/user")
public String createUser(@RequestBody User user) { ... }
```

- éœ€é…ç½® `HttpMessageConverter`ï¼ŒSpring Boot é»˜è®¤æ”¯æŒ JSON è½¬æ¢

### `@ModelAttribute`ï¼šç»‘å®šè¡¨å•å¯¹è±¡ï¼ˆé€‚åˆä¼ ç»Ÿè¡¨å•ï¼‰

```
@PostMapping("/register")
public String register(@ModelAttribute UserForm form) { ... }
```

> ğŸ’¡ å¯¹æ¯”å»ºè®®ï¼š
>
> - æ¥æ”¶è¡¨å•å‚æ•° â†’ `@RequestParam`
> - æ¥æ”¶è·¯å¾„å‚æ•° â†’ `@PathVariable`
> - æ¥æ”¶ JSON â†’ `@RequestBody`
> - æ¥æ”¶å¯¹è±¡å‚æ•°ï¼ˆè¡¨å•ï¼‰â†’ `@ModelAttribute`

------

## 4. å“åº”å¤„ç†ï¼š`@ResponseBody`ã€è¿”å› JSONã€è¿”å›è§†å›¾

### `@ResponseBody`ï¼šå°†è¿”å›å¯¹è±¡å†™å…¥å“åº”ä½“ï¼Œå¸¸ç”¨äº JSON è¾“å‡º

```
@GetMapping("/json")
@ResponseBody
public User getUser() {
    return new User("Tom", 20);
}
```

- Spring Boot ä¸­æ¨èä½¿ç”¨ `@RestController` ä»£æ›¿

### è¿”å›è§†å›¾ï¼ˆé€»è¾‘è§†å›¾åï¼‰

```
@GetMapping("/hello")
public String hello() {
    return "hello"; // ç”± ViewResolver æ¸²æŸ“ hello.jsp
}
```

### è¿”å› ModelAndView

```
@GetMapping("/home")
public ModelAndView home() {
    ModelAndView mv = new ModelAndView("home");
    mv.addObject("name", "Tom");
    return mv;
}
```

### è‡ªå®šä¹‰å“åº”ç»“æ„å»ºè®®

ç»Ÿä¸€è¿”å›æ ¼å¼ï¼š

```
public class ApiResponse<T> {
    private int code;
    private String message;
    private T data;
}
```

------

## 5. æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½å¤„ç†

### æ–‡ä»¶ä¸Šä¼ 

éœ€è¦æ·»åŠ ä¾èµ–å¹¶å¯ç”¨ multipartï¼š

```properties
propertiesspring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=10MB
```

Controller ç¤ºä¾‹ï¼š

```
@PostMapping("/upload")
public String upload(@RequestParam("file") MultipartFile file) throws IOException {
    String filename = file.getOriginalFilename();
    file.transferTo(new File("/uploads/" + filename));
    return "ä¸Šä¼ æˆåŠŸ";
}
```

### æ–‡ä»¶ä¸‹è½½

```
@GetMapping("/download")
public void download(HttpServletResponse response) throws IOException {
    File file = new File("/uploads/example.pdf");
    response.setContentType("application/pdf");
    response.setHeader("Content-Disposition", "attachment;filename=example.pdf");
    Files.copy(file.toPath(), response.getOutputStream());
}
```

> âš ï¸ æ³¨æ„å®‰å…¨ï¼šæ–‡ä»¶ä¸Šä¼ /ä¸‹è½½è¦é˜²æ­¢è·¯å¾„éå†æ¼æ´ã€æ£€æŸ¥ MIME ç±»å‹ã€é™åˆ¶ä¸Šä¼ å¤§å°ã€‚

------

æŠ±æ­‰ï¼Œæˆ‘æ˜ç™½äº†ï¼ä½ å¸Œæœ›æˆ‘æ ¹æ®ä½ æä¾›çš„æ ¼å¼é‡æ–°å†™**ç¬¬å››ç« **çš„å†…å®¹ã€‚æˆ‘ä¼šæŒ‰ç…§ä½ æä¾›çš„æ ¼å¼ç¼–å†™ã€Šå››ã€æ•°æ®ç»‘å®šä¸ç±»å‹è½¬æ¢æœºåˆ¶ã€‹ã€‚ä»¥ä¸‹æ˜¯è°ƒæ•´åçš„å†…å®¹ï¼š

------

# å››ã€æ•°æ®ç»‘å®šä¸ç±»å‹è½¬æ¢æœºåˆ¶

æ•°æ®ç»‘å®šæ˜¯ Spring MVC çš„æ ¸å¿ƒæœºåˆ¶ä¹‹ä¸€ï¼Œå®ƒå…è®¸å°†å®¢æˆ·ç«¯è¯·æ±‚æ•°æ®ï¼ˆå¦‚è¡¨å•æ•°æ®ã€æŸ¥è¯¢å‚æ•°ç­‰ï¼‰ä¸æœåŠ¡å™¨ç«¯çš„å¯¹è±¡è¿›è¡Œç»‘å®šã€‚æœ¬ç« å°†ä»‹ç» Spring MVC ä¸­çš„å±æ€§ç»‘å®šæœºåˆ¶ã€ç±»å‹è½¬æ¢å™¨çš„ä½¿ç”¨ä»¥åŠå¦‚ä½•è¿›è¡Œè¡¨å•å¯¹è±¡ç»‘å®šä¸éªŒè¯ã€‚

------

## 1. å±æ€§ç»‘å®šçš„åº•å±‚æœºåˆ¶ï¼š`WebDataBinder`

Spring MVC ä¸­ï¼Œæ•°æ®ç»‘å®šçš„åº•å±‚ç”± `WebDataBinder` å®Œæˆã€‚å®ƒè´Ÿè´£å°†è¯·æ±‚å‚æ•°ä¸ Java å¯¹è±¡å±æ€§è¿›è¡Œç»‘å®šï¼Œå¹¶æ‰§è¡Œç±»å‹è½¬æ¢ã€æ•°æ®éªŒè¯ç­‰æ“ä½œã€‚

### `WebDataBinder` æ ¸å¿ƒåŠŸèƒ½ï¼š

- **å±æ€§ç»‘å®š**ï¼šå°† HTTP è¯·æ±‚ä¸­çš„å‚æ•°æ˜ å°„åˆ° Java Bean å±æ€§ã€‚
- **ç±»å‹è½¬æ¢**ï¼šè‡ªåŠ¨å°†è¯·æ±‚ä¸­çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºæŒ‡å®šç±»å‹ï¼ˆå¦‚æ—¥æœŸã€æ•°å­—ç­‰ï¼‰ã€‚
- **æ•°æ®éªŒè¯**ï¼šåœ¨ç»‘å®šè¿‡ç¨‹ä¸­è§¦å‘éªŒè¯è§„åˆ™ï¼Œç¡®ä¿æ•°æ®çš„æœ‰æ•ˆæ€§ã€‚

```java
@InitBinder
public void initBinder(WebDataBinder binder) {
    binder.addValidators(new MyValidator());
}
```

> ğŸ¯ å®è·µå»ºè®®ï¼š
>
> - ä½¿ç”¨ `@InitBinder` å®šåˆ¶æ•°æ®ç»‘å®šè¡Œä¸ºã€‚
> - ä½¿ç”¨è‡ªå®šä¹‰è½¬æ¢å™¨ã€éªŒè¯å™¨æé«˜çµæ´»æ€§ã€‚

------

## 2. è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨ï¼š`Converter`ã€`Formatter`

Spring æä¾›äº† `Converter` å’Œ `Formatter` æ¥å£ï¼Œç”¨äºè‡ªå®šä¹‰ç±»å‹è½¬æ¢é€»è¾‘ã€‚`Converter` ç”¨äºä¸¤ç§ç±»å‹ä¹‹é—´çš„è½¬æ¢ï¼Œè€Œ `Formatter` æä¾›äº†æ›´ä¸°å¯Œçš„æ ¼å¼åŒ–åŠŸèƒ½ã€‚

### `Converter` æ¥å£

`Converter<S, T>` æ¥å£ç”¨äºå®šä¹‰ä»ç±»å‹ S åˆ°ç±»å‹ T çš„è½¬æ¢ã€‚é€šå¸¸ç”¨äºç®€å•çš„æ•°æ®ç±»å‹è½¬æ¢ã€‚

```java
@Component
public class StringToDateConverter implements Converter<String, Date> {
    @Override
    public Date convert(String source) {
        try {
            return new SimpleDateFormat("yyyy-MM-dd").parse(source);
        } catch (ParseException e) {
            return null;
        }
    }
}
```

### `Formatter` æ¥å£

`Formatter` æä¾›äº†æ›´å¤æ‚çš„æ ¼å¼åŒ–åŠŸèƒ½ï¼Œé€‚ç”¨äºç‰¹å®šç±»å‹ï¼ˆå¦‚æ—¥æœŸã€è´§å¸ç­‰ï¼‰çš„è½¬æ¢ã€‚

```java
@Component
public class DateFormatter implements Formatter<Date> {
    private final SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd");

    @Override
    public Date parse(String text, Locale locale) throws ParseException {
        return dateFormat.parse(text);
    }

    @Override
    public String print(Date object, Locale locale) {
        return dateFormat.format(object);
    }
}
```

> ğŸ’¡ å¯¹æ¯”å»ºè®®ï¼š
>
> - ç®€å•ç±»å‹è½¬æ¢ â†’ ä½¿ç”¨ `Converter`
> - éœ€è¦æ ¼å¼åŒ–çš„å¤æ‚ç±»å‹è½¬æ¢ â†’ ä½¿ç”¨ `Formatter`

------

## 3. è¡¨å•å¯¹è±¡ç»‘å®šä¸éªŒè¯æµç¨‹

åœ¨ Spring MVC ä¸­ï¼Œè¡¨å•å¯¹è±¡ï¼ˆå³æ¥æ”¶è¡¨å•æäº¤çš„ Java ç±»ï¼‰é€šå¸¸é€šè¿‡ `@ModelAttribute` è¿›è¡Œç»‘å®šã€‚Spring ä¼šè‡ªåŠ¨å¡«å……è¡¨å•å­—æ®µåˆ°è¡¨å•å¯¹è±¡çš„å±æ€§ä¸­ï¼Œå¹¶è¿›è¡Œæ•°æ®éªŒè¯ã€‚

### è¡¨å•å¯¹è±¡ç»‘å®šç¤ºä¾‹ï¼š

```java
@PostMapping("/register")
public String register(@ModelAttribute UserForm form) {
    // ç»‘å®šè¡¨å•æ•°æ®åˆ° UserForm å¯¹è±¡
    return "registrationSuccess";
}
```

### æ•°æ®éªŒè¯ï¼š

Spring æ”¯æŒä½¿ç”¨ JSR-303/JSR-380 æ³¨è§£ï¼ˆå¦‚ `@NotNull`ã€`@Size` ç­‰ï¼‰è¿›è¡Œæ•°æ®éªŒè¯ã€‚éªŒè¯é”™è¯¯å°†é€šè¿‡ `BindingResult` å¯¹è±¡è¿”å›ã€‚

```java
public class UserForm {
    @NotNull
    @Size(min = 5, max = 15)
    private String username;
    
    @NotNull
    private String password;
}

@PostMapping("/register")
public String register(@ModelAttribute @Valid UserForm form, BindingResult result) {
    if (result.hasErrors()) {
        return "registrationForm"; // è¿”å›è¡¨å•é¡µé¢ï¼Œæ˜¾ç¤ºéªŒè¯é”™è¯¯
    }
    return "registrationSuccess";
}
```

> ğŸ¯ å®è·µå»ºè®®ï¼š
>
> - ä½¿ç”¨ `@Valid` å’Œ `BindingResult` ç»“åˆè¿›è¡Œè¡¨å•éªŒè¯ã€‚
> - ä½¿ç”¨è‡ªå®šä¹‰éªŒè¯å™¨æä¾›æ›´å¤æ‚çš„éªŒè¯é€»è¾‘ã€‚

------

## 4. `@Valid`ã€`@Validated` ä¸å¼‚å¸¸å¤„ç†è”åŠ¨

`@Valid` å’Œ `@Validated` æ˜¯ç”¨äºè§¦å‘å¯¹è±¡éªŒè¯çš„æ³¨è§£ã€‚åœ¨ Spring MVC ä¸­ï¼Œå®ƒä»¬é€šå¸¸ä¸ `BindingResult` é…åˆä½¿ç”¨ï¼Œç”¨äºéªŒè¯è¡¨å•å¯¹è±¡ä¸­çš„æ•°æ®ã€‚å¦‚æœéªŒè¯å¤±è´¥ï¼ŒSpring ä¼šè¿”å›å¯¹åº”çš„é”™è¯¯ä¿¡æ¯ã€‚

### `@Valid` ä¸ `@Validated`ï¼š

- `@Valid` ç”¨äºè§¦å‘å¯¹è±¡çš„æ ¡éªŒã€‚
- `@Validated` æ˜¯ Spring æä¾›çš„æ›´å¼ºå¤§çš„éªŒè¯æ³¨è§£ï¼Œå…è®¸æŒ‰ç…§ä¸åŒçš„ç»„è¿›è¡ŒéªŒè¯ã€‚

```java
public class UserForm {
    @NotNull
    private String username;

    @NotNull
    private String password;
}

@PostMapping("/register")
public String register(@Valid UserForm form, BindingResult result) {
    if (result.hasErrors()) {
        return "registrationForm";
    }
    return "registrationSuccess";
}
```

### å¼‚å¸¸å¤„ç†è”åŠ¨ï¼š

Spring è¿˜æä¾›äº†å…¨å±€å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œé€šè¿‡ `@ControllerAdvice` é…åˆ `@ExceptionHandler` å¤„ç†éªŒè¯å¤±è´¥çš„å¼‚å¸¸ã€‚

```java
@ControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity<String> handleValidationExceptions(MethodArgumentNotValidException ex) {
        String errorMessage = ex.getBindingResult()
                                  .getFieldErrors()
                                  .stream()
                                  .map(fieldError -> fieldError.getField() + ": " + fieldError.getDefaultMessage())
                                  .collect(Collectors.joining(", "));
        return new ResponseEntity<>(errorMessage, HttpStatus.BAD_REQUEST);
    }
}
```

> ğŸ’¡ å¼‚å¸¸å¤„ç†å»ºè®®ï¼š
>
> - ä½¿ç”¨ `@Valid` æˆ– `@Validated` å®ç°è¡¨å•éªŒè¯ã€‚
> - é…åˆ `BindingResult` å¤„ç†è¡¨å•é”™è¯¯ã€‚
> - ä½¿ç”¨ `@ControllerAdvice` å…¨å±€å¤„ç†éªŒè¯å¤±è´¥çš„å¼‚å¸¸ã€‚

------

# äº”ã€å¼‚å¸¸å¤„ç†æœºåˆ¶

åœ¨å¼€å‘ Web åº”ç”¨æ—¶ï¼Œå¼‚å¸¸å¤„ç†æ˜¯ä¸å¯é¿å…çš„ï¼ŒSpring MVC æä¾›äº†å¤šç§æ–¹å¼æ¥å¤„ç†ä¸åŒå±‚æ¬¡çš„å¼‚å¸¸ã€‚æœ¬ç« å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨å±€éƒ¨å’Œå…¨å±€å¼‚å¸¸å¤„ç†æœºåˆ¶æ¥å¤„ç†è¯·æ±‚ä¸­çš„å¼‚å¸¸ï¼Œå¹¶é€šè¿‡è‡ªå®šä¹‰å¼‚å¸¸å“åº”ç»“æ„å®ç°ç»Ÿä¸€çš„å¼‚å¸¸å°è£…ã€‚

------

## 1. å±€éƒ¨å¼‚å¸¸å¤„ç†ï¼š`@ExceptionHandler`

`@ExceptionHandler` æ³¨è§£å…è®¸åœ¨æ§åˆ¶å™¨å†…å±€éƒ¨å¤„ç†ç‰¹å®šç±»å‹çš„å¼‚å¸¸ã€‚å½“æ–¹æ³•å‚æ•°ä¸­æœ‰å¼‚å¸¸ç±»å‹æ—¶ï¼ŒSpring ä¼šè‡ªåŠ¨è°ƒç”¨ç›¸åº”çš„å¼‚å¸¸å¤„ç†æ–¹æ³•ã€‚é€šå¸¸ç”¨äºå¤„ç†ä¸è¯¥æ§åˆ¶å™¨æ–¹æ³•ç›¸å…³çš„å¼‚å¸¸ã€‚

### ç¤ºä¾‹ï¼š

```java
@Controller
public class UserController {

    @GetMapping("/user/{id}")
    public String getUser(@PathVariable Long id) {
        if (id < 0) {
            throw new IllegalArgumentException("ID cannot be negative");
        }
        return "user";
    }

    @ExceptionHandler(IllegalArgumentException.class)
    public String handleIllegalArgumentException(IllegalArgumentException ex, Model model) {
        model.addAttribute("error", ex.getMessage());
        return "errorPage";
    }
}
```

> ğŸ¯ å®è·µå»ºè®®ï¼š
>
> - å±€éƒ¨å¼‚å¸¸å¤„ç†é€‚ç”¨äºæ§åˆ¶å™¨ä¸­èƒ½å¤Ÿé¢„è§çš„å¼‚å¸¸ï¼Œå¦‚ä¸šåŠ¡é€»è¾‘ç›¸å…³çš„éªŒè¯ã€‚
> - æ§åˆ¶å™¨çº§åˆ«çš„å¼‚å¸¸å¤„ç†å¯ä»¥è®©ä¸åŒæ§åˆ¶å™¨æœ‰ç‹¬ç«‹çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚

------

## 2. å…¨å±€å¼‚å¸¸å¤„ç†ï¼š`@ControllerAdvice`

`@ControllerAdvice` æä¾›äº†å…¨å±€å¼‚å¸¸å¤„ç†åŠŸèƒ½ã€‚å®ƒå…è®¸åœ¨åº”ç”¨ç¨‹åºä¸­é›†ä¸­å¤„ç†ä¸åŒæ§åˆ¶å™¨çš„å¼‚å¸¸ï¼Œå¯ä»¥é¿å…åœ¨æ¯ä¸ªæ§åˆ¶å™¨ä¸­é‡å¤ç¼–å†™å¼‚å¸¸å¤„ç†ä»£ç ã€‚

### ç¤ºä¾‹ï¼š

```java
@ControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(IllegalArgumentException.class)
    public ResponseEntity<String> handleIllegalArgumentException(IllegalArgumentException ex) {
        return new ResponseEntity<>("Invalid input: " + ex.getMessage(), HttpStatus.BAD_REQUEST);
    }

    @ExceptionHandler(Exception.class)
    public ResponseEntity<String> handleGeneralException(Exception ex) {
        return new ResponseEntity<>("An error occurred: " + ex.getMessage(), HttpStatus.INTERNAL_SERVER_ERROR);
    }
}
```

### `@ControllerAdvice` çš„ä½œç”¨ï¼š

- `@ExceptionHandler`ï¼šå¤„ç†ä¸åŒç±»å‹çš„å¼‚å¸¸ã€‚
- `@ModelAttribute`ï¼šä¸ºæ‰€æœ‰æ§åˆ¶å™¨æä¾›å…¬å…±æ•°æ®ï¼ˆå¦‚å…¨å±€å˜é‡ã€å±æ€§ï¼‰ã€‚
- `@InitBinder`ï¼šä¸ºæ‰€æœ‰æ§åˆ¶å™¨æä¾›æ•°æ®ç»‘å®šè®¾ç½®ã€‚

> ğŸ’¡ ä½¿ç”¨åœºæ™¯ï¼š
>
> - `@ControllerAdvice` æ˜¯å¤„ç†å…¨å±€å¼‚å¸¸çš„æœ€ä½³å®è·µï¼Œé€‚ç”¨äºéœ€è¦é›†ä¸­å¤„ç†æ‰€æœ‰å¼‚å¸¸æˆ–ä¸ä¸šåŠ¡é€»è¾‘æ— å…³çš„å¼‚å¸¸ã€‚

------

## 3. å¼‚å¸¸å“åº”æ ¼å¼è®¾è®¡ä¸ç»Ÿä¸€å°è£…

ä¸ºäº†ä¿æŒä¸€è‡´çš„å¼‚å¸¸å“åº”æ ¼å¼ï¼Œé€šå¸¸ä¼šè®¾è®¡ä¸€ä¸ªç»Ÿä¸€çš„å“åº”æ ¼å¼ã€‚è¿™æ ·åšæœ‰åŠ©äºå‰ç«¯è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼Œå¹¶èƒ½åœ¨ API æ¥å£ä¸­æä¾›ç»Ÿä¸€çš„é”™è¯¯ä¿¡æ¯ã€‚

### ç¤ºä¾‹ï¼š

ç»Ÿä¸€å“åº”æ ¼å¼ï¼š

```java
public class ApiResponse<T> {
    private int status;
    private String message;
    private T data;

    // getters and setters
}
```

å…¨å±€å¼‚å¸¸å¤„ç†è¿”å›ç»Ÿä¸€å“åº”æ ¼å¼ï¼š

```java
@ControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(IllegalArgumentException.class)
    public ResponseEntity<ApiResponse<String>> handleIllegalArgumentException(IllegalArgumentException ex) {
        ApiResponse<String> response = new ApiResponse<>();
        response.setStatus(HttpStatus.BAD_REQUEST.value());
        response.setMessage(ex.getMessage());
        response.setData(null);
        return new ResponseEntity<>(response, HttpStatus.BAD_REQUEST);
    }

    @ExceptionHandler(Exception.class)
    public ResponseEntity<ApiResponse<String>> handleGeneralException(Exception ex) {
        ApiResponse<String> response = new ApiResponse<>();
        response.setStatus(HttpStatus.INTERNAL_SERVER_ERROR.value());
        response.setMessage("An error occurred: " + ex.getMessage());
        response.setData(null);
        return new ResponseEntity<>(response, HttpStatus.INTERNAL_SERVER_ERROR);
    }
}
```

> ğŸ’¡ å®è·µå»ºè®®ï¼š
>
> - ç»Ÿä¸€å¼‚å¸¸å“åº”æ ¼å¼æœ‰åŠ©äºå‰åç«¯åä½œï¼Œå‡å°‘å› å¼‚å¸¸å“åº”æ ¼å¼ä¸ä¸€è‡´å¯¼è‡´çš„å¼€å‘é—®é¢˜ã€‚
> - å®šä¹‰ `ApiResponse` ç±»è¿›è¡Œå“åº”å°è£…æ˜¯å¤„ç† API å¼‚å¸¸çš„è‰¯å¥½åšæ³•ã€‚

------

## 4. è‡ªå®šä¹‰å¼‚å¸¸ç»“æ„çš„è®¾è®¡å®è·µ

è‡ªå®šä¹‰å¼‚å¸¸ç»“æ„æœ‰åŠ©äºæ ¹æ®ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚è¿”å›æ›´æœ‰æ„ä¹‰çš„é”™è¯¯ä¿¡æ¯ã€‚é€šè¿‡è‡ªå®šä¹‰å¼‚å¸¸ç±»å’Œå“åº”å¯¹è±¡ï¼Œèƒ½å¤Ÿæä¾›æ›´åŠ è¯¦ç»†å’Œå‡†ç¡®çš„é”™è¯¯åé¦ˆã€‚

### è‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼š

```java
public class CustomException extends RuntimeException {
    private int code;
    private String details;

    public CustomException(int code, String details) {
        super(details);
        this.code = code;
        this.details = details;
    }

    public int getCode() {
        return code;
    }

    public String getDetails() {
        return details;
    }
}
```

### å…¨å±€å¼‚å¸¸å¤„ç†ä¸­çš„è‡ªå®šä¹‰å¼‚å¸¸ï¼š

```java
@ControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(CustomException.class)
    public ResponseEntity<ApiResponse<String>> handleCustomException(CustomException ex) {
        ApiResponse<String> response = new ApiResponse<>();
        response.setStatus(ex.getCode());
        response.setMessage(ex.getDetails());
        response.setData(null);
        return new ResponseEntity<>(response, HttpStatus.valueOf(ex.getCode()));
    }
}
```

> ğŸ¯ å®è·µå»ºè®®ï¼š
>
> - åœ¨ä¸šåŠ¡é€»è¾‘ä¸­æ ¹æ®éœ€è¦æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸ï¼Œä¾¿äºä¼ é€’è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ã€‚
> - è‡ªå®šä¹‰å¼‚å¸¸ç»“æ„æœ‰åŠ©äºæä¾›æ›´é«˜å±‚æ¬¡çš„é”™è¯¯ä¿¡æ¯å°è£…ï¼Œå¢å¼ºé”™è¯¯ä¿¡æ¯çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

------

é€šè¿‡ä»¥ä¸Šæ–¹å¼ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨ Spring MVC ä¸­ä¼˜é›…åœ°å¤„ç†å¼‚å¸¸ï¼Œä¸ä»…èƒ½æä¾›å±€éƒ¨å’Œå…¨å±€çš„å¼‚å¸¸å¤„ç†ï¼Œè¿˜èƒ½é€šè¿‡ç»Ÿä¸€çš„å¼‚å¸¸å“åº”æ ¼å¼ï¼Œæå‡å¼‚å¸¸å¤„ç†çš„è§„èŒƒæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚åŒæ—¶ï¼Œå€ŸåŠ©è‡ªå®šä¹‰å¼‚å¸¸ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä¸åŒä¸šåŠ¡åœºæ™¯è®¾è®¡ä¸“é—¨çš„é”™è¯¯åé¦ˆï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚

# å…­ã€è§†å›¾è§£æä¸æ¨¡æ¿å¼•æ“

åœ¨ Spring MVC ä¸­ï¼Œè§†å›¾è§£æå’Œæ¨¡æ¿å¼•æ“æ˜¯å±•ç¤ºå±‚çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚è§†å›¾è§£ææœºåˆ¶å†³å®šäº†å¦‚ä½•å°†åç«¯æ•°æ®æ¸²æŸ“æˆå‰ç«¯é¡µé¢ï¼Œè€Œæ¨¡æ¿å¼•æ“åˆ™ç”¨äºç”ŸæˆåŠ¨æ€ç½‘é¡µã€‚æœ¬ç« å°†ä»‹ç» Spring MVC è§†å›¾è§£æçš„åŸç†ï¼Œå¹¶æ·±å…¥æ¢è®¨å¸¸ç”¨çš„æ¨¡æ¿å¼•æ“å’Œè§†å›¾ä¸æ•°æ®æ¨¡å‹çš„äº¤äº’æ–¹å¼ã€‚

------

## 1. Spring MVC è§†å›¾è§£ææœºåˆ¶åŸç†

Spring MVC çš„è§†å›¾è§£ææœºåˆ¶ä¸»è¦æ¶‰åŠ `DispatcherServlet` ä¸ `ViewResolver` çš„äº¤äº’ã€‚`DispatcherServlet` åœ¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä¼šæ ¹æ®è¯·æ±‚ä¿¡æ¯é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„è§†å›¾ï¼Œå¹¶å°†æ¨¡å‹æ•°æ®ä¼ é€’ç»™è¯¥è§†å›¾ã€‚`ViewResolver` è´Ÿè´£è§£æè§†å›¾åç§°ï¼Œå¹¶å°†å…¶æ˜ å°„åˆ°å®é™…çš„è§†å›¾å¯¹è±¡ï¼ˆå¦‚ JSPã€Thymeleaf æ¨¡æ¿ç­‰ï¼‰ã€‚

### è§†å›¾è§£ææµç¨‹ï¼š

1. **è¯·æ±‚å¤„ç†**ï¼š`DispatcherServlet` æ ¹æ®è¯·æ±‚æ‰¾åˆ°ç›¸åº”çš„æ§åˆ¶å™¨æ–¹æ³•å¹¶æ‰§è¡Œã€‚
2. **è¿”å›è§†å›¾åç§°**ï¼šæ§åˆ¶å™¨æ–¹æ³•è¿”å›è§†å›¾çš„é€»è¾‘åç§°ï¼ˆä¾‹å¦‚ "home"ï¼‰ã€‚
3. **è§†å›¾è§£æ**ï¼š`DispatcherServlet` è°ƒç”¨ `ViewResolver` æ¥è§£æè§†å›¾åç§°ï¼Œå¹¶æ‰¾åˆ°å…·ä½“çš„è§†å›¾å®ç°ï¼ˆå¦‚ JSP æ–‡ä»¶ã€Thymeleaf æ¨¡æ¿ç­‰ï¼‰ã€‚
4. **æ¸²æŸ“è§†å›¾**ï¼šè§†å›¾å°†æ¨¡å‹æ•°æ®ä¸æ¨¡æ¿ç»“åˆï¼Œç”Ÿæˆ HTML å†…å®¹å¹¶è¿”å›å®¢æˆ·ç«¯ã€‚

### ç¤ºä¾‹ï¼š

```java
@Controller
public class HomeController {

    @GetMapping("/home")
    public String home(Model model) {
        model.addAttribute("message", "Welcome to Spring MVC!");
        return "home";  // è¿”å›é€»è¾‘è§†å›¾å
    }
}
```

- åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`home` æ˜¯é€»è¾‘è§†å›¾åï¼Œ`ViewResolver` ä¼šæ ¹æ®é…ç½®çš„è§†å›¾è§£æå™¨æ‰¾åˆ°ç›¸åº”çš„è§†å›¾æ–‡ä»¶ï¼ˆå¦‚ JSP æ–‡ä»¶æˆ– Thymeleaf æ¨¡æ¿ï¼‰ã€‚

------

## 2. å¸¸ç”¨æ¨¡æ¿å¼•æ“ï¼šThymeleafã€Freemarkerã€JSP

Spring MVC æ”¯æŒå¤šç§æ¨¡æ¿å¼•æ“ï¼Œå¸¸ç”¨çš„æœ‰ Thymeleafã€Freemarker å’Œ JSPã€‚æ¯ç§æ¨¡æ¿å¼•æ“æœ‰ä¸åŒçš„ä¼˜åŠ¿å’Œä½¿ç”¨åœºæ™¯ã€‚

### 2.1 Thymeleaf

Thymeleaf æ˜¯ä¸€ç§ç°ä»£åŒ–çš„æ¨¡æ¿å¼•æ“ï¼Œä¸“æ³¨äº Web åº”ç”¨çš„è§†å›¾æ¸²æŸ“ï¼Œå…·æœ‰ç®€å•çš„è¯­æ³•å’Œå¼ºå¤§çš„åŠŸèƒ½ï¼Œå°¤å…¶é€‚ç”¨äº Spring Boot é¡¹ç›®ã€‚Thymeleaf çš„æ¨¡æ¿æ–‡ä»¶å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ï¼Œæ— éœ€åç«¯æ¸²æŸ“ï¼Œæ˜¯ç›®å‰æœ€æ¨èä½¿ç”¨çš„æ¨¡æ¿å¼•æ“ã€‚

#### é…ç½® Thymeleafï¼š

```java
@Configuration
public class ThymeleafConfig {

    @Bean
    public SpringTemplateEngine templateEngine() {
        SpringTemplateEngine engine = new SpringTemplateEngine();
        engine.setTemplateResolver(templateResolver());
        return engine;
    }

    @Bean
    public ITemplateResolver templateResolver() {
        ClassLoaderTemplateResolver resolver = new ClassLoaderTemplateResolver();
        resolver.setPrefix("classpath:/templates/");
        resolver.setSuffix(".html");
        resolver.setTemplateMode("HTML5");
        return resolver;
    }
}
```

#### ç¤ºä¾‹ï¼š

```html
<!-- home.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Welcome</title>
</head>
<body>
    <h1 th:text="${message}"></h1>
</body>
</html>
```

- åœ¨æ§åˆ¶å™¨ä¸­ï¼Œå°† `Model` ä¸­çš„ `message` æ•°æ®æ¸²æŸ“åˆ°é¡µé¢ä¸­ã€‚

### 2.2 Freemarker

Freemarker æ˜¯ä¸€ç§åŠŸèƒ½å¼ºå¤§çš„æ¨¡æ¿å¼•æ“ï¼Œé€šå¸¸ç”¨äºå¤„ç†åŠ¨æ€ç”Ÿæˆçš„æ–‡æœ¬ï¼Œå¦‚ HTMLã€XMLã€é‚®ä»¶ç­‰ã€‚Freemarker æ”¯æŒå¤æ‚çš„æ¨¡æ¿é€»è¾‘å’Œè¾ƒä¸ºä¸°å¯Œçš„è¯­æ³•ï¼Œä½†ä¸ Thymeleaf ç›¸æ¯”ï¼Œå®ƒçš„è¯­æ³•ç¨æ˜¾å¤æ‚ã€‚

#### é…ç½® Freemarkerï¼š

```java
@Configuration
public class FreemarkerConfig {

    @Bean
    public freemarker.template.Configuration freemarkerConfiguration() {
        freemarker.template.Configuration configuration = new freemarker.template.Configuration(freemarker.template.Configuration.VERSION_2_3_29);
        configuration.setClassForTemplateLoading(this.getClass(), "/templates/");
        return configuration;
    }
}
```

#### ç¤ºä¾‹ï¼š

```html
<!-- home.ftl -->
<!DOCTYPE html>
<html>
<head>
    <title>Welcome</title>
</head>
<body>
    <h1>${message}</h1>
</body>
</html>
```

- ä¸ Thymeleaf ç›¸ä¼¼ï¼ŒFreemarker æ¨¡æ¿ä¹Ÿå¯ä»¥ä½¿ç”¨ `Model` ä¸­çš„å±æ€§è¿›è¡ŒåŠ¨æ€æ¸²æŸ“ã€‚

### 2.3 JSP

JSPï¼ˆJavaServer Pagesï¼‰æ˜¯ Java Web å¼€å‘çš„ä¼ ç»ŸæŠ€æœ¯ï¼Œè™½ç„¶è¢« Thymeleaf å’Œ Freemarker æ›¿ä»£çš„è¶‹åŠ¿é€æ¸å¢å¼ºï¼Œä½†ä»ç„¶è¢«ä¸€äº›è€æ—§çš„é¡¹ç›®ä½¿ç”¨ã€‚JSP æ–‡ä»¶ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šç¼–è¯‘æˆ Servlets å¹¶æ¸²æŸ“ã€‚

#### é…ç½® JSPï¼š

```java
@Configuration
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void configureViewResolvers(ViewResolverRegistry registry) {
        registry.jsp("/WEB-INF/views/", ".jsp");
    }
}
```

#### ç¤ºä¾‹ï¼š

```jsp
<!-- home.jsp -->
<!DOCTYPE html>
<html>
<head>
    <title>Welcome</title>
</head>
<body>
    <h1>${message}</h1>
</body>
</html>
```

> ğŸ¯ å®è·µå»ºè®®ï¼š
>
> - å¯¹äºæ–°çš„ Spring é¡¹ç›®ï¼Œæ¨èä½¿ç”¨ Thymeleaf ä½œä¸ºæ¨¡æ¿å¼•æ“ï¼Œå®ƒä¸ Spring çš„é›†æˆéå¸¸å¥½ï¼Œä¸”æ”¯æŒç°ä»£åŒ–çš„ Web å¼€å‘ã€‚
> - å¯¹äºä¼ ç»Ÿé¡¹ç›®ï¼ŒFreemarker å’Œ JSP ä»ç„¶æ˜¯æœ‰æ•ˆçš„é€‰æ‹©ï¼Œå°¤å…¶æ˜¯åœ¨ä¸€äº›å¤§å‹ä¼ä¸šçº§åº”ç”¨ä¸­ã€‚

------

## 3. è§†å›¾ä¸æ•°æ®æ¨¡å‹çš„äº¤äº’ï¼š`Model`ã€`ModelAndView`

åœ¨ Spring MVC ä¸­ï¼Œæ§åˆ¶å™¨æ–¹æ³•é€šå¸¸è¿”å› `Model` æˆ– `ModelAndView` å¯¹è±¡ï¼Œè´Ÿè´£å°†æ•°æ®ä¼ é€’ç»™è§†å›¾ã€‚

### 3.1 `Model` æ¥å£

`Model` æ˜¯ä¸€ä¸ªç®€å•çš„å®¹å™¨ï¼Œå­˜å‚¨ä¼ é€’ç»™è§†å›¾çš„æ•°æ®ã€‚æ§åˆ¶å™¨æ–¹æ³•é€šè¿‡å‘ `Model` æ·»åŠ å±æ€§æ¥å°†æ•°æ®ä¼ é€’ç»™è§†å›¾ã€‚

#### ç¤ºä¾‹ï¼š

```java
@Controller
public class HomeController {

    @GetMapping("/home")
    public String home(Model model) {
        model.addAttribute("message", "Welcome to Spring MVC!");
        return "home";  // è¿”å›é€»è¾‘è§†å›¾å
    }
}
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ`Model` ç”¨äºå°† `message` æ•°æ®ä¼ é€’ç»™è§†å›¾ã€‚

### 3.2 `ModelAndView` ç±»

`ModelAndView` æ˜¯ Spring MVC ä¸­æ›´å¤æ‚çš„è§†å›¾å’Œæ•°æ®æ¨¡å‹äº¤äº’æ–¹å¼ï¼Œæ—¢å¯ä»¥ä¼ é€’æ•°æ®æ¨¡å‹ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šè§†å›¾åã€‚

#### ç¤ºä¾‹ï¼š

```java
@Controller
public class HomeController {

    @GetMapping("/home")
    public ModelAndView home() {
        ModelAndView mv = new ModelAndView("home");
        mv.addObject("message", "Welcome to Spring MVC!");
        return mv;  // è¿”å› ModelAndView å¯¹è±¡
    }
}
```

`ModelAndView` å¯¹è±¡åŒ…å«äº†è§†å›¾åå’Œæ•°æ®ï¼Œå¯ä»¥çµæ´»åœ°å°†æ•°æ®ä¸è§†å›¾ä¸€èµ·ä¼ é€’ã€‚

------

## æ€»ç»“

Spring MVC çš„è§†å›¾è§£ææœºåˆ¶é€šè¿‡ `ViewResolver` å®Œæˆè§†å›¾åç§°ä¸è§†å›¾å®ç°çš„æ˜ å°„ï¼Œæ”¯æŒå¤šç§æ¨¡æ¿å¼•æ“ï¼Œå¦‚ Thymeleafã€Freemarker å’Œ JSPã€‚`Model` å’Œ `ModelAndView` ä½œä¸ºæ•°æ®ä¸è§†å›¾äº¤äº’çš„æ–¹å¼ï¼Œæä¾›äº†çµæ´»çš„è§£å†³æ–¹æ¡ˆï¼Œå¸®åŠ©å¼€å‘è€…å°†æ•°æ®åŠ¨æ€æ¸²æŸ“åˆ°é¡µé¢ä¸­ã€‚é€šè¿‡åˆç†é€‰æ‹©æ¨¡æ¿å¼•æ“å’Œè§†å›¾äº¤äº’æ–¹å¼ï¼Œå¯ä»¥å®ç°é«˜æ•ˆã€å¯ç»´æŠ¤çš„è§†å›¾æ¸²æŸ“ã€‚

# ä¸ƒã€æ‹¦æˆªå™¨ä¸è¿‡æ»¤å™¨æœºåˆ¶

åœ¨ Spring MVC ä¸­ï¼Œæ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰å’Œè¿‡æ»¤å™¨ï¼ˆFilterï¼‰ç”¨äºå¤„ç†è¯·æ±‚å’Œå“åº”ï¼Œèƒ½å¤Ÿåœ¨è¯·æ±‚å¤„ç†çš„ä¸åŒé˜¶æ®µæ‰§è¡Œè‡ªå®šä¹‰æ“ä½œã€‚ä¸¤è€…è™½ç„¶çœ‹ä¼¼ç›¸ä¼¼ï¼Œä½†å®ƒä»¬çš„ä½œç”¨èŒƒå›´ã€åº”ç”¨åœºæ™¯å’Œå®ç°æ–¹å¼æœ‰æ‰€ä¸åŒã€‚æœ¬ç« å°†è¯¦ç»†è®²è§£æ‹¦æˆªå™¨ä¸è¿‡æ»¤å™¨çš„åŒºåˆ«ã€ä½¿ç”¨æ–¹å¼åŠå…¶å¸¸è§åº”ç”¨åœºæ™¯ã€‚

------

## 1. æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰ä¸ Filter çš„åŒºåˆ«ä¸åº”ç”¨åœºæ™¯

### 1.1 æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰

- **ä½œç”¨èŒƒå›´**ï¼šæ‹¦æˆªå™¨æ˜¯ Spring MVC ç‰¹æœ‰çš„ç»„ä»¶ï¼Œä¸»è¦ç”¨äºå¤„ç†è¯·æ±‚å’Œå“åº”çš„å¤„ç†é“¾ä¸­ã€‚å®ƒå¯ä»¥æ‹¦æˆª Controller æ–¹æ³•çš„æ‰§è¡Œï¼Œé€‚ç”¨äºä¸šåŠ¡é€»è¾‘å¤„ç†é˜¶æ®µã€‚
- **å·¥ä½œæ—¶æœº**ï¼šæ‹¦æˆªå™¨å·¥ä½œåœ¨ Spring MVC çš„ DispatcherServlet ä¹‹å‰å’Œä¹‹åï¼Œèƒ½å¤Ÿåœ¨å¤„ç†è¯·æ±‚æ—¶åšä¸€äº›å¤„ç†ï¼Œä¹Ÿå¯ä»¥åœ¨å“åº”è¿”å›å‰åšä¸€äº›é¢å¤–çš„æ“ä½œã€‚
- **æ”¯æŒæ¨¡å‹æ•°æ®**ï¼šæ‹¦æˆªå™¨å¯ä»¥è®¿é—® Spring MVC çš„ `ModelAndView` å¯¹è±¡ï¼Œé€‚åˆç”¨äºå¤„ç†è§†å›¾å’Œæ¨¡å‹æ•°æ®ã€‚
- **é…ç½®æ–¹å¼**ï¼šæ‹¦æˆªå™¨æ˜¯åŸºäº Spring é…ç½®çš„ï¼Œéœ€è¦å®ç° `HandlerInterceptor` æ¥å£å¹¶æ³¨å†Œåˆ° Spring MVC çš„é…ç½®ä¸­ã€‚

#### åº”ç”¨åœºæ™¯ï¼š

- æƒé™æ ¡éªŒ
- ç»Ÿä¸€æ—¥å¿—è®°å½•
- æ€§èƒ½ç›‘æ§
- è¯·æ±‚å’Œå“åº”çš„æ•°æ®å¤„ç†

### 1.2 è¿‡æ»¤å™¨ï¼ˆFilterï¼‰

- **ä½œç”¨èŒƒå›´**ï¼šè¿‡æ»¤å™¨æ˜¯ Servlet è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥å¯¹ HTTP è¯·æ±‚å’Œå“åº”åšå‰å¤„ç†å’Œåå¤„ç†ï¼Œé€‚ç”¨äºæ‰€æœ‰çš„ HTTP è¯·æ±‚ã€‚
- **å·¥ä½œæ—¶æœº**ï¼šè¿‡æ»¤å™¨åœ¨ Servlet å®¹å™¨çº§åˆ«è¿è¡Œï¼Œåœ¨ Spring MVC çš„ DispatcherServlet ä¹‹å‰æ‰§è¡Œã€‚å®ƒå¯ä»¥å¯¹è¯·æ±‚è¿›è¡Œè¿‡æ»¤ï¼Œä½†ä¸èƒ½è®¿é—® `ModelAndView` å¯¹è±¡ã€‚
- **ä¸èƒ½è®¿é—® Spring MVC çš„ä¸Šä¸‹æ–‡**ï¼šè¿‡æ»¤å™¨ä¸æ”¯æŒè®¿é—® Spring ç‰¹å®šçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆå¦‚ `Model` æˆ– `Controller`ï¼‰ã€‚
- **é…ç½®æ–¹å¼**ï¼šè¿‡æ»¤å™¨éœ€è¦åœ¨ `web.xml` æˆ– Java é…ç½®ç±»ä¸­è¿›è¡Œé…ç½®ï¼Œæˆ–è€…é€šè¿‡ Spring Boot æä¾›çš„è¿‡æ»¤å™¨æ³¨å†Œæœºåˆ¶è¿›è¡Œæ³¨å†Œã€‚

#### åº”ç”¨åœºæ™¯ï¼š

- è¯·æ±‚æ—¥å¿—è®°å½•
- è¯·æ±‚ç¼–ç å¤„ç†
- å®‰å…¨æ§åˆ¶ï¼ˆå¦‚è·¨ç«™è¯·æ±‚ä¼ªé€ é˜²æŠ¤ï¼‰
- èµ„æºå‹ç¼©ï¼ˆå¦‚ GZIPï¼‰

### 1.3 æ‹¦æˆªå™¨ä¸è¿‡æ»¤å™¨çš„é€‰æ‹©

- **å½“éœ€è¦å¤„ç† Spring MVC çš„ Controller è¯·æ±‚æ—¶**ï¼Œä½¿ç”¨æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰ã€‚
- **å½“éœ€è¦åœ¨ Servlet å®¹å™¨çº§åˆ«å¤„ç†è¯·æ±‚æ—¶**ï¼Œä½¿ç”¨è¿‡æ»¤å™¨ï¼ˆFilterï¼‰ï¼Œæ¯”å¦‚è·¨åŸŸè¯·æ±‚ã€GZIP å‹ç¼©ç­‰ã€‚

------

## 2. å®ç° `HandlerInterceptor` æ¥å£çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•

Spring MVC çš„æ‹¦æˆªå™¨é€šè¿‡å®ç° `HandlerInterceptor` æ¥å£æ¥å®šä¹‰ã€‚è¯¥æ¥å£æœ‰ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼š

### 2.1 `preHandle()`ï¼šè¯·æ±‚å¤„ç†å‰

`preHandle()` æ–¹æ³•ä¼šåœ¨è¯·æ±‚å¤„ç†ä¹‹å‰è¢«è°ƒç”¨ã€‚è¿”å› `true` è¡¨ç¤ºè¯·æ±‚ç»§ç»­ä¼ é€’åˆ° Controllerï¼Œè¿”å› `false` ä¼šé˜»æ­¢è¯·æ±‚ç»§ç»­å‘åä¼ é€’ï¼Œç›´æ¥è¿”å›å“åº”ã€‚

#### ç¤ºä¾‹ï¼š

```java
public class MyInterceptor implements HandlerInterceptor {
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        System.out.println("è¯·æ±‚å¤„ç†å‰æ‰§è¡Œ");
        return true;  // ç»§ç»­å¤„ç†è¯·æ±‚
    }
}
```

### 2.2 `postHandle()`ï¼šè¯·æ±‚å¤„ç†åï¼Œè§†å›¾æ¸²æŸ“å‰

`postHandle()` æ–¹æ³•ä¼šåœ¨ Controller æ–¹æ³•æ‰§è¡Œåï¼Œä½†åœ¨è§†å›¾æ¸²æŸ“ä¹‹å‰è°ƒç”¨ã€‚å¯ä»¥ç”¨æ¥ä¿®æ”¹ `ModelAndView` å¯¹è±¡ï¼Œè¿›ä¸€æ­¥å¤„ç†æ¨¡å‹æ•°æ®æˆ–è§†å›¾ã€‚

#### ç¤ºä¾‹ï¼š

```java
public class MyInterceptor implements HandlerInterceptor {
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        return true;
    }

    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
        System.out.println("è¯·æ±‚å¤„ç†åï¼Œè§†å›¾æ¸²æŸ“å‰æ‰§è¡Œ");
        if (modelAndView != null) {
            modelAndView.addObject("message", "Intercepted!");
        }
    }
}
```

### 2.3 `afterCompletion()`ï¼šè¯·æ±‚å¤„ç†åï¼Œè§†å›¾æ¸²æŸ“å

`afterCompletion()` æ–¹æ³•ä¼šåœ¨æ•´ä¸ªè¯·æ±‚å¤„ç†å®Œæ¯•ä¹‹åè°ƒç”¨ï¼Œç”¨äºæ¸…ç†èµ„æºã€æ—¥å¿—è®°å½•ç­‰æ“ä½œã€‚æ­¤æ—¶è§†å›¾å·²ç»æ¸²æŸ“å®Œæ¯•ï¼Œå¯ä»¥è¿›è¡Œæœ€åçš„æ¸…ç†å·¥ä½œã€‚

#### ç¤ºä¾‹ï¼š

```java
public class MyInterceptor implements HandlerInterceptor {
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        return true;
    }

    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {}

    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {
        System.out.println("è¯·æ±‚å¤„ç†å®Œæ¯•ï¼Œè§†å›¾æ¸²æŸ“åæ‰§è¡Œ");
    }
}
```

------

## 3. æ³¨å†Œä¸é…ç½®å¤šä¸ªæ‹¦æˆªå™¨çš„é¡ºåº

åœ¨ Spring MVC ä¸­ï¼Œæ‹¦æˆªå™¨çš„æ³¨å†Œå’Œæ‰§è¡Œé¡ºåºç”± `WebMvcConfigurer` æ¥é…ç½®ã€‚é€šè¿‡å®ç° `addInterceptors()` æ–¹æ³•ï¼Œå¯ä»¥å°†è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨æ³¨å†Œåˆ° Spring å®¹å™¨ä¸­ã€‚

### 3.1 é…ç½®å¤šä¸ªæ‹¦æˆªå™¨çš„é¡ºåº

æ‹¦æˆªå™¨çš„é¡ºåºæ˜¯é€šè¿‡åœ¨é…ç½®ç±»ä¸­æ³¨å†Œæ‹¦æˆªå™¨çš„é¡ºåºæ¥ç¡®å®šçš„ï¼Œæ³¨å†Œçš„å…ˆåé¡ºåºå†³å®šäº†æ‹¦æˆªå™¨çš„æ‰§è¡Œé¡ºåºã€‚

#### ç¤ºä¾‹ï¼š

```java
@Configuration
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new MyInterceptor1()).addPathPatterns("/**");
        registry.addInterceptor(new MyInterceptor2()).addPathPatterns("/admin/**");
    }
}
```

- `MyInterceptor1` ä¼šåœ¨ `MyInterceptor2` ä¹‹å‰æ‰§è¡Œï¼Œå› ä¸ºå®ƒè¢«å…ˆæ³¨å†Œã€‚

------

## 4. å®æˆ˜ï¼šç”¨æˆ·æƒé™æ ¡éªŒã€æ¥å£ç­¾åæ ¡éªŒç­‰

### 4.1 ç”¨æˆ·æƒé™æ ¡éªŒ

åœ¨å¼€å‘ Web åº”ç”¨æ—¶ï¼Œç»å¸¸éœ€è¦å¯¹ç”¨æˆ·æƒé™è¿›è¡Œæ ¡éªŒï¼Œç¡®ä¿åªæœ‰åˆæ³•ç”¨æˆ·æ‰èƒ½è®¿é—®ç‰¹å®šèµ„æºã€‚æ­¤æ—¶ï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰æ‹¦æˆªå™¨æ¥å®ç°æƒé™éªŒè¯ã€‚

#### ç¤ºä¾‹ï¼šæƒé™æ ¡éªŒæ‹¦æˆªå™¨

```java
public class PermissionInterceptor implements HandlerInterceptor {
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        String userRole = (String) request.getSession().getAttribute("role");
        if ("ADMIN".equals(userRole)) {
            return true;  // ç”¨æˆ·æœ‰æƒé™ï¼Œç»§ç»­è¯·æ±‚
        } else {
            response.sendRedirect("/access-denied");  // æ— æƒé™ï¼Œé‡å®šå‘
            return false;
        }
    }
}
```

### 4.2 æ¥å£ç­¾åæ ¡éªŒ

åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒAPI çš„æ¥å£ç­¾åæ ¡éªŒéå¸¸é‡è¦ï¼Œç¡®ä¿è¯·æ±‚æ˜¯ç”±åˆæ³•å®¢æˆ·ç«¯å‘èµ·çš„ã€‚å¯ä»¥é€šè¿‡æ‹¦æˆªå™¨æ¥å®ç°ç­¾åæ ¡éªŒã€‚

#### ç¤ºä¾‹ï¼šæ¥å£ç­¾åæ ¡éªŒæ‹¦æˆªå™¨

```java
public class SignatureInterceptor implements HandlerInterceptor {
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        String signature = request.getHeader("Signature");
        String secret = "secretKey";  // å‡è®¾ç”¨ä¸€ä¸ªå›ºå®šçš„å¯†é’¥ç­¾å
        String expectedSignature = generateSignature(request.getParameterMap(), secret);

        if (signature.equals(expectedSignature)) {
            return true;  // æ ¡éªŒé€šè¿‡
        } else {
            response.sendError(HttpServletResponse.SC_FORBIDDEN, "Invalid signature");
            return false;  // æ ¡éªŒå¤±è´¥ï¼Œæ‹’ç»è¯·æ±‚
        }
    }

    private String generateSignature(Map<String, String[]> parameters, String secret) {
        // ç®€å•çš„ç­¾åç”Ÿæˆé€»è¾‘
        StringBuilder sb = new StringBuilder(secret);
        parameters.forEach((key, value) -> sb.append(key).append("=").append(value[0]));
        return DigestUtils.md5DigestAsHex(sb.toString().getBytes());
    }
}
```

------

## æ€»ç»“

æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨æ˜¯ Spring MVC ä¸­é‡è¦çš„ç»„ä»¶ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…åœ¨è¯·æ±‚å’Œå“åº”è¿‡ç¨‹ä¸­æ‰§è¡Œå„ç§è‡ªå®šä¹‰æ“ä½œã€‚é€šè¿‡åˆç†ä½¿ç”¨æ‹¦æˆªå™¨ï¼Œå¯ä»¥æœ‰æ•ˆå®ç°æƒé™æ ¡éªŒã€æ—¥å¿—è®°å½•ã€æ€§èƒ½ç›‘æ§ç­‰åŠŸèƒ½ï¼›è€Œè¿‡æ»¤å™¨é€‚ç”¨äºæ›´åº•å±‚çš„ HTTP è¯·æ±‚å¤„ç†ï¼Œå¦‚è·¨åŸŸã€ç¼–ç å’Œå‹ç¼©ç­‰ã€‚æŒæ¡æ‹¦æˆªå™¨çš„ç”Ÿå‘½å‘¨æœŸå’Œé…ç½®æŠ€å·§ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…æ›´åŠ çµæ´»åœ°æ§åˆ¶è¯·æ±‚çš„å¤„ç†æµç¨‹ã€‚

# å…«ã€å¼‚æ­¥è¯·æ±‚ä¸å“åº”å¤„ç†

åœ¨ç°ä»£ Web åº”ç”¨ä¸­ï¼Œå¼‚æ­¥å¤„ç†æ˜¯æå‡æ€§èƒ½çš„é‡è¦æ‰‹æ®µï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†è€—æ—¶æ“ä½œæ—¶ã€‚Spring MVC æä¾›äº†å¤šç§æœºåˆ¶æ¥æ”¯æŒå¼‚æ­¥è¯·æ±‚ä¸å“åº”å¤„ç†ï¼ŒåŒ…æ‹¬ `@Async`ã€`Callable`ã€`DeferredResult` å’Œ `WebAsyncTask` ç­‰ã€‚æœ¬ç« å°†é‡ç‚¹ä»‹ç»å¦‚ä½•åˆ©ç”¨è¿™äº›æœºåˆ¶å®ç°å¼‚æ­¥è¯·æ±‚å¤„ç†ï¼Œä»¥åŠå®ƒä»¬èƒŒåçš„å·¥ä½œåŸç†ã€‚

------

## 1. ä½¿ç”¨ `@Async` ä¸ `Callable` å®ç°å¼‚æ­¥æ§åˆ¶å™¨

### 1.1 `@Async` æ³¨è§£

`@Async` æ˜¯ Spring æä¾›çš„å¼‚æ­¥æ–¹æ³•æ‰§è¡Œæ”¯æŒï¼Œé€šå¸¸ç”¨äºå°†æ–¹æ³•çš„æ‰§è¡Œä»ä¸»çº¿ç¨‹ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå¼‚æ­¥æ‰§è¡Œã€‚è¿™åœ¨å¤„ç†è€—æ—¶æ“ä½œæ—¶éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚æ•°æ®åº“æŸ¥è¯¢ã€å¤–éƒ¨æœåŠ¡è°ƒç”¨ç­‰ã€‚

#### é…ç½®ä¸ä½¿ç”¨ï¼š

é¦–å…ˆï¼Œéœ€è¦åœ¨ Spring é…ç½®ç±»ä¸­å¯ç”¨å¼‚æ­¥æ”¯æŒï¼š

```java
@Configuration
@EnableAsync  // å¯ç”¨å¼‚æ­¥æ”¯æŒ
public class AsyncConfig {
    @Bean
    public Executor taskExecutor() {
        return Executors.newFixedThreadPool(10);  // é…ç½®çº¿ç¨‹æ± 
    }
}
```

ç„¶åï¼Œå¯ä»¥åœ¨éœ€è¦å¼‚æ­¥æ‰§è¡Œçš„æ–¹æ³•ä¸Šä½¿ç”¨ `@Async` æ³¨è§£ï¼š

```java
@Service
public class AsyncService {

    @Async
    public void performTask() {
        System.out.println("å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œä¸­...");
    }
}
```

### 1.2 `Callable` æ¥å£

`Callable` æ˜¯ Java åŸç”Ÿçš„æ¥å£ï¼Œç”¨äºå®šä¹‰èƒ½å¤Ÿåœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­æ‰§è¡Œçš„ä»»åŠ¡ã€‚åœ¨ Spring MVC ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ `Callable` æ¥å°†è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹å¼‚æ­¥åŒ–ã€‚

#### ç¤ºä¾‹ï¼š

```java
@Controller
public class AsyncController {

    @GetMapping("/async")
    public Callable<String> asyncMethod() {
        return () -> {
            Thread.sleep(5000);  // æ¨¡æ‹Ÿé•¿æ—¶é—´ä»»åŠ¡
            return "å¼‚æ­¥è¯·æ±‚å¤„ç†å®Œæˆ";
        };
    }
}
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå½“è®¿é—® `/async` è·¯å¾„æ—¶ï¼Œæ§åˆ¶å™¨ä¼šç«‹å³è¿”å›ä¸€ä¸ª `Callable` å¯¹è±¡ï¼Œè€Œå®é™…çš„å¤„ç†è¿‡ç¨‹åˆ™åœ¨åå°çº¿ç¨‹ä¸­å¼‚æ­¥æ‰§è¡Œã€‚

------

## 2. ä½¿ç”¨ `DeferredResult`ã€`WebAsyncTask` å®ç°é•¿è½®è¯¢

### 2.1 `DeferredResult`ï¼šé•¿æ—¶é—´å¼‚æ­¥å¤„ç†

`DeferredResult` æ˜¯ä¸€ç§å¼ºå¤§çš„æœºåˆ¶ï¼Œå¯ä»¥å¤„ç†éœ€è¦è¾ƒé•¿æ—¶é—´å®Œæˆçš„å¼‚æ­¥ä»»åŠ¡ï¼Œä¾‹å¦‚ä¸å¤–éƒ¨ç³»ç»Ÿçš„äº¤äº’æˆ–å¤æ‚çš„è®¡ç®—è¿‡ç¨‹ã€‚å®ƒå…è®¸åœ¨å¼‚æ­¥å¤„ç†å®Œæˆæ—¶ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ç»“æœã€‚

#### ç¤ºä¾‹ï¼šä½¿ç”¨ `DeferredResult`

```java
@Controller
public class DeferredResultController {

    @GetMapping("/deferred")
    public DeferredResult<String> deferredResult() {
        DeferredResult<String> result = new DeferredResult<>();

        // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
        new Thread(() -> {
            try {
                Thread.sleep(5000);  // æ¨¡æ‹Ÿè€—æ—¶ä»»åŠ¡
                result.setResult("å¼‚æ­¥å¤„ç†å®Œæˆ");
            } catch (InterruptedException e) {
                result.setErrorResult("ä»»åŠ¡å¤±è´¥");
            }
        }).start();

        return result;
    }
}
```

åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ`DeferredResult` åœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œå¹¶å°†ç»“æœä¼ é€’ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯ä¼šåœ¨ 5 ç§’åæ”¶åˆ°å“åº”ã€‚

### 2.2 `WebAsyncTask`ï¼šå¤„ç†å¼‚æ­¥è¯·æ±‚å’Œå“åº”

`WebAsyncTask` æ˜¯ Spring 3.2 å¼•å…¥çš„ä¸€ç§å¢å¼ºçš„å¼‚æ­¥å¤„ç†æ–¹å¼ï¼Œå®ƒç±»ä¼¼äº `DeferredResult`ï¼Œä½†æä¾›äº†æ›´ç²¾ç»†çš„æ§åˆ¶ï¼Œå¦‚è¶…æ—¶è®¾ç½®å’Œé”™è¯¯å¤„ç†ã€‚

#### ç¤ºä¾‹ï¼šä½¿ç”¨ `WebAsyncTask`

```java
@Controller
public class WebAsyncTaskController {

    @GetMapping("/webAsyncTask")
    public WebAsyncTask<String> webAsyncTask() {
        Callable<String> callable = () -> {
            Thread.sleep(5000);  // æ¨¡æ‹Ÿè€—æ—¶ä»»åŠ¡
            return "WebAsyncTask å®Œæˆ";
        };

        WebAsyncTask<String> asyncTask = new WebAsyncTask<>(callable);
        asyncTask.onTimeout(() -> "è¶…æ—¶æœªå®Œæˆ");
        asyncTask.onError(() -> "ä»»åŠ¡æ‰§è¡Œå‡ºé”™");
        return asyncTask;
    }
}
```

`WebAsyncTask` å…è®¸å¼€å‘è€…è®¾ç½®è¶…æ—¶å’Œé”™è¯¯å¤„ç†é€»è¾‘ï¼Œæ˜¯ä¸€ä¸ªæ›´çµæ´»çš„å¼‚æ­¥å¤„ç†æœºåˆ¶ã€‚

------

## 3. å¼‚æ­¥å¤„ç†åŸç†ä¸çº¿ç¨‹æ¨¡å‹

Spring MVC çš„å¼‚æ­¥å¤„ç†æœºåˆ¶åŸºäº Java çš„çº¿ç¨‹æ± å’Œ `Executor`ã€‚åœ¨å¼‚æ­¥æ¨¡å¼ä¸‹ï¼ŒSpring MVC å°†è¯·æ±‚å¤„ç†çš„ä»»åŠ¡äº¤ç»™ç‹¬ç«‹çš„çº¿ç¨‹æ¥æ‰§è¡Œï¼Œè€Œä¸å ç”¨ä¸»çº¿ç¨‹ï¼Œä»è€Œå®ç°éé˜»å¡çš„è¯·æ±‚å¤„ç†ã€‚è¿™ç§æ–¹å¼èƒ½å¤Ÿæ˜¾è‘—æå‡ Web åº”ç”¨çš„æ€§èƒ½ï¼Œå°¤å…¶åœ¨å¤„ç† I/O å¯†é›†å‹æ“ä½œæ—¶ã€‚

### 3.1 å¼‚æ­¥å¤„ç†åŸç†

1. **è¯·æ±‚åˆ°è¾¾ DispatcherServlet**ï¼šå½“å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚æ—¶ï¼ŒSpring MVC çš„ `DispatcherServlet` ä¼šæ ¹æ®è¯·æ±‚ç±»å‹åˆ¤æ–­æ˜¯å¦éœ€è¦å¼‚æ­¥å¤„ç†ã€‚
2. **å¼‚æ­¥å¤„ç†å¯åŠ¨**ï¼šå¦‚æœè¯·æ±‚è¢«æ ‡è®°ä¸ºå¼‚æ­¥å¤„ç†ï¼ˆé€šè¿‡ `@Async` æˆ– `Callable` ç­‰ï¼‰ï¼ŒSpring MVC ä¼šå°†è¯·æ±‚åˆ†æ´¾åˆ°åå°çº¿ç¨‹æ± å¤„ç†ï¼Œè€Œä¸»çº¿ç¨‹åˆ™ç«‹å³é‡Šæ”¾ï¼Œç»§ç»­å¤„ç†å…¶ä»–è¯·æ±‚ã€‚
3. **ä»»åŠ¡å®Œæˆé€šçŸ¥**ï¼šåå°çº¿ç¨‹å¤„ç†å®Œæˆåï¼Œä¼šé€šè¿‡ `DeferredResult` æˆ– `WebAsyncTask` å°†ç»“æœè¿”å›ç»™ä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹å†å°†æœ€ç»ˆçš„å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

### 3.2 å¼‚æ­¥çº¿ç¨‹æ± 

Spring æä¾›äº†ä¸€ä¸ªé»˜è®¤çš„å¼‚æ­¥çº¿ç¨‹æ± ï¼Œä½†ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦è‡ªå®šä¹‰çº¿ç¨‹æ± é…ç½®ã€‚é€šè¿‡ `@EnableAsync` æ³¨è§£å¯ä»¥å¯ç”¨å¼‚æ­¥æ‰§è¡Œï¼Œå¹¶é€šè¿‡ `Executor` é…ç½®æ¥æŒ‡å®šçº¿ç¨‹æ± ã€‚

```java
@Configuration
@EnableAsync
public class AsyncConfig {

    @Bean
    public Executor asyncExecutor() {
        return Executors.newFixedThreadPool(10);  // é…ç½®çº¿ç¨‹æ± 
    }
}
```

### 3.3 å¼‚æ­¥å¤„ç†çš„ä¼˜ç¼ºç‚¹

#### ä¼˜ç‚¹ï¼š

- **æé«˜å¹¶å‘æ€§èƒ½**ï¼šå¼‚æ­¥å¤„ç†èƒ½æ˜¾è‘—æå‡ Web åº”ç”¨çš„ååé‡å’Œå“åº”èƒ½åŠ›ï¼Œç‰¹åˆ«æ˜¯åœ¨ I/O å¯†é›†å‹çš„åº”ç”¨åœºæ™¯ä¸‹ã€‚
- **é™ä½é˜»å¡**ï¼šé•¿æ—¶é—´æ“ä½œä¸å†é˜»å¡ä¸»çº¿ç¨‹ï¼Œä½¿å¾—æœåŠ¡å™¨èƒ½å¤ŸåŒæ—¶å¤„ç†æ›´å¤šè¯·æ±‚ã€‚

#### ç¼ºç‚¹ï¼š

- **å¤æ‚æ€§å¢åŠ **ï¼šå¼‚æ­¥å¤„ç†å¼•å…¥äº†çº¿ç¨‹ç®¡ç†å’Œå¼‚å¸¸å¤„ç†ç­‰å¤æ‚æ€§ï¼Œéœ€è¦å¼€å‘è€…ç‰¹åˆ«å°å¿ƒã€‚
- **çº¿ç¨‹ç®¡ç†å¼€é”€**ï¼šåˆ›å»ºå’Œç»´æŠ¤å¤šä¸ªçº¿ç¨‹ä¼šæ¶ˆè€—ä¸€å®šçš„èµ„æºï¼Œè¿‡å¤šçš„å¹¶å‘è¯·æ±‚å¯èƒ½ä¼šå¸¦æ¥çº¿ç¨‹æ± è€—å°½æˆ–ç³»ç»Ÿèµ„æºä¸è¶³çš„é—®é¢˜ã€‚

------

## æ€»ç»“

Spring MVC æä¾›äº†å¼ºå¤§çš„å¼‚æ­¥å¤„ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬ `@Async`ã€`Callable`ã€`DeferredResult` å’Œ `WebAsyncTask` ç­‰æœºåˆ¶ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…å¤„ç†é«˜å¹¶å‘å’Œé•¿æ—¶é—´æ“ä½œçš„ä»»åŠ¡ã€‚ç†è§£è¿™äº›å¼‚æ­¥æœºåˆ¶çš„å·¥ä½œåŸç†åŠå…¶é€‚ç”¨åœºæ™¯ï¼Œå¯¹äºæ„å»ºé«˜æ•ˆã€å“åº”è¿…é€Ÿçš„ Web åº”ç”¨è‡³å…³é‡è¦ã€‚åŒæ—¶ï¼Œåˆç†é…ç½®çº¿ç¨‹æ± å’Œä»»åŠ¡ç®¡ç†ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œé«˜æ€§èƒ½ã€‚

# ä¹ã€è·¨åŸŸè¯·æ±‚ä¸ CORS æ”¯æŒ

è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼ŒCross-Origin Resource Sharingï¼‰æ˜¯ Web åº”ç”¨ä¸­å¸¸è§çš„éœ€æ±‚ï¼Œå°¤å…¶æ˜¯åœ¨å‰åç«¯åˆ†ç¦»çš„æ¶æ„ä¸­ï¼Œå‰ç«¯å’Œåç«¯å¯èƒ½æ‰˜ç®¡åœ¨ä¸åŒçš„åŸŸåä¸‹ã€‚è·¨åŸŸé—®é¢˜ä¼šå¯¼è‡´æµè§ˆå™¨æ‹’ç»è¿›è¡Œè¯·æ±‚ã€‚Spring MVC æä¾›äº†å¯¹ CORS çš„å†…å»ºæ”¯æŒï¼Œå¸®åŠ©å¼€å‘è€…æ–¹ä¾¿åœ°é…ç½®å’Œå¤„ç†è·¨åŸŸè¯·æ±‚ã€‚æœ¬ç« å°†è¯¦ç»†è®²è§£è·¨åŸŸçš„æ¦‚å¿µã€Spring MVC ä¸­çš„ CORS é…ç½®æ–¹å¼ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡ `@CrossOrigin` æ³¨è§£å¤„ç†è·¨åŸŸè¯·æ±‚ã€‚

------

## 1. ä»€ä¹ˆæ˜¯è·¨åŸŸåŠå…¶æœ¬è´¨

### 1.1 è·¨åŸŸå®šä¹‰

è·¨åŸŸæ˜¯æŒ‡æµè§ˆå™¨ä¸­çš„ä¸€ä¸ªåŸŸåï¼ˆoriginï¼‰è®¿é—®å¦ä¸€ä¸ªåŸŸåä¸Šçš„èµ„æºæ—¶ï¼Œè§¦å‘äº†æµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼ˆSame-Origin Policyï¼‰ã€‚åŒæºç­–ç•¥æ˜¯æµè§ˆå™¨çš„å®‰å…¨æœºåˆ¶ï¼Œç¦æ­¢æ¥è‡ªä¸åŒæºçš„è„šæœ¬è®¿é—®ç½‘é¡µçš„èµ„æºï¼Œé˜²æ­¢æ¶æ„ç½‘ç«™çªƒå–ç”¨æˆ·æ•°æ®æˆ–è¿›è¡Œè·¨ç«™è¯·æ±‚ã€‚

åŒæºç­–ç•¥è¦æ±‚ï¼šåè®®ã€ä¸»æœºã€ç«¯å£å¿…é¡»å®Œå…¨ç›¸åŒã€‚å¦‚æœå®ƒä»¬å…¶ä¸­ä¸€ä¸ªä¸åŒï¼Œå°±ä¼šè¢«è®¤ä¸ºæ˜¯è·¨åŸŸè¯·æ±‚ã€‚

ä¾‹å¦‚ï¼Œ`http://example.com` å’Œ `http://api.example.com` ä¹‹é—´çš„è¯·æ±‚å°±å±äºè·¨åŸŸè¯·æ±‚ï¼Œå› ä¸ºå®ƒä»¬çš„åŸŸåä¸åŒã€‚

### 1.2 è·¨åŸŸæœ¬è´¨

è·¨åŸŸé—®é¢˜çš„æœ¬è´¨æ˜¯å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæµè§ˆå™¨ä¸å…è®¸ä¸åŒæºä¹‹é—´çš„èµ„æºå…±äº«ã€‚ä¸ºäº†å…è®¸è·¨åŸŸè¯·æ±‚ï¼Œç›®æ ‡æœåŠ¡å™¨éœ€è¦æ˜¾å¼åœ°æŒ‡ç¤ºæµè§ˆå™¨å…è®¸æŸä¸ªæºçš„è®¿é—®ï¼Œè¿™ä¸ªæœºåˆ¶è¢«ç§°ä¸º CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰ã€‚

CORS æ˜¯ä¸€ç§æ ‡å‡†åŒ–çš„åè®®ï¼Œå®ƒé€šè¿‡ HTTP è¯·æ±‚å¤´æ¥å‘ŠçŸ¥æµè§ˆå™¨æ˜¯å¦å…è®¸è·¨åŸŸè¯·æ±‚ã€‚

------

## 2. Spring MVC ä¸­é…ç½®è·¨åŸŸæ”¯æŒçš„ä¸‰ç§æ–¹å¼

Spring MVC æä¾›äº†å¤šç§æ–¹å¼æ¥æ”¯æŒ CORSï¼Œä»¥ä¸‹æ˜¯ä¸‰ç§å¸¸è§çš„é…ç½®æ–¹å¼ï¼š

### 2.1 å…¨å±€ CORS é…ç½®ï¼ˆé€šè¿‡ `WebMvcConfigurer`ï¼‰

Spring å…è®¸åœ¨å…¨å±€èŒƒå›´å†…é…ç½® CORS ç­–ç•¥ï¼Œä½¿å¾—æ‰€æœ‰çš„è¯·æ±‚éƒ½æ”¯æŒè·¨åŸŸã€‚å¯ä»¥é€šè¿‡å®ç° `WebMvcConfigurer` æ¥å£å¹¶é‡å†™ `addCorsMappings()` æ–¹æ³•æ¥å®ç°å…¨å±€é…ç½®ã€‚

#### ç¤ºä¾‹ï¼š

```java
@Configuration
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")  // è®¾ç½®å…è®¸è·¨åŸŸçš„è·¯å¾„
                .allowedOrigins("http://localhost:3000")  // å…è®¸æ¥è‡ªè¿™ä¸ªåŸŸçš„è¯·æ±‚
                .allowedMethods("GET", "POST", "PUT", "DELETE")  // å…è®¸çš„ HTTP æ–¹æ³•
                .allowedHeaders("*")  // å…è®¸çš„è¯·æ±‚å¤´
                .allowCredentials(true)  // æ˜¯å¦å…è®¸å‘é€ cookie
                .maxAge(3600);  // ç¼“å­˜é¢„æ£€è¯·æ±‚çš„æœ€å¤§æ—¶é—´
    }
}
```

### 2.2 æ§åˆ¶å™¨æ–¹æ³•çº§åˆ« CORS é…ç½®

é™¤äº†å…¨å±€é…ç½®ï¼Œè¿˜å¯ä»¥åœ¨å•ä¸ªæ§åˆ¶å™¨æ–¹æ³•ä¸Šè¿›è¡Œ CORS é…ç½®ï¼Œé€šè¿‡ `@CrossOrigin` æ³¨è§£ç›´æ¥è®¾ç½®è·¨åŸŸç­–ç•¥ã€‚

#### ç¤ºä¾‹ï¼š

```java
@RestController
@RequestMapping("/api")
public class ApiController {

    @GetMapping("/hello")
    @CrossOrigin(origins = "http://localhost:3000")  // ä»…å…è®¸æ¥è‡ªè¿™ä¸ªåŸŸçš„è¯·æ±‚
    public String hello() {
        return "Hello, World!";
    }
}
```

è¿™ç§æ–¹å¼ä½¿å¾—å¼€å‘è€…å¯ä»¥ç²¾ç»†åœ°æ§åˆ¶å“ªäº›æ–¹æ³•æ”¯æŒè·¨åŸŸè¯·æ±‚ã€‚

### 2.3 é€šè¿‡ Filter é…ç½® CORS

å¦å¤–ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡è‡ªå®šä¹‰ `Filter` æ¥å®ç° CORSã€‚Spring Boot æä¾›äº† `CorsFilter`ï¼Œå¯ä»¥é€šè¿‡æ³¨å†Œ `CorsFilter` Bean æ¥å…¨å±€é…ç½®è·¨åŸŸã€‚

#### ç¤ºä¾‹ï¼š

```java
@Bean
public CorsFilter corsFilter() {
    UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
    CorsConfiguration config = new CorsConfiguration();
    config.setAllowCredentials(true);  // å…è®¸å‘é€ cookie
    config.addAllowedOrigin("http://localhost:3000");  // å…è®¸çš„åŸŸ
    config.addAllowedHeader("*");  // å…è®¸æ‰€æœ‰è¯·æ±‚å¤´
    config.addAllowedMethod("*");  // å…è®¸æ‰€æœ‰æ–¹æ³•
    source.registerCorsConfiguration("/**", config);  // é…ç½®è·¨åŸŸè§„åˆ™
    return new CorsFilter(source);
}
```

è¿™ç§æ–¹å¼å¯ä»¥æ›´çµæ´»åœ°æ§åˆ¶è·¨åŸŸè¯·æ±‚çš„å¤„ç†ï¼Œé€‚ç”¨äºéœ€è¦æ›´å¤æ‚è·¨åŸŸé…ç½®çš„åœºæ™¯ã€‚

------

## 3. ä½¿ç”¨ `@CrossOrigin` æ³¨è§£å¤„ç†è·¨åŸŸ

`@CrossOrigin` æ˜¯ Spring 4.2 å¼•å…¥çš„æ³¨è§£ï¼Œç”¨äºåœ¨æ§åˆ¶å™¨æ–¹æ³•ä¸Šé…ç½®è·¨åŸŸç­–ç•¥ã€‚å®ƒå…è®¸å¼€å‘è€…ä¸ºæŸä¸ªç‰¹å®šçš„è¯·æ±‚æŒ‡å®šè·¨åŸŸè§„åˆ™ï¼Œç®€åŒ–äº†é…ç½®çš„å¤æ‚åº¦ã€‚

### 3.1 `@CrossOrigin` æ³¨è§£çš„å¸¸ç”¨å±æ€§

| å±æ€§               | å«ä¹‰                                                         |
| ------------------ | ------------------------------------------------------------ |
| `origins`          | å…è®¸çš„è·¨åŸŸè¯·æ±‚çš„æ¥æºåœ°å€ï¼Œæ”¯æŒæ•°ç»„å½¢å¼ï¼Œå¦‚ `@CrossOrigin(origins = {"http://localhost:3000", "http://localhost:4000"})`ã€‚ |
| `methods`          | å…è®¸çš„ HTTP è¯·æ±‚æ–¹æ³•ï¼Œå¦‚ `GET`, `POST` ç­‰ï¼Œé»˜è®¤ä¸º `GET` å’Œ `POST`ã€‚ |
| `allowedHeaders`   | å…è®¸çš„è¯·æ±‚å¤´ï¼Œé»˜è®¤ä¸º `*`ï¼Œå³æ‰€æœ‰å¤´éƒ¨éƒ½å…è®¸ã€‚                 |
| `exposedHeaders`   | è®¾ç½®å“ªäº›å“åº”å¤´å¯ä»¥æš´éœ²ç»™å®¢æˆ·ç«¯ã€‚                             |
| `allowCredentials` | æ˜¯å¦å…è®¸å‘é€ cookieï¼Œé»˜è®¤ä¸º `false`ã€‚                        |
| `maxAge`           | é¢„æ£€è¯·æ±‚çš„ç¼“å­˜æ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚                               |

### 3.2 ç¤ºä¾‹

```java
@RestController
public class CrossOriginController {

    @GetMapping("/greet")
    @CrossOrigin(origins = "http://localhost:3000")  // ä»…å…è®¸æ¥è‡ª http://localhost:3000 çš„è¯·æ±‚
    public String greet() {
        return "Hello from the server!";
    }

    @PostMapping("/submit")
    @CrossOrigin(origins = "*", allowedHeaders = "*", methods = {RequestMethod.POST})
    public String submitData(@RequestBody Data data) {
        return "Data submitted successfully!";
    }
}
```

é€šè¿‡ `@CrossOrigin` æ³¨è§£ï¼Œå¼€å‘è€…å¯ä»¥æ–¹ä¾¿åœ°ä¸ºå•ä¸ªæ§åˆ¶å™¨æ–¹æ³•æˆ–ç±»çº§åˆ«è®¾ç½®è·¨åŸŸè§„åˆ™ã€‚

------

## 4. è·¨åŸŸè¯·æ±‚ä¸è®¤è¯å®‰å…¨æ€§é£é™©é˜²èŒƒ

è™½ç„¶è·¨åŸŸè¯·æ±‚æå¤§åœ°æé«˜äº† Web åº”ç”¨çš„çµæ´»æ€§ï¼Œä½†å®ƒä¹Ÿå¼•å…¥äº†ä¸€äº›å®‰å…¨é£é™©ï¼Œå°¤å…¶æ˜¯åœ¨ä¸ç”¨æˆ·è®¤è¯ç›¸å…³çš„åœºæ™¯ä¸­ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„è·¨åŸŸå®‰å…¨é£é™©å’Œé˜²èŒƒæªæ–½ï¼š

### 4.1 CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰

è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰æ˜¯æŒ‡æ¶æ„ç½‘ç«™é€šè¿‡ä¼ªé€ ç”¨æˆ·è¯·æ±‚ï¼Œåœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæ“ä½œã€‚ä¸ºé˜²æ­¢ CSRF æ”»å‡»ï¼ŒSpring æä¾›äº†é˜²æŠ¤æœºåˆ¶ï¼šåœ¨è·¨åŸŸè¯·æ±‚ä¸­ï¼Œéœ€è¦æ˜¾å¼åœ°å¯ç”¨ `allowCredentials` å±æ€§å¹¶ç¡®ä¿åªæœ‰å—ä¿¡ä»»çš„æºèƒ½å¤Ÿå‘é€è¯·æ±‚ã€‚

#### é˜²èŒƒæªæ–½ï¼š

- åœ¨è·¨åŸŸé…ç½®ä¸­å¯ç”¨ `allowCredentials = true`ï¼Œå¹¶ç¡®ä¿æ­£ç¡®é…ç½® `origins`ï¼Œé¿å…å¼€æ”¾è¿‡å¤šçš„æºã€‚
- ä½¿ç”¨ Spring Security çš„ CSRF é˜²æŠ¤æœºåˆ¶ï¼Œç¡®ä¿è¯·æ±‚çš„å®‰å…¨æ€§ã€‚

### 4.2 CORS é¢„æ£€è¯·æ±‚æ»¥ç”¨

CORS é¢„æ£€è¯·æ±‚ï¼ˆOPTIONS è¯·æ±‚ï¼‰æ˜¯æµè§ˆå™¨åœ¨å‘é€å®é™…è¯·æ±‚ä¹‹å‰å‘å‡ºçš„ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œç”¨äºç¡®è®¤æ˜¯å¦å…è®¸è·¨åŸŸè¯·æ±‚ã€‚æ¶æ„è¯·æ±‚å¯èƒ½æ»¥ç”¨è¿™ä¸ªæœºåˆ¶ã€‚

#### é˜²èŒƒæªæ–½ï¼š

- é…ç½®åˆç†çš„ `maxAge`ï¼Œé™åˆ¶é¢„æ£€è¯·æ±‚çš„ç¼“å­˜æ—¶é—´ï¼Œé˜²æ­¢æ»¥ç”¨ã€‚
- ä¸¥æ ¼é™åˆ¶ `origins` å’Œ `methods`ï¼Œåªå…è®¸ä¿¡ä»»çš„æºå’Œè¯·æ±‚æ–¹æ³•ã€‚

### 4.3 XSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰

XSS æ”»å‡»å…è®¸æ”»å‡»è€…é€šè¿‡è„šæœ¬æ³¨å…¥æ‰§è¡Œæ¶æ„ä»£ç ã€‚ä¸ºäº†é¿å… XSS æ”»å‡»ï¼ŒåŠ¡å¿…å¯¹ä¼ å…¥çš„ç”¨æˆ·æ•°æ®è¿›è¡Œä¸¥æ ¼éªŒè¯å’Œæ¸…ç†ã€‚

#### é˜²èŒƒæªæ–½ï¼š

- ä½¿ç”¨ HTTPS åŠ å¯†æ‰€æœ‰è¯·æ±‚ï¼Œé¿å…æ•æ„Ÿæ•°æ®æ³„éœ²ã€‚
- å¯¹è¾“å…¥æ•°æ®è¿›è¡ŒéªŒè¯å’Œè½¬ä¹‰ï¼Œé¿å…æ¶æ„è„šæœ¬çš„æ‰§è¡Œã€‚

------

## æ€»ç»“

è·¨åŸŸè¯·æ±‚æ˜¯ç°ä»£ Web å¼€å‘ä¸­çš„å¸¸è§éœ€æ±‚ï¼ŒSpring MVC æä¾›äº†å¤šç§æ–¹å¼æ¥æ”¯æŒè·¨åŸŸè¯·æ±‚ï¼ŒåŒ…æ‹¬å…¨å±€é…ç½®ã€æ§åˆ¶å™¨æ–¹æ³•çº§é…ç½®å’Œé€šè¿‡ Filter é…ç½®ã€‚é€šè¿‡ `@CrossOrigin` æ³¨è§£ï¼Œå¼€å‘è€…å¯ä»¥çµæ´»åœ°ä¸ºå…·ä½“è¯·æ±‚æ·»åŠ è·¨åŸŸæ”¯æŒã€‚ä½†åœ¨å¼€å¯è·¨åŸŸæ”¯æŒçš„åŒæ—¶ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„è®¤è¯ä¸å®‰å…¨æ€§é—®é¢˜ï¼Œç¡®ä¿é˜²èŒƒå¸¸è§çš„è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰å’Œè·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰ç­‰å®‰å…¨é£é™©ã€‚

# åã€Spring MVC æ€§èƒ½ä¼˜åŒ–ä¸è°ƒè¯•æŠ€å·§

åœ¨å¼€å‘é«˜æ€§èƒ½çš„ Web åº”ç”¨æ—¶ï¼ŒSpring MVC æä¾›äº†å¤šä¸ªä¼˜åŒ–ç‚¹æ¥æé«˜ç³»ç»Ÿçš„å“åº”é€Ÿåº¦å’Œå¯æ‰©å±•æ€§ã€‚ä¼˜åŒ–ä¸ä»…ä»…æ˜¯ä¸ºäº†åŠ é€Ÿè¯·æ±‚å¤„ç†ï¼Œè¿˜åŒ…æ‹¬é™æ€èµ„æºçš„ç¼“å­˜ã€JSON è½¬æ¢çš„ä¼˜åŒ–ç­‰æ–¹é¢ã€‚æœ¬ç« å°†ä»‹ç» Spring MVC æ€§èƒ½ä¼˜åŒ–çš„å¸¸è§æŠ€å·§ï¼Œå¹¶ç»™å‡ºè°ƒè¯•å»ºè®®ï¼Œå¸®åŠ©å¼€å‘è€…è¯Šæ–­å’Œè§£å†³å¸¸è§çš„æ€§èƒ½ç“¶é¢ˆã€‚

------

## 1. è¯·æ±‚å¤„ç†é“¾è°ƒä¼˜å»ºè®®

Spring MVC ä¸­ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šç»è¿‡ä¸€ç³»åˆ—çš„å¤„ç†å™¨ã€æ‹¦æˆªå™¨å’Œè§†å›¾è§£æç­‰é˜¶æ®µï¼Œä¼˜åŒ–è¯·æ±‚å¤„ç†é“¾æ˜¯æå‡æ€§èƒ½çš„å…³é”®ä¹‹ä¸€ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›è°ƒä¼˜å»ºè®®ï¼š

### 1.1 å‡å°‘ä¸å¿…è¦çš„æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨

æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰å’Œè¿‡æ»¤å™¨ï¼ˆFilterï¼‰æ˜¯è¯·æ±‚å¤„ç†é“¾ä¸­çš„é‡è¦ç»„ä»¶ï¼Œå®ƒä»¬å¯ä»¥æ‹¦æˆªè¯·æ±‚å¹¶è¿›è¡Œé¢„å¤„ç†æˆ–åå¤„ç†ã€‚ä½†è¿‡å¤šçš„æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨ä¼šå¢åŠ è¯·æ±‚çš„å¤„ç†æ—¶é—´ï¼Œå½±å“ç³»ç»Ÿçš„å“åº”é€Ÿåº¦ã€‚

#### è°ƒä¼˜å»ºè®®ï¼š

- ç§»é™¤ä¸å¿…è¦çš„æ‹¦æˆªå™¨æˆ–è¿‡æ»¤å™¨ã€‚
- å°†æ‹¦æˆªå™¨é…ç½®ä¸ºåªæ‹¦æˆªå¿…è¦çš„è·¯å¾„ï¼Œé¿å…å…¨å±€æ‹¦æˆªã€‚
- ä½¿ç”¨ `HandlerInterceptor` å’Œ `Filter` æ—¶ï¼Œç¡®ä¿å®ƒä»¬çš„æ‰§è¡Œæ•ˆç‡ï¼Œé¿å…åšè€—æ—¶æ“ä½œã€‚

### 1.2 ä¼˜åŒ– `DispatcherServlet` çš„åˆå§‹åŒ–å’Œæ˜ å°„

`DispatcherServlet` æ˜¯ Spring MVC çš„æ ¸å¿ƒç»„ä»¶ï¼Œå®ƒè´Ÿè´£è¯·æ±‚çš„è°ƒåº¦å’Œåˆ†å‘ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ`DispatcherServlet` ä¼šæ‰«æå’Œåˆå§‹åŒ–æ•´ä¸ªåº”ç”¨çš„æ‰€æœ‰ Beanï¼Œè¿™ä¼šå½±å“åº”ç”¨çš„å¯åŠ¨æ—¶é—´ã€‚

#### è°ƒä¼˜å»ºè®®ï¼š

- ä½¿ç”¨ Spring Boot çš„å»¶è¿Ÿåˆå§‹åŒ–ç‰¹æ€§ï¼Œæ¨è¿Ÿéå…³é”® Bean çš„åˆå§‹åŒ–ã€‚
- é€šè¿‡ `servlet-mapping` é…ç½®ï¼Œç²¾ç¡®æ§åˆ¶ `DispatcherServlet` æ˜ å°„çš„è·¯å¾„ï¼Œé¿å…ä¸å¿…è¦çš„è¯·æ±‚è¿›å…¥ Spring MVC çš„å¤„ç†æµç¨‹ã€‚

### 1.3 ç²¾ç®€è¯·æ±‚è·¯å¾„å’Œ URL æ˜ å°„

åœ¨ Spring MVC ä¸­ï¼Œæ¯ä¸ªè¯·æ±‚è·¯å¾„éƒ½ä¼šç»è¿‡ä¸€ç³»åˆ—çš„åŒ¹é…å’Œå¤„ç†ã€‚è·¯å¾„è¿‡é•¿æˆ–è¿‡å¤šçš„ URL æ˜ å°„ä¼šé™ä½è·¯ç”±åŒ¹é…çš„æ•ˆç‡ã€‚

#### è°ƒä¼˜å»ºè®®ï¼š

- ä½¿ç”¨ç®€æ´çš„è·¯å¾„å’Œæ˜ å°„è§„åˆ™ï¼Œé¿å…å¤æ‚çš„ URL è§„åˆ™ã€‚
- é¿å…åœ¨è·¯å¾„ä¸­ä½¿ç”¨å¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚

------

## 2. JSON è½¬æ¢æ€§èƒ½ä¼˜åŒ–

åœ¨ç°ä»£ Web åº”ç”¨ä¸­ï¼ŒJSON å·²æˆä¸ºæ•°æ®äº¤æ¢çš„æ ‡å‡†æ ¼å¼ã€‚ç„¶è€Œï¼ŒJSON åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ˜¯ä¸€ä¸ªæ¯”è¾ƒè€—æ—¶çš„è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ã€‚å› æ­¤ï¼Œä¼˜åŒ– JSON è½¬æ¢çš„æ€§èƒ½å¯¹äºæé«˜åº”ç”¨å“åº”é€Ÿåº¦è‡³å…³é‡è¦ã€‚

### 2.1 ä½¿ç”¨é«˜æ•ˆçš„ JSON åºåˆ—åŒ–æ¡†æ¶

Spring é»˜è®¤ä½¿ç”¨ Jackson æ¥å¤„ç† JSON è½¬æ¢ã€‚Jackson æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„ JSON åºåˆ—åŒ–/ååºåˆ—åŒ–åº“ï¼Œä½†å¯¹äºå¤§æ•°æ®é‡çš„å¤„ç†ï¼Œä¾ç„¶å­˜åœ¨ä¸€å®šçš„æ€§èƒ½ç“¶é¢ˆã€‚

#### è°ƒä¼˜å»ºè®®ï¼š

- **å®šåˆ¶ Jackson çš„é…ç½®**ï¼šé€šè¿‡å®šåˆ¶ `ObjectMapper` é…ç½®ï¼Œä¼˜åŒ– JSON è½¬æ¢çš„æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œå…³é—­è‡ªåŠ¨æ ¼å¼åŒ–å’Œå¯ç”¨æµå¼å¤„ç†ã€‚
- **ä½¿ç”¨æ›´é«˜æ•ˆçš„ JSON åºåˆ—åŒ–åº“**ï¼šé™¤äº† Jacksonï¼ŒGson å’Œ Fastjson ç­‰åº“ä¹Ÿå¯ä»¥ä¸ Spring é›†æˆï¼Œè¿™äº›åº“åœ¨å¤„ç†æŸäº›åœºæ™¯ä¸‹å¯èƒ½ä¼šæ›´åŠ é«˜æ•ˆã€‚
- **å¼€å¯ Jackson ç¼“å­˜**ï¼šå¯ç”¨ Jackson çš„ç¼“å­˜æœºåˆ¶ï¼Œå‡å°‘é‡å¤çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ã€‚

#### ç¤ºä¾‹ï¼š

```java
@Bean
public ObjectMapper objectMapper() {
    ObjectMapper objectMapper = new ObjectMapper();
    objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);  // ç¦ç”¨æœªçŸ¥å±æ€§å¼‚å¸¸
    objectMapper.configure(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS, false);  // ç¦ç”¨æ—¥æœŸæ ¼å¼åŒ–
    return objectMapper;
}
```

### 2.2 æ§åˆ¶ JSON å“åº”å¤§å°

å¦‚æœå“åº”çš„ JSON æ•°æ®é‡å¾ˆå¤§ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚å‡å°‘è¿”å›çš„æ•°æ®é‡æ˜¯æå‡æ€§èƒ½çš„æœ‰æ•ˆæ–¹æ³•ã€‚

#### è°ƒä¼˜å»ºè®®ï¼š

- åªè¿”å›å¿…è¦çš„å­—æ®µï¼Œä½¿ç”¨ `@JsonView` æˆ– DTOï¼ˆæ•°æ®ä¼ è¾“å¯¹è±¡ï¼‰æ¥è¿‡æ»¤ä¸å¿…è¦çš„å­—æ®µã€‚
- ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢æ¥é¿å…ä¸€æ¬¡æ€§è¿”å›è¿‡å¤šæ•°æ®ã€‚

------

## 3. é™æ€èµ„æºä¼˜åŒ–ä¸ç¼“å­˜é…ç½®

é™æ€èµ„æºï¼ˆå¦‚å›¾ç‰‡ã€CSS æ–‡ä»¶ã€JavaScript æ–‡ä»¶ç­‰ï¼‰åœ¨ Web åº”ç”¨ä¸­å æ®äº†å¾ˆå¤§æ¯”ä¾‹ï¼Œä¼˜åŒ–é™æ€èµ„æºçš„åŠ è½½é€Ÿåº¦å’Œç¼“å­˜ç­–ç•¥ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡é¡µé¢åŠ è½½æ—¶é—´ã€‚

### 3.1 ä½¿ç”¨ CDN åŠ é€Ÿé™æ€èµ„æºåŠ è½½

å°†é™æ€èµ„æºæ‰˜ç®¡åœ¨å†…å®¹åˆ†å‘ç½‘ç»œï¼ˆCDNï¼‰ä¸Šï¼Œå¯ä»¥å‡å°‘æœåŠ¡å™¨è´Ÿè½½ï¼Œæé«˜èµ„æºåŠ è½½é€Ÿåº¦ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå…¨çƒè®¿é—®çš„åº”ç”¨ã€‚

#### è°ƒä¼˜å»ºè®®ï¼š

- å°†é™æ€èµ„æºä¸Šä¼ åˆ° CDNï¼Œå¹¶é€šè¿‡é…ç½®æœåŠ¡å™¨å°†è¯·æ±‚é‡å®šå‘åˆ° CDN æœåŠ¡å™¨ã€‚
- é…ç½®é™æ€èµ„æºçš„ç‰ˆæœ¬å·å’Œæ–‡ä»¶åå“ˆå¸Œï¼Œç¡®ä¿æµè§ˆå™¨èƒ½å¤Ÿæ­£ç¡®ç¼“å­˜æ–‡ä»¶ã€‚

### 3.2 é…ç½®æµè§ˆå™¨ç¼“å­˜

é€šè¿‡è®¾ç½®åˆç†çš„ HTTP ç¼“å­˜å¤´ï¼Œå…è®¸æµè§ˆå™¨ç¼“å­˜é™æ€èµ„æºï¼Œä»è€Œé¿å…æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦é‡æ–°åŠ è½½ã€‚

#### ç¤ºä¾‹ï¼š

```java
@Configuration
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/static/**")
                .addResourceLocations("classpath:/static/")
                .setCachePeriod(3600);  // è®¾ç½®é™æ€èµ„æºç¼“å­˜æ—¶é—´
    }
}
```

### 3.3 å‹ç¼©é™æ€èµ„æº

é™æ€èµ„æºï¼ˆå¦‚ CSSã€JavaScriptã€HTMLï¼‰å¯ä»¥é€šè¿‡ Gzip æˆ– Brotli ç­‰å‹ç¼©ç®—æ³•æ¥å‹ç¼©ï¼Œä»è€Œå‡å°‘æ–‡ä»¶çš„å¤§å°ï¼Œæé«˜åŠ è½½é€Ÿåº¦ã€‚

#### è°ƒä¼˜å»ºè®®ï¼š

- å¯ç”¨ Gzip æˆ– Brotli å‹ç¼©ï¼Œå‡å°é™æ€èµ„æºçš„ä¼ è¾“å¤§å°ã€‚
- ä½¿ç”¨ Webpack ç­‰å·¥å…·å¯¹ JavaScript å’Œ CSS è¿›è¡Œå‹ç¼©å’Œæ··æ·†ã€‚

------

## 4. å¸¸è§æ€§èƒ½é—®é¢˜è¯Šæ–­æŠ€å·§

åœ¨ Spring MVC ä¸­ï¼Œæ€§èƒ½é—®é¢˜å¯èƒ½å‘ç”Ÿåœ¨è¯·æ±‚å¤„ç†é“¾çš„å¤šä¸ªé˜¶æ®µï¼Œå¦‚è¯·æ±‚æ‹¦æˆªã€JSON è½¬æ¢ã€è§†å›¾æ¸²æŸ“ç­‰ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„æ€§èƒ½ç“¶é¢ˆåŠå…¶è¯Šæ–­æŠ€å·§ã€‚

### 4.1 è¯·æ±‚é˜»å¡

è¯·æ±‚é˜»å¡é€šå¸¸å‘ç”Ÿåœ¨é•¿æ—¶é—´è¿è¡Œçš„æ“ä½œï¼Œå¦‚æ•°æ®åº“æŸ¥è¯¢ã€å¤–éƒ¨ API è°ƒç”¨ç­‰ã€‚æ­¤æ—¶è¯·æ±‚ä¼šè¢«æŒ‚èµ·ï¼Œç›´åˆ°æ“ä½œå®Œæˆã€‚

#### è°ƒä¼˜å»ºè®®ï¼š

- ä½¿ç”¨å¼‚æ­¥è¯·æ±‚å¤„ç†ï¼ˆ`@Async`ã€`DeferredResult` ç­‰ï¼‰æ¥é¿å…é˜»å¡ã€‚
- å¯¹äºé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ï¼Œå¯ä»¥å°†å…¶ç§»è‡³åå°å¤„ç†ï¼Œä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚ Kafkaã€RabbitMQï¼‰ç­‰å¼‚æ­¥æœºåˆ¶ã€‚

### 4.2 è§†å›¾æ¸²æŸ“æ…¢

è§†å›¾æ¸²æŸ“æ…¢é€šå¸¸å‘ç”Ÿåœ¨ä½¿ç”¨å¤æ‚æ¨¡æ¿å¼•æ“ï¼ˆå¦‚ Thymeleafã€Freemarkerï¼‰æ—¶ã€‚æ¨¡æ¿å¼•æ“ä¼šæ ¹æ®æ•°æ®æ¨¡å‹ç”Ÿæˆæœ€ç»ˆçš„ HTMLï¼Œè¿‡äºå¤æ‚çš„æ¨¡æ¿æˆ–ä¸åˆç†çš„æ•°æ®å¤„ç†ä¼šå¯¼è‡´æ¸²æŸ“é€Ÿåº¦å˜æ…¢ã€‚

#### è°ƒä¼˜å»ºè®®ï¼š

- ä¼˜åŒ–æ¨¡æ¿å¼•æ“çš„ä½¿ç”¨ï¼Œé¿å…è¿‡å¤šçš„å¾ªç¯å’Œæ¡ä»¶åˆ¤æ–­ã€‚
- å‡å°‘ä¸å¿…è¦çš„è§†å›¾åˆ·æ–°ï¼Œç¼“å­˜æ¸²æŸ“ç»“æœã€‚
- ä½¿ç”¨å·¥å…·å¦‚ Thymeleaf çš„ç¼“å­˜æœºåˆ¶æˆ–æœåŠ¡å™¨çº§åˆ«çš„ç¼“å­˜æ¥æå‡æ€§èƒ½ã€‚

### 4.3 æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½

æ•°æ®åº“æŸ¥è¯¢å¾€å¾€æ˜¯ Web åº”ç”¨ä¸­çš„ç“¶é¢ˆï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ã€‚å¦‚æœæ•°æ®åº“æŸ¥è¯¢æ²¡æœ‰è¿›è¡Œä¼˜åŒ–ï¼Œå¯èƒ½ä¼šå¯¼è‡´å“åº”é€Ÿåº¦å˜æ…¢ã€‚

#### è°ƒä¼˜å»ºè®®ï¼š

- ä½¿ç”¨ç¼“å­˜ï¼ˆå¦‚ Redisï¼‰ç¼“å­˜å¸¸ç”¨æ•°æ®ï¼Œé¿å…é¢‘ç¹æŸ¥è¯¢æ•°æ®åº“ã€‚
- ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢ï¼Œé¿å…ä¸€æ¬¡æ€§æŸ¥è¯¢è¿‡å¤šæ•°æ®ã€‚
- ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢è¯­å¥ï¼Œä½¿ç”¨ç´¢å¼•ã€é¿å… N+1 æŸ¥è¯¢ç­‰ã€‚

### 4.4 å†…å­˜æ³„æ¼

å†…å­˜æ³„æ¼å¯èƒ½å¯¼è‡´åº”ç”¨åœ¨é•¿æ—¶é—´è¿è¡Œåæ€§èƒ½ä¸‹é™ï¼Œç”šè‡³å´©æºƒã€‚

#### è°ƒä¼˜å»ºè®®ï¼š

- ä½¿ç”¨å†…å­˜åˆ†æå·¥å…·ï¼ˆå¦‚ VisualVMã€JProfilerï¼‰æ¥æ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µã€‚
- ç¡®ä¿å®šæ—¶é‡Šæ”¾ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚

------

## æ€»ç»“

Spring MVC çš„æ€§èƒ½ä¼˜åŒ–ä¸ä»…ä»…å±€é™äºä»£ç çš„æ”¹è¿›ï¼Œè¿˜åŒ…æ‹¬æœåŠ¡å™¨é…ç½®ã€ç¼“å­˜ç­–ç•¥å’Œå¤–éƒ¨èµ„æºçš„ç®¡ç†ã€‚é€šè¿‡ä¼˜åŒ–è¯·æ±‚å¤„ç†é“¾ã€JSON è½¬æ¢ã€é™æ€èµ„æºå’Œæ•°æ®åº“æŸ¥è¯¢ç­‰æ–¹é¢ï¼Œå¯ä»¥æ˜¾è‘—æå‡ Web åº”ç”¨çš„æ€§èƒ½ã€‚åŒæ—¶ï¼Œå¼€å‘è€…è¿˜åº”æŒæ¡å¸¸è§çš„æ€§èƒ½ç“¶é¢ˆè¯Šæ–­æŠ€å·§ï¼Œç¡®ä¿åœ¨ç”Ÿäº§ç¯å¢ƒä¸­èƒ½å¤Ÿå¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜ã€‚

# åä¸€ã€æµ‹è¯•ä¸è°ƒè¯•æ”¯æŒ

åœ¨ Spring MVC å¼€å‘ä¸­ï¼Œå•å…ƒæµ‹è¯•å’Œè°ƒè¯•æ”¯æŒæ˜¯ç¡®ä¿ç³»ç»Ÿè´¨é‡å’Œç¨³å®šæ€§çš„å…³é”®éƒ¨åˆ†ã€‚æœ‰æ•ˆçš„æµ‹è¯•èƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…åœ¨ä»£ç å˜æ›´åç¡®ä¿ç³»ç»Ÿçš„æ­£ç¡®æ€§ï¼Œå°¤å…¶æ˜¯å¯¹äº Web å±‚çš„æ§åˆ¶å™¨å’Œè¯·æ±‚å¤„ç†æµç¨‹ã€‚Spring æä¾›äº†å¤šç§å·¥å…·æ¥æ”¯æŒæ§åˆ¶å™¨çš„æµ‹è¯•ï¼Œç‰¹åˆ«æ˜¯ `MockMvc`ï¼Œå®ƒå¯ä»¥æ¨¡æ‹Ÿ HTTP è¯·æ±‚ï¼Œå¹¶å¸®åŠ©å¼€å‘è€…éªŒè¯è¯·æ±‚å¤„ç†çš„ç»“æœã€‚æœ¬ç« å°†è¯¦ç»†è®²è§£ Spring MVC ä¸­çš„æµ‹è¯•ä¸è°ƒè¯•æ”¯æŒï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•çš„å®ç°ã€è¯·æ±‚å‚æ•°æ¨¡æ‹Ÿå’Œå¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚

------

## 1. å•å…ƒæµ‹è¯•ä¸æ§åˆ¶å™¨ Mock æµ‹è¯•ï¼ˆMockMvcï¼‰

### 1.1 MockMvc æ¦‚è¿°

`MockMvc` æ˜¯ Spring æä¾›çš„ä¸€ç§ç”¨äºæµ‹è¯•æ§åˆ¶å™¨ï¼ˆControllerï¼‰çš„æ–¹æ³•ï¼Œå®ƒæ¨¡æ‹Ÿ HTTP è¯·æ±‚å¹¶éªŒè¯è¿”å›çš„ç»“æœï¼Œè€Œæ— éœ€å¯åŠ¨å®Œæ•´çš„ Web æœåŠ¡å™¨ã€‚é€šè¿‡ `MockMvc`ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•è¯·æ±‚æ˜ å°„ã€è¯·æ±‚å¤„ç†å’Œè§†å›¾æ¸²æŸ“ç­‰åŠŸèƒ½ï¼Œè€Œæ— éœ€ä¸å‰ç«¯æˆ–å®é™… HTTP æœåŠ¡è¿›è¡Œäº¤äº’ã€‚

#### ç¤ºä¾‹ï¼š

```java
@RunWith(SpringRunner.class)
@WebMvcTest(UserController.class)
public class UserControllerTest {

    @Autowired
    private MockMvc mockMvc;

    @MockBean
    private UserService userService;

    @Test
    public void testGetUser() throws Exception {
        User user = new User(1L, "Tom", 25);
        Mockito.when(userService.getUserById(1L)).thenReturn(user);

        mockMvc.perform(get("/user/{id}", 1L))
               .andExpect(status().isOk())
               .andExpect(jsonPath("$.name").value("Tom"))
               .andExpect(jsonPath("$.age").value(25));
    }
}
```

åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `@WebMvcTest` æ³¨è§£åŠ è½½ `UserController` ç±»ï¼Œæ¨¡æ‹Ÿ GET è¯·æ±‚ï¼ŒéªŒè¯è¿”å›çš„ JSON å“åº”æ•°æ®æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚

### 1.2 æµ‹è¯•æ­¥éª¤

1. **ä½¿ç”¨ `@WebMvcTest`**ï¼šè¿™ä¸ªæ³¨è§£ä¼šåˆå§‹åŒ– Spring MVC çš„ç›¸å…³é…ç½®ï¼ŒåªåŠ è½½ Web å±‚çš„ Beanï¼Œé¿å…åŠ è½½æ•´ä¸ª Spring ä¸Šä¸‹æ–‡ï¼Œæå‡æµ‹è¯•é€Ÿåº¦ã€‚
2. **`MockMvc` æ¨¡æ‹Ÿè¯·æ±‚**ï¼šé€šè¿‡ `MockMvc` æ¥æ¨¡æ‹Ÿ HTTP è¯·æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ `get()`ã€`post()`ã€`put()`ã€`delete()` ç­‰æ–¹æ³•æ¨¡æ‹Ÿä¸åŒçš„ HTTP æ–¹æ³•ã€‚
3. **æ–­è¨€éªŒè¯å“åº”**ï¼šä½¿ç”¨ `andExpect()` æ–¹æ³•å¯¹å“åº”ç»“æœè¿›è¡Œæ–­è¨€éªŒè¯ï¼Œå¸¸è§çš„éªŒè¯æœ‰çŠ¶æ€ç ã€å“åº”ä½“ã€å“åº”å¤´ç­‰ã€‚

------

## 2. æ¨¡æ‹Ÿè¯·æ±‚å‚æ•°ä¸çŠ¶æ€æ ¡éªŒ

### 2.1 æ¨¡æ‹Ÿè¯·æ±‚å‚æ•°

åœ¨æµ‹è¯•æ§åˆ¶å™¨æ—¶ï¼Œæ¨¡æ‹Ÿè¯·æ±‚å‚æ•°æ˜¯å¿…ä¸å¯å°‘çš„ç¯èŠ‚ã€‚å¯ä»¥é€šè¿‡ `MockMvc` æ¨¡æ‹Ÿè·¯å¾„å˜é‡ã€æŸ¥è¯¢å‚æ•°ã€è¯·æ±‚ä½“ç­‰ï¼Œæ¥éªŒè¯æ§åˆ¶å™¨æ˜¯å¦æ­£ç¡®å¤„ç†è¿™äº›å‚æ•°ã€‚

#### ç¤ºä¾‹ï¼šæ¨¡æ‹ŸæŸ¥è¯¢å‚æ•°

```java
@Test
public void testSearchUser() throws Exception {
    mockMvc.perform(get("/search").param("q", "Tom"))
           .andExpect(status().isOk())
           .andExpect(jsonPath("$.name").value("Tom"));
}
```

åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ `.param("q", "Tom")` æ¨¡æ‹ŸæŸ¥è¯¢å‚æ•°ï¼ŒéªŒè¯æ§åˆ¶å™¨æ˜¯å¦èƒ½å¤Ÿæ­£ç¡®æ¥æ”¶å¹¶å¤„ç†è¯¥å‚æ•°ã€‚

### 2.2 æ¨¡æ‹Ÿè¯·æ±‚ä½“

å¯¹äº `POST`ã€`PUT` ç­‰è¯·æ±‚æ–¹æ³•ï¼Œé€šå¸¸éœ€è¦æ¨¡æ‹Ÿè¯·æ±‚ä½“ä¸­çš„ JSON æ•°æ®ã€‚å¯ä»¥ä½¿ç”¨ `MockMvc` æä¾›çš„ `content()` æ–¹æ³•æ¥è®¾ç½®è¯·æ±‚ä½“ã€‚

#### ç¤ºä¾‹ï¼šæ¨¡æ‹Ÿè¯·æ±‚ä½“

```java
@Test
public void testCreateUser() throws Exception {
    User user = new User("Tom", 25);
    String json = new ObjectMapper().writeValueAsString(user);

    mockMvc.perform(post("/user")
                    .contentType(MediaType.APPLICATION_JSON)
                    .content(json))
           .andExpect(status().isCreated())
           .andExpect(jsonPath("$.name").value("Tom"))
           .andExpect(jsonPath("$.age").value(25));
}
```

åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Jackson å°† `User` å¯¹è±¡è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²ï¼Œç„¶åé€šè¿‡ `content()` æ–¹æ³•å°†å…¶ä½œä¸ºè¯·æ±‚ä½“å‘é€ã€‚

### 2.3 æ¨¡æ‹ŸçŠ¶æ€æ ¡éªŒ

çŠ¶æ€æ ¡éªŒæ˜¯æµ‹è¯•ä¸­å¸¸è§çš„éœ€æ±‚ï¼Œç¡®ä¿è¯·æ±‚è¿”å›çš„çŠ¶æ€ç å’Œå“åº”ä½“ç¬¦åˆé¢„æœŸã€‚å¸¸ç”¨çš„æ–­è¨€åŒ…æ‹¬ï¼š

- **çŠ¶æ€ç æ–­è¨€**ï¼šä½¿ç”¨ `andExpect(status().isOk())` æ¥æ–­è¨€ HTTP çŠ¶æ€ç ã€‚
- **JSON æ–­è¨€**ï¼šä½¿ç”¨ `jsonPath()` æ¥éªŒè¯ JSON å“åº”å†…å®¹ã€‚

#### ç¤ºä¾‹ï¼šéªŒè¯ HTTP çŠ¶æ€ç å’Œå“åº”ä½“

```java
@Test
public void testGetUserNotFound() throws Exception {
    mockMvc.perform(get("/user/{id}", 999L))
           .andExpect(status().isNotFound());
}
```

åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿè¯·æ±‚ä¸€ä¸ªä¸å­˜åœ¨çš„ç”¨æˆ· IDï¼Œå¹¶éªŒè¯è¿”å›çŠ¶æ€ä¸º `404 Not Found`ã€‚

------

## 3. Spring MVC æµ‹è¯•ä¸­å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### 3.1 é—®é¢˜ï¼š`@Autowired` æ— æ³•æ³¨å…¥ `MockMvc`

åœ¨æµ‹è¯•æ§åˆ¶å™¨æ—¶ï¼Œå¦‚æœæ— æ³•æ­£ç¡®æ³¨å…¥ `MockMvc`ï¼Œé€šå¸¸æ˜¯ç”±äºæµ‹è¯•ç¯å¢ƒçš„é…ç½®ä¸æ­£ç¡®ï¼Œå¯èƒ½æ²¡æœ‰æ­£ç¡®åŠ è½½ Spring çš„ Web ç¯å¢ƒã€‚

#### è§£å†³æ–¹æ¡ˆï¼š

ç¡®ä¿åœ¨æµ‹è¯•ç±»ä¸­ä½¿ç”¨äº† `@RunWith(SpringRunner.class)` å’Œ `@WebMvcTest` æ³¨è§£ï¼Œç¡®ä¿ Spring MVC é…ç½®æ­£ç¡®åŠ è½½ã€‚

```java
@RunWith(SpringRunner.class)
@WebMvcTest(UserController.class)
public class UserControllerTest {
    @Autowired
    private MockMvc mockMvc;
}
```

### 3.2 é—®é¢˜ï¼šæ— æ³•æ¨¡æ‹Ÿè¯·æ±‚ä½“ï¼ˆRequest Bodyï¼‰

å¦‚æœåœ¨æ¨¡æ‹Ÿ `POST` è¯·æ±‚æ—¶ï¼Œå‘ç°æ— æ³•æ­£ç¡®ä¼ é€’è¯·æ±‚ä½“ï¼ˆå¦‚ JSON æ•°æ®ï¼‰ï¼Œå¯èƒ½æ˜¯å› ä¸ºæ²¡æœ‰è®¾ç½®è¯·æ±‚çš„ `Content-Type`ã€‚

#### è§£å†³æ–¹æ¡ˆï¼š

ç¡®ä¿è¯·æ±‚è®¾ç½®äº†æ­£ç¡®çš„ `Content-Type`ï¼Œä¾‹å¦‚ `application/json`ï¼Œå¹¶ä½¿ç”¨ `.content()` æ–¹æ³•ä¼ é€’è¯·æ±‚ä½“ã€‚

```java
mockMvc.perform(post("/user")
        .contentType(MediaType.APPLICATION_JSON)
        .content(json))
       .andExpect(status().isCreated());
```

### 3.3 é—®é¢˜ï¼šæ— æ³•è§£æå“åº”ä½“

å¦‚æœåœ¨æ–­è¨€å“åº”ä½“æ—¶ï¼Œå‘ç°æ— æ³•æ­£ç¡®è§£æ JSON æ•°æ®ï¼Œé€šå¸¸æ˜¯å› ä¸ºè¿”å›çš„ JSON æ ¼å¼ä¸ç¬¦åˆé¢„æœŸï¼Œæˆ–è€… JSON å­—æ®µåä¸åŒ¹é…ã€‚

#### è§£å†³æ–¹æ¡ˆï¼š

ä½¿ç”¨ `jsonPath()` å¯¹è¿”å›çš„ JSON æ•°æ®è¿›è¡Œæ–­è¨€æ—¶ï¼Œç¡®ä¿å­—æ®µåå’Œç±»å‹ä¸è¿”å›çš„å“åº”ä½“ä¸€è‡´ã€‚è¿˜å¯ä»¥ä½¿ç”¨ `ObjectMapper` å¯¹è¿”å›çš„å“åº”ä½“è¿›è¡Œåºåˆ—åŒ–ï¼Œæ‰‹åŠ¨æ£€æŸ¥å…¶ç»“æ„ã€‚

```java
mockMvc.perform(get("/user/{id}", 1L))
       .andExpect(jsonPath("$.name").value("Tom"))
       .andExpect(jsonPath("$.age").value(25));
```

### 3.4 é—®é¢˜ï¼šæµ‹è¯•å¤±è´¥æ—¶è°ƒè¯•å›°éš¾

å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œéš¾ä»¥å¿«é€Ÿå®šä½é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ `ResultActions` çš„ `andDo(print())` æ–¹æ³•ï¼Œæ‰“å°å‡ºè¯·æ±‚å’Œå“åº”çš„è¯¦ç»†ä¿¡æ¯ã€‚

#### è§£å†³æ–¹æ¡ˆï¼š

```java
mockMvc.perform(get("/user/{id}", 1L))
       .andDo(print()) // æ‰“å°è¯·æ±‚å’Œå“åº”
       .andExpect(status().isOk());
```

é€šè¿‡ `andDo(print())`ï¼Œä½ å¯ä»¥æŸ¥çœ‹è¯·æ±‚çš„ URIã€è¯·æ±‚å‚æ•°ã€è¯·æ±‚ä½“å’Œå“åº”ä½“ç­‰è¯¦ç»†ä¿¡æ¯ï¼Œå¸®åŠ©å¿«é€Ÿå®šä½é—®é¢˜ã€‚

------

## æ€»ç»“

åœ¨ Spring MVC ä¸­ï¼Œæµ‹è¯•æ˜¯ä¿è¯ Web å±‚æ­£ç¡®æ€§å’Œç¨³å®šæ€§çš„é‡è¦æ‰‹æ®µã€‚é€šè¿‡ `MockMvc`ï¼Œå¼€å‘è€…å¯ä»¥è½»æ¾åœ°æ¨¡æ‹Ÿ HTTP è¯·æ±‚ï¼ŒéªŒè¯æ§åˆ¶å™¨çš„è¡Œä¸ºã€‚æ¨¡æ‹Ÿè¯·æ±‚å‚æ•°ã€è¯·æ±‚ä½“ã€éªŒè¯çŠ¶æ€ç å’Œå“åº”ä½“ç­‰å¸¸è§æ“ä½œï¼Œéƒ½æ˜¯æµ‹è¯•ä¸­çš„åŸºæœ¬éœ€æ±‚ã€‚åŒæ—¶ï¼Œäº†è§£ä¸€äº›å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼Œæœ‰åŠ©äºå¼€å‘è€…æ›´é«˜æ•ˆåœ°è¿›è¡Œæµ‹è¯•ä¸è°ƒè¯•ï¼Œç¡®ä¿ç³»ç»Ÿçš„é«˜è´¨é‡è¿è¡Œã€‚

# åäºŒã€Spring MVC å¸¸è§é¢è¯•é¢˜ä¸è®¾è®¡é¢˜

Spring MVC æ˜¯ Java Web å¼€å‘ä¸­çš„é‡è¦æ¡†æ¶ï¼Œæ·±å…¥ç†è§£å…¶åŸç†å’Œæ ¸å¿ƒç»„ä»¶ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…åœ¨é¢è¯•ä¸­è„±é¢–è€Œå‡ºã€‚æœ¬ç« å°†åˆ—ä¸¾ä¸€äº›å¸¸è§çš„é¢è¯•é¢˜å’Œè®¾è®¡é¢˜ï¼Œæ¶µç›– Spring MVC æ‰§è¡Œæµç¨‹ã€DispatcherServlet çš„å·¥ä½œåŸç†ã€å‚æ•°ç»‘å®šã€å…¨å±€å¼‚å¸¸å¤„ç†ç­‰å…³é”®æŠ€æœ¯ç‚¹ï¼Œå¹¶æä¾›å¯¹è¿™äº›é—®é¢˜çš„è¯¦ç»†è§£ç­”å’Œæ€è€ƒã€‚

------

## 1. Spring MVC æ‰§è¡Œæµç¨‹èƒ½å¦è¯¦ç»†æè¿°ï¼Ÿ

### **Spring MVC æ‰§è¡Œæµç¨‹æ¦‚è¿°**

Spring MVC çš„æ‰§è¡Œæµç¨‹å¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š

1. **å®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾ DispatcherServlet**
    å®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚é¦–å…ˆåˆ°è¾¾ `DispatcherServlet`ï¼Œå®ƒæ˜¯ Spring MVC çš„å‰ç«¯æ§åˆ¶å™¨ï¼Œè´Ÿè´£è¯·æ±‚çš„åˆ†å‘å’Œå¤„ç†ã€‚
2. **DispatcherServlet æŸ¥æ‰¾ HandlerMapping**
    `DispatcherServlet` ä¼šé€šè¿‡ `HandlerMapping` æŸ¥æ‰¾å¯¹åº”çš„æ§åˆ¶å™¨ï¼ˆControllerï¼‰æ¥å¤„ç†è¯¥è¯·æ±‚ã€‚`HandlerMapping` æ ¹æ®è¯·æ±‚çš„ URLã€è¯·æ±‚æ–¹æ³•ç­‰ä¿¡æ¯æ¥ç¡®å®šå…·ä½“çš„å¤„ç†æ–¹æ³•ã€‚
3. **HandlerAdapter è°ƒç”¨æ–¹æ³•**
    æ‰¾åˆ°å¯¹åº”çš„æ§åˆ¶å™¨åï¼Œ`HandlerAdapter` è´Ÿè´£è°ƒç”¨æ§åˆ¶å™¨çš„æ–¹æ³•æ¥å¤„ç†è¯·æ±‚ï¼Œå¹¶å°†è¿”å›å€¼ä¼ é€’ç»™ `DispatcherServlet`ã€‚
4. **è§†å›¾è§£æï¼ˆViewResolverï¼‰**
    å¦‚æœæ§åˆ¶å™¨è¿”å›çš„æ˜¯ä¸€ä¸ªè§†å›¾åï¼Œ`DispatcherServlet` ä¼šå°†è§†å›¾åä¼ é€’ç»™ `ViewResolver`ï¼Œé€šè¿‡è§†å›¾è§£æå™¨æ‰¾åˆ°ç›¸åº”çš„è§†å›¾å¯¹è±¡ï¼ˆå¦‚ JSP é¡µé¢ï¼‰ã€‚
5. **æ¸²æŸ“è§†å›¾**
    æœ€åï¼Œè§†å›¾ä¼šè¢«æ¸²æŸ“å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®Œæˆè¯·æ±‚çš„å“åº”ã€‚

------

## 2. DispatcherServlet æ˜¯å¦‚ä½•è°ƒåº¦è¯·æ±‚çš„ï¼Ÿ

`DispatcherServlet` æ˜¯ Spring MVC ä¸­çš„æ ¸å¿ƒç»„ä»¶ï¼Œå®ƒè´Ÿè´£æ•´ä¸ªè¯·æ±‚å¤„ç†è¿‡ç¨‹ã€‚å®ƒçš„è°ƒåº¦æµç¨‹å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š

1. **æ¥æ”¶è¯·æ±‚**
    `DispatcherServlet` ä½œä¸ºå‰ç«¯æ§åˆ¶å™¨æ¥æ”¶æ‰€æœ‰è¿›å…¥çš„ HTTP è¯·æ±‚ã€‚
2. **æŸ¥æ‰¾ HandlerMapping**
    `DispatcherServlet` æ ¹æ®è¯·æ±‚çš„ URLã€è¯·æ±‚æ–¹æ³•ç­‰ä¿¡æ¯ï¼Œé€šè¿‡é…ç½®çš„ `HandlerMapping` æŸ¥æ‰¾å¯¹åº”çš„æ§åˆ¶å™¨ï¼ˆHandlerï¼‰å’Œæ–¹æ³•ï¼ˆHandlerMethodï¼‰ã€‚
3. **è°ƒç”¨ HandlerAdapter**
    æ‰¾åˆ°åˆé€‚çš„æ§åˆ¶å™¨åï¼Œ`DispatcherServlet` ä½¿ç”¨ `HandlerAdapter` è°ƒç”¨æ§åˆ¶å™¨çš„æ–¹æ³•æ¥å¤„ç†è¯·æ±‚ã€‚`HandlerAdapter` æä¾›äº†å¯¹ä¸åŒç±»å‹çš„æ§åˆ¶å™¨çš„æ”¯æŒï¼Œä¾‹å¦‚ `@Controller` æˆ– `@RestController`ã€‚
4. **è§†å›¾è§£æä¸å“åº”**
    å¦‚æœæ§åˆ¶å™¨è¿”å›çš„æ˜¯è§†å›¾åç§°ï¼ˆä¾‹å¦‚ `ModelAndView`ï¼‰ï¼Œ`DispatcherServlet` ä¼šé€šè¿‡ `ViewResolver` æ‰¾åˆ°å¹¶æ¸²æŸ“è¯¥è§†å›¾ã€‚æœ€ç»ˆï¼Œå“åº”å†…å®¹é€šè¿‡ `HttpServletResponse` è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

------

## 3. å‚æ•°ç»‘å®šåº•å±‚åŸç†ä¸è‡ªå®šä¹‰ç»‘å®šï¼Ÿ

### **å‚æ•°ç»‘å®šåŸç†**

Spring MVC çš„å‚æ•°ç»‘å®šæœºåˆ¶ä¾èµ–äº `WebDataBinder`ï¼Œå®ƒå°† HTTP è¯·æ±‚çš„å‚æ•°ç»‘å®šåˆ°æ§åˆ¶å™¨æ–¹æ³•çš„å‚æ•°æˆ– JavaBean å±æ€§ä¸Šã€‚å¸¸è§çš„ç»‘å®šæ–¹å¼æœ‰ï¼š

1. **è¯·æ±‚å‚æ•°ç»‘å®š**
    `@RequestParam` ç”¨äºç»‘å®šæŸ¥è¯¢å‚æ•°ã€è¡¨å•å‚æ•°åˆ°æ§åˆ¶å™¨æ–¹æ³•çš„å‚æ•°ã€‚ä¾‹å¦‚ï¼š

   ```java
   @GetMapping("/user")
   public String getUser(@RequestParam("id") Long userId) { ... }
   ```

2. **è·¯å¾„å˜é‡ç»‘å®š**
    `@PathVariable` ç”¨äºç»‘å®š URL è·¯å¾„ä¸­çš„å˜é‡ã€‚ä¾‹å¦‚ï¼š

   ```java
   @GetMapping("/user/{id}")
   public String getUser(@PathVariable Long id) { ... }
   ```

3. **è¯·æ±‚ä½“ç»‘å®š**
    `@RequestBody` ç”¨äºç»‘å®šè¯·æ±‚ä½“ï¼ˆé€šå¸¸ä¸º JSONï¼‰åˆ°æ§åˆ¶å™¨æ–¹æ³•çš„å‚æ•°ã€‚ä¾‹å¦‚ï¼š

   ```java
   @PostMapping("/user")
   public String createUser(@RequestBody User user) { ... }
   ```

4. **æ¨¡å‹å¯¹è±¡ç»‘å®š**
    `@ModelAttribute` ç”¨äºç»‘å®šè¡¨å•æ•°æ®åˆ° JavaBean å¯¹è±¡ã€‚Spring ä¼šè‡ªåŠ¨å°†è¯·æ±‚å‚æ•°å¡«å……åˆ°è¯¥å¯¹è±¡çš„å±æ€§ä¸­ã€‚ä¾‹å¦‚ï¼š

   ```java
   @PostMapping("/register")
   public String register(@ModelAttribute UserForm userForm) { ... }
   ```

### **è‡ªå®šä¹‰ç»‘å®š**

Spring æä¾›äº†è‡ªå®šä¹‰ç±»å‹è½¬æ¢å’Œç»‘å®šçš„èƒ½åŠ›ã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡å®ç° `PropertyEditor` æˆ–ä½¿ç”¨ `@InitBinder` æ³¨è§£æ¥æ³¨å†Œè‡ªå®šä¹‰çš„å±æ€§ç¼–è¾‘å™¨ï¼Œå®ç°å¤æ‚çš„ç»‘å®šéœ€æ±‚ã€‚

#### ç¤ºä¾‹ï¼šè‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨

```java
@InitBinder
public void initBinder(WebDataBinder binder) {
    binder.registerCustomEditor(Date.class, new CustomDateEditor(new SimpleDateFormat("yyyy-MM-dd"), false));
}
```

------

## 4. å¦‚ä½•ä¼˜é›…åœ°å¤„ç†å…¨å±€å¼‚å¸¸ï¼Ÿæ˜¯å¦å¯ä»¥æŒ‰æ¨¡å—åˆ‡åˆ†ï¼Ÿ

### **å…¨å±€å¼‚å¸¸å¤„ç†**

åœ¨ Spring MVC ä¸­ï¼Œå¸¸ç”¨çš„å…¨å±€å¼‚å¸¸å¤„ç†æ–¹æ¡ˆæ˜¯ä½¿ç”¨ `@ControllerAdvice`ã€‚å®ƒå…è®¸æˆ‘ä»¬é›†ä¸­å¤„ç†æ‰€æœ‰æ§åˆ¶å™¨ä¸­çš„å¼‚å¸¸ï¼Œæä¾›ç»Ÿä¸€çš„å¼‚å¸¸å“åº”æ ¼å¼ã€‚

#### ç¤ºä¾‹ï¼šå…¨å±€å¼‚å¸¸å¤„ç†

```java
@ControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(Exception.class)
    public ResponseEntity<ApiResponse> handleException(Exception e) {
        ApiResponse response = new ApiResponse(500, "Internal Server Error", e.getMessage());
        return new ResponseEntity<>(response, HttpStatus.INTERNAL_SERVER_ERROR);
    }
}
```

### **æŒ‰æ¨¡å—åˆ‡åˆ†å¼‚å¸¸å¤„ç†**

å¦‚æœåº”ç”¨ç¨‹åºåŒ…å«å¤šä¸ªæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—æœ‰ä¸åŒçš„å¼‚å¸¸å¤„ç†éœ€æ±‚ï¼Œå¯ä»¥é€šè¿‡æŒ‰æ¨¡å—åˆ’åˆ†ä¸åŒçš„ `@ControllerAdvice` æ¥å®ç°ï¼š

```java
@ControllerAdvice(basePackages = "com.example.user")
public class UserExceptionHandler {
    @ExceptionHandler(UserNotFoundException.class)
    public ResponseEntity<ApiResponse> handleUserNotFound(UserNotFoundException e) {
        ApiResponse response = new ApiResponse(404, "User Not Found", e.getMessage());
        return new ResponseEntity<>(response, HttpStatus.NOT_FOUND);
    }
}
```

------

## 5. å¦‚ä½•åº”å¯¹é«˜å¹¶å‘ä¸‹ Controller æ€§èƒ½ç“¶é¢ˆï¼Ÿ

### **æ€§èƒ½ç“¶é¢ˆåˆ†æ**

åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼ŒController å±‚å¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œå¸¸è§çš„ç“¶é¢ˆæœ‰ï¼š

1. **é˜»å¡ I/O æ“ä½œ**
    å¦‚æœ Controller ä¸­å­˜åœ¨é˜»å¡çš„ I/O æ“ä½œï¼ˆä¾‹å¦‚æ•°æ®åº“æŸ¥è¯¢ã€æ–‡ä»¶æ“ä½œï¼‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Œå½±å“æ•´ä½“æ€§èƒ½ã€‚
2. **å¤æ‚è®¡ç®—**
    å¦‚æœ Controller è¿›è¡Œå¤æ‚çš„è®¡ç®—ï¼Œå¯èƒ½å¯¼è‡´å¤„ç†æ—¶é—´è¾ƒé•¿ï¼Œä»è€Œå½±å“å“åº”é€Ÿåº¦ã€‚

### **è§£å†³æ–¹æ¡ˆ**

1. **å¼‚æ­¥å¤„ç†**
    ä½¿ç”¨ `@Async` æ³¨è§£æˆ– `DeferredResult` æ¥å®ç°å¼‚æ­¥è¯·æ±‚å¤„ç†ï¼Œå‡å°‘çº¿ç¨‹é˜»å¡çš„å½±å“ã€‚

   ```java
   @Async
   @GetMapping("/process")
   public CompletableFuture<String> processData() {
       // å¤æ‚è®¡ç®—æˆ– I/O æ“ä½œ
       return CompletableFuture.completedFuture("Processed");
   }
   ```

2. **ç¼“å­˜æœºåˆ¶**
    ä½¿ç”¨ç¼“å­˜ï¼ˆå¦‚ `@Cacheable`ï¼‰æ¥å‡å°‘é‡å¤è®¡ç®—å’Œæ•°æ®åº“æŸ¥è¯¢ï¼Œæå‡ç³»ç»Ÿå“åº”é€Ÿåº¦ã€‚

3. **è´Ÿè½½å‡è¡¡**
    åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä½¿ç”¨è´Ÿè½½å‡è¡¡æŠ€æœ¯å°†è¯·æ±‚å‡åŒ€åˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å™¨ï¼Œé¿å…å•ç‚¹å‹åŠ›è¿‡å¤§ã€‚

4. **æ•°æ®åº“ä¼˜åŒ–**
    ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢ï¼Œé¿å…å…¨è¡¨æ‰«æï¼Œä½¿ç”¨ç´¢å¼•ã€æŸ¥è¯¢ç¼“å­˜ç­‰æŠ€æœ¯æé«˜æ•°æ®åº“å“åº”é€Ÿåº¦ã€‚

5. **çº¿ç¨‹æ± é…ç½®**
    é…ç½®é€‚å½“å¤§å°çš„çº¿ç¨‹æ± ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨é«˜å¹¶å‘ä¸‹èƒ½å¤Ÿé«˜æ•ˆå¤„ç†è¯·æ±‚ã€‚

------

## æ€»ç»“

Spring MVC é¢è¯•é¢˜æ¶‰åŠçš„å†…å®¹æ¶µç›–äº†ä»æ¡†æ¶åŸç†ã€è¯·æ±‚è°ƒåº¦åˆ°æ€§èƒ½ä¼˜åŒ–ã€å¼‚å¸¸å¤„ç†ç­‰å¤šä¸ªæ–¹é¢ã€‚é€šè¿‡å¯¹è¿™äº›é—®é¢˜çš„æ·±å…¥ç†è§£å’ŒæŒæ¡ï¼Œä¸ä»…èƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°åº”å¯¹é¢è¯•ï¼Œè¿˜èƒ½å¤Ÿæå‡åœ¨å®é™…å¼€å‘ä¸­çš„è®¾è®¡ä¸ä¼˜åŒ–èƒ½åŠ›ã€‚æŒæ¡è¿™äº›å¸¸è§çš„é¢è¯•é¢˜ï¼Œä¸ä»…æ˜¯ç†è§£ Spring MVC çš„ä¸€ä¸ªçª—å£ï¼Œä¹Ÿæ˜¯æ·±å…¥å¼€å‘æŠ€èƒ½çš„ä¸€ä¸ªé‡è¦ç¯èŠ‚ã€‚

## åä¸‰ã€æœ€ä½³å®è·µä¸æ¶æ„å»ºè®®

åœ¨å¼€å‘å¤§å‹ Spring MVC é¡¹ç›®æ—¶ï¼Œè‰¯å¥½çš„æ¶æ„è®¾è®¡å’Œå®è·µèƒ½å¸®åŠ©æå‡ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œæ€§èƒ½ã€‚æœ¬ç« å°†æ¢è®¨ä¸€äº›æœ€ä½³å®è·µä¸æ¶æ„å»ºè®®ï¼Œæ¶µç›– Controller å±‚è®¾è®¡ã€å“åº”å°è£…ã€æ¨¡å—åŒ–è®¾è®¡ä»¥åŠå¦‚ä½•ä½¿ç”¨æ‹¦æˆªå™¨ä¸ AOP è¿›è¡Œåˆ‡é¢é€»è¾‘å¤„ç†ç­‰å†…å®¹ã€‚

------

## 1. åˆ†å±‚ Controller è®¾è®¡ï¼šAPI å±‚ã€ä¸šåŠ¡å±‚è§£è€¦

åœ¨ Spring MVC ä¸­ï¼ŒController å±‚é€šå¸¸ä¼šæ‰¿æ‹…å¤„ç† HTTP è¯·æ±‚ã€è§£æå‚æ•°ã€è°ƒç”¨ä¸šåŠ¡é€»è¾‘ç­‰è´£ä»»ã€‚ä¸ºäº†æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œçµæ´»æ€§ï¼Œå»ºè®®å°†ä¸šåŠ¡é€»è¾‘ä¸ Controller å±‚è§£è€¦ï¼Œé‡‡ç”¨åˆ†å±‚è®¾è®¡ã€‚

### **åˆ†å±‚è®¾è®¡æ¦‚è¿°ï¼š**

1. **Controller å±‚**ï¼šè´Ÿè´£æ¥æ”¶ HTTP è¯·æ±‚ï¼Œå‚æ•°æ ¡éªŒï¼Œè°ƒç”¨ä¸šåŠ¡é€»è¾‘ï¼Œæœ€ç»ˆè¿”å›è§†å›¾æˆ– JSON æ•°æ®ã€‚Controller å±‚åº”è¯¥å°½é‡ç²¾ç®€ï¼Œé¿å…ä¸šåŠ¡é€»è¾‘çš„å®ç°ã€‚
2. **Service å±‚**ï¼šä¸šåŠ¡é€»è¾‘é€šå¸¸æ”¾åœ¨ Service å±‚ï¼ŒController åªè´Ÿè´£è°ƒç”¨ Service å±‚çš„æ–¹æ³•ï¼Œå¤„ç†å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚ã€‚è¿™æ ·ï¼Œä¸šåŠ¡é€»è¾‘å’Œ HTTP è¯·æ±‚çš„å¤„ç†è¢«è§£è€¦ï¼Œä½¿å¾—ä»£ç æ›´æ˜“äºæµ‹è¯•å’Œç»´æŠ¤ã€‚
3. **Repository å±‚**ï¼šæ•°æ®æŒä¹…åŒ–å±‚ï¼Œè´Ÿè´£ä¸æ•°æ®åº“äº¤äº’ã€‚å¯ä»¥ä½¿ç”¨ Spring Data JPAã€MyBatis ç­‰æŒä¹…å±‚æ¡†æ¶ã€‚

#### ç¤ºä¾‹ï¼šController å±‚è°ƒç”¨ Service å±‚

```java
@Controller
@RequestMapping("/user")
public class UserController {

    private final UserService userService;

    public UserController(UserService userService) {
        this.userService = userService;
    }

    @GetMapping("/{id}")
    @ResponseBody
    public User getUser(@PathVariable Long id) {
        return userService.getUserById(id);
    }
}
```

#### ç¤ºä¾‹ï¼šService å±‚å®ç°

```java
@Service
public class UserService {

    private final UserRepository userRepository;

    public UserService(UserRepository userRepository) {
        this.userRepository = userRepository;
    }

    public User getUserById(Long id) {
        return userRepository.findById(id).orElseThrow(() -> new UserNotFoundException("User not found"));
    }
}
```

------

## 2. ç»Ÿä¸€è¿”å›å€¼ç»“æ„ä¸å“åº”å°è£…æ–¹æ¡ˆ

ä¸ºäº†ç¡®ä¿ç³»ç»Ÿä¸­çš„å“åº”æ ¼å¼ç»Ÿä¸€ï¼Œå»ºè®®é‡‡ç”¨ç»Ÿä¸€çš„å“åº”å°è£…æ–¹æ¡ˆã€‚æ— è®ºæ˜¯è¿”å›æ•°æ®ï¼Œè¿˜æ˜¯è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œç»Ÿä¸€çš„æ ¼å¼èƒ½å¤Ÿç®€åŒ–å‰ç«¯å¤„ç†å’Œè°ƒè¯•ã€‚

### **ç»Ÿä¸€è¿”å›å€¼æ ¼å¼**

ä¸€ä¸ªå¸¸è§çš„ç»Ÿä¸€è¿”å›å€¼ç»“æ„å¦‚ä¸‹ï¼š

```java
public class ApiResponse<T> {
    private int code;
    private String message;
    private T data;

    public ApiResponse(int code, String message, T data) {
        this.code = code;
        this.message = message;
        this.data = data;
    }

    // Getters and setters
}
```

### **ç¤ºä¾‹ï¼šController å±‚è¿”å›ç»Ÿä¸€å“åº”**

```java
@Controller
@RequestMapping("/user")
public class UserController {

    private final UserService userService;

    public UserController(UserService userService) {
        this.userService = userService;
    }

    @GetMapping("/{id}")
    @ResponseBody
    public ApiResponse<User> getUser(@PathVariable Long id) {
        User user = userService.getUserById(id);
        return new ApiResponse<>(200, "Success", user);
    }
}
```

> ğŸ¯ **å®è·µå»ºè®®**ï¼š
>
> - ä½¿ç”¨æ ‡å‡†çš„ HTTP çŠ¶æ€ç ï¼ˆå¦‚ 200ã€404ã€500ï¼‰è¡¨ç¤ºè¯·æ±‚å¤„ç†çŠ¶æ€ã€‚
> - `code` å­—æ®µé€šå¸¸ç”¨äºæ ‡è¯†ä¸šåŠ¡é€»è¾‘çš„å¤„ç†ç»“æœã€‚
> - `message` å­—æ®µç”¨äºæä¾›æ›´å¤šçš„é”™è¯¯ä¿¡æ¯æˆ–æˆåŠŸæç¤ºã€‚
> - `data` å­—æ®µå­˜å‚¨è¿”å›çš„æ•°æ®å¯¹è±¡ã€‚

------

## 3. æ¨¡å—åŒ– MVC æ¶æ„å»ºè®®ï¼ˆå¦‚å¤šæ¨¡å—æ§åˆ¶å™¨æ³¨å†Œï¼‰

å¯¹äºå¤§å‹åº”ç”¨ï¼Œé‡‡ç”¨æ¨¡å—åŒ–æ¶æ„æ˜¯éå¸¸å¿…è¦çš„ã€‚Spring MVC æ”¯æŒé€šè¿‡ä¸åŒçš„ `@Controller` å’Œ `@RequestMapping` å®ç°æ¨¡å—åŒ–çš„è¯·æ±‚æ˜ å°„ã€‚ä¸ºäº†æé«˜ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ï¼Œå»ºè®®å°†ä¸åŒåŠŸèƒ½æ¨¡å—çš„ Controller åˆ†å¼€ï¼ŒæŒ‰æ¨¡å—è¿›è¡Œç®¡ç†ã€‚

### **æ¨¡å—åŒ–è®¾è®¡è¦ç‚¹ï¼š**

1. **æ¯ä¸ªæ¨¡å—æ‹¥æœ‰è‡ªå·±çš„ Controller å±‚**ï¼šä¾‹å¦‚ç”¨æˆ·ç®¡ç†ã€è®¢å•ç®¡ç†ç­‰åŠŸèƒ½æ¨¡å—åˆ†åˆ«æ‹¥æœ‰ç‹¬ç«‹çš„ Controller å±‚ã€‚
2. **ä½¿ç”¨ `@ComponentScan` æ‰«æä¸åŒæ¨¡å—çš„ Controller**ï¼šé€šè¿‡ä¸åŒçš„é…ç½®ç±»æ‰«æä¸åŒçš„æ¨¡å—ï¼Œé¿å…æ··æ‚åœ¨ä¸€èµ·ã€‚
3. **æ¨¡å—é—´è§£è€¦**ï¼šæ¯ä¸ªæ¨¡å—åº”è¯¥ç‹¬ç«‹å¼€å‘ï¼Œä¾èµ–æ¥å£è€Œéå®ç°ç±»ï¼Œé™ä½è€¦åˆåº¦ã€‚

#### ç¤ºä¾‹ï¼šæ¨¡å—åŒ– Controller æ³¨å†Œ

```java
@Configuration
@ComponentScan(basePackages = "com.example.user")
public class UserModuleConfig {
    // æ‰«æ User æ¨¡å—ç›¸å…³ç»„ä»¶
}

@Configuration
@ComponentScan(basePackages = "com.example.order")
public class OrderModuleConfig {
    // æ‰«æ Order æ¨¡å—ç›¸å…³ç»„ä»¶
}
```

------

## 4. å¦‚ä½•åˆç†ä½¿ç”¨æ‹¦æˆªå™¨ä¸ AOP åšåˆ‡é¢é€»è¾‘å¤„ç†

### **æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰ä¸ AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰**

åœ¨ Spring MVC ä¸­ï¼Œæ‹¦æˆªå™¨å’Œ AOP æä¾›äº†éå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬åœ¨è¯·æ±‚å¤„ç†çš„å„ä¸ªç¯èŠ‚æ’å…¥ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚æ—¥å¿—è®°å½•ã€æƒé™æ ¡éªŒã€äº‹åŠ¡ç®¡ç†ç­‰ã€‚

#### **æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰**ï¼š

æ‹¦æˆªå™¨ç”¨äºå¤„ç†è¯·æ±‚å’Œå“åº”çš„é¢„å¤„ç†å’Œåå¤„ç†ã€‚é€šè¿‡å®ç° `HandlerInterceptor` æ¥å£ï¼Œå¯ä»¥åœ¨è¯·æ±‚åˆ°è¾¾æ§åˆ¶å™¨ä¹‹å‰ã€æ‰§è¡Œå®Œæ§åˆ¶å™¨æ–¹æ³•åã€è§†å›¾æ¸²æŸ“ä¹‹å‰è¿›è¡Œä¸€äº›æ“ä½œã€‚

#### ç¤ºä¾‹ï¼šæ‹¦æˆªå™¨å®ç°

```java
@Component
public class AuthInterceptor implements HandlerInterceptor {

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        // åœ¨è¯·æ±‚åˆ°è¾¾æ§åˆ¶å™¨ä¹‹å‰è¿›è¡Œæƒé™æ ¡éªŒ
        if (request.getSession().getAttribute("user") == null) {
            response.sendRedirect("/login");
            return false;
        }
        return true;
    }
}
```

#### **AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰**ï¼š

AOP æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹çš„æ ¸å¿ƒï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°æ’å…¥ç‰¹å®šè¡Œä¸ºåˆ°ç›®æ ‡æ–¹æ³•ä¸­ï¼Œå¸¸ç”¨äºæ—¥å¿—è®°å½•ã€æ€§èƒ½ç›‘æ§ã€äº‹åŠ¡ç®¡ç†ç­‰åœºæ™¯ã€‚

#### ç¤ºä¾‹ï¼šä½¿ç”¨ AOP è®°å½•æ—¥å¿—

```java
@Aspect
@Component
public class LoggingAspect {

    @Before("execution(* com.example.*.*(..))")
    public void logBefore(JoinPoint joinPoint) {
        System.out.println("Method " + joinPoint.getSignature().getName() + " is about to be executed");
    }

    @After("execution(* com.example.*.*(..))")
    public void logAfter(JoinPoint joinPoint) {
        System.out.println("Method " + joinPoint.getSignature().getName() + " has been executed");
    }
}
```

### **æ‹¦æˆªå™¨ä¸ AOP çš„é€‰æ‹©**

- **æ‹¦æˆªå™¨**ï¼šé€‚ç”¨äºéœ€è¦å¯¹è¯·æ±‚ã€å“åº”è¿›è¡Œå¤„ç†ï¼Œæˆ–è€…åœ¨æ§åˆ¶å™¨æ–¹æ³•è°ƒç”¨å‰åè¿›è¡Œæ“ä½œã€‚
- **AOP**ï¼šé€‚ç”¨äºè·¨å¤šä¸ªæ–¹æ³•ã€ç±»çš„é€»è¾‘ï¼Œå¦‚æ—¥å¿—è®°å½•ã€äº‹åŠ¡å¤„ç†ç­‰ï¼ŒAOP å¯ä»¥åœ¨ä¸æ”¹å˜æ–¹æ³•é€»è¾‘çš„æƒ…å†µä¸‹å¢åŠ é¢å¤–åŠŸèƒ½ã€‚

------

## æ€»ç»“

Spring MVC æä¾›äº†å¼ºå¤§çš„åŠŸèƒ½æ”¯æŒï¼Œä½†æ­£ç¡®çš„æ¶æ„è®¾è®¡å’Œå®è·µæ˜¯æå‡åº”ç”¨æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§çš„å…³é”®ã€‚é€šè¿‡åˆç†çš„ Controller å±‚åˆ†å±‚è®¾è®¡ã€ç»Ÿä¸€çš„å“åº”ç»“æ„ã€æ¨¡å—åŒ–æ¶æ„ä»¥åŠä½¿ç”¨æ‹¦æˆªå™¨ä¸ AOP è¿›è¡Œåˆ‡é¢é€»è¾‘å¤„ç†ï¼Œå¯ä»¥ä½¿å¾—ç³»ç»Ÿæ›´åŠ æ¸…æ™°ã€æ˜“äºæ‰©å±•å’Œç»´æŠ¤ã€‚è¿™äº›æœ€ä½³å®è·µå°†å¸®åŠ©å¼€å‘è€…åœ¨æ—¥å¸¸å¼€å‘ä¸­æ›´åŠ é«˜æ•ˆï¼ŒåŒæ—¶ä¸ºæ„å»ºé«˜è´¨é‡ã€å¯æ‰©å±•çš„åº”ç”¨æ‰“ä¸‹åšå®çš„åŸºç¡€ã€‚
