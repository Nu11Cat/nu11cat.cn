---
title : 2.JDBC
---

# ç›®å½•

## ä¸€ã€JDBC åŸºç¡€å…¥é—¨ï¼šæ•°æ®åº“è®¿é—®çš„åŸå§‹æ¥å£

- JDBC æ˜¯ä»€ä¹ˆï¼Ÿå®ƒåœ¨ Java ä¸­æ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼Ÿ
- JDBC å·¥ä½œåŸç†å›¾è§£ï¼ˆé©±åŠ¨ -> è¿æ¥ -> æ‰§è¡Œ -> å…³é—­ï¼‰
- å¸¸è§ JDBC é©±åŠ¨ç±»å‹åŠå·®å¼‚
- ç¬¬ä¸€ä¸ª JDBC ç¤ºä¾‹ç¨‹åºï¼šè¿æ¥æ•°æ®åº“ + æ‰§è¡ŒæŸ¥è¯¢

## äºŒã€JDBC æ ¸å¿ƒ API è¯¦è§£

- æ ¸å¿ƒæ¥å£ä»‹ç»ï¼š`DriverManager` / `Connection` / `Statement` / `PreparedStatement` / `ResultSet`
- PreparedStatement ä¸ Statement çš„åŒºåˆ«ä¸å®‰å…¨æ€§ï¼ˆé˜²æ­¢ SQL æ³¨å…¥ï¼‰
- ResultSet éå†ä¸æ•°æ®æå–æŠ€å·§
- JDBC æ“ä½œæµç¨‹å…­æ­¥è¯¦è§£

## ä¸‰ã€JDBC ä¸äº‹åŠ¡æ§åˆ¶

- JDBC ä¸­çš„äº‹åŠ¡æ§åˆ¶ï¼šè‡ªåŠ¨æäº¤ä¸æ‰‹åŠ¨æäº¤
- `commit()`ã€`rollback()` çš„ä½¿ç”¨ä¸å®æˆ˜
- å¤šäº‹åŠ¡åµŒå¥—æ§åˆ¶åŠæ³¨æ„äº‹é¡¹
- å¦‚ä½•å¤„ç†äº‹åŠ¡ä¸­æ–­å¼‚å¸¸ï¼Ÿé¢è¯•å¸¸é—®é™·é˜±é¢˜è§£æ

## å››ã€JDBC å®æˆ˜ï¼šå¢åˆ æ”¹æŸ¥ CURD æ¨¡æ¿

- é€šç”¨ CURD æ¨¡æ¿å°è£…
- æ‰¹é‡æ’å…¥ä¸æ‰¹å¤„ç†ä¼˜åŒ–ï¼ˆ`addBatch()` / `executeBatch()`ï¼‰
- å®æˆ˜æ¼”ç»ƒï¼šå®ç°ä¸€ä¸ªç®€æ˜“ DAO å±‚
- JDBC ä¸ç”¨æˆ·ç™»å½•/æ³¨å†Œ/åˆ†é¡µæŸ¥è¯¢ç­‰å…¸å‹ä¸šåŠ¡ç¤ºä¾‹

## äº”ã€JDBC æ€§èƒ½ä¼˜åŒ–ä¸è¿æ¥æ± æŠ€æœ¯

- JDBC æ€§èƒ½ç“¶é¢ˆåˆ†æ
- ä¸ºä»€ä¹ˆä¸èƒ½é¢‘ç¹å¼€å…³è¿æ¥ï¼Ÿ
- å¸¸è§è¿æ¥æ± æŠ€æœ¯å¯¹æ¯”ï¼šC3P0ã€DBCPã€HikariCPã€Druid
- HikariCP å®è·µï¼šé…ç½®ã€ç›‘æ§ã€è°ƒä¼˜

## å…­ã€JDBC ä¸æ•°æ®åº“å®‰å…¨

- é˜²æ­¢ SQL æ³¨å…¥çš„æœ€ä½³å®è·µ
- å‚æ•°é¢„ç¼–è¯‘çš„ä½œç”¨ä¸å±€é™
- æ•°æ®åº“æƒé™æ§åˆ¶ï¼ˆä»ä»£ç åˆ°æ•°æ®åº“ç”¨æˆ·ï¼‰

## ä¸ƒã€JDBC ä¸æ¡†æ¶é›†æˆ

- Spring JDBC ç®€ä»‹ï¼šæ¯”åŸç”Ÿ JDBC æ›´é«˜æ•ˆ
- Spring JDBC æ¨¡æ¿ï¼ˆJdbcTemplateï¼‰ä½¿ç”¨æŒ‡å—
- ä¸ MyBatis çš„å¯¹æ¯”ï¼ˆJDBC å’Œ ORM ä¹‹é—´çš„é€‰æ‹©ï¼‰
- ä¼ä¸šé¡¹ç›®ä¸­ JDBC çš„å…¸å‹åº”ç”¨åœºæ™¯

## å…«ã€å¸¸è§é—®é¢˜ä¸é¢è¯•é¢˜ç²¾é€‰

- JDBC ä¸è¿æ¥æ± çš„é¢è¯•é«˜é¢‘é¢˜è§£æ
- JDBC å¦‚ä½•å®ç°äº‹åŠ¡æ§åˆ¶ï¼ŸåµŒå¥—äº‹åŠ¡å¦‚ä½•å¤„ç†ï¼Ÿ
- å¦‚ä½•è§£å†³ JDBC ä¸­è¿æ¥æ³„æ¼é—®é¢˜ï¼Ÿ
- é¢è¯•å®˜æé—®ï¼šâ€œå¦‚æœè®©ä½ å°è£…ä¸€ä¸ªé€šç”¨ JDBC å·¥å…·ç±»ï¼Œä½ æ€ä¹ˆè®¾è®¡ï¼Ÿâ€

------

# ä¸€ã€JDBC åŸºç¡€å…¥é—¨ï¼šæ•°æ®åº“è®¿é—®çš„åŸå§‹æ¥å£

åœ¨ Java å¼€å‘ä¸­ï¼Œ**æ— è®ºä½ æ˜¯å¦ä½¿ç”¨æ¡†æ¶å¦‚ MyBatisã€JPAã€Hibernateï¼ŒJDBC å§‹ç»ˆæ˜¯åº•å±‚çš„æ ¹åŸº**ã€‚ç†è§£å®ƒï¼Œä¸ä»…èƒ½å¸®åŠ©ä½ æ‰“å¥½åŸºæœ¬åŠŸï¼Œè¿˜èƒ½åœ¨é¢è¯•ä¸­å±•ç¤ºä½ å¯¹åŸç†çš„æŒæ§åŠ›ã€‚

------

## 1.1 JDBC æ˜¯ä»€ä¹ˆï¼Ÿå®ƒåœ¨ Java ä¸­æ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼Ÿ

JDBCï¼ˆJava Database Connectivityï¼‰æ˜¯ Java å®˜æ–¹æä¾›çš„ä¸€å¥— **ç”¨äºæ“ä½œæ•°æ®åº“çš„ API æ¥å£è§„èŒƒ**ï¼Œä¸»è¦ç”¨æ¥ï¼š

- è¿æ¥æ•°æ®åº“ï¼ˆMySQLã€Oracleã€PostgreSQL ç­‰ï¼‰
- æ‰§è¡Œ SQLï¼ˆæŸ¥è¯¢ã€æ’å…¥ã€æ›´æ–°ã€åˆ é™¤ï¼‰
- è·å–æ‰§è¡Œç»“æœ
- æ§åˆ¶äº‹åŠ¡ï¼ˆæäº¤ / å›æ»šï¼‰

> ğŸ“Œ é€šä¿—ç†è§£ï¼šJDBC å°±æ˜¯ Java å’Œæ•°æ®åº“ä¹‹é—´çš„â€œç¿»è¯‘å™¨â€ã€‚

#### é¢è¯•å®˜å¸¸é—®ï¼š

> â€œä½ å†™è¿‡ JDBC å—ï¼Ÿå®ƒå’Œ MyBatis çš„æœ¬è´¨åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿâ€

âœ… å›ç­”å»ºè®®ï¼š

- JDBC æ˜¯ä½å±‚åŸç”Ÿæ¥å£ï¼ŒMyBatis æ˜¯å¯¹ JDBC çš„å°è£…ï¼›
- JDBC æ›´çµæ´»ä½†ä»£ç å¤šï¼ŒMyBatis ç®€æ´ä½†å°è£…æ·±ï¼›
- ç†è§£ JDBC åŸç†æœ‰åŠ©äºå®šä½ MyBatis çš„æ€§èƒ½é—®é¢˜ã€‚

------

## 1.2 JDBC çš„å·¥ä½œåŸç†ï¼ˆæµç¨‹å›¾ï¼‰

JDBC å·¥ä½œæµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š

```
åŠ è½½é©±åŠ¨ â†’ è·å–è¿æ¥ â†’ åˆ›å»º Statement â†’ æ‰§è¡Œ SQL â†’ å¤„ç†ç»“æœ â†’ å…³é—­èµ„æº
```

ä½ å¯ä»¥ç±»æ¯”ç†è§£ä¸ºï¼š

> **ä½ ï¼ˆJava ç¨‹åºï¼‰ â†’ è¯´è¯ç¿»è¯‘ï¼ˆJDBC é©±åŠ¨ï¼‰ â†’ æ•°æ®åº“ â†’ ç»™å‡ºå›åº” â†’ ç¿»è¯‘å›æ¥ â†’ ä½ å¤„ç†ç»“æœ**

å…³é”®ç±»ä¸æ¥å£å¦‚ä¸‹ï¼š

| æ­¥éª¤     | å¯¹åº”ç±»æˆ–æ–¹æ³•                      | è¯´æ˜           |
| -------- | --------------------------------- | -------------- |
| åŠ è½½é©±åŠ¨ | `Class.forName()`                 | æ³¨å†Œ JDBC é©±åŠ¨ |
| è·å–è¿æ¥ | `DriverManager.getConnection()`   | è¿æ¥æ•°æ®åº“     |
| æ‰§è¡Œè¯­å¥ | `Statement` / `PreparedStatement` | å‘èµ· SQL       |
| å¤„ç†ç»“æœ | `ResultSet`                       | æŸ¥è¯¢ç»“æœ       |
| å…³é—­èµ„æº | `close()` æ–¹æ³•                    | é˜²æ­¢è¿æ¥æ³„æ¼   |

------

## 1.3 å¸¸è§ JDBC é©±åŠ¨ç±»å‹åŠåŒºåˆ«

JDBC é©±åŠ¨åˆ†ä¸º 4 ç§ç±»å‹ï¼Œäº†è§£å³å¯ï¼Œé¢è¯•å¯é‡ç‚¹è®° Type 4ã€‚

| ç±»å‹       | ç®€ä»‹             | ç¤ºä¾‹                           | æ˜¯å¦æ¨è         |
| ---------- | ---------------- | ------------------------------ | ---------------- |
| Type 1     | JDBC-ODBC æ¡¥æ¥   | æ—©æœŸç‰ˆæœ¬ï¼Œå‡ ä¹åºŸå¼ƒ             | âŒ ä¸æ¨è         |
| Type 2     | Java åˆ°æœ¬åœ° API  | ä¾èµ–æœ¬åœ°åº“ï¼ˆDLLã€soï¼‰          | âŒ ç§»æ¤æ€§å·®       |
| Type 3     | ä¸­é—´æœåŠ¡å™¨è½¬å‘   | ç¨€æœ‰ï¼Œå¤æ‚                     | âŒ                |
| **Type 4** | **çº¯ Java é©±åŠ¨** | å¦‚ï¼š`com.mysql.cj.jdbc.Driver` | âœ… æœ€å¸¸ç”¨ã€æ€§èƒ½å¥½ |

------

## 1.4 ç¬¬ä¸€ä¸ª JDBC ç¤ºä¾‹ç¨‹åº

```java
import java.sql.*;

public class JdbcDemo {
    public static void main(String[] args) throws Exception {
        // 1. åŠ è½½é©±åŠ¨ï¼ˆMySQL 8 ä»¥åå¯çœç•¥ï¼‰
        Class.forName("com.mysql.cj.jdbc.Driver");

        // 2. è·å–è¿æ¥
        Connection conn = DriverManager.getConnection(
                "jdbc:mysql://localhost:3306/testdb?serverTimezone=UTC", 
                "root", "password");

        // 3. åˆ›å»º Statement æ‰§è¡Œ SQL
        String sql = "SELECT id, name FROM users";
        Statement stmt = conn.createStatement();
        ResultSet rs = stmt.executeQuery(sql);

        // 4. å¤„ç†ç»“æœ
        while (rs.next()) {
            int id = rs.getInt("id");
            String name = rs.getString("name");
            System.out.println("ç”¨æˆ·ID: " + id + "ï¼Œç”¨æˆ·åï¼š" + name);
        }

        // 5. å…³é—­èµ„æº
        rs.close();
        stmt.close();
        conn.close();
    }
}
```

âœ… é‡ç‚¹æé†’ï¼š

- è¦å¯¼å…¥ MySQL JDBC é©±åŠ¨ jar åŒ…ï¼ˆå¦‚ï¼š`mysql-connector-j`ï¼‰
- ä½¿ç”¨å®Œè¿æ¥å¿…é¡»å…³é—­ï¼Œé¿å…â€œè¿æ¥æ³„æ¼â€
- å®é™…é¡¹ç›®ä¸­ä¸ç›´æ¥ä½¿ç”¨ `Statement`ï¼Œè€Œæ˜¯ç”¨ `PreparedStatement`

------

## æ€»ç»“

- JDBC æ˜¯æ•°æ®åº“è®¿é—®çš„åŸºç¡€æŠ€èƒ½ï¼Œ**è™½ç„¶åœ¨é¡¹ç›®ä¸­è¢«æ¡†æ¶å°è£…ï¼Œä½†é¢è¯•æ—¶ç»å¸¸ä¼šé—®åº•å±‚ç»†èŠ‚**ï¼›
- è®°ä½å…­æ­¥æµç¨‹ï¼Œå°¤å…¶æ˜¯è¿æ¥è·å–ã€é¢„ç¼–è¯‘ SQLã€é˜²æ­¢æ³¨å…¥ï¼›
- JDBC æ˜¯å­¦ä¹  Spring JDBCã€MyBatis çš„å‰æã€‚

------

å¥½çš„ï¼Œä¸‹é¢æ˜¯ç¬¬äºŒç« çš„æ­£æ–‡å†…å®¹ï¼Œç»§ç»­åšæŒâ€œåŸç† + å®æˆ˜ + é¢è¯•â€çš„æ€è·¯ï¼Œå¸®åŠ© Java å­¦ä¹ è€…å…¨é¢æŒæ¡ JDBC æ ¸å¿ƒæ¥å£ã€‚

------

# äºŒã€JDBC æ ¸å¿ƒ API è¯¦è§£

å­¦ä¹  JDBCï¼Œæœ€ç»•ä¸å¼€çš„å°±æ˜¯è¿™å‡ ä¸ªæ ¸å¿ƒæ¥å£ï¼š`DriverManager`ã€`Connection`ã€`Statement`ã€`PreparedStatement`ã€`ResultSet`ã€‚è¿™äº›ä¸œè¥¿ä¸ä»…å†™ä»£ç ç”¨å¾—ä¸Šï¼Œé¢è¯•æ—¶ä¹Ÿå¸¸è¢«ç”¨æ¥è€ƒå¯Ÿå¯¹åº•å±‚æœºåˆ¶çš„ç†è§£ã€‚

------

## 2.1 æ ¸å¿ƒæ¥å£ä¸€è§ˆ

| æ¥å£/ç±»å           | ä½œç”¨                                      |
| ------------------- | ----------------------------------------- |
| `DriverManager`     | ç®¡ç†æ•°æ®åº“é©±åŠ¨ï¼Œåˆ›å»ºæ•°æ®åº“è¿æ¥            |
| `Connection`        | è¡¨ç¤ºæ•°æ®åº“è¿æ¥ï¼Œæ”¯æŒäº‹åŠ¡ç®¡ç†              |
| `Statement`         | ç”¨äºæ‰§è¡Œé™æ€ SQL è¯­å¥                     |
| `PreparedStatement` | ç”¨äºæ‰§è¡Œå‚æ•°åŒ– SQLï¼Œé¢„ç¼–è¯‘ï¼Œé˜²æ­¢ SQL æ³¨å…¥ |
| `ResultSet`         | æŸ¥è¯¢ç»“æœé›†ï¼Œå¯éå†è¯»å–æ¯ä¸€è¡Œæ•°æ®          |

------

## 2.2 `PreparedStatement` ä¸ `Statement` çš„åŒºåˆ«ä¸ä¼˜åŠ£

è™½ç„¶ä¸¤è€…éƒ½èƒ½æ‰§è¡Œ SQLï¼Œä½†å·®è·å¾ˆå¤§ã€‚

#### âœ… Statement ç¤ºä¾‹ï¼ˆä¸æ¨èï¼‰ï¼š

```java
Statement stmt = conn.createStatement();
ResultSet rs = stmt.executeQuery("SELECT * FROM users WHERE name = '" + name + "'");
```

##### é—®é¢˜ï¼š

- SQL æ‹¼æ¥éº»çƒ¦
- **å­˜åœ¨ SQL æ³¨å…¥é£é™©**
- æ— æ³•é¢„ç¼–è¯‘ï¼Œæ€§èƒ½å·®

------

#### âœ… PreparedStatement ç¤ºä¾‹ï¼ˆæ¨èï¼‰ï¼š

```java
PreparedStatement ps = conn.prepareStatement("SELECT * FROM users WHERE name = ?");
ps.setString(1, name);
ResultSet rs = ps.executeQuery();
```

##### ä¼˜ç‚¹ï¼š

- **é¢„ç¼–è¯‘ï¼Œæé«˜æ€§èƒ½ï¼ˆå°¤å…¶åœ¨æ‰¹é‡å¤„ç†æ—¶ï¼‰**
- **é˜²æ­¢ SQL æ³¨å…¥**
- ä»£ç ç»“æ„æ¸…æ™°ï¼Œå‚æ•°ç±»å‹æ›´å®‰å…¨

> ğŸ¯ é¢è¯•å®˜å¸¸é—®ï¼šä½ èƒ½è®²è®² PreparedStatement å’Œ Statement çš„åŒºåˆ«å—ï¼Ÿ
>
> å›ç­”æ€è·¯ï¼š
>
> - å®‰å…¨æ€§ï¼šPreparedStatement èƒ½é˜² SQL æ³¨å…¥ï¼ŒStatement ä¸èƒ½ï¼›
> - æ€§èƒ½ï¼šPreparedStatement ä¼šé¢„ç¼–è¯‘ SQLï¼Œæé«˜æ•ˆç‡ï¼›
> - å¯ç»´æŠ¤æ€§ï¼šPreparedStatement å‚æ•°ç»‘å®šæ¸…æ™°ï¼ŒSQL æ‹¼æ¥æ›´å®‰å…¨ç®€æ´ã€‚

------

## 2.3 ResultSet éå†ä¸æ•°æ®æå–æŠ€å·§

`ResultSet` æ˜¯ SQL æŸ¥è¯¢ç»“æœçš„å°è£…å¯¹è±¡ï¼Œéå†å®ƒçš„æ–¹å¼å¦‚ä¸‹ï¼š

```java
while (rs.next()) {
    int id = rs.getInt("id");
    String name = rs.getString("name");
    // è¿˜å¯ä»¥ rs.getDate(), rs.getDouble() ç­‰
}
```

#### å¸¸è§é—®é¢˜ï¼š

- åˆ«å¿˜äº†å…ˆ `rs.next()` ç§»åŠ¨æŒ‡é’ˆï¼
- å­—æ®µç±»å‹è¦å’Œæ•°æ®åº“å­—æ®µåŒ¹é…ï¼Œé¿å…ç±»å‹è½¬æ¢é”™è¯¯

------

## 2.4 JDBC æ“ä½œæµç¨‹å…­æ­¥è¯¦è§£

è¿™å…­æ­¥æ˜¯ç»å…¸å¥—è·¯ï¼Œä¹Ÿæ˜¯æ¯ä¸€é“ JDBC é¢è¯•é¢˜çš„â€œåŸºæœ¬åŠŸâ€ã€‚

| æ­¥éª¤ | è¯´æ˜          | ç¤ºä¾‹                                                         |
| ---- | ------------- | ------------------------------------------------------------ |
| 1    | åŠ è½½é©±åŠ¨      | `Class.forName("com.mysql.cj.jdbc.Driver");`ï¼ˆæ–°ç‰ˆæœ¬å¯çœç•¥ï¼‰ |
| 2    | è·å–è¿æ¥      | `DriverManager.getConnection(...)`                           |
| 3    | åˆ›å»º SQL å¯¹è±¡ | `PreparedStatement ps = conn.prepareStatement(sql);`         |
| 4    | æ‰§è¡Œ SQL      | `ps.executeQuery()` æˆ– `ps.executeUpdate()`                  |
| 5    | å¤„ç†ç»“æœ      | éå† `ResultSet`                                             |
| 6    | é‡Šæ”¾èµ„æº      | å…ˆå…³ `ResultSet`ï¼Œå†å…³ `Statement`ï¼Œæœ€åå…³ `Connection`      |

------

### âš ï¸ æ³¨æ„èµ„æºé‡Šæ”¾é¡ºåº

èµ„æºé‡Šæ”¾é¡ºåºå¿…é¡»ä»â€œæœ€å°â€å‘â€œæœ€å¤§â€ä¾æ¬¡å…³é—­ï¼š

```java
try {
    // ä½¿ç”¨èµ„æº
} finally {
    if (rs != null) rs.close();
    if (ps != null) ps.close();
    if (conn != null) conn.close();
}
```

æˆ–è€…ä½¿ç”¨ Java 7+ çš„ try-with-resourcesï¼š

```java
try (
    Connection conn = ...;
    PreparedStatement ps = ...;
    ResultSet rs = ...
) {
    // è‡ªåŠ¨å…³é—­èµ„æº
}
```

------

### å°ç»“

- JDBC æœ€æ ¸å¿ƒçš„æ¥å£å°±æ˜¯è¿™ä¸€ç»„ï¼š`Connection`ã€`PreparedStatement`ã€`ResultSet`ï¼›
- **PreparedStatement æ˜¯é¢è¯•æœ€å–œæ¬¢è€ƒçš„ç‚¹ï¼ŒåŠ¡å¿…æŒæ¡å…¶ä¼˜åŠ¿ä¸ä½¿ç”¨æ–¹å¼**ï¼›
- ç†è§£ JDBC çš„å…­æ­¥æµç¨‹ï¼Œæ˜¯ä¹‹åå­¦ä¹  Spring JDBC / MyBatis çš„åŸºç¡€ã€‚

------

å¥½çš„ï¼Œä¸‹é¢æ˜¯ç¬¬ä¸‰ç« çš„æ­£æ–‡å†…å®¹ï¼Œèšç„¦äº JDBC ä¸­çš„äº‹åŠ¡æ§åˆ¶æœºåˆ¶ã€‚è¿™éƒ¨åˆ†æ—¢æ˜¯ JDBC çš„é‡ç‚¹ï¼Œä¹Ÿä¸æ•°æ®åº“äº‹åŠ¡çŸ¥è¯†ï¼ˆACIDï¼‰é«˜åº¦å…³è”ï¼Œæ˜¯é¢è¯•çš„å¸¸è€ƒæ¨¡å—ã€‚

------

# ä¸‰ã€JDBC ä¸äº‹åŠ¡æ§åˆ¶

åœ¨çœŸå®é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯¹æ•°æ®åº“çš„æ“ä½œå¾€å¾€ä¸æ˜¯â€œæŸ¥ä¸€ä¸‹â€è¿™ä¹ˆç®€å•ã€‚**æ¶‰åŠå¢åˆ æ”¹æ“ä½œæ—¶ï¼Œæ•°æ®ä¸€è‡´æ€§å°±æˆäº†å¿…é¡»ä¿éšœçš„åº•çº¿ã€‚**JDBC æä¾›äº†æœ€åŸå§‹ä½†ä¹Ÿæ˜¯æœ€çµæ´»çš„äº‹åŠ¡æ§åˆ¶èƒ½åŠ›ã€‚

------

## 3.1 JDBC çš„äº‹åŠ¡æ§åˆ¶æœºåˆ¶

é»˜è®¤æƒ…å†µä¸‹ï¼ŒJDBC çš„è¿æ¥æ˜¯**è‡ªåŠ¨æäº¤ï¼ˆauto-commitï¼‰**çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š

```java
Connection conn = DriverManager.getConnection(...);
Statement stmt = conn.createStatement();
stmt.executeUpdate("UPDATE account SET balance = balance - 100 WHERE id = 1");
// è¯­å¥æ‰§è¡Œåï¼Œç«‹åˆ»è‡ªåŠ¨æäº¤
```

#### ä½†æ˜¯é—®é¢˜æ¥äº†ï¼š

- å¦‚æœä½ æœ‰å¤šä¸ªè¯­å¥ç»„æˆä¸€ä¸ªä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚â€œè½¬è´¦â€ï¼Œå°±ä¸èƒ½æ¯å¥éƒ½ç«‹åˆ»æäº¤ã€‚
- ä¸€æ—¦å…¶ä¸­ä¸€å¥å¤±è´¥ï¼Œ**å°±æ— æ³•å›æ»šå‰é¢å·²æäº¤çš„è¯­å¥**ï¼Œè¿™å°†å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼

------

## 3.2 æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡ï¼ˆæ¨èåšæ³•ï¼‰

```java
Connection conn = DriverManager.getConnection(...);
try {
    conn.setAutoCommit(false); // å¼€å¯æ‰‹åŠ¨äº‹åŠ¡

    PreparedStatement ps1 = conn.prepareStatement("...");
    ps1.executeUpdate();

    PreparedStatement ps2 = conn.prepareStatement("...");
    ps2.executeUpdate();

    conn.commit(); // æ‰€æœ‰æ“ä½œæˆåŠŸåæäº¤
} catch (Exception e) {
    conn.rollback(); // æœ‰å¼‚å¸¸å°±å›æ»š
} finally {
    conn.close();
}
```

#### âœ… è¿™å°±æ˜¯â€œåŸå­æ€§â€çš„å®ç°ï¼š

è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œ**æ•°æ®å§‹ç»ˆä¿æŒä¸€è‡´**ã€‚

------

## 3.3 å¤šäº‹åŠ¡åµŒå¥—çš„æ§åˆ¶

JDBC åŸç”Ÿå¹¶ä¸ç›´æ¥æ”¯æŒåµŒå¥—äº‹åŠ¡ï¼ˆä¸åƒ Spring æ”¯æŒä¼ æ’­æœºåˆ¶ï¼‰ï¼Œä½†ä½ å¯èƒ½ä¼šåœ¨åŒä¸€ä¸ªè¿æ¥é‡Œâ€œæ¨¡æ‹ŸåµŒå¥—è¡Œä¸ºâ€ã€‚

- å»ºè®®é€šè¿‡ **åˆ†æ–¹æ³• + åŒä¸€ä¸ª Connection ä¼ å‚** çš„æ–¹å¼ï¼Œæ§åˆ¶å¤šä¸ªå­äº‹åŠ¡ã€‚
- **ä¸è¦åœ¨å­æ–¹æ³•ä¸­éšæ„æäº¤äº‹åŠ¡ï¼Œç»Ÿä¸€ç”±è°ƒç”¨æ–¹å†³å®š commit/rollbackã€‚**

> âœ… é¢è¯•åœºæ™¯é¢˜ï¼šä¸¤ä¸ªå­æ¨¡å—éƒ½è¦æ“ä½œæ•°æ®åº“ï¼Œä¸€ä¸ªå¤±è´¥å¦ä¸€ä¸ªå¿…é¡»å›æ»šï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ
>
> ç­”ï¼šç»Ÿä¸€ç”±ä¸Šå±‚æ§åˆ¶äº‹åŠ¡è¾¹ç•Œï¼Œå­æ¨¡å—åªæŠ›å¼‚å¸¸æˆ–è¿”å›çŠ¶æ€ï¼Œä¸ä¸»åŠ¨ commit/rollbackã€‚

------

## 3.4 äº‹åŠ¡ä¸­æ–­å¼‚å¸¸æ€ä¹ˆå¤„ç†ï¼Ÿ

ä¸€æ—¦å‡ºé”™ï¼Œå¿…é¡» `rollback()`ï¼Œä½†å¾ˆå¤šäººçŠ¯ä»¥ä¸‹é”™è¯¯ï¼š

- **é”™è¯¯åšæ³•ï¼š**

  ```java
  conn.setAutoCommit(false);
  stmt.executeUpdate(sql1);
  // å‡å¦‚è¿™é‡ŒæŠ›å‡ºå¼‚å¸¸â€¦â€¦
  stmt.executeUpdate(sql2);
  conn.commit(); // æ°¸è¿œä¸ä¼šæ‰§è¡Œ
  ```

  ä¸Šé¢è¯­å¥ä¼šå¡åœ¨â€œæ‰§è¡Œäº†ä¸€åŠâ€ï¼Œæ•°æ®åº“è¢«â€œè„æ”¹â€ã€‚

- **æ­£ç¡®åšæ³•ï¼š** æŠŠ `commit()` å’Œ `rollback()` éƒ½å†™åœ¨ try-catch å—ä¸­ï¼Œä¿è¯å¼‚å¸¸åèƒ½å›æ»šï¼š

  ```java
  try {
      conn.setAutoCommit(false);
      ...
      conn.commit();
  } catch (Exception e) {
      conn.rollback(); // æŠ“å¼‚å¸¸å°±å›æ»š
  }
  ```

------

## âœ… é¢è¯•é™·é˜±é¢˜ï¼šJDBC é»˜è®¤æ˜¯è‡ªåŠ¨æäº¤çš„å—ï¼Ÿ

æ˜¯çš„ï¼ŒJDBC é»˜è®¤ `autoCommit = true`ã€‚è¿™æ„å‘³ç€æ¯æ¡æ‰§è¡Œå®Œçš„ SQL éƒ½ç«‹å³æäº¤ï¼

æ‰€ä»¥å¦‚æœä½ æ‰§è¡Œä¸€ä¸²æ›´æ–°è¯­å¥è€Œå¿˜è®°æ‰‹åŠ¨å…³æ‰ `autoCommit`ï¼Œé‚£å°±ä¼šï¼š

- æˆåŠŸä¸€åŠã€å¤±è´¥ä¸€åŠ
- æ— æ³•å›æ»š
- æ•°æ®å‡ºé—®é¢˜ï¼Œåæœæéš¾æ’æŸ¥

------

### å°ç»“

- JDBC é»˜è®¤è‡ªåŠ¨æäº¤äº‹åŠ¡ï¼Œ**ä¸€å®šè¦æ‰‹åŠ¨è®¾ç½® `autoCommit(false)` æ¥æ§åˆ¶äº‹åŠ¡è¾¹ç•Œ**ã€‚
- `commit()` å’Œ `rollback()` è¦é…å¯¹ä½¿ç”¨ï¼Œå¹¶æ³¨æ„å¼‚å¸¸å¤„ç†ã€‚
- åµŒå¥—äº‹åŠ¡åº”é¿å…åœ¨å­æ–¹æ³•ä¸­æ“ä½œäº‹åŠ¡è¾¹ç•Œï¼Œç»Ÿä¸€ç”±è°ƒç”¨è€…è´Ÿè´£ã€‚
- **äº‹åŠ¡æ§åˆ¶æ˜¯é¢è¯•é«˜é¢‘é¡¹ï¼Œå°¤å…¶åœ¨è½¬è´¦/è®¢å•/æ‰£åº“å­˜åœºæ™¯ä¸­åå¤è€ƒå¯Ÿã€‚**

------

å½“ç„¶ï¼Œè¿™ä¸€ç« ä¼šä»æœ€å¸¸ç”¨çš„ JDBC CURD å®æˆ˜å‡ºå‘ï¼Œç»™ Java åç«¯æ±‚èŒè€…å’Œå­¦ä¹ è€…ä¸€ä¸ªâ€œèƒ½ç›´æ¥æ¬åˆ°é¡¹ç›®é‡Œâ€çš„è½åœ°æ¨¡æ¿ï¼Œå¹¶ç»“åˆå…¸å‹ä¸šåŠ¡åœºæ™¯å’Œæ€§èƒ½ä¼˜åŒ–ç‚¹ã€‚ä»¥ä¸‹æ˜¯æ­£æ–‡å†…å®¹ï¼š

------

## å››ã€JDBC å®æˆ˜ï¼šå¢åˆ æ”¹æŸ¥ CURD æ¨¡æ¿

JDBC æœ¬è´¨ä¸Šå°±æ˜¯â€œJava å†™ SQLâ€ï¼Œå®ƒæä¾›äº†æœ€åŸºç¡€ã€æœ€ç›´æ¥çš„æ•°æ®åº“è®¿é—®èƒ½åŠ›ã€‚è¿™ä¸€ç« æˆ‘ä»¬å°±æ¥æå®šä¸€ä»¶äº‹ï¼š

> **å¦‚ä½•ç”¨ JDBC å†™å‡ºç»“æ„æ¸…æ™°ã€å¯ç»´æŠ¤ã€æ€§èƒ½è¿˜ä¸é”™çš„ CURDï¼Ÿ**

------

### 4.1 é€šç”¨ CURD æ¨¡æ¿å°è£…æ€è·¯

å¾ˆå¤šåˆå­¦è€…å†™ JDBC ä»£ç æ˜¯è¿™æ ·çš„ï¼š

```java
Connection conn = DriverManager.getConnection(...);
PreparedStatement ps = conn.prepareStatement("INSERT INTO user (name) VALUES (?)");
ps.setString(1, "Tom");
ps.executeUpdate();
```

è¿™æ²¡é—®é¢˜ï¼Œä½†é‡å¤å¤šäº†ä¼šæ˜¾å¾—å•°å—¦åˆéš¾ç»´æŠ¤ã€‚**æˆ‘ä»¬åº”è¯¥åšçš„æ˜¯ï¼šæŠ½å‡ºå…¬å…±æ¨¡æ¿ + å°è£…é€šç”¨å·¥å…·ç±»ã€‚**

#### æ¨èå°è£…ç»“æ„ï¼š

```java
public class JdbcUtil {
    public static Connection getConnection() { ... }  // è·å–è¿æ¥
    public static void close(Connection conn, Statement stmt, ResultSet rs) { ... } // å…³é—­è¿æ¥
}
```

------

### 4.2 æ‰¹é‡æ’å…¥ä¸ `addBatch()` ä½¿ç”¨

å¤„ç†å¤§é‡æ•°æ®æ—¶ï¼Œå¦‚æœä½ è¿˜åœ¨ç”¨ for å¾ªç¯ä¸€ä¸ªä¸ªæ’å…¥ï¼Œé‚£æ€§èƒ½å°±å½»åº•æ‹‰è·¨äº†ã€‚**æ­£ç¡®æ–¹å¼æ˜¯ç”¨æ‰¹å¤„ç†ï¼š**

```java
Connection conn = JdbcUtil.getConnection();
String sql = "INSERT INTO user (name, age) VALUES (?, ?)";
PreparedStatement ps = conn.prepareStatement(sql);

for (int i = 0; i < 1000; i++) {
    ps.setString(1, "User" + i);
    ps.setInt(2, 20 + i % 10);
    ps.addBatch();  // æ‰¹é‡æ·»åŠ 
    if (i % 200 == 0) {
        ps.executeBatch(); // æ¯200æ¡æ‰¹é‡æäº¤
        ps.clearBatch();
    }
}
ps.executeBatch();  // æœ€åä¸è¶³200æ¡çš„æäº¤
```

âœ… è¿™ç§æ–¹å¼æ¯”å•æ¡æ’å…¥æ€§èƒ½é«˜ 10 å€ä»¥ä¸Šã€‚

------

### 4.3 å®æˆ˜ï¼šå®ç°ä¸€ä¸ªç®€æ˜“ DAO å±‚ï¼ˆUserDAOï¼‰

è¿™æ˜¯é¢è¯•ä¸­å¸¸è§çš„é—®æ³•ï¼šâ€œä½ æ€ä¹ˆè®¾è®¡ DAO å±‚ï¼Ÿâ€

#### å…ˆå®šä¹‰å®ä½“ç±»ï¼š

```java
public class User {
    private int id;
    private String name;
    private int age;
    // getter / setter
}
```

#### å†å°è£… DAOï¼š

```java
public class UserDAO {
    public void insert(User user) throws SQLException {
        Connection conn = JdbcUtil.getConnection();
        String sql = "INSERT INTO user (name, age) VALUES (?, ?)";
        PreparedStatement ps = conn.prepareStatement(sql);
        ps.setString(1, user.getName());
        ps.setInt(2, user.getAge());
        ps.executeUpdate();
        JdbcUtil.close(conn, ps, null);
    }

    public List<User> findAll() throws SQLException {
        Connection conn = JdbcUtil.getConnection();
        String sql = "SELECT * FROM user";
        PreparedStatement ps = conn.prepareStatement(sql);
        ResultSet rs = ps.executeQuery();
        List<User> list = new ArrayList<>();
        while (rs.next()) {
            User u = new User();
            u.setId(rs.getInt("id"));
            u.setName(rs.getString("name"));
            u.setAge(rs.getInt("age"));
            list.add(u);
        }
        JdbcUtil.close(conn, ps, rs);
        return list;
    }
}
```

âœ… ä½ å¯ä»¥å¾ˆå®¹æ˜“æ‰©å±•å‡º `update`ã€`delete`ã€`findById` ç­‰æ–¹æ³•ï¼Œå®Œå…¨è¦†ç›–é¡¹ç›®éœ€æ±‚ã€‚

------

### 4.4 JDBC ä¸å…¸å‹ä¸šåŠ¡åœºæ™¯å®æˆ˜

#### âœ… ç”¨æˆ·ç™»å½•

```java
public boolean login(String username, String password) {
    String sql = "SELECT * FROM user WHERE username = ? AND password = ?";
    Connection conn = JdbcUtil.getConnection();
    PreparedStatement ps = conn.prepareStatement(sql);
    ps.setString(1, username);
    ps.setString(2, password);
    ResultSet rs = ps.executeQuery();
    return rs.next();  // æŸ¥åˆ°å³ç™»å½•æˆåŠŸ
}
```

> é¢è¯•åŠ åˆ†æç¤ºï¼šçœŸå®ç³»ç»Ÿä¸­å¯†ç è¦åŠ å¯†ï¼ˆå¦‚ MD5ã€BCryptï¼‰ï¼Œè¿™é‡Œä¸ºç®€åŒ–çœç•¥ã€‚

------

#### âœ… æ³¨å†Œæ ¡éªŒç”¨æˆ·åæ˜¯å¦å­˜åœ¨

```java
public boolean exists(String username) {
    String sql = "SELECT COUNT(*) FROM user WHERE username = ?";
    PreparedStatement ps = JdbcUtil.getConnection().prepareStatement(sql);
    ps.setString(1, username);
    ResultSet rs = ps.executeQuery();
    if (rs.next()) {
        return rs.getInt(1) > 0;
    }
    return false;
}
```

------

#### âœ… åˆ†é¡µæŸ¥è¯¢

```java
public List<User> findByPage(int page, int size) {
    int offset = (page - 1) * size;
    String sql = "SELECT * FROM user ORDER BY id DESC LIMIT ?, ?";
    PreparedStatement ps = JdbcUtil.getConnection().prepareStatement(sql);
    ps.setInt(1, offset);
    ps.setInt(2, size);
    ResultSet rs = ps.executeQuery();
    // åŒä¸Šéå† rs å¹¶å°è£… User
}
```

------

### å°ç»“

- JDBC è™½ç„¶åº•å±‚ï¼Œä½†æ˜¯çœŸå®é¢è¯•ä¸­å¾ˆå¤šé—®é¢˜éƒ½æ¥è‡ªå®ƒã€‚
- å°è£…é€šç”¨æ¨¡æ¿ã€ç²¾é€šæ‰¹å¤„ç†ã€äº†è§£ä¸šåŠ¡å¸¸è§åœºæ™¯ï¼Œæ˜¯ä½ æŠŠ JDBC ç”¨â€œå¥½â€çš„å…³é”®ã€‚
- å¦‚æœä½ èƒ½å†™å‡ºä¸€ä¸ªç®€æ´ã€æ‰©å±•æ€§å¼ºçš„ DAO å±‚ï¼Œå°±æ¯”å¤§å¤šæ•°äººå¼ºå¾ˆå¤šäº†ã€‚

------

å½“ç„¶ï¼Œä¸‹é¢æ˜¯è¿™ä¸€éƒ¨åˆ†çš„æ­£æ–‡å†…å®¹ï¼Œä¾æ—§ä¿æŒå®ç”¨æ€§ + é¢è¯•å¯¼å‘ + æ˜“è½åœ°çš„é£æ ¼ï¼š

------

# äº”ã€JDBC æ€§èƒ½ä¼˜åŒ–ä¸è¿æ¥æ± æŠ€æœ¯

å¾ˆå¤šäººå­¦ JDBC æ—¶æœ€å¤§çš„è¯¯åŒºæ˜¯ï¼š**ä»¥ä¸ºå†™å®Œ `Connection conn = DriverManager.getConnection(...)` å°±å®Œäº‹äº†ã€‚**

é”™ï¼æ€§èƒ½é—®é¢˜å¾€å¾€å°±è—åœ¨è¿™å¥ä»£ç é‡Œã€‚

> **è¿™ç« æ ¸å¿ƒç›®æ ‡ï¼šææ¸…æ¥š JDBC çš„æ€§èƒ½ç“¶é¢ˆåœ¨å“ªï¼Ÿè¿æ¥æ± æ€ä¹ˆé€‰ã€æ€ä¹ˆé…ã€æ€ä¹ˆè°ƒï¼Ÿ**

------

## 5.1 JDBC æ€§èƒ½ç“¶é¢ˆåœ¨å“ªï¼Ÿ

æ‰“å¼€æ•°æ®åº“è¿æ¥æ˜¯éå¸¸æ˜‚è´µçš„æ“ä½œï¼ˆæ¶‰åŠä¸‰æ¬¡æ¡æ‰‹ã€æƒé™è®¤è¯ã€å†…å­˜èµ„æºåˆ†é…ç­‰ï¼‰ï¼Œè€Œä¸”é¢‘ç¹å¼€å…³è¿æ¥è¿˜ä¼šæ‹–å®æ•°æ®åº“ã€‚

ğŸ‘‡ ä¸¾ä¸ªä¾‹å­ï¼š

```java
for (int i = 0; i < 1000; i++) {
    Connection conn = DriverManager.getConnection(...); // âŒ æ…¢ + å èµ„æº
    PreparedStatement ps = conn.prepareStatement(...);
    ...
    conn.close();
}
```

å³ä½¿ä½ åœ¨æ¯æ¬¡æ“ä½œåéƒ½å…³é—­è¿æ¥ï¼Œä¹Ÿä¼šå› ä¸ºé¢‘ç¹è¿æ¥ + å…³é—­è€Œä¸¥é‡æ‹–æ…¢æ€§èƒ½ï¼ˆç”šè‡³æ‰“çˆ†è¿æ¥æ± ã€è€—å°½æ•°æ®åº“è¿æ¥æ•°ï¼‰ã€‚

------

## 5.2 ä¸ºä»€ä¹ˆè¦ç”¨è¿æ¥æ± ï¼Ÿ

è¿æ¥æ± çš„æ ¸å¿ƒæ€è·¯å°±æ˜¯ï¼š

> **æå‰å‡†å¤‡å¥½ä¸€æ‰¹è¿æ¥ï¼Œç¨‹åºè¦ç”¨çš„æ—¶å€™â€œå€Ÿâ€ï¼Œç”¨å®Œå†â€œè¿˜â€ã€‚**

è¿™æ ·å°±é¿å…äº†é¢‘ç¹åˆ›å»º/é”€æ¯è¿æ¥çš„é—®é¢˜ï¼Œæ˜¾è‘—æé«˜æ€§èƒ½ã€‚

#### è¿æ¥æ± å¸¦æ¥çš„å¥½å¤„ï¼š

- âœ… é¿å…é¢‘ç¹åˆ›å»ºè¿æ¥ï¼ˆé‡ç”¨è¿æ¥ï¼‰
- âœ… æ§åˆ¶è¿æ¥æ•°é‡ï¼Œé¿å…èµ„æºæ³„éœ²
- âœ… æä¾›è¿æ¥ç›‘æ§ã€è¶…æ—¶æ£€æµ‹ã€æ…¢æŸ¥è¯¢å‘Šè­¦ç­‰èƒ½åŠ›

------

## 5.3 å¸¸è§è¿æ¥æ± æŠ€æœ¯å¯¹æ¯”

| åç§°         | ç‰¹ç‚¹                                 | æ˜¯å¦æ¨è   |
| ------------ | ------------------------------------ | ---------- |
| **C3P0**     | è€ç‰Œè¿æ¥æ± ï¼ŒåŠŸèƒ½é½å…¨ï¼Œä½†æ€§èƒ½è¾ƒå·®     | âŒ è¿‡æ—¶     |
| **DBCP**     | Apache æä¾›ï¼Œè½»é‡ä½†ç¨³å®šæ€§ä¸€èˆ¬        | âš ï¸ ä¸€èˆ¬     |
| **HikariCP** | Spring Boot é»˜è®¤è¿æ¥æ± ï¼Œæè‡´æ€§èƒ½     | âœ… æ¨è     |
| **Druid**    | é˜¿é‡Œå‡ºå“ï¼ŒåŠŸèƒ½ä¸°å¯Œã€ç›‘æ§å¼ºå¤§ï¼Œä½†ç¨é‡ | âœ… å¤§å‚å¸¸ç”¨ |

> é¢è¯•é—®ä½ è¿æ¥æ± ç”¨å“ªä¸ªï¼Ÿâ€”â€”**Spring Boot é»˜è®¤ç”¨çš„æ˜¯ HikariCPï¼ŒDruid å¸¸è§äºä¸šåŠ¡å¤æ‚ç³»ç»Ÿã€‚**

------

## 5.4 HikariCP å®è·µï¼šé…ç½®ã€ç›‘æ§ã€è°ƒä¼˜

HikariCP æ˜¯ç›®å‰æ€§èƒ½æœ€å¼ºã€æœ€ç°ä»£çš„è¿æ¥æ± å®ç°ï¼ŒSpring Boot ä» 2.x å¼€å§‹å°±é»˜è®¤é‡‡ç”¨å®ƒã€‚

#### âœ… HikariCP åŸºæœ¬é…ç½®ï¼ˆapplication.ymlï¼‰

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/demo?serverTimezone=UTC
    username: root
    password: root
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      minimum-idle: 5
      maximum-pool-size: 15
      idle-timeout: 600000
      max-lifetime: 1800000
      connection-timeout: 30000
```

#### å‚æ•°è¯´æ˜ï¼š

- `maximum-pool-size`: æœ€å¤§è¿æ¥æ•°ï¼Œ**å†³å®šå¹¶å‘èƒ½åŠ›**ï¼Œå¯æ ¹æ®æœåŠ¡å™¨æ ¸æ•°é€‚é…ï¼ˆCPU æ ¸æ•° * 2ï¼‰
- `idle-timeout`: ç©ºé—²è¿æ¥æœ€å¤§å­˜æ´»æ—¶é—´ï¼Œå»ºè®®10åˆ†é’Ÿ
- `max-lifetime`: è¿æ¥æœ€å¤§ç”Ÿå‘½å‘¨æœŸï¼Œé˜²æ­¢è¢«æ•°æ®åº“å¼ºè¸¢
- `connection-timeout`: è·å–è¿æ¥æœ€å¤§ç­‰å¾…æ—¶é—´

------

## 5.5 å¦‚ä½•ç›‘æ§è¿æ¥æ± ï¼Ÿ

å¦‚æœä½ ç”¨çš„æ˜¯ Druidï¼Œå¯ä»¥ç›´æ¥è®¿é—®å†…ç½®çš„ç›‘æ§ç•Œé¢ï¼š

```yaml
spring.datasource.druid.stat-view-servlet.enabled=true
spring.datasource.druid.stat-view-servlet.login-username=admin
spring.datasource.druid.stat-view-servlet.login-password=123456
```

è®¿é—® `http://localhost:8080/druid` å³å¯æŸ¥çœ‹å®æ—¶è¿æ¥æ•°ã€SQL æ‰§è¡Œæ—¶é—´ç­‰ä¿¡æ¯ã€‚

è€Œ HikariCP å¯ä»¥é€šè¿‡ Micrometer + Actuator ç›‘æ§ï¼š

```xml
<dependency>
  <groupId>io.micrometer</groupId>
  <artifactId>micrometer-core</artifactId>
</dependency>
```

åŠ ä¸Š Spring Boot Actuator ä¹‹åï¼Œè®¿é—® `/actuator/metrics/hikaricp.connections.active` ç­‰æŒ‡æ ‡å³å¯ã€‚

------

### âœ… æ€»ç»“ä¸€å¥è¯ï¼š

- è¿æ¥æ± æ˜¯ JDBC æ€§èƒ½ä¼˜åŒ–çš„**ç¬¬ä¸€è¦ç´ **
- é¡¹ç›®å°å°±ç”¨ HikariCPï¼ˆé»˜è®¤ã€å¿«ï¼‰ï¼Œé¡¹ç›®å¤æ‚å°±ç”¨ Druidï¼ˆåŠŸèƒ½å¼ºï¼‰
- æ°¸è¿œä¸è¦æ¯æ¬¡æ“ä½œéƒ½æ–°å»ºä¸€ä¸ª `Connection`

------

# å…­ã€JDBC ä¸æ•°æ®åº“å®‰å…¨

å®‰å…¨æ°¸è¿œæ˜¯å¼€å‘ä¸­ä¸èƒ½å¿½è§†çš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯æ¶‰åŠæ•°æ®åº“è®¿é—®æ—¶ã€‚å¾ˆå¤šâ€œè€æ‰ç‰™â€çš„æ¼æ´ï¼Œå…¶å®è‡³ä»Šä¾ç„¶é¢‘ç¹å‡ºç°â€”â€”æ¯”å¦‚æœ€å¸¸è§çš„ï¼šSQL æ³¨å…¥ã€‚

è¿™ä¸€ç« ï¼Œæˆ‘ä»¬å°±ä» JDBC å±‚é¢ï¼Œæ·±å…¥èŠä¸€èŠï¼š

- JDBC æ€ä¹ˆé˜² SQL æ³¨å…¥ï¼Ÿ
- PreparedStatement çœŸçš„æ˜¯ä¸‡èƒ½çš„å—ï¼Ÿ
- ä»£ç å’Œæ•°æ®åº“åˆ†åˆ«è¯¥æ€ä¹ˆåšå¥½æƒé™éš”ç¦»ï¼Ÿ

------

## 6.1 é˜²æ­¢ SQL æ³¨å…¥çš„æœ€ä½³å®è·µ

#### ä»€ä¹ˆæ˜¯ SQL æ³¨å…¥ï¼Ÿ

SQL æ³¨å…¥ï¼ˆSQL Injectionï¼‰æŒ‡çš„æ˜¯**æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„è¾“å…¥ï¼Œå¹²æ‰° SQL æŸ¥è¯¢ç»“æ„ï¼Œä»è€Œç»•è¿‡éªŒè¯ã€çªƒå–æ•°æ®ç”šè‡³ç ´åæ•°æ®**çš„è¡Œä¸ºã€‚

ğŸ‘‡ ä¸¾ä¸ªâ€œæ­»äº¡å†™æ³•â€çš„ä¾‹å­ï¼š

```java
String username = request.getParameter("username");
String password = request.getParameter("password");

String sql = "SELECT * FROM users WHERE username = '" + username + "' AND password = '" + password + "'";
Statement stmt = conn.createStatement();
ResultSet rs = stmt.executeQuery(sql);
```

å¦‚æœæ”»å‡»è€…è¾“å…¥çš„æ˜¯ï¼š

```
username = admin' -- 
password = éšä¾¿
```

æœ€ç»ˆæ‹¼æ¥å‡ºçš„ SQL ä¼šå˜æˆï¼š

```sql
SELECT * FROM users WHERE username = 'admin' -- ' AND password = 'éšä¾¿'
```

ç»“æœï¼šæ•´ä¸ª password æ¡ä»¶è¢«æ³¨é‡Šï¼Œç›´æ¥ç™»å½•æˆåŠŸï¼

------

## 6.2 å¦‚ä½•é˜²å¾¡ï¼šä½¿ç”¨ PreparedStatement

æ­£ç¡®çš„å†™æ³•å¦‚ä¸‹ ğŸ‘‡ï¼š

```java
String sql = "SELECT * FROM users WHERE username = ? AND password = ?";
PreparedStatement ps = conn.prepareStatement(sql);
ps.setString(1, username);
ps.setString(2, password);
ResultSet rs = ps.executeQuery();
```

> PreparedStatement ä¼šè‡ªåŠ¨å°†è¾“å…¥è¿›è¡Œå‚æ•°é¢„ç¼–è¯‘ä¸è½¬ä¹‰ï¼Œ**å½»åº•é¿å…æ³¨å…¥æ¼æ´**ã€‚

#### âœ… å¥½å¤„ï¼š

- è‡ªåŠ¨å¤„ç†ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ `'`ã€`"` ç­‰ï¼‰
- æå‰ç¼–è¯‘ SQLï¼Œæé«˜æ€§èƒ½
- å®Œå…¨é˜»æ–­ SQL æ³¨å…¥é£é™©

------

## 6.3 PreparedStatement æœ‰å±€é™å—ï¼Ÿ

æ˜¯çš„ï¼Œå®ƒå¹¶éä¸‡èƒ½ï¼Œå°¤å…¶åœ¨**åŠ¨æ€æ„å»º SQL ç»“æ„**æ—¶ã€‚

ä¾‹å¦‚ä¸‹é¢è¿™ç§â€œæ¨¡ç³ŠæŸ¥è¯¢ + åŠ¨æ€å­—æ®µâ€çš„å†™æ³•ï¼š

```java
String column = request.getParameter("sortBy"); // å±é™©ï¼
String sql = "SELECT * FROM products ORDER BY " + column;
```

æ”»å‡»è€…ä¼ å…¥ `sortBy=1 desc; DROP TABLE products;`ï¼Œé‚£ä½ åŸºæœ¬å°±å¯ä»¥ä¸‹ç­äº†ã€‚

#### åº”å¯¹ç­–ç•¥ï¼š

- æ°¸è¿œä¸è¦è®©ç”¨æˆ·æ§åˆ¶ SQL çš„ç»“æ„ï¼ˆå¦‚å­—æ®µåã€è¡¨åã€order by ç­‰ï¼‰
- å¯¹å­—æ®µååšç™½åå•è¿‡æ»¤ï¼ˆé™å®šåªèƒ½æ˜¯ `id`ã€`name`ã€`price` ç­‰ï¼‰

------

## 6.4 æ•°æ®åº“æƒé™æ§åˆ¶ï¼ˆä»£ç å±‚ + æ•°æ®åº“å±‚åŒä¿é™©ï¼‰

é™¤äº†å†™ä»£ç è¦å®‰å…¨ï¼Œè¿˜è¦ä»æ•°æ®åº“è´¦å·æœ¬èº«â€œé™æƒâ€ï¼š

#### âœ… åŸåˆ™ï¼šæœ€å°æƒé™åŸåˆ™ï¼ˆLeast Privilegeï¼‰

- ä¸šåŠ¡ç”¨è´¦å·ä¸èƒ½æœ‰ `DROP`ã€`ALTER` ç­‰é«˜æƒé™
- ç®¡ç†è´¦å·ä»…ä¾›ç®¡ç†å‘˜ä½¿ç”¨ï¼Œä¸æ”¾è¿›ä»£ç é‡Œ
- åˆ†æ¨¡å—è®¾ç½®è´¦å·ï¼šåªè¯»è´¦å· / è¯»å†™è´¦å· / å®¡è®¡è´¦å·

#### ğŸ‘‡ ä»£ç å±‚ä¹Ÿå¯é€šè¿‡ `@Secured`ã€`@PreAuthorize` åšæƒé™æ§åˆ¶ï¼š

```java
@PreAuthorize("hasRole('ADMIN')")
public void deleteUser(...) {
    ...
}
```

------

### âœ… æ€»ç»“ä¸€å¥è¯ï¼š

- æ°¸è¿œç”¨ `PreparedStatement`ï¼Œåˆ«æ‹¼æ¥ SQL
- é˜²æ³¨å…¥çš„æ ¸å¿ƒï¼š**ç”¨æˆ·è¾“å…¥ä¸èƒ½å½±å“ SQL ç»“æ„**
- æ•°æ®åº“å’Œä»£ç éƒ½è¦é™æƒï¼Œä¸ç•™åé—¨

------

å¦‚æœä½ å‡†å¤‡é¢è¯•ï¼Œè¿™ä¸€ç« å¾ˆæœ‰å¯èƒ½å°±æ˜¯â€œå¼€èƒƒé¢˜â€ï¼Œæ¯”å¦‚ï¼š

> é¢è¯•å®˜ï¼šä½ çŸ¥é“ PreparedStatement å’Œ Statement æœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿ
>  ä½ å¯ä»¥ç›´æ¥è¯´ï¼šâ€œPreparedStatement æ˜¯é˜²æ³¨å…¥çš„æ ¸å¿ƒæœºåˆ¶ï¼Œå› ä¸ºâ€¦â€¦â€

------

## ä¸ƒã€JDBC ä¸æ¡†æ¶é›†æˆï¼šä»åŸå§‹è¿æ¥åˆ°é«˜æ•ˆå®æˆ˜

JDBC æ˜¯ Java ä¸–ç•Œè®¿é—®æ•°æ®åº“çš„â€œåº•å±‚æ¥å£â€ï¼Œä½†å¦‚æœä½ çœŸçš„åœ¨ä¼ä¸šé¡¹ç›®ä¸­è¿˜åœ¨æ‰‹å†™ä¸€å † `try-catch-finally`ï¼Œé‚£åªèƒ½è¯´â€”â€”ä½ è¯¥å‡çº§äº†ã€‚

æ‰€ä»¥è¿™ä¸€ç« ï¼Œæˆ‘ä»¬å°±æ¥èŠèŠï¼š

- ä¸ºä»€ä¹ˆ Spring JDBC æ›´â€œé¦™â€ï¼Ÿ
- JdbcTemplate æ˜¯æ€ä¹ˆå¸®æˆ‘ä»¬ç®€åŒ–ä»£ç çš„ï¼Ÿ
- ä»€ä¹ˆæ—¶å€™åº”è¯¥ç”¨ MyBatisï¼ŸJDBC å’Œ ORM æ€ä¹ˆé€‰ï¼Ÿ
- JDBC åœ¨å®é™…é¡¹ç›®ä¸­è¿˜æœ‰å“ªäº›å…¸å‹ç”¨æ³•ï¼Ÿ

------

### 7.1 Spring JDBC ç®€ä»‹ï¼šè®©åº•å±‚ JDBC æ›´â€œä¸æ»‘â€

Spring Framework ä¸ºåŸç”Ÿ JDBC æä¾›äº†ä¸€ä¸ªæ›´è½»é‡çš„å°è£…å±‚ï¼šSpring JDBCï¼Œä¹Ÿç§° JdbcTemplateã€‚

å®ƒè§£å†³çš„æ ¸å¿ƒç—›ç‚¹å°±æ˜¯ï¼š

| åŸç”Ÿ JDBC çš„ç—›ç‚¹           | Spring JDBC çš„ä¼˜åŒ–                        |
| -------------------------- | ----------------------------------------- |
| ä»£ç å†—é•¿ã€é‡å¤             | ç®€æ´æ¨¡æ¿å¼å†™æ³•                            |
| å¼‚å¸¸å¤„ç†å¤æ‚               | ç»Ÿä¸€åŒ…è£…æˆ DataAccessException            |
| èµ„æºé‡Šæ”¾å®¹æ˜“å†™æ¼ï¼ˆå¦‚å…³é—­ï¼‰ | è‡ªåŠ¨å…³é—­ Connectionã€Statementã€ResultSet |
| å‚æ•°è®¾ç½®å®¹æ˜“å‡ºé”™           | è‡ªåŠ¨å¡«å……å‚æ•°                              |

ç®€å•ç†è§£å°±æ˜¯ï¼š**Spring JDBC æ˜¯å¯¹åŸç”Ÿ JDBC çš„â€œå·¥å…·åŒ–å°è£…â€ï¼Œè®©ä½ æ›´ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸æ˜¯åº•å±‚æµç¨‹ã€‚**

------

### 7.2 JdbcTemplate ä½¿ç”¨æŒ‡å—

Spring æä¾›çš„ `JdbcTemplate` æ˜¯ Spring JDBC çš„æ ¸å¿ƒå·¥å…·ç±»ã€‚

#### å…¸å‹ä½¿ç”¨æ–¹å¼ï¼š

```java
@Autowired
private JdbcTemplate jdbcTemplate;

public List<User> getUsers() {
    String sql = "SELECT * FROM users";
    return jdbcTemplate.query(sql, new BeanPropertyRowMapper<>(User.class));
}
```

#### å‚æ•°ç»‘å®š + æ’å…¥ç¤ºä¾‹ï¼š

```java
String sql = "INSERT INTO users(name, age) VALUES (?, ?)";
jdbcTemplate.update(sql, "Tom", 25);
```

#### æŸ¥è¯¢ä¸€ä¸ªå€¼ï¼ˆæ¯”å¦‚æ€»æ•°ï¼‰ï¼š

```java
String sql = "SELECT COUNT(*) FROM users";
int count = jdbcTemplate.queryForObject(sql, Integer.class);
```

æ˜¯ä¸æ˜¯æ¯”åŸå§‹çš„ `Statement` + `ResultSet` å¹²å‡€å¤ªå¤šäº†ï¼Ÿ

------

### 7.3 ä¸ MyBatis çš„å¯¹æ¯”ï¼šä»€ä¹ˆæ—¶å€™ç”¨ JDBCï¼Œä»€ä¹ˆæ—¶å€™ç”¨ ORMï¼Ÿ

| å¯¹æ¯”é¡¹         | JdbcTemplate       | MyBatis                             |
| -------------- | ------------------ | ----------------------------------- |
| æ€§è´¨           | åŠè‡ªåŠ¨ï¼ˆåŸºäº SQLï¼‰ | å…¨è‡ªåŠ¨æ˜ å°„ ORM æ¡†æ¶                 |
| å­¦ä¹ æ›²çº¿       | è¾ƒä½               | ä¸­ç­‰ï¼ˆXML / æ³¨è§£é…ç½®ï¼‰              |
| çµæ´»æ€§         | æ›´è´´è¿‘åŸç”Ÿ SQL     | å¯æ‰©å±•æ€§å¥½ï¼Œæ”¯æŒ SQL æ˜ å°„ã€æ’ä»¶æœºåˆ¶ |
| é€‚åˆåœºæ™¯       | ç®€å• CRUDã€æ‰¹å¤„ç†  | å¤æ‚ä¸šåŠ¡ã€å¤šè¡¨å…³è”ã€åŠ¨æ€ SQL        |
| ä¸ JDBC çš„å…³ç³» | åŸºäº JDBC å°è£…     | åº•å±‚ä»ç„¶ä½¿ç”¨ JDBC                   |

#### ç®€å•è¯´ï¼š

- **å°å‹æœåŠ¡ / ç®€å• CRUD**ï¼š`JdbcTemplate` éå¸¸è½»é‡é«˜æ•ˆï¼›
- **ä¸­å¤§å‹é¡¹ç›® / åŠ¨æ€æŸ¥è¯¢å¤š**ï¼š`MyBatis` æ›´çµæ´»ï¼Œä¹Ÿæ›´å¯ç»´æŠ¤ï¼›
- **çº¯ ORM å®ä½“æ˜ å°„éœ€æ±‚é‡**ï¼šè€ƒè™‘ `Hibernate` ä½†è¦å°å¿ƒæ€§èƒ½å‘ã€‚

------

### 7.4 ä¼ä¸šé¡¹ç›®ä¸­ JDBC çš„å…¸å‹åº”ç”¨åœºæ™¯

JDBC æœ¬è´¨æ˜¯â€œæ•°æ®åº“è®¿é—®åè®®â€ï¼Œå³ä½¿ç”¨äº†æ¡†æ¶ï¼Œåº•å±‚è¿˜æ˜¯ JDBCã€‚

#### å¸¸è§ä½¿ç”¨æ–¹å¼ï¼š

- æ‰¹å¤„ç†ä»»åŠ¡ï¼ˆå¦‚ Spring Batch ä¸­çš„æ•°æ®åº“å†™å…¥ï¼‰
- åå°è„šæœ¬ / ä»»åŠ¡ç³»ç»Ÿ / æ•°æ®å¯¼å‡º
- ä¸ä¼ ç»Ÿç³»ç»Ÿå¯¹æ¥æ—¶ï¼ˆåªæ”¯æŒ JDBC é©±åŠ¨ï¼‰
- éœ€è¦æè‡´æ€§èƒ½ä¼˜åŒ–çš„åœºæ™¯ï¼ˆæ‰‹åŠ¨æ§åˆ¶è¿æ¥ä¸æ‰§è¡Œï¼‰

åœ¨è¿™äº›â€œè´´åº•å±‚â€çš„åœºæ™¯é‡Œï¼Œ`JdbcTemplate` + æ‰‹åŠ¨ SQL ä»ç„¶æ˜¯éå¸¸å¯é çš„é€‰æ‹©ã€‚

------

### âœ… å°ç»“ï¼šæ¡†æ¶æ˜¯å¸®ä½ ææ•ˆï¼Œä¸æ˜¯è®©ä½ å¿˜äº†åº•å±‚

- åŸç”Ÿ JDBC å¤ªå†—é•¿ï¼ŒSpring JDBC æä¾›é«˜æ•ˆå°è£…ï¼›
- `JdbcTemplate` æ˜¯ JDBC å…¥é—¨çš„æœ€ä½³å®æˆ˜å·¥å…·ï¼›
- MyBatis / Hibernate é€‚åˆå¤æ‚ä¸šåŠ¡åœºæ™¯ï¼Œä½† JDBC æ›´è½»ã€æ›´å¿«ï¼›
- é¢è¯•å¸¸é—®ï¼šâ€œJDBC å’Œ ORM å“ªä¸ªå¥½ï¼Ÿâ€åˆ«è¯´â€œæˆ‘éƒ½ç”¨â€ï¼Œè¯´â€œæŒ‰éœ€é€‰å‹â€ã€‚

------

# å…«ã€å¸¸è§é—®é¢˜ä¸é¢è¯•é¢˜ç²¾é€‰

JDBC æ˜¯ Java ä¸æ•°æ®åº“ä¹‹é—´çš„æ¡¥æ¢ï¼Œä½†çœŸæ­£é¢è¯•æ—¶ï¼Œè€ƒå¯Ÿçš„ä¸æ˜¯ä½ è®°äº†å¤šå°‘ APIï¼Œè€Œæ˜¯ä½ å¯¹è¿æ¥æ± ã€äº‹åŠ¡æ§åˆ¶ã€å°è£…æ€æƒ³çš„ç†è§£æ˜¯å¦æ·±å…¥ã€‚

è¿™ä¸€èŠ‚æˆ‘ä»¬æ‹†è§£ 4 ä¸ªé«˜é¢‘é¢è¯•æ–¹å‘ï¼Œå¸®ä½ å»ºç«‹ç³»ç»ŸåŒ–è®¤çŸ¥ï¼š

------

## 1ï¸âƒ£ JDBC ä¸è¿æ¥æ± çš„é¢è¯•é«˜é¢‘é¢˜è§£æ

**é—®é¢˜ 1ï¼šä¸ºä»€ä¹ˆ JDBC ä¸å»ºè®®é¢‘ç¹åˆ›å»ºå’Œå…³é—­è¿æ¥ï¼Ÿ**

> JDBC çš„ `Connection` å¯¹è±¡æ˜¯é‡é‡çº§èµ„æºï¼Œåº•å±‚å®é™…æ˜¯â€œç½‘ç»œ TCP è¿æ¥ + æ•°æ®åº“ sessionâ€ã€‚ æ¯æ¬¡ `DriverManager.getConnection()` éƒ½ä¼šå‘èµ·ä¸€æ¬¡ç‰©ç†è¿æ¥ï¼Œæˆæœ¬é«˜æ˜‚ã€‚

**é¢è¯•å»ºè®®ç­”æ³•ï¼š**

- æ¯æ¬¡è¿æ¥çš„å»ºç«‹å’Œé”€æ¯ä¼šé€ æˆæ€§èƒ½ç“¶é¢ˆï¼›
- åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹æ›´å®¹æ˜“é€ æˆæ•°æ®åº“è¿æ¥èµ„æºè€—å°½ï¼›
- æ­£ç¡®åšæ³•æ˜¯ä½¿ç”¨è¿æ¥æ± ï¼ˆå¦‚ Druidã€HikariCPï¼‰å¤ç”¨è¿æ¥ã€‚

------

**é—®é¢˜ 2ï¼šä½ äº†è§£å“ªäº›å¸¸è§è¿æ¥æ± ï¼ŸåŒºåˆ«åœ¨å“ªï¼Ÿ**

| è¿æ¥æ±    | ç‰¹ç‚¹                             |
| -------- | -------------------------------- |
| DBCP     | æ—©æœŸ Spring é»˜è®¤ä½¿ç”¨ï¼Œå·²é€æ¸æ·˜æ±° |
| C3P0     | é…ç½®ç®€å•ï¼Œæ€§èƒ½ä¸€èˆ¬               |
| Druid    | é˜¿é‡Œå‡ºå“ï¼Œç›‘æ§å¼ºå¤§ï¼Œä½¿ç”¨å¹¿æ³›     |
| HikariCP | æ€§èƒ½æœ€ä½³ï¼ŒSpring Boot é»˜è®¤è¿æ¥æ±  |

> å»ºè®®é‡ç‚¹æŒæ¡ Druidï¼ˆç›‘æ§å¼ºï¼‰å’Œ HikariCPï¼ˆé€Ÿåº¦å¿«ï¼‰ã€‚

------

## 2ï¸âƒ£ JDBC å¦‚ä½•å®ç°äº‹åŠ¡æ§åˆ¶ï¼ŸåµŒå¥—äº‹åŠ¡å¦‚ä½•å¤„ç†ï¼Ÿ

**é—®é¢˜ 3ï¼šJDBC é»˜è®¤æ˜¯è‡ªåŠ¨æäº¤äº‹åŠ¡çš„å—ï¼Ÿå¦‚ä½•æ‰‹åŠ¨æ§åˆ¶ï¼Ÿ**

> æ˜¯çš„ï¼ŒJDBC é»˜è®¤æ‰§è¡Œå®Œæ¯æ¡ SQL å°±è‡ªåŠ¨æäº¤ã€‚ æƒ³æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡ï¼Œéœ€è¦å…³é—­è‡ªåŠ¨æäº¤æ¨¡å¼ï¼š

```java
conn.setAutoCommit(false); // å¼€å¯æ‰‹åŠ¨æäº¤æ¨¡å¼
try {
    // æ‰§è¡Œä¸šåŠ¡ SQL
    conn.commit();
} catch (Exception e) {
    conn.rollback();
}
```

------

**é—®é¢˜ 4ï¼šJDBC æ”¯æŒåµŒå¥—äº‹åŠ¡å—ï¼Ÿæ€ä¹ˆå¤„ç†ï¼Ÿ**

åŸç”Ÿ JDBC **ä¸æ”¯æŒåµŒå¥—äº‹åŠ¡**ã€‚ä½ åªèƒ½é€šè¿‡é€»è¾‘å°è£…æ¥æ¨¡æ‹Ÿâ€œåµŒå¥—â€æ§åˆ¶ï¼Œæ¯”å¦‚åˆ©ç”¨ä¿å­˜ç‚¹ï¼ˆSavePointï¼‰ï¼š

```java
Connection conn = getConnection();
conn.setAutoCommit(false);
Savepoint sp = conn.setSavepoint();

try {
    // ç¬¬ä¸€ä¸ªäº‹åŠ¡é€»è¾‘
    // ç¬¬äºŒæ®µé€»è¾‘å‡ºé”™
    conn.rollback(sp); // å›æ»šåˆ° savepoint
    conn.commit();
} catch (Exception e) {
    conn.rollback();
}
```

é¢è¯•å»ºè®®å›ç­”ï¼š

> JDBC ä¸ç›´æ¥æ”¯æŒåµŒå¥—äº‹åŠ¡ï¼Œä½†å¯é€šè¿‡ `Savepoint` æ¨¡æ‹Ÿéƒ¨åˆ†äº‹åŠ¡å›æ»šèƒ½åŠ›ã€‚

------

## 3ï¸âƒ£ å¦‚ä½•è§£å†³ JDBC ä¸­è¿æ¥æ³„æ¼é—®é¢˜ï¼Ÿ

è¿æ¥æ³„æ¼ = è·å–äº†è¿æ¥ä½†æ²¡æœ‰é‡Šæ”¾ï¼Œé•¿æœŸç§¯å‹å¯¼è‡´è¿æ¥æ± è€—å°½ã€ç³»ç»Ÿå´©æºƒã€‚

**å¸¸è§åŸå› ï¼š**

- å¿˜è®°è°ƒç”¨ `conn.close()`ï¼›
- å¼‚å¸¸å‘ç”Ÿåæœªè¿›å…¥ `finally` é‡Šæ”¾è¿æ¥ï¼›
- å¤šçº¿ç¨‹å¹¶å‘ä¸‹ Connection è¢«è¦†ç›–ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**

- å¼ºåˆ¶ä½¿ç”¨ `try-with-resources`ï¼ˆJava 7 èµ·ï¼‰è‡ªåŠ¨é‡Šæ”¾èµ„æºï¼š

```java
try (Connection conn = getConnection()) {
    // æ“ä½œ
} // è‡ªåŠ¨ close()
```

- ä½¿ç”¨è¿æ¥æ±  + é…ç½®è¿æ¥è¶…æ—¶ã€ç©ºé—²æ£€æµ‹ï¼›
- é…åˆ Druid ç›‘æ§åˆ†æè¿æ¥ä½¿ç”¨æƒ…å†µã€‚

------

## 4ï¸âƒ£ é¢è¯•å®˜æé—®ï¼šâ€œå¦‚æœè®©ä½ å°è£…ä¸€ä¸ªé€šç”¨ JDBC å·¥å…·ç±»ï¼Œä½ æ€ä¹ˆè®¾è®¡ï¼Ÿâ€

è¿™ä¸ªé—®é¢˜éå¸¸ç»å…¸ï¼Œæ—¢è€ƒå¯Ÿç¼–ç èƒ½åŠ›ï¼Œä¹Ÿè€ƒå¯ŸæŠ½è±¡èƒ½åŠ›ã€‚

**ç­”é¢˜æ€è·¯ï¼š**

> æˆ‘ä¼šä»å¤ç”¨æ€§ã€å¯æ‰©å±•æ€§ã€å®‰å…¨æ€§è§’åº¦å‡ºå‘ï¼Œå°è£…ä»¥ä¸‹åŠŸèƒ½æ¨¡å—ï¼š

1. **ç»Ÿä¸€ç®¡ç†è¿æ¥æ± æ•°æ®æº**ï¼ˆå¯æ³¨å…¥ Druid æˆ– Hikariï¼‰ï¼›
2. **æä¾›é€šç”¨æ–¹æ³•**ï¼ˆå¦‚ `queryList()`ã€`update()`ã€`queryOne()`ï¼‰ï¼›
3. **ä½¿ç”¨æ³›å‹ + RowMapper å›è°ƒå°è£…ç»“æœæ˜ å°„é€»è¾‘**ï¼›
4. **ä½¿ç”¨ try-with-resources é¿å…èµ„æºæ³„æ¼**ï¼›
5. **å¼‚å¸¸ç»Ÿä¸€å°è£…ä¸º RuntimeExceptionï¼Œé¿å…è°ƒç”¨è€…å¤„ç†ç¹ç SQL å¼‚å¸¸ã€‚**

**ä»£ç ç»“æ„ç¤ºæ„ï¼š**

```java
public class JdbcUtil {
    private static DataSource ds = ...;

    public static <T> List<T> queryList(String sql, RowMapper<T> mapper, Object... params) {
        try (Connection conn = ds.getConnection();
             PreparedStatement ps = conn.prepareStatement(sql)) {
            // å¡«å……å‚æ•° + æ‰§è¡Œ + æ˜ å°„
        }
    }
}
```

------

## âœ… å°ç»“

| é—®é¢˜ç»´åº¦     | é¢è¯•å…³é”®ç‚¹                                           |
| ------------ | ---------------------------------------------------- |
| è¿æ¥æ± åŸç†   | æ€§èƒ½ä¼˜åŒ–ã€å¤ç”¨è¿æ¥ã€ç›‘æ§é…ç½®                         |
| äº‹åŠ¡æ§åˆ¶     | æ‰‹åŠ¨æ§åˆ¶ã€å›æ»šã€åµŒå¥—æ¨¡æ‹Ÿ SavePoint                   |
| è¿æ¥æ³„æ¼é—®é¢˜ | try-with-resourcesã€è¿æ¥æ± é…ç½®ã€ç›‘æ§æ’æŸ¥             |
| å°è£…æ€æƒ³     | æ³›å‹ã€å¼‚å¸¸å¤„ç†ã€æ¨¡æ¿æ–¹æ³•ã€ä½è€¦åˆå¯ç»´æŠ¤çš„ä»£ç è®¾è®¡æ€ç»´ |

------

