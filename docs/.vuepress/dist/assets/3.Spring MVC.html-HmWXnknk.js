import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as n,o as l}from"./app-2aldPGZG.js";const e={};function h(t,s){return l(),a("div",null,s[0]||(s[0]=[n(`<h1 id="spring-mvc-ç›®å½•" tabindex="-1"><a class="header-anchor" href="#spring-mvc-ç›®å½•"><span>Spring MVC ç›®å½•</span></a></h1><h2 id="ä¸€ã€spring-mvc-æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€spring-mvc-æ¦‚è¿°"><span>ä¸€ã€Spring MVC æ¦‚è¿°</span></a></h2><ul><li>ä»€ä¹ˆæ˜¯ Spring MVCï¼Ÿ</li><li>Spring MVC ä¸ Servlet çš„å…³ç³»</li><li>Spring MVC åœ¨ Spring ç”Ÿæ€ç³»ç»Ÿä¸­çš„è§’è‰²</li></ul><h2 id="äºŒã€è¯·æ±‚å¤„ç†æµç¨‹æ ¸å¿ƒåŸç†" tabindex="-1"><a class="header-anchor" href="#äºŒã€è¯·æ±‚å¤„ç†æµç¨‹æ ¸å¿ƒåŸç†"><span>äºŒã€è¯·æ±‚å¤„ç†æµç¨‹æ ¸å¿ƒåŸç†</span></a></h2><ul><li>ä»æµè§ˆå™¨è¯·æ±‚åˆ° Controller çš„å¤„ç†æµç¨‹</li><li>DispatcherServlet çš„å·¥ä½œæœºåˆ¶</li><li>HandlerMappingã€HandlerAdapterã€ViewResolver è¯¦è§£</li><li>å¸¸è§æ‰§è¡Œé“¾æ¡ä¸æ‹¦æˆªç‚¹åˆ†æ</li></ul><h2 id="ä¸‰ã€controller-å¼€å‘ä¸æ³¨è§£è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€controller-å¼€å‘ä¸æ³¨è§£è¯¦è§£"><span>ä¸‰ã€Controller å¼€å‘ä¸æ³¨è§£è¯¦è§£</span></a></h2><ul><li><code>@Controller</code> ä¸ <code>@RestController</code> çš„åŒºåˆ«</li><li>è¯·æ±‚æ˜ å°„æ³¨è§£è¯¦è§£ï¼š<code>@RequestMapping</code>ã€<code>@GetMapping</code>ã€<code>@PostMapping</code> ç­‰</li><li>å‚æ•°ç»‘å®šï¼š<code>@RequestParam</code>ã€<code>@PathVariable</code>ã€<code>@RequestBody</code>ã€<code>@ModelAttribute</code></li><li>å“åº”å¤„ç†ï¼š<code>@ResponseBody</code>ã€è¿”å› JSONã€è¿”å›è§†å›¾</li><li>æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½å¤„ç†</li></ul><h2 id="å››ã€æ•°æ®ç»‘å®šä¸ç±»å‹è½¬æ¢æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#å››ã€æ•°æ®ç»‘å®šä¸ç±»å‹è½¬æ¢æœºåˆ¶"><span>å››ã€æ•°æ®ç»‘å®šä¸ç±»å‹è½¬æ¢æœºåˆ¶</span></a></h2><ul><li>å±æ€§ç»‘å®šçš„åº•å±‚æœºåˆ¶ï¼š<code>WebDataBinder</code></li><li>è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨ï¼š<code>Converter</code>ã€<code>Formatter</code></li><li>è¡¨å•å¯¹è±¡ç»‘å®šä¸éªŒè¯æµç¨‹</li><li><code>@Valid</code>ã€<code>@Validated</code> ä¸å¼‚å¸¸å¤„ç†è”åŠ¨</li></ul><h2 id="äº”ã€å¼‚å¸¸å¤„ç†æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#äº”ã€å¼‚å¸¸å¤„ç†æœºåˆ¶"><span>äº”ã€å¼‚å¸¸å¤„ç†æœºåˆ¶</span></a></h2><ul><li>å±€éƒ¨å¼‚å¸¸å¤„ç†ï¼š<code>@ExceptionHandler</code></li><li>å…¨å±€å¼‚å¸¸å¤„ç†ï¼š<code>@ControllerAdvice</code></li><li>å¼‚å¸¸å“åº”æ ¼å¼è®¾è®¡ä¸ç»Ÿä¸€å°è£…</li><li>è‡ªå®šä¹‰å¼‚å¸¸ç»“æ„çš„è®¾è®¡å®è·µ</li></ul><h2 id="å…­ã€è§†å›¾è§£æä¸æ¨¡æ¿å¼•æ“" tabindex="-1"><a class="header-anchor" href="#å…­ã€è§†å›¾è§£æä¸æ¨¡æ¿å¼•æ“"><span>å…­ã€è§†å›¾è§£æä¸æ¨¡æ¿å¼•æ“</span></a></h2><ul><li>Spring MVC è§†å›¾è§£ææœºåˆ¶åŸç†</li><li>å¸¸ç”¨æ¨¡æ¿å¼•æ“ï¼šThymeleafã€Freemarkerã€JSP</li><li>è§†å›¾ä¸æ•°æ®æ¨¡å‹çš„äº¤äº’ï¼š<code>Model</code>ã€<code>ModelAndView</code></li></ul><h2 id="ä¸ƒã€æ‹¦æˆªå™¨ä¸è¿‡æ»¤å™¨æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€æ‹¦æˆªå™¨ä¸è¿‡æ»¤å™¨æœºåˆ¶"><span>ä¸ƒã€æ‹¦æˆªå™¨ä¸è¿‡æ»¤å™¨æœºåˆ¶</span></a></h2><ul><li>æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰ä¸ Filter çš„åŒºåˆ«ä¸åº”ç”¨åœºæ™¯</li><li>å®ç° HandlerInterceptor æ¥å£çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</li><li>æ³¨å†Œä¸é…ç½®å¤šä¸ªæ‹¦æˆªå™¨çš„é¡ºåº</li><li>å®æˆ˜ï¼šç”¨æˆ·æƒé™æ ¡éªŒã€æ¥å£ç­¾åæ ¡éªŒç­‰</li></ul><h2 id="å…«ã€å¼‚æ­¥è¯·æ±‚ä¸å“åº”å¤„ç†" tabindex="-1"><a class="header-anchor" href="#å…«ã€å¼‚æ­¥è¯·æ±‚ä¸å“åº”å¤„ç†"><span>å…«ã€å¼‚æ­¥è¯·æ±‚ä¸å“åº”å¤„ç†</span></a></h2><ul><li>ä½¿ç”¨ <code>@Async</code> ä¸ <code>Callable</code> å®ç°å¼‚æ­¥æ§åˆ¶å™¨</li><li>ä½¿ç”¨ <code>DeferredResult</code>ã€<code>WebAsyncTask</code> å®ç°é•¿è½®è¯¢</li><li>å¼‚æ­¥å¤„ç†åŸç†ä¸çº¿ç¨‹æ¨¡å‹</li></ul><h2 id="ä¹ã€è·¨åŸŸè¯·æ±‚ä¸-cors-æ”¯æŒ" tabindex="-1"><a class="header-anchor" href="#ä¹ã€è·¨åŸŸè¯·æ±‚ä¸-cors-æ”¯æŒ"><span>ä¹ã€è·¨åŸŸè¯·æ±‚ä¸ CORS æ”¯æŒ</span></a></h2><ul><li>ä»€ä¹ˆæ˜¯è·¨åŸŸåŠå…¶æœ¬è´¨</li><li>Spring MVC ä¸­é…ç½®è·¨åŸŸæ”¯æŒçš„ä¸‰ç§æ–¹å¼</li><li>ä½¿ç”¨ <code>@CrossOrigin</code> æ³¨è§£å¤„ç†è·¨åŸŸ</li><li>è·¨åŸŸè¯·æ±‚ä¸è®¤è¯å®‰å…¨æ€§é£é™©é˜²èŒƒ</li></ul><h2 id="åã€spring-mvc-æ€§èƒ½ä¼˜åŒ–ä¸è°ƒè¯•æŠ€å·§" tabindex="-1"><a class="header-anchor" href="#åã€spring-mvc-æ€§èƒ½ä¼˜åŒ–ä¸è°ƒè¯•æŠ€å·§"><span>åã€Spring MVC æ€§èƒ½ä¼˜åŒ–ä¸è°ƒè¯•æŠ€å·§</span></a></h2><ul><li>è¯·æ±‚å¤„ç†é“¾è°ƒä¼˜å»ºè®®</li><li>JSON è½¬æ¢æ€§èƒ½ä¼˜åŒ–</li><li>é™æ€èµ„æºä¼˜åŒ–ä¸ç¼“å­˜é…ç½®</li><li>å¸¸è§æ€§èƒ½é—®é¢˜è¯Šæ–­æŠ€å·§ï¼ˆå¦‚è¯·æ±‚é˜»å¡ã€è§†å›¾æ¸²æŸ“æ…¢ï¼‰</li></ul><h2 id="åä¸€ã€æµ‹è¯•ä¸è°ƒè¯•æ”¯æŒ" tabindex="-1"><a class="header-anchor" href="#åä¸€ã€æµ‹è¯•ä¸è°ƒè¯•æ”¯æŒ"><span>åä¸€ã€æµ‹è¯•ä¸è°ƒè¯•æ”¯æŒ</span></a></h2><ul><li>å•å…ƒæµ‹è¯•ä¸æ§åˆ¶å™¨ Mock æµ‹è¯•ï¼ˆMockMvcï¼‰</li><li>æ¨¡æ‹Ÿè¯·æ±‚å‚æ•°ä¸çŠ¶æ€æ ¡éªŒ</li><li>Spring MVC æµ‹è¯•ä¸­å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</li></ul><h2 id="åäºŒã€spring-mvc-å¸¸è§é¢è¯•é¢˜ä¸è®¾è®¡é¢˜" tabindex="-1"><a class="header-anchor" href="#åäºŒã€spring-mvc-å¸¸è§é¢è¯•é¢˜ä¸è®¾è®¡é¢˜"><span>åäºŒã€Spring MVC å¸¸è§é¢è¯•é¢˜ä¸è®¾è®¡é¢˜</span></a></h2><ul><li>Spring MVC æ‰§è¡Œæµç¨‹èƒ½å¦è¯¦ç»†æè¿°ï¼Ÿ</li><li>DispatcherServlet æ˜¯å¦‚ä½•è°ƒåº¦è¯·æ±‚çš„ï¼Ÿ</li><li>å‚æ•°ç»‘å®šåº•å±‚åŸç†ä¸è‡ªå®šä¹‰ç»‘å®šï¼Ÿ</li><li>å¦‚ä½•ä¼˜é›…åœ°å¤„ç†å…¨å±€å¼‚å¸¸ï¼Ÿæ˜¯å¦å¯ä»¥æŒ‰æ¨¡å—åˆ‡åˆ†ï¼Ÿ</li><li>å¦‚ä½•åº”å¯¹é«˜å¹¶å‘ä¸‹ Controller æ€§èƒ½ç“¶é¢ˆï¼Ÿ</li></ul><h2 id="åä¸‰ã€æœ€ä½³å®è·µä¸æ¶æ„å»ºè®®" tabindex="-1"><a class="header-anchor" href="#åä¸‰ã€æœ€ä½³å®è·µä¸æ¶æ„å»ºè®®"><span>åä¸‰ã€æœ€ä½³å®è·µä¸æ¶æ„å»ºè®®</span></a></h2><ul><li>åˆ†å±‚ Controller è®¾è®¡ï¼šAPI å±‚ã€ä¸šåŠ¡å±‚è§£è€¦</li><li>ç»Ÿä¸€è¿”å›å€¼ç»“æ„ä¸å“åº”å°è£…æ–¹æ¡ˆ</li><li>æ¨¡å—åŒ– MVC æ¶æ„å»ºè®®ï¼ˆå¦‚å¤šæ¨¡å—æ§åˆ¶å™¨æ³¨å†Œï¼‰</li><li>å¦‚ä½•åˆç†ä½¿ç”¨æ‹¦æˆªå™¨ä¸ AOP åšåˆ‡é¢é€»è¾‘å¤„ç†</li></ul><hr><h1 id="ä¸€ã€spring-mvc-æ¦‚è¿°-1" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€spring-mvc-æ¦‚è¿°-1"><span>ä¸€ã€Spring MVC æ¦‚è¿°</span></a></h1><p>Spring MVC æ˜¯ Spring Framework æä¾›çš„ä¸€ä¸ªå¼ºå¤§è€Œçµæ´»çš„ Web æ¡†æ¶ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯å¯¹ Servlet çš„æŠ½è±¡å’Œå°è£…ï¼ŒåŸºäºå‰ç«¯æ§åˆ¶å™¨ï¼ˆFront Controllerï¼‰æ¨¡å¼ï¼Œå®ç°äº†è¯·æ±‚çš„ç»Ÿä¸€è°ƒåº¦ã€å‚æ•°ç»‘å®šã€æ•°æ®è¿”å›ã€è§†å›¾æ¸²æŸ“ç­‰åŠŸèƒ½ï¼Œæ˜¯æ„å»ºç°ä»£ Java Web åº”ç”¨çš„ä¸»æµæ–¹æ¡ˆä¹‹ä¸€ã€‚</p><hr><h2 id="_1-ä»€ä¹ˆæ˜¯-spring-mvc" tabindex="-1"><a class="header-anchor" href="#_1-ä»€ä¹ˆæ˜¯-spring-mvc"><span>1. ä»€ä¹ˆæ˜¯ Spring MVCï¼Ÿ</span></a></h2><p>Spring MVCï¼ˆModel-View-Controllerï¼‰æ˜¯ä¸€ä¸ª Web å±‚æ¡†æ¶ï¼Œæ„å»ºåœ¨ Servlet API ä¹‹ä¸Šï¼Œæ—¨åœ¨å®ç°è¯·æ±‚é©±åŠ¨çš„ Web åº”ç”¨å¼€å‘ã€‚</p><p>å®ƒå…·å¤‡ä»¥ä¸‹æ ¸å¿ƒç‰¹æ€§ï¼š</p><ul><li>åŸºäº DispatcherServlet å®ç°è¯·æ±‚é›†ä¸­åˆ†å‘</li><li>æ”¯æŒæ³¨è§£é©±åŠ¨çš„ Controller å¼€å‘</li><li>å‚æ•°è‡ªåŠ¨ç»‘å®šä¸æ•°æ®éªŒè¯</li><li>çµæ´»çš„è§†å›¾è§£æï¼ˆæ”¯æŒ JSPã€Thymeleafã€JSON ç­‰ï¼‰</li><li>ä¸°å¯Œçš„æ‰©å±•æ¥å£ï¼šæ‹¦æˆªå™¨ã€æ¶ˆæ¯è½¬æ¢å™¨ã€å¼‚å¸¸å¤„ç†å™¨ç­‰</li></ul><p>Spring MVC å¹¶éâ€œé‡é‡çº§æ¡†æ¶â€ï¼Œè€Œæ˜¯é€šè¿‡é«˜åº¦æ¨¡å—åŒ–ã€æŒ‰éœ€åŠ è½½çš„æ–¹å¼ï¼Œæå‡å¼€å‘æ•ˆç‡å’Œæ‰©å±•èƒ½åŠ›ã€‚</p><blockquote><p>âœ… æ‰¹åˆ¤æ€§æ€è€ƒï¼šSpring MVC æœ€å¤§ä¼˜åŠ¿æ˜¯ä¸ Spring å®¹å™¨çš„æ— ç¼é›†æˆï¼Œå½¢æˆå®Œæ•´çš„ IoC + AOP + MVC å…¨å®¶æ¡¶ï¼›ä½†ç¼ºç‚¹æ˜¯å­¦ä¹ æ›²çº¿ç›¸å¯¹é™¡å³­ã€é…ç½®é¡¹å¤šã€å¯¹ Servlet æœ¬èº«æŠ½è±¡å±‚æ¬¡è¾ƒé«˜ï¼Œè°ƒè¯•éš¾åº¦ä¸Šå‡ã€‚</p></blockquote><hr><h2 id="_2-spring-mvc-ä¸-servlet-çš„å…³ç³»" tabindex="-1"><a class="header-anchor" href="#_2-spring-mvc-ä¸-servlet-çš„å…³ç³»"><span>2. Spring MVC ä¸ Servlet çš„å…³ç³»</span></a></h2><p>Spring MVC æœ¬è´¨ä¸Šæ˜¯ Servlet çš„é«˜çº§å°è£…ã€‚ä¸‹é¢æ˜¯ä¸¤è€…çš„ç»“æ„å¯¹åº”å…³ç³»ï¼š</p><table><thead><tr><th>Servlet API æ¦‚å¿µ</th><th>Spring MVC å¯¹åº”å°è£…</th></tr></thead><tbody><tr><td><code>HttpServlet</code></td><td><code>DispatcherServlet</code></td></tr><tr><td><code>doGet()/doPost()</code></td><td><code>@RequestMapping</code> æ§åˆ¶å™¨æ–¹æ³•</td></tr><tr><td><code>ServletRequest</code></td><td>è‡ªåŠ¨å‚æ•°ç»‘å®šï¼ˆ<code>@RequestParam</code> ç­‰ï¼‰</td></tr><tr><td><code>RequestDispatcher.forward()</code></td><td><code>ViewResolver</code> è§†å›¾è§£æ</td></tr></tbody></table><p><strong>å…³é”®ç‚¹ï¼š</strong></p><ul><li>æ‰€æœ‰ HTTP è¯·æ±‚æœ€ç»ˆç”± <code>DispatcherServlet</code> ç»Ÿä¸€å¤„ç†ï¼Œè¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ Servletã€‚</li><li><code>DispatcherServlet</code> æœ¬è´¨æ˜¯ Servletï¼Œå®ƒç»§æ‰¿è‡ª <code>HttpServlet</code>ï¼Œå¹¶é€šè¿‡ Spring çš„é…ç½®æœºåˆ¶æ³¨å†Œåˆ° Web å®¹å™¨ä¸­ã€‚</li><li><code>DispatcherServlet</code> å†…éƒ¨é€šè¿‡ HandlerMappingã€HandlerAdapterã€ViewResolver ç­‰ç­–ç•¥ç»„ä»¶è§£è€¦è¯·æ±‚åˆ†å‘ã€æ§åˆ¶å™¨æ‰§è¡Œã€ç»“æœè¿”å›ã€‚</li></ul><blockquote><p>âš ï¸ æ³¨æ„ï¼šSpring MVC ä¸ç­‰äº Spring Bootï¼Œåè€…æ˜¯å¯¹ Spring MVC çš„è‡ªåŠ¨åŒ–å°è£…ï¼Œä½†åº•å±‚ä¾èµ–ä¾ç„¶æ˜¯ DispatcherServletã€‚</p></blockquote><hr><h2 id="_3-spring-mvc-åœ¨-spring-ç”Ÿæ€ç³»ç»Ÿä¸­çš„è§’è‰²" tabindex="-1"><a class="header-anchor" href="#_3-spring-mvc-åœ¨-spring-ç”Ÿæ€ç³»ç»Ÿä¸­çš„è§’è‰²"><span>3. Spring MVC åœ¨ Spring ç”Ÿæ€ç³»ç»Ÿä¸­çš„è§’è‰²</span></a></h2><p>Spring MVC åœ¨æ•´ä¸ª Spring æŠ€æœ¯ä½“ç³»ä¸­çš„å®šä½å¦‚ä¸‹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>          Web å±‚ï¼ˆSpring MVCï¼‰</span></span>
<span class="line"><span>               â†“</span></span>
<span class="line"><span>          Service å±‚ï¼ˆSpringï¼‰</span></span>
<span class="line"><span>               â†“</span></span>
<span class="line"><span>          DAO å±‚ï¼ˆSpring JDBC / MyBatisï¼‰</span></span>
<span class="line"><span>               â†“</span></span>
<span class="line"><span>          æ•°æ®æºï¼ˆHikariCP / DBCPï¼‰</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å¾®æœåŠ¡æ—¶ä»£ï¼ŒSpring MVC ä»ç„¶æ˜¯ï¼š</p><ul><li>Spring Boot Web çš„æ ¸å¿ƒç»„ä»¶ï¼ˆspring-boot-starter-webï¼‰</li><li>Spring Cloud Gatewayã€Feignã€RestTemplate çš„åŸºç¡€æ„å»ºå—</li><li>å‰åç«¯äº¤äº’ä¸­ï¼ŒRESTful API çš„ä¸»è¦è¾“å‡ºè€…</li></ul><p>Spring MVC ä¹Ÿä¸å…¶ä»– Spring ç”Ÿæ€ä¸­çš„æ¨¡å—é…åˆç´§å¯†ï¼š</p><table><thead><tr><th>æ¨¡å—</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>Spring AOP</td><td>æ—¥å¿—ã€æƒé™ã€äº‹åŠ¡ç­‰åˆ‡é¢ç¼–ç¨‹æ”¯æŒ</td></tr><tr><td>Spring Validation</td><td>å‚æ•°æ ¡éªŒæ¡†æ¶ï¼Œé…åˆ <code>@Valid</code> ä½¿ç”¨</td></tr><tr><td>Spring Security</td><td>ä¸ MVC æ‹¦æˆªå™¨ã€Filter æ·±åº¦èåˆ</td></tr><tr><td>Spring Data</td><td>æ”¯æŒ JSON è¯·æ±‚ â†’ å¯¹è±¡ç»‘å®š â†’ æŒä¹…åŒ–æµç¨‹</td></tr><tr><td>Thymeleaf</td><td>MVC çš„ä¸»æµæ¨¡æ¿å¼•æ“</td></tr></tbody></table><blockquote><p>ğŸ¯ æ€»ç»“ï¼šSpring MVC æ˜¯è¿æ¥ Web å±‚ä¸æ ¸å¿ƒä¸šåŠ¡é€»è¾‘çš„æ¡¥æ¢ã€‚è™½ç„¶å¾®æœåŠ¡æ¶æ„æ·¡åŒ–äº† Web å±‚é‡é‡ï¼Œä½† Spring MVC ä¾æ—§æ˜¯æœ€å¹¿æ³›ä½¿ç”¨ã€æœ€æˆç†Ÿçš„ Web æ¡†æ¶ä¹‹ä¸€ã€‚åœ¨ä»¥ REST ä¸ºä¸­å¿ƒçš„æ¶æ„è®¾è®¡ä¸­ï¼Œå®ƒä»æ˜¯æ ¸å¿ƒè§’è‰²ã€‚</p></blockquote><hr><p>å¥½çš„ï¼Œä¸‹é¢æ˜¯<strong>ç¬¬äºŒç« ï¼šè¯·æ±‚å¤„ç†æµç¨‹æ ¸å¿ƒåŸç†</strong>çš„è¯¦ç»†å†…å®¹ï¼Œä¾ç„¶ä¿æŒä½ è¦æ±‚çš„é€»è¾‘æ¸…æ™°ã€åˆ†ç‚¹æ·±å…¥ã€ç»“æ„ä¸€è‡´çš„é£æ ¼ï¼š</p><hr><h1 id="äºŒã€è¯·æ±‚å¤„ç†æµç¨‹æ ¸å¿ƒåŸç†-1" tabindex="-1"><a class="header-anchor" href="#äºŒã€è¯·æ±‚å¤„ç†æµç¨‹æ ¸å¿ƒåŸç†-1"><span>äºŒã€è¯·æ±‚å¤„ç†æµç¨‹æ ¸å¿ƒåŸç†</span></a></h1><p>Spring MVC ä¹‹æ‰€ä»¥å¼ºå¤§ï¼Œå…³é”®åœ¨äºå®ƒå¯¹ HTTP è¯·æ±‚ç”Ÿå‘½å‘¨æœŸçš„å…¨é¢æ¥ç®¡å’Œçµæ´»è°ƒåº¦ã€‚ç†è§£ DispatcherServlet çš„è°ƒåº¦æœºåˆ¶ï¼Œæ˜¯æŒæ¡ Spring MVC çš„åŸºç¡€ã€‚</p><hr><h2 id="_1-ä»æµè§ˆå™¨è¯·æ±‚åˆ°-controller-çš„å¤„ç†æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_1-ä»æµè§ˆå™¨è¯·æ±‚åˆ°-controller-çš„å¤„ç†æµç¨‹"><span>1. ä»æµè§ˆå™¨è¯·æ±‚åˆ° Controller çš„å¤„ç†æµç¨‹</span></a></h2><p>ä¸€ä¸ªå…¸å‹çš„ HTTP è¯·æ±‚åœ¨ Spring MVC ä¸­çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>æµè§ˆå™¨å‘é€è¯·æ±‚ â†’ DispatcherServlet â†’ HandlerMapping â†’ HandlerAdapter â†’ Controller â†’ è¿”å› ModelAndView â†’ ViewResolver â†’ æ¸²æŸ“è§†å›¾</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æµç¨‹ç»†åŒ–å¦‚ä¸‹ï¼š</p><ol><li><strong>æµè§ˆå™¨å‘èµ·è¯·æ±‚</strong>ï¼Œåˆ°è¾¾ Web å®¹å™¨ï¼ˆTomcatã€Jettyï¼‰</li><li><strong>DispatcherServlet</strong> æ‹¦æˆªè¯·æ±‚ï¼ˆç”± web.xml æˆ– Spring Boot è‡ªåŠ¨æ³¨å†Œï¼‰</li><li><strong>æŸ¥æ‰¾ HandlerMapping</strong>ï¼šæ ¹æ® URL å’Œæ–¹æ³•åŒ¹é…å¯¹åº”çš„ Controller å¤„ç†å™¨</li><li><strong>è°ƒç”¨ HandlerAdapter</strong>ï¼šæ‰¾åˆ°åˆé€‚çš„é€‚é…å™¨æ‰§è¡Œå¤„ç†å™¨æ–¹æ³•</li><li><strong>æ‰§è¡Œ Controller æ–¹æ³•</strong>ï¼šå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œè¿”å› ModelAndView æˆ–æ•°æ®</li><li><strong>è¿”å›ç»“æœäº¤ç”± ViewResolver</strong>ï¼šæ ¹æ®é€»è¾‘è§†å›¾åè§£æä¸ºç‰©ç†è§†å›¾è·¯å¾„</li><li><strong>æ¸²æŸ“è§†å›¾å¹¶å“åº”</strong>ï¼šå°† HTML æˆ– JSON è¾“å‡ºåˆ°æµè§ˆå™¨</li></ol><blockquote><p>ğŸ§  åæ€ï¼šè™½ç„¶ Spring MVC çš„å¤„ç†é“¾çœ‹ä¼¼å¤æ‚ï¼Œä½†æœ¬è´¨æ˜¯â€œè¯·æ±‚è°ƒåº¦ â†’ æ§åˆ¶å™¨æ‰§è¡Œ â†’ ç»“æœæ¸²æŸ“â€ä¸‰æ®µå¼ç»“æ„ï¼Œä¸”é€šè¿‡ç­–ç•¥æ¥å£è§£è€¦æ¯ä¸€ç¯ï¼Œåˆ©äºæ‰©å±•ä¸æ›¿æ¢ã€‚</p></blockquote><hr><h2 id="_2-dispatcherservlet-çš„å·¥ä½œæœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_2-dispatcherservlet-çš„å·¥ä½œæœºåˆ¶"><span>2. DispatcherServlet çš„å·¥ä½œæœºåˆ¶</span></a></h2><p><code>DispatcherServlet</code> æ˜¯ Spring MVC çš„æ ¸å¿ƒï¼Œå®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ Servletï¼Œèµ·åˆ°â€œå‰ç«¯æ§åˆ¶å™¨â€çš„ä½œç”¨ï¼Œè´Ÿè´£æ•´ä¸ªè¯·æ±‚æµç¨‹çš„åˆ†å‘ã€åè°ƒã€æ‰§è¡Œã€‚</p><p>å…¶ç”Ÿå‘½å‘¨æœŸä¸æ™®é€š Servlet ä¸€è‡´ï¼š</p><ul><li><strong>åˆå§‹åŒ–é˜¶æ®µ</strong>ï¼ˆinitï¼‰ï¼š <ul><li>åŠ è½½ Spring å®¹å™¨ï¼ˆæˆ–å­å®¹å™¨ï¼‰</li><li>åˆå§‹åŒ–æ‰€æœ‰æ ¸å¿ƒç»„ä»¶ï¼šHandlerMappingã€HandlerAdapterã€ViewResolver ç­‰</li></ul></li><li><strong>è¯·æ±‚å¤„ç†é˜¶æ®µ</strong>ï¼ˆservice/doDispatchï¼‰ï¼š <ul><li>æ ¹æ®è¯·æ±‚æŸ¥æ‰¾æ§åˆ¶å™¨ â†’ æ‰§è¡Œ â†’ æ¸²æŸ“ â†’ è¿”å›å“åº”</li></ul></li></ul><p>æºç å…¥å£ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">protected</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> doDispatch</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> HttpServletResponse</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> response) throws Exception {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    HandlerExecutionChain</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mappedHandler </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(request)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // 1. æ‰¾å¤„ç†å™¨</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    HandlerAdapter</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> ha </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getHandlerAdapter</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">mappedHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // 2. æ‰¾é€‚é…å™¨</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    ModelAndView</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mv </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> ha</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">handle</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(request, response, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">mappedHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // 3. è°ƒç”¨å¤„ç†å™¨</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    render</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> response)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // 4. è§†å›¾è§£æ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ğŸ¯ å…³é”®è§‚ç‚¹ï¼šDispatcherServlet çš„è®¾è®¡å……åˆ†ä½“ç°äº†â€œå¼€é—­åŸåˆ™â€ï¼šé€šè¿‡ç­–ç•¥æ¥å£å¼€æ”¾æ‰©å±•ç‚¹ï¼Œè€Œæ ¸å¿ƒæµç¨‹ä¿æŒç¨³å®šã€‚</p></blockquote><hr><h2 id="_3-handlermappingã€handleradapterã€viewresolver-è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#_3-handlermappingã€handleradapterã€viewresolver-è¯¦è§£"><span>3. HandlerMappingã€HandlerAdapterã€ViewResolver è¯¦è§£</span></a></h2><h3 id="handlermapping-è¯·æ±‚è·¯å¾„æ˜ å°„å™¨" tabindex="-1"><a class="header-anchor" href="#handlermapping-è¯·æ±‚è·¯å¾„æ˜ å°„å™¨"><span>HandlerMappingï¼ˆè¯·æ±‚è·¯å¾„æ˜ å°„å™¨ï¼‰</span></a></h3><ul><li>ä½œç”¨ï¼šå°†è¯·æ±‚è·¯å¾„æ˜ å°„åˆ°å¯¹åº”çš„ Handlerï¼ˆä¸€èˆ¬æ˜¯ Controller æ–¹æ³•ï¼‰</li><li>å¸¸è§å®ç°ç±»ï¼š <ul><li><code>RequestMappingHandlerMapping</code>ï¼ˆåŸºäºæ³¨è§£ï¼‰</li><li><code>SimpleUrlHandlerMapping</code>ï¼ˆåŸºäº XMLï¼‰</li></ul></li></ul><h3 id="handleradapter-å¤„ç†å™¨é€‚é…å™¨" tabindex="-1"><a class="header-anchor" href="#handleradapter-å¤„ç†å™¨é€‚é…å™¨"><span>HandlerAdapterï¼ˆå¤„ç†å™¨é€‚é…å™¨ï¼‰</span></a></h3><ul><li>ä½œç”¨ï¼šè´Ÿè´£â€œå¦‚ä½•æ‰§è¡Œâ€Handler</li><li>è®¾è®¡è§£è€¦ Controller çš„ç±»å‹å’Œæ‰§è¡Œæ–¹å¼</li><li>å…¸å‹å®ç°ï¼š <ul><li><code>RequestMappingHandlerAdapter</code>ï¼šæ”¯æŒ <code>@RequestMapping</code> æ³¨è§£çš„æ–¹æ³•</li><li><code>HttpRequestHandlerAdapter</code>ï¼šé€‚é…å®ç° <code>HttpRequestHandler</code> æ¥å£çš„å¤„ç†å™¨</li></ul></li></ul><h3 id="viewresolver-è§†å›¾è§£æå™¨" tabindex="-1"><a class="header-anchor" href="#viewresolver-è§†å›¾è§£æå™¨"><span>ViewResolverï¼ˆè§†å›¾è§£æå™¨ï¼‰</span></a></h3><ul><li>ä½œç”¨ï¼šæ ¹æ® Controller è¿”å›çš„é€»è¾‘è§†å›¾åï¼Œè§£æå‡ºå®é™…çš„ç‰©ç†è§†å›¾è·¯å¾„</li><li>å¸¸è§å®ç°ï¼š <ul><li><code>InternalResourceViewResolver</code>ï¼šç”¨äº JSP</li><li><code>ThymeleafViewResolver</code>ï¼šç”¨äº Thymeleaf</li><li><code>MappingJackson2JsonView</code>ï¼šè¿”å› JSON æ•°æ®</li></ul></li></ul><p>é…ç½®ç¤ºä¾‹ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Bean</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> InternalResourceViewResolver</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> viewResolver</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    InternalResourceViewResolver</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> resolver </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> InternalResourceViewResolver</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    resolver</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setPrefix</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/WEB-INF/views/&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    resolver</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setSuffix</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;.jsp&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> resolver</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ğŸ’¡ æ€è€ƒï¼šä¸‰å¤§ç»„ä»¶çš„ç­–ç•¥æ¨¡å¼è®¾è®¡ï¼Œä¿è¯äº† MVC å¤„ç†é“¾çš„é«˜åº¦çµæ´»ä¸å¯å®šåˆ¶æ€§ â€”â€” ä½ å¯ä»¥è½»æ¾æ›¿æ¢é»˜è®¤å®ç°ï¼Œè‡ªå®šä¹‰é€‚åˆä½ çš„è¯·æ±‚å¤„ç†é€»è¾‘ã€‚</p></blockquote><hr><h2 id="_4-å¸¸è§æ‰§è¡Œé“¾æ¡ä¸æ‹¦æˆªç‚¹åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_4-å¸¸è§æ‰§è¡Œé“¾æ¡ä¸æ‹¦æˆªç‚¹åˆ†æ"><span>4. å¸¸è§æ‰§è¡Œé“¾æ¡ä¸æ‹¦æˆªç‚¹åˆ†æ</span></a></h2><p>Spring MVC çš„è¯·æ±‚ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæœ‰å¤šä¸ªå¯æ’æ‹”çš„â€œæ‹¦æˆªç‚¹â€ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡æ‰©å±•æ¥å£æˆ–æ³¨è§£ä»‹å…¥è¯·æ±‚æµç¨‹ï¼Œå…¸å‹åŒ…æ‹¬ï¼š</p><table><thead><tr><th>æ‹¦æˆªç‚¹</th><th>å¯¹åº”ç»„ä»¶</th><th>åº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>è¯·æ±‚è¿›å…¥</td><td><code>HandlerInterceptor.preHandle</code></td><td>ç™»å½•æ ¡éªŒã€ç­¾åæ ¡éªŒ</td></tr><tr><td>æ§åˆ¶å™¨æ‰§è¡Œå‰</td><td><code>@InitBinder</code>ã€AOP Before</td><td>å‚æ•°é¢„å¤„ç†ã€æ—¥å¿—è®°å½•</td></tr><tr><td>æ§åˆ¶å™¨æ‰§è¡Œå</td><td><code>HandlerInterceptor.postHandle</code></td><td>ä¿®æ”¹å“åº”å¯¹è±¡ã€è¿½åŠ å…¬å…±æ¨¡å‹æ•°æ®</td></tr><tr><td>è§†å›¾æ¸²æŸ“å®Œæˆå</td><td><code>HandlerInterceptor.afterCompletion</code></td><td>èµ„æºæ¸…ç†ã€è€—æ—¶ç»Ÿè®¡ã€å¼‚å¸¸è®°å½•</td></tr><tr><td>å¼‚å¸¸å‘ç”Ÿ</td><td><code>@ExceptionHandler</code>ã€<code>@ControllerAdvice</code></td><td>è‡ªå®šä¹‰é”™è¯¯å“åº”ã€ç»Ÿä¸€å¼‚å¸¸å¤„ç†</td></tr></tbody></table><p>æ‹¦æˆªå™¨é“¾æ¡æ‰§è¡Œé¡ºåºï¼š</p><ol><li>preHandle â†’ Controller â†’ postHandle â†’ è§†å›¾æ¸²æŸ“ â†’ afterCompletion</li></ol><blockquote><p>âš ï¸ è­¦æƒ•ï¼šæ‹¦æˆªå™¨é“¾é¡ºåºå’Œè¿”å›å€¼ä¼šå½±å“æ•´ä¸ªè¯·æ±‚æ˜¯å¦ç»§ç»­æ‰§è¡Œï¼Œå°¤å…¶æ˜¯è®¤è¯æ‹¦æˆªã€æƒé™æ ¡éªŒç±»æ‹¦æˆªå™¨ä¸­ï¼Œè¦åˆç†æ§åˆ¶é€»è¾‘åˆ†æ”¯ã€‚</p></blockquote><hr><h1 id="ä¸‰ã€controller-å¼€å‘ä¸æ³¨è§£è¯¦è§£-1" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€controller-å¼€å‘ä¸æ³¨è§£è¯¦è§£-1"><span>ä¸‰ã€Controller å¼€å‘ä¸æ³¨è§£è¯¦è§£</span></a></h1><p>Controller æ˜¯ Spring MVC ä¸­æœ€æ ¸å¿ƒçš„ç»„ä»¶ä¹‹ä¸€ï¼Œæ‰¿æ‹…äº† Web å±‚çš„è·¯ç”±å…¥å£ã€å‚æ•°è§£æã€å“åº”å¤„ç†ç­‰èŒè´£ã€‚æœ¬ç« é‡ç‚¹è®²è§£å¸¸ç”¨æ§åˆ¶å™¨æ³¨è§£åŠå…¶ä½¿ç”¨åœºæ™¯ã€‚</p><hr><h2 id="_1-controller-ä¸-restcontroller-çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_1-controller-ä¸-restcontroller-çš„åŒºåˆ«"><span>1. <code>@Controller</code> ä¸ <code>@RestController</code> çš„åŒºåˆ«</span></a></h2><table><thead><tr><th>æ³¨è§£</th><th>å«ä¹‰</th><th>é»˜è®¤è¡Œä¸º</th></tr></thead><tbody><tr><td><code>@Controller</code></td><td>æ ‡è®°ç±»ä¸ºæ§åˆ¶å™¨ç»„ä»¶</td><td>æ–¹æ³•é»˜è®¤è¿”å›è§†å›¾ï¼ˆé€»è¾‘è§†å›¾åï¼‰</td></tr><tr><td><code>@RestController</code></td><td><code>@Controller + @ResponseBody</code>ç»„åˆ</td><td>æ‰€æœ‰æ–¹æ³•é»˜è®¤è¿”å› JSONï¼ˆæˆ–å…¶ä»–å¯¹è±¡ï¼‰å“åº”</td></tr></tbody></table><p>ç¤ºä¾‹å¯¹æ¯”ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>@Controller</span></span>
<span class="line"><span>public class ViewController {</span></span>
<span class="line"><span>    @GetMapping(&quot;/hello&quot;)</span></span>
<span class="line"><span>    public String hello() {</span></span>
<span class="line"><span>        return &quot;hello&quot;; // è¿”å›é€»è¾‘è§†å›¾åï¼ˆhello.jspï¼‰</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>@RestController</span></span>
<span class="line"><span>public class ApiController {</span></span>
<span class="line"><span>    @GetMapping(&quot;/hello&quot;)</span></span>
<span class="line"><span>    public String hello() {</span></span>
<span class="line"><span>        return &quot;Hello JSON&quot;; // è¿”å›å­—ç¬¦ä¸²ï¼ˆJSON å“åº”ä½“ï¼‰</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ğŸ¯ å®è·µå»ºè®®ï¼š</p><ul><li>Web é¡µé¢å¼€å‘ â†’ ä½¿ç”¨ <code>@Controller</code></li><li>REST API å¼€å‘ â†’ ä½¿ç”¨ <code>@RestController</code></li></ul></blockquote><hr><h2 id="_2-è¯·æ±‚æ˜ å°„æ³¨è§£è¯¦è§£-requestmappingã€-getmappingã€-postmapping-ç­‰" tabindex="-1"><a class="header-anchor" href="#_2-è¯·æ±‚æ˜ å°„æ³¨è§£è¯¦è§£-requestmappingã€-getmappingã€-postmapping-ç­‰"><span>2. è¯·æ±‚æ˜ å°„æ³¨è§£è¯¦è§£ï¼š<code>@RequestMapping</code>ã€<code>@GetMapping</code>ã€<code>@PostMapping</code> ç­‰</span></a></h2><h3 id="requestmapping-é€šç”¨æ˜ å°„" tabindex="-1"><a class="header-anchor" href="#requestmapping-é€šç”¨æ˜ å°„"><span>@RequestMappingï¼ˆé€šç”¨æ˜ å°„ï¼‰</span></a></h3><ul><li>å¯ç”¨äºç±»æˆ–æ–¹æ³•çº§åˆ«</li><li>æ”¯æŒè®¾ç½®è·¯å¾„ã€æ–¹æ³•ã€å‚æ•°ã€è¯·æ±‚å¤´ç­‰å±æ€§</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>@RequestMapping(value = &quot;/user&quot;, method = RequestMethod.GET)</span></span>
<span class="line"><span>public String getUser() { ... }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç®€åŒ–æ˜ å°„æ³¨è§£-æ¨èä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#ç®€åŒ–æ˜ å°„æ³¨è§£-æ¨èä½¿ç”¨"><span>ç®€åŒ–æ˜ å°„æ³¨è§£ï¼ˆæ¨èä½¿ç”¨ï¼‰</span></a></h3><ul><li><code>@GetMapping</code>ï¼šä»…å¤„ç† GET è¯·æ±‚</li><li><code>@PostMapping</code>ï¼šä»…å¤„ç† POST è¯·æ±‚</li><li><code>@PutMapping</code>ã€<code>@DeleteMapping</code>ã€<code>@PatchMapping</code>ï¼šç”¨äº REST é£æ ¼æ¥å£</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>@GetMapping(&quot;/user/{id}&quot;)</span></span>
<span class="line"><span>public User getUser(@PathVariable Long id) { ... }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>âš ï¸ æ³¨æ„ï¼šç±»ä¸Šçš„æ˜ å°„ä¸æ–¹æ³•ä¸Šçš„æ˜ å°„è·¯å¾„ä¼šæ‹¼æ¥å½¢æˆå®Œæ•´çš„è·¯å¾„ã€‚</p></blockquote><hr><h2 id="_3-å‚æ•°ç»‘å®š-requestparamã€-pathvariableã€-requestbodyã€-modelattribute" tabindex="-1"><a class="header-anchor" href="#_3-å‚æ•°ç»‘å®š-requestparamã€-pathvariableã€-requestbodyã€-modelattribute"><span>3. å‚æ•°ç»‘å®šï¼š<code>@RequestParam</code>ã€<code>@PathVariable</code>ã€<code>@RequestBody</code>ã€<code>@ModelAttribute</code></span></a></h2><h3 id="requestparam-ç»‘å®š-url-æŸ¥è¯¢å‚æ•°æˆ–è¡¨å•å‚æ•°" tabindex="-1"><a class="header-anchor" href="#requestparam-ç»‘å®š-url-æŸ¥è¯¢å‚æ•°æˆ–è¡¨å•å‚æ•°"><span><code>@RequestParam</code>ï¼šç»‘å®š URL æŸ¥è¯¢å‚æ•°æˆ–è¡¨å•å‚æ•°</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>@GetMapping(&quot;/search&quot;)</span></span>
<span class="line"><span>public String search(@RequestParam(&quot;q&quot;) String query) { ... }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ”¯æŒé»˜è®¤å€¼ï¼š<code>@RequestParam(defaultValue = &quot;all&quot;)</code></li><li>å¯è®¾ä¸ºå¯é€‰ï¼š<code>required = false</code></li></ul><h3 id="pathvariable-ç»‘å®š-url-è·¯å¾„å˜é‡" tabindex="-1"><a class="header-anchor" href="#pathvariable-ç»‘å®š-url-è·¯å¾„å˜é‡"><span><code>@PathVariable</code>ï¼šç»‘å®š URL è·¯å¾„å˜é‡</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>@GetMapping(&quot;/user/{id}&quot;)</span></span>
<span class="line"><span>public User getUser(@PathVariable Long id) { ... }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è·¯å¾„å˜é‡åå¿…é¡»ä¸ URL åŒ¹é…ï¼Œé™¤éä½¿ç”¨ <code>@PathVariable(&quot;urlName&quot;)</code></li></ul><h3 id="requestbody-ç»‘å®šè¯·æ±‚ä½“-ä¸€èˆ¬ä¸º-json" tabindex="-1"><a class="header-anchor" href="#requestbody-ç»‘å®šè¯·æ±‚ä½“-ä¸€èˆ¬ä¸º-json"><span><code>@RequestBody</code>ï¼šç»‘å®šè¯·æ±‚ä½“ï¼ˆä¸€èˆ¬ä¸º JSONï¼‰</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>@PostMapping(&quot;/user&quot;)</span></span>
<span class="line"><span>public String createUser(@RequestBody User user) { ... }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>éœ€é…ç½® <code>HttpMessageConverter</code>ï¼ŒSpring Boot é»˜è®¤æ”¯æŒ JSON è½¬æ¢</li></ul><h3 id="modelattribute-ç»‘å®šè¡¨å•å¯¹è±¡-é€‚åˆä¼ ç»Ÿè¡¨å•" tabindex="-1"><a class="header-anchor" href="#modelattribute-ç»‘å®šè¡¨å•å¯¹è±¡-é€‚åˆä¼ ç»Ÿè¡¨å•"><span><code>@ModelAttribute</code>ï¼šç»‘å®šè¡¨å•å¯¹è±¡ï¼ˆé€‚åˆä¼ ç»Ÿè¡¨å•ï¼‰</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>@PostMapping(&quot;/register&quot;)</span></span>
<span class="line"><span>public String register(@ModelAttribute UserForm form) { ... }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ğŸ’¡ å¯¹æ¯”å»ºè®®ï¼š</p><ul><li>æ¥æ”¶è¡¨å•å‚æ•° â†’ <code>@RequestParam</code></li><li>æ¥æ”¶è·¯å¾„å‚æ•° â†’ <code>@PathVariable</code></li><li>æ¥æ”¶ JSON â†’ <code>@RequestBody</code></li><li>æ¥æ”¶å¯¹è±¡å‚æ•°ï¼ˆè¡¨å•ï¼‰â†’ <code>@ModelAttribute</code></li></ul></blockquote><hr><h2 id="_4-å“åº”å¤„ç†-responsebodyã€è¿”å›-jsonã€è¿”å›è§†å›¾" tabindex="-1"><a class="header-anchor" href="#_4-å“åº”å¤„ç†-responsebodyã€è¿”å›-jsonã€è¿”å›è§†å›¾"><span>4. å“åº”å¤„ç†ï¼š<code>@ResponseBody</code>ã€è¿”å› JSONã€è¿”å›è§†å›¾</span></a></h2><h3 id="responsebody-å°†è¿”å›å¯¹è±¡å†™å…¥å“åº”ä½“-å¸¸ç”¨äº-json-è¾“å‡º" tabindex="-1"><a class="header-anchor" href="#responsebody-å°†è¿”å›å¯¹è±¡å†™å…¥å“åº”ä½“-å¸¸ç”¨äº-json-è¾“å‡º"><span><code>@ResponseBody</code>ï¼šå°†è¿”å›å¯¹è±¡å†™å…¥å“åº”ä½“ï¼Œå¸¸ç”¨äº JSON è¾“å‡º</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>@GetMapping(&quot;/json&quot;)</span></span>
<span class="line"><span>@ResponseBody</span></span>
<span class="line"><span>public User getUser() {</span></span>
<span class="line"><span>    return new User(&quot;Tom&quot;, 20);</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Spring Boot ä¸­æ¨èä½¿ç”¨ <code>@RestController</code> ä»£æ›¿</li></ul><h3 id="è¿”å›è§†å›¾-é€»è¾‘è§†å›¾å" tabindex="-1"><a class="header-anchor" href="#è¿”å›è§†å›¾-é€»è¾‘è§†å›¾å"><span>è¿”å›è§†å›¾ï¼ˆé€»è¾‘è§†å›¾åï¼‰</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>@GetMapping(&quot;/hello&quot;)</span></span>
<span class="line"><span>public String hello() {</span></span>
<span class="line"><span>    return &quot;hello&quot;; // ç”± ViewResolver æ¸²æŸ“ hello.jsp</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è¿”å›-modelandview" tabindex="-1"><a class="header-anchor" href="#è¿”å›-modelandview"><span>è¿”å› ModelAndView</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>@GetMapping(&quot;/home&quot;)</span></span>
<span class="line"><span>public ModelAndView home() {</span></span>
<span class="line"><span>    ModelAndView mv = new ModelAndView(&quot;home&quot;);</span></span>
<span class="line"><span>    mv.addObject(&quot;name&quot;, &quot;Tom&quot;);</span></span>
<span class="line"><span>    return mv;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è‡ªå®šä¹‰å“åº”ç»“æ„å»ºè®®" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰å“åº”ç»“æ„å»ºè®®"><span>è‡ªå®šä¹‰å“åº”ç»“æ„å»ºè®®</span></a></h3><p>ç»Ÿä¸€è¿”å›æ ¼å¼ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>public class ApiResponse&lt;T&gt; {</span></span>
<span class="line"><span>    private int code;</span></span>
<span class="line"><span>    private String message;</span></span>
<span class="line"><span>    private T data;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_5-æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_5-æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½å¤„ç†"><span>5. æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½å¤„ç†</span></a></h2><h3 id="æ–‡ä»¶ä¸Šä¼ " tabindex="-1"><a class="header-anchor" href="#æ–‡ä»¶ä¸Šä¼ "><span>æ–‡ä»¶ä¸Šä¼ </span></a></h3><p>éœ€è¦æ·»åŠ ä¾èµ–å¹¶å¯ç”¨ multipartï¼š</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">propertiesspring.servlet.multipart.enabled</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">spring.servlet.multipart.max-file-size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">10MB</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Controller ç¤ºä¾‹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>@PostMapping(&quot;/upload&quot;)</span></span>
<span class="line"><span>public String upload(@RequestParam(&quot;file&quot;) MultipartFile file) throws IOException {</span></span>
<span class="line"><span>    String filename = file.getOriginalFilename();</span></span>
<span class="line"><span>    file.transferTo(new File(&quot;/uploads/&quot; + filename));</span></span>
<span class="line"><span>    return &quot;ä¸Šä¼ æˆåŠŸ&quot;;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ–‡ä»¶ä¸‹è½½" tabindex="-1"><a class="header-anchor" href="#æ–‡ä»¶ä¸‹è½½"><span>æ–‡ä»¶ä¸‹è½½</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>@GetMapping(&quot;/download&quot;)</span></span>
<span class="line"><span>public void download(HttpServletResponse response) throws IOException {</span></span>
<span class="line"><span>    File file = new File(&quot;/uploads/example.pdf&quot;);</span></span>
<span class="line"><span>    response.setContentType(&quot;application/pdf&quot;);</span></span>
<span class="line"><span>    response.setHeader(&quot;Content-Disposition&quot;, &quot;attachment;filename=example.pdf&quot;);</span></span>
<span class="line"><span>    Files.copy(file.toPath(), response.getOutputStream());</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>âš ï¸ æ³¨æ„å®‰å…¨ï¼šæ–‡ä»¶ä¸Šä¼ /ä¸‹è½½è¦é˜²æ­¢è·¯å¾„éå†æ¼æ´ã€æ£€æŸ¥ MIME ç±»å‹ã€é™åˆ¶ä¸Šä¼ å¤§å°ã€‚</p></blockquote><hr><p>æŠ±æ­‰ï¼Œæˆ‘æ˜ç™½äº†ï¼ä½ å¸Œæœ›æˆ‘æ ¹æ®ä½ æä¾›çš„æ ¼å¼é‡æ–°å†™<strong>ç¬¬å››ç« </strong>çš„å†…å®¹ã€‚æˆ‘ä¼šæŒ‰ç…§ä½ æä¾›çš„æ ¼å¼ç¼–å†™ã€Šå››ã€æ•°æ®ç»‘å®šä¸ç±»å‹è½¬æ¢æœºåˆ¶ã€‹ã€‚ä»¥ä¸‹æ˜¯è°ƒæ•´åçš„å†…å®¹ï¼š</p><hr><h1 id="å››ã€æ•°æ®ç»‘å®šä¸ç±»å‹è½¬æ¢æœºåˆ¶-1" tabindex="-1"><a class="header-anchor" href="#å››ã€æ•°æ®ç»‘å®šä¸ç±»å‹è½¬æ¢æœºåˆ¶-1"><span>å››ã€æ•°æ®ç»‘å®šä¸ç±»å‹è½¬æ¢æœºåˆ¶</span></a></h1><p>æ•°æ®ç»‘å®šæ˜¯ Spring MVC çš„æ ¸å¿ƒæœºåˆ¶ä¹‹ä¸€ï¼Œå®ƒå…è®¸å°†å®¢æˆ·ç«¯è¯·æ±‚æ•°æ®ï¼ˆå¦‚è¡¨å•æ•°æ®ã€æŸ¥è¯¢å‚æ•°ç­‰ï¼‰ä¸æœåŠ¡å™¨ç«¯çš„å¯¹è±¡è¿›è¡Œç»‘å®šã€‚æœ¬ç« å°†ä»‹ç» Spring MVC ä¸­çš„å±æ€§ç»‘å®šæœºåˆ¶ã€ç±»å‹è½¬æ¢å™¨çš„ä½¿ç”¨ä»¥åŠå¦‚ä½•è¿›è¡Œè¡¨å•å¯¹è±¡ç»‘å®šä¸éªŒè¯ã€‚</p><hr><h2 id="_1-å±æ€§ç»‘å®šçš„åº•å±‚æœºåˆ¶-webdatabinder" tabindex="-1"><a class="header-anchor" href="#_1-å±æ€§ç»‘å®šçš„åº•å±‚æœºåˆ¶-webdatabinder"><span>1. å±æ€§ç»‘å®šçš„åº•å±‚æœºåˆ¶ï¼š<code>WebDataBinder</code></span></a></h2><p>Spring MVC ä¸­ï¼Œæ•°æ®ç»‘å®šçš„åº•å±‚ç”± <code>WebDataBinder</code> å®Œæˆã€‚å®ƒè´Ÿè´£å°†è¯·æ±‚å‚æ•°ä¸ Java å¯¹è±¡å±æ€§è¿›è¡Œç»‘å®šï¼Œå¹¶æ‰§è¡Œç±»å‹è½¬æ¢ã€æ•°æ®éªŒè¯ç­‰æ“ä½œã€‚</p><h3 id="webdatabinder-æ ¸å¿ƒåŠŸèƒ½" tabindex="-1"><a class="header-anchor" href="#webdatabinder-æ ¸å¿ƒåŠŸèƒ½"><span><code>WebDataBinder</code> æ ¸å¿ƒåŠŸèƒ½ï¼š</span></a></h3><ul><li><strong>å±æ€§ç»‘å®š</strong>ï¼šå°† HTTP è¯·æ±‚ä¸­çš„å‚æ•°æ˜ å°„åˆ° Java Bean å±æ€§ã€‚</li><li><strong>ç±»å‹è½¬æ¢</strong>ï¼šè‡ªåŠ¨å°†è¯·æ±‚ä¸­çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºæŒ‡å®šç±»å‹ï¼ˆå¦‚æ—¥æœŸã€æ•°å­—ç­‰ï¼‰ã€‚</li><li><strong>æ•°æ®éªŒè¯</strong>ï¼šåœ¨ç»‘å®šè¿‡ç¨‹ä¸­è§¦å‘éªŒè¯è§„åˆ™ï¼Œç¡®ä¿æ•°æ®çš„æœ‰æ•ˆæ€§ã€‚</li></ul><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">InitBinder</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> initBinder</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">WebDataBinder</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> binder) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    binder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addValidators</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> MyValidator</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ğŸ¯ å®è·µå»ºè®®ï¼š</p><ul><li>ä½¿ç”¨ <code>@InitBinder</code> å®šåˆ¶æ•°æ®ç»‘å®šè¡Œä¸ºã€‚</li><li>ä½¿ç”¨è‡ªå®šä¹‰è½¬æ¢å™¨ã€éªŒè¯å™¨æé«˜çµæ´»æ€§ã€‚</li></ul></blockquote><hr><h2 id="_2-è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨-converterã€formatter" tabindex="-1"><a class="header-anchor" href="#_2-è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨-converterã€formatter"><span>2. è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨ï¼š<code>Converter</code>ã€<code>Formatter</code></span></a></h2><p>Spring æä¾›äº† <code>Converter</code> å’Œ <code>Formatter</code> æ¥å£ï¼Œç”¨äºè‡ªå®šä¹‰ç±»å‹è½¬æ¢é€»è¾‘ã€‚<code>Converter</code> ç”¨äºä¸¤ç§ç±»å‹ä¹‹é—´çš„è½¬æ¢ï¼Œè€Œ <code>Formatter</code> æä¾›äº†æ›´ä¸°å¯Œçš„æ ¼å¼åŒ–åŠŸèƒ½ã€‚</p><h3 id="converter-æ¥å£" tabindex="-1"><a class="header-anchor" href="#converter-æ¥å£"><span><code>Converter</code> æ¥å£</span></a></h3><p><code>Converter&lt;S, T&gt;</code> æ¥å£ç”¨äºå®šä¹‰ä»ç±»å‹ S åˆ°ç±»å‹ T çš„è½¬æ¢ã€‚é€šå¸¸ç”¨äºç®€å•çš„æ•°æ®ç±»å‹è½¬æ¢ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Component</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> StringToDateConverter</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Converter</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Date</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Date</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> convert</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> source</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        try</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> SimpleDateFormat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;yyyy-MM-dd&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">parse</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(source);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ParseException</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="formatter-æ¥å£" tabindex="-1"><a class="header-anchor" href="#formatter-æ¥å£"><span><code>Formatter</code> æ¥å£</span></a></h3><p><code>Formatter</code> æä¾›äº†æ›´å¤æ‚çš„æ ¼å¼åŒ–åŠŸèƒ½ï¼Œé€‚ç”¨äºç‰¹å®šç±»å‹ï¼ˆå¦‚æ—¥æœŸã€è´§å¸ç­‰ï¼‰çš„è½¬æ¢ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Component</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> DateFormatter</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Formatter</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Date</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> SimpleDateFormat</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> dateFormat </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> SimpleDateFormat</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;yyyy-MM-dd&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Date</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> parse</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> text</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Locale</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> locale</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ParseException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> dateFormat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">parse</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(text);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Date</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> object</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Locale</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> locale</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> dateFormat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">format</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(object);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ğŸ’¡ å¯¹æ¯”å»ºè®®ï¼š</p><ul><li>ç®€å•ç±»å‹è½¬æ¢ â†’ ä½¿ç”¨ <code>Converter</code></li><li>éœ€è¦æ ¼å¼åŒ–çš„å¤æ‚ç±»å‹è½¬æ¢ â†’ ä½¿ç”¨ <code>Formatter</code></li></ul></blockquote><hr><h2 id="_3-è¡¨å•å¯¹è±¡ç»‘å®šä¸éªŒè¯æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_3-è¡¨å•å¯¹è±¡ç»‘å®šä¸éªŒè¯æµç¨‹"><span>3. è¡¨å•å¯¹è±¡ç»‘å®šä¸éªŒè¯æµç¨‹</span></a></h2><p>åœ¨ Spring MVC ä¸­ï¼Œè¡¨å•å¯¹è±¡ï¼ˆå³æ¥æ”¶è¡¨å•æäº¤çš„ Java ç±»ï¼‰é€šå¸¸é€šè¿‡ <code>@ModelAttribute</code> è¿›è¡Œç»‘å®šã€‚Spring ä¼šè‡ªåŠ¨å¡«å……è¡¨å•å­—æ®µåˆ°è¡¨å•å¯¹è±¡çš„å±æ€§ä¸­ï¼Œå¹¶è¿›è¡Œæ•°æ®éªŒè¯ã€‚</p><h3 id="è¡¨å•å¯¹è±¡ç»‘å®šç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#è¡¨å•å¯¹è±¡ç»‘å®šç¤ºä¾‹"><span>è¡¨å•å¯¹è±¡ç»‘å®šç¤ºä¾‹ï¼š</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PostMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/register&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> register</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">ModelAttribute</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserForm</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> form) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // ç»‘å®šè¡¨å•æ•°æ®åˆ° UserForm å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;registrationSuccess&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ•°æ®éªŒè¯" tabindex="-1"><a class="header-anchor" href="#æ•°æ®éªŒè¯"><span>æ•°æ®éªŒè¯ï¼š</span></a></h3><p>Spring æ”¯æŒä½¿ç”¨ JSR-303/JSR-380 æ³¨è§£ï¼ˆå¦‚ <code>@NotNull</code>ã€<code>@Size</code> ç­‰ï¼‰è¿›è¡Œæ•°æ®éªŒè¯ã€‚éªŒè¯é”™è¯¯å°†é€šè¿‡ <code>BindingResult</code> å¯¹è±¡è¿”å›ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserForm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">NotNull</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Size</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">min</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> max</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 15</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> username</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">NotNull</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> password</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PostMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/register&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> register</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">ModelAttribute</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Valid</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserForm</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> form</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BindingResult</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> result) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">result</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">hasErrors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;registrationForm&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // è¿”å›è¡¨å•é¡µé¢ï¼Œæ˜¾ç¤ºéªŒè¯é”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;registrationSuccess&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ğŸ¯ å®è·µå»ºè®®ï¼š</p><ul><li>ä½¿ç”¨ <code>@Valid</code> å’Œ <code>BindingResult</code> ç»“åˆè¿›è¡Œè¡¨å•éªŒè¯ã€‚</li><li>ä½¿ç”¨è‡ªå®šä¹‰éªŒè¯å™¨æä¾›æ›´å¤æ‚çš„éªŒè¯é€»è¾‘ã€‚</li></ul></blockquote><hr><h2 id="_4-validã€-validated-ä¸å¼‚å¸¸å¤„ç†è”åŠ¨" tabindex="-1"><a class="header-anchor" href="#_4-validã€-validated-ä¸å¼‚å¸¸å¤„ç†è”åŠ¨"><span>4. <code>@Valid</code>ã€<code>@Validated</code> ä¸å¼‚å¸¸å¤„ç†è”åŠ¨</span></a></h2><p><code>@Valid</code> å’Œ <code>@Validated</code> æ˜¯ç”¨äºè§¦å‘å¯¹è±¡éªŒè¯çš„æ³¨è§£ã€‚åœ¨ Spring MVC ä¸­ï¼Œå®ƒä»¬é€šå¸¸ä¸ <code>BindingResult</code> é…åˆä½¿ç”¨ï¼Œç”¨äºéªŒè¯è¡¨å•å¯¹è±¡ä¸­çš„æ•°æ®ã€‚å¦‚æœéªŒè¯å¤±è´¥ï¼ŒSpring ä¼šè¿”å›å¯¹åº”çš„é”™è¯¯ä¿¡æ¯ã€‚</p><h3 id="valid-ä¸-validated" tabindex="-1"><a class="header-anchor" href="#valid-ä¸-validated"><span><code>@Valid</code> ä¸ <code>@Validated</code>ï¼š</span></a></h3><ul><li><code>@Valid</code> ç”¨äºè§¦å‘å¯¹è±¡çš„æ ¡éªŒã€‚</li><li><code>@Validated</code> æ˜¯ Spring æä¾›çš„æ›´å¼ºå¤§çš„éªŒè¯æ³¨è§£ï¼Œå…è®¸æŒ‰ç…§ä¸åŒçš„ç»„è¿›è¡ŒéªŒè¯ã€‚</li></ul><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserForm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">NotNull</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> username</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">NotNull</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> password</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PostMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/register&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> register</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Valid</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserForm</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> form</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BindingResult</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> result) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">result</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">hasErrors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;registrationForm&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;registrationSuccess&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¼‚å¸¸å¤„ç†è”åŠ¨" tabindex="-1"><a class="header-anchor" href="#å¼‚å¸¸å¤„ç†è”åŠ¨"><span>å¼‚å¸¸å¤„ç†è”åŠ¨ï¼š</span></a></h3><p>Spring è¿˜æä¾›äº†å…¨å±€å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œé€šè¿‡ <code>@ControllerAdvice</code> é…åˆ <code>@ExceptionHandler</code> å¤„ç†éªŒè¯å¤±è´¥çš„å¼‚å¸¸ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">ControllerAdvice</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> GlobalExceptionHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">ExceptionHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">MethodArgumentNotValidException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ResponseEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> handleValidationExceptions</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">MethodArgumentNotValidException</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> errorMessage</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> ex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBindingResult</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                  .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getFieldErrors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                  .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">stream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                  .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(fieldError </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> fieldError</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getField</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;: &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> fieldError</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getDefaultMessage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                  .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">collect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Collectors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">joining</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;, &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ResponseEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;(errorMessage, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">HttpStatus</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">BAD_REQUEST</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ğŸ’¡ å¼‚å¸¸å¤„ç†å»ºè®®ï¼š</p><ul><li>ä½¿ç”¨ <code>@Valid</code> æˆ– <code>@Validated</code> å®ç°è¡¨å•éªŒè¯ã€‚</li><li>é…åˆ <code>BindingResult</code> å¤„ç†è¡¨å•é”™è¯¯ã€‚</li><li>ä½¿ç”¨ <code>@ControllerAdvice</code> å…¨å±€å¤„ç†éªŒè¯å¤±è´¥çš„å¼‚å¸¸ã€‚</li></ul></blockquote><hr><h1 id="äº”ã€å¼‚å¸¸å¤„ç†æœºåˆ¶-1" tabindex="-1"><a class="header-anchor" href="#äº”ã€å¼‚å¸¸å¤„ç†æœºåˆ¶-1"><span>äº”ã€å¼‚å¸¸å¤„ç†æœºåˆ¶</span></a></h1><p>åœ¨å¼€å‘ Web åº”ç”¨æ—¶ï¼Œå¼‚å¸¸å¤„ç†æ˜¯ä¸å¯é¿å…çš„ï¼ŒSpring MVC æä¾›äº†å¤šç§æ–¹å¼æ¥å¤„ç†ä¸åŒå±‚æ¬¡çš„å¼‚å¸¸ã€‚æœ¬ç« å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨å±€éƒ¨å’Œå…¨å±€å¼‚å¸¸å¤„ç†æœºåˆ¶æ¥å¤„ç†è¯·æ±‚ä¸­çš„å¼‚å¸¸ï¼Œå¹¶é€šè¿‡è‡ªå®šä¹‰å¼‚å¸¸å“åº”ç»“æ„å®ç°ç»Ÿä¸€çš„å¼‚å¸¸å°è£…ã€‚</p><hr><h2 id="_1-å±€éƒ¨å¼‚å¸¸å¤„ç†-exceptionhandler" tabindex="-1"><a class="header-anchor" href="#_1-å±€éƒ¨å¼‚å¸¸å¤„ç†-exceptionhandler"><span>1. å±€éƒ¨å¼‚å¸¸å¤„ç†ï¼š<code>@ExceptionHandler</code></span></a></h2><p><code>@ExceptionHandler</code> æ³¨è§£å…è®¸åœ¨æ§åˆ¶å™¨å†…å±€éƒ¨å¤„ç†ç‰¹å®šç±»å‹çš„å¼‚å¸¸ã€‚å½“æ–¹æ³•å‚æ•°ä¸­æœ‰å¼‚å¸¸ç±»å‹æ—¶ï¼ŒSpring ä¼šè‡ªåŠ¨è°ƒç”¨ç›¸åº”çš„å¼‚å¸¸å¤„ç†æ–¹æ³•ã€‚é€šå¸¸ç”¨äºå¤„ç†ä¸è¯¥æ§åˆ¶å™¨æ–¹æ³•ç›¸å…³çš„å¼‚å¸¸ã€‚</p><h3 id="ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹"><span>ç¤ºä¾‹ï¼š</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Controller</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/user/{id}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getUser</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Long</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IllegalArgumentException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ID cannot be negative&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;user&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">ExceptionHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">IllegalArgumentException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> handleIllegalArgumentException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">IllegalArgumentException</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Model</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> model</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        model</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addAttribute</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">ex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getMessage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;errorPage&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ğŸ¯ å®è·µå»ºè®®ï¼š</p><ul><li>å±€éƒ¨å¼‚å¸¸å¤„ç†é€‚ç”¨äºæ§åˆ¶å™¨ä¸­èƒ½å¤Ÿé¢„è§çš„å¼‚å¸¸ï¼Œå¦‚ä¸šåŠ¡é€»è¾‘ç›¸å…³çš„éªŒè¯ã€‚</li><li>æ§åˆ¶å™¨çº§åˆ«çš„å¼‚å¸¸å¤„ç†å¯ä»¥è®©ä¸åŒæ§åˆ¶å™¨æœ‰ç‹¬ç«‹çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚</li></ul></blockquote><hr><h2 id="_2-å…¨å±€å¼‚å¸¸å¤„ç†-controlleradvice" tabindex="-1"><a class="header-anchor" href="#_2-å…¨å±€å¼‚å¸¸å¤„ç†-controlleradvice"><span>2. å…¨å±€å¼‚å¸¸å¤„ç†ï¼š<code>@ControllerAdvice</code></span></a></h2><p><code>@ControllerAdvice</code> æä¾›äº†å…¨å±€å¼‚å¸¸å¤„ç†åŠŸèƒ½ã€‚å®ƒå…è®¸åœ¨åº”ç”¨ç¨‹åºä¸­é›†ä¸­å¤„ç†ä¸åŒæ§åˆ¶å™¨çš„å¼‚å¸¸ï¼Œå¯ä»¥é¿å…åœ¨æ¯ä¸ªæ§åˆ¶å™¨ä¸­é‡å¤ç¼–å†™å¼‚å¸¸å¤„ç†ä»£ç ã€‚</p><h3 id="ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1"><span>ç¤ºä¾‹ï¼š</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">ControllerAdvice</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> GlobalExceptionHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">ExceptionHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">IllegalArgumentException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ResponseEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> handleIllegalArgumentException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">IllegalArgumentException</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ResponseEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Invalid input: &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> ex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getMessage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">HttpStatus</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">BAD_REQUEST</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">ExceptionHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ResponseEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> handleGeneralException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ResponseEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;An error occurred: &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> ex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getMessage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">HttpStatus</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">INTERNAL_SERVER_ERROR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="controlleradvice-çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#controlleradvice-çš„ä½œç”¨"><span><code>@ControllerAdvice</code> çš„ä½œç”¨ï¼š</span></a></h3><ul><li><code>@ExceptionHandler</code>ï¼šå¤„ç†ä¸åŒç±»å‹çš„å¼‚å¸¸ã€‚</li><li><code>@ModelAttribute</code>ï¼šä¸ºæ‰€æœ‰æ§åˆ¶å™¨æä¾›å…¬å…±æ•°æ®ï¼ˆå¦‚å…¨å±€å˜é‡ã€å±æ€§ï¼‰ã€‚</li><li><code>@InitBinder</code>ï¼šä¸ºæ‰€æœ‰æ§åˆ¶å™¨æä¾›æ•°æ®ç»‘å®šè®¾ç½®ã€‚</li></ul><blockquote><p>ğŸ’¡ ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li><code>@ControllerAdvice</code> æ˜¯å¤„ç†å…¨å±€å¼‚å¸¸çš„æœ€ä½³å®è·µï¼Œé€‚ç”¨äºéœ€è¦é›†ä¸­å¤„ç†æ‰€æœ‰å¼‚å¸¸æˆ–ä¸ä¸šåŠ¡é€»è¾‘æ— å…³çš„å¼‚å¸¸ã€‚</li></ul></blockquote><hr><h2 id="_3-å¼‚å¸¸å“åº”æ ¼å¼è®¾è®¡ä¸ç»Ÿä¸€å°è£…" tabindex="-1"><a class="header-anchor" href="#_3-å¼‚å¸¸å“åº”æ ¼å¼è®¾è®¡ä¸ç»Ÿä¸€å°è£…"><span>3. å¼‚å¸¸å“åº”æ ¼å¼è®¾è®¡ä¸ç»Ÿä¸€å°è£…</span></a></h2><p>ä¸ºäº†ä¿æŒä¸€è‡´çš„å¼‚å¸¸å“åº”æ ¼å¼ï¼Œé€šå¸¸ä¼šè®¾è®¡ä¸€ä¸ªç»Ÿä¸€çš„å“åº”æ ¼å¼ã€‚è¿™æ ·åšæœ‰åŠ©äºå‰ç«¯è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼Œå¹¶èƒ½åœ¨ API æ¥å£ä¸­æä¾›ç»Ÿä¸€çš„é”™è¯¯ä¿¡æ¯ã€‚</p><h3 id="ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2"><span>ç¤ºä¾‹ï¼š</span></a></h3><p>ç»Ÿä¸€å“åº”æ ¼å¼ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ApiResponse</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> status</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> message</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> T</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // getters and setters</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¨å±€å¼‚å¸¸å¤„ç†è¿”å›ç»Ÿä¸€å“åº”æ ¼å¼ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">ControllerAdvice</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> GlobalExceptionHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">ExceptionHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">IllegalArgumentException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ResponseEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ApiResponse</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> handleIllegalArgumentException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">IllegalArgumentException</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        ApiResponse</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">response</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ApiResponse</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setStatus</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">HttpStatus</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">BAD_REQUEST</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setMessage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">ex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getMessage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setData</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ResponseEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;(response, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">HttpStatus</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">BAD_REQUEST</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">ExceptionHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ResponseEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ApiResponse</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> handleGeneralException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        ApiResponse</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">response</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ApiResponse</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setStatus</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">HttpStatus</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">INTERNAL_SERVER_ERROR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setMessage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;An error occurred: &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> ex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getMessage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setData</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ResponseEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;(response, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">HttpStatus</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">INTERNAL_SERVER_ERROR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ğŸ’¡ å®è·µå»ºè®®ï¼š</p><ul><li>ç»Ÿä¸€å¼‚å¸¸å“åº”æ ¼å¼æœ‰åŠ©äºå‰åç«¯åä½œï¼Œå‡å°‘å› å¼‚å¸¸å“åº”æ ¼å¼ä¸ä¸€è‡´å¯¼è‡´çš„å¼€å‘é—®é¢˜ã€‚</li><li>å®šä¹‰ <code>ApiResponse</code> ç±»è¿›è¡Œå“åº”å°è£…æ˜¯å¤„ç† API å¼‚å¸¸çš„è‰¯å¥½åšæ³•ã€‚</li></ul></blockquote><hr><h2 id="_4-è‡ªå®šä¹‰å¼‚å¸¸ç»“æ„çš„è®¾è®¡å®è·µ" tabindex="-1"><a class="header-anchor" href="#_4-è‡ªå®šä¹‰å¼‚å¸¸ç»“æ„çš„è®¾è®¡å®è·µ"><span>4. è‡ªå®šä¹‰å¼‚å¸¸ç»“æ„çš„è®¾è®¡å®è·µ</span></a></h2><p>è‡ªå®šä¹‰å¼‚å¸¸ç»“æ„æœ‰åŠ©äºæ ¹æ®ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚è¿”å›æ›´æœ‰æ„ä¹‰çš„é”™è¯¯ä¿¡æ¯ã€‚é€šè¿‡è‡ªå®šä¹‰å¼‚å¸¸ç±»å’Œå“åº”å¯¹è±¡ï¼Œèƒ½å¤Ÿæä¾›æ›´åŠ è¯¦ç»†å’Œå‡†ç¡®çš„é”™è¯¯åé¦ˆã€‚</p><h3 id="è‡ªå®šä¹‰å¼‚å¸¸ç±»" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰å¼‚å¸¸ç±»"><span>è‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼š</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> CustomException</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> code</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> details</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> CustomException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> code</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> details</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        super</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(details);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">code</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> code;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">details</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> details;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getCode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> code;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getDetails</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> details;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å…¨å±€å¼‚å¸¸å¤„ç†ä¸­çš„è‡ªå®šä¹‰å¼‚å¸¸" tabindex="-1"><a class="header-anchor" href="#å…¨å±€å¼‚å¸¸å¤„ç†ä¸­çš„è‡ªå®šä¹‰å¼‚å¸¸"><span>å…¨å±€å¼‚å¸¸å¤„ç†ä¸­çš„è‡ªå®šä¹‰å¼‚å¸¸ï¼š</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">ControllerAdvice</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> GlobalExceptionHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">ExceptionHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">CustomException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ResponseEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ApiResponse</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> handleCustomException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">CustomException</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        ApiResponse</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">response</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ApiResponse</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setStatus</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">ex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getCode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setMessage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">ex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getDetails</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setData</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ResponseEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;(response, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">HttpStatus</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">valueOf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">ex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getCode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()));</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ğŸ¯ å®è·µå»ºè®®ï¼š</p><ul><li>åœ¨ä¸šåŠ¡é€»è¾‘ä¸­æ ¹æ®éœ€è¦æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸ï¼Œä¾¿äºä¼ é€’è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ã€‚</li><li>è‡ªå®šä¹‰å¼‚å¸¸ç»“æ„æœ‰åŠ©äºæä¾›æ›´é«˜å±‚æ¬¡çš„é”™è¯¯ä¿¡æ¯å°è£…ï¼Œå¢å¼ºé”™è¯¯ä¿¡æ¯çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li></ul></blockquote><hr><p>é€šè¿‡ä»¥ä¸Šæ–¹å¼ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨ Spring MVC ä¸­ä¼˜é›…åœ°å¤„ç†å¼‚å¸¸ï¼Œä¸ä»…èƒ½æä¾›å±€éƒ¨å’Œå…¨å±€çš„å¼‚å¸¸å¤„ç†ï¼Œè¿˜èƒ½é€šè¿‡ç»Ÿä¸€çš„å¼‚å¸¸å“åº”æ ¼å¼ï¼Œæå‡å¼‚å¸¸å¤„ç†çš„è§„èŒƒæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚åŒæ—¶ï¼Œå€ŸåŠ©è‡ªå®šä¹‰å¼‚å¸¸ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä¸åŒä¸šåŠ¡åœºæ™¯è®¾è®¡ä¸“é—¨çš„é”™è¯¯åé¦ˆï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚</p><h1 id="å…­ã€è§†å›¾è§£æä¸æ¨¡æ¿å¼•æ“-1" tabindex="-1"><a class="header-anchor" href="#å…­ã€è§†å›¾è§£æä¸æ¨¡æ¿å¼•æ“-1"><span>å…­ã€è§†å›¾è§£æä¸æ¨¡æ¿å¼•æ“</span></a></h1><p>åœ¨ Spring MVC ä¸­ï¼Œè§†å›¾è§£æå’Œæ¨¡æ¿å¼•æ“æ˜¯å±•ç¤ºå±‚çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚è§†å›¾è§£ææœºåˆ¶å†³å®šäº†å¦‚ä½•å°†åç«¯æ•°æ®æ¸²æŸ“æˆå‰ç«¯é¡µé¢ï¼Œè€Œæ¨¡æ¿å¼•æ“åˆ™ç”¨äºç”ŸæˆåŠ¨æ€ç½‘é¡µã€‚æœ¬ç« å°†ä»‹ç» Spring MVC è§†å›¾è§£æçš„åŸç†ï¼Œå¹¶æ·±å…¥æ¢è®¨å¸¸ç”¨çš„æ¨¡æ¿å¼•æ“å’Œè§†å›¾ä¸æ•°æ®æ¨¡å‹çš„äº¤äº’æ–¹å¼ã€‚</p><hr><h2 id="_1-spring-mvc-è§†å›¾è§£ææœºåˆ¶åŸç†" tabindex="-1"><a class="header-anchor" href="#_1-spring-mvc-è§†å›¾è§£ææœºåˆ¶åŸç†"><span>1. Spring MVC è§†å›¾è§£ææœºåˆ¶åŸç†</span></a></h2><p>Spring MVC çš„è§†å›¾è§£ææœºåˆ¶ä¸»è¦æ¶‰åŠ <code>DispatcherServlet</code> ä¸ <code>ViewResolver</code> çš„äº¤äº’ã€‚<code>DispatcherServlet</code> åœ¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä¼šæ ¹æ®è¯·æ±‚ä¿¡æ¯é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„è§†å›¾ï¼Œå¹¶å°†æ¨¡å‹æ•°æ®ä¼ é€’ç»™è¯¥è§†å›¾ã€‚<code>ViewResolver</code> è´Ÿè´£è§£æè§†å›¾åç§°ï¼Œå¹¶å°†å…¶æ˜ å°„åˆ°å®é™…çš„è§†å›¾å¯¹è±¡ï¼ˆå¦‚ JSPã€Thymeleaf æ¨¡æ¿ç­‰ï¼‰ã€‚</p><h3 id="è§†å›¾è§£ææµç¨‹" tabindex="-1"><a class="header-anchor" href="#è§†å›¾è§£ææµç¨‹"><span>è§†å›¾è§£ææµç¨‹ï¼š</span></a></h3><ol><li><strong>è¯·æ±‚å¤„ç†</strong>ï¼š<code>DispatcherServlet</code> æ ¹æ®è¯·æ±‚æ‰¾åˆ°ç›¸åº”çš„æ§åˆ¶å™¨æ–¹æ³•å¹¶æ‰§è¡Œã€‚</li><li><strong>è¿”å›è§†å›¾åç§°</strong>ï¼šæ§åˆ¶å™¨æ–¹æ³•è¿”å›è§†å›¾çš„é€»è¾‘åç§°ï¼ˆä¾‹å¦‚ &quot;home&quot;ï¼‰ã€‚</li><li><strong>è§†å›¾è§£æ</strong>ï¼š<code>DispatcherServlet</code> è°ƒç”¨ <code>ViewResolver</code> æ¥è§£æè§†å›¾åç§°ï¼Œå¹¶æ‰¾åˆ°å…·ä½“çš„è§†å›¾å®ç°ï¼ˆå¦‚ JSP æ–‡ä»¶ã€Thymeleaf æ¨¡æ¿ç­‰ï¼‰ã€‚</li><li><strong>æ¸²æŸ“è§†å›¾</strong>ï¼šè§†å›¾å°†æ¨¡å‹æ•°æ®ä¸æ¨¡æ¿ç»“åˆï¼Œç”Ÿæˆ HTML å†…å®¹å¹¶è¿”å›å®¢æˆ·ç«¯ã€‚</li></ol><h3 id="ç¤ºä¾‹-3" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-3"><span>ç¤ºä¾‹ï¼š</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Controller</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> HomeController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/home&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> home</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Model</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> model</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        model</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addAttribute</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;message&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Welcome to Spring MVC!&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;home&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// è¿”å›é€»è¾‘è§†å›¾å</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>home</code> æ˜¯é€»è¾‘è§†å›¾åï¼Œ<code>ViewResolver</code> ä¼šæ ¹æ®é…ç½®çš„è§†å›¾è§£æå™¨æ‰¾åˆ°ç›¸åº”çš„è§†å›¾æ–‡ä»¶ï¼ˆå¦‚ JSP æ–‡ä»¶æˆ– Thymeleaf æ¨¡æ¿ï¼‰ã€‚</li></ul><hr><h2 id="_2-å¸¸ç”¨æ¨¡æ¿å¼•æ“-thymeleafã€freemarkerã€jsp" tabindex="-1"><a class="header-anchor" href="#_2-å¸¸ç”¨æ¨¡æ¿å¼•æ“-thymeleafã€freemarkerã€jsp"><span>2. å¸¸ç”¨æ¨¡æ¿å¼•æ“ï¼šThymeleafã€Freemarkerã€JSP</span></a></h2><p>Spring MVC æ”¯æŒå¤šç§æ¨¡æ¿å¼•æ“ï¼Œå¸¸ç”¨çš„æœ‰ Thymeleafã€Freemarker å’Œ JSPã€‚æ¯ç§æ¨¡æ¿å¼•æ“æœ‰ä¸åŒçš„ä¼˜åŠ¿å’Œä½¿ç”¨åœºæ™¯ã€‚</p><h3 id="_2-1-thymeleaf" tabindex="-1"><a class="header-anchor" href="#_2-1-thymeleaf"><span>2.1 Thymeleaf</span></a></h3><p>Thymeleaf æ˜¯ä¸€ç§ç°ä»£åŒ–çš„æ¨¡æ¿å¼•æ“ï¼Œä¸“æ³¨äº Web åº”ç”¨çš„è§†å›¾æ¸²æŸ“ï¼Œå…·æœ‰ç®€å•çš„è¯­æ³•å’Œå¼ºå¤§çš„åŠŸèƒ½ï¼Œå°¤å…¶é€‚ç”¨äº Spring Boot é¡¹ç›®ã€‚Thymeleaf çš„æ¨¡æ¿æ–‡ä»¶å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ï¼Œæ— éœ€åç«¯æ¸²æŸ“ï¼Œæ˜¯ç›®å‰æœ€æ¨èä½¿ç”¨çš„æ¨¡æ¿å¼•æ“ã€‚</p><h4 id="é…ç½®-thymeleaf" tabindex="-1"><a class="header-anchor" href="#é…ç½®-thymeleaf"><span>é…ç½® Thymeleafï¼š</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ThymeleafConfig</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Bean</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> SpringTemplateEngine</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> templateEngine</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        SpringTemplateEngine</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> engine</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> SpringTemplateEngine</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        engine</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setTemplateResolver</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">templateResolver</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> engine;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Bean</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ITemplateResolver</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> templateResolver</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        ClassLoaderTemplateResolver</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> resolver</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ClassLoaderTemplateResolver</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        resolver</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setPrefix</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;classpath:/templates/&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        resolver</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setSuffix</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;.html&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        resolver</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setTemplateMode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;HTML5&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> resolver;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-4" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-4"><span>ç¤ºä¾‹ï¼š</span></a></h4><div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">&lt;!-- home.html --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;!</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">DOCTYPE</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> html</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">html</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">head</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">title</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;Welcome&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">title</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">head</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">h1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> th:text</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;\${message}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">h1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">html</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨æ§åˆ¶å™¨ä¸­ï¼Œå°† <code>Model</code> ä¸­çš„ <code>message</code> æ•°æ®æ¸²æŸ“åˆ°é¡µé¢ä¸­ã€‚</li></ul><h3 id="_2-2-freemarker" tabindex="-1"><a class="header-anchor" href="#_2-2-freemarker"><span>2.2 Freemarker</span></a></h3><p>Freemarker æ˜¯ä¸€ç§åŠŸèƒ½å¼ºå¤§çš„æ¨¡æ¿å¼•æ“ï¼Œé€šå¸¸ç”¨äºå¤„ç†åŠ¨æ€ç”Ÿæˆçš„æ–‡æœ¬ï¼Œå¦‚ HTMLã€XMLã€é‚®ä»¶ç­‰ã€‚Freemarker æ”¯æŒå¤æ‚çš„æ¨¡æ¿é€»è¾‘å’Œè¾ƒä¸ºä¸°å¯Œçš„è¯­æ³•ï¼Œä½†ä¸ Thymeleaf ç›¸æ¯”ï¼Œå®ƒçš„è¯­æ³•ç¨æ˜¾å¤æ‚ã€‚</p><h4 id="é…ç½®-freemarker" tabindex="-1"><a class="header-anchor" href="#é…ç½®-freemarker"><span>é…ç½® Freemarkerï¼š</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> FreemarkerConfig</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Bean</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> freemarker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">template</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Configuration</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> freemarkerConfiguration</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        freemarker</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">template</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Configuration</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> configuration</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> freemarker.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">template</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Configuration</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">freemarker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">template</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Configuration</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">VERSION_2_3_29</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        configuration</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setClassForTemplateLoading</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getClass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/templates/&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> configuration;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-5" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-5"><span>ç¤ºä¾‹ï¼š</span></a></h4><div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">&lt;!-- home.ftl --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;!</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">DOCTYPE</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> html</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">html</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">head</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">title</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;Welcome&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">title</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">head</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">h1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;\${message}&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">h1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">html</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä¸ Thymeleaf ç›¸ä¼¼ï¼ŒFreemarker æ¨¡æ¿ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>Model</code> ä¸­çš„å±æ€§è¿›è¡ŒåŠ¨æ€æ¸²æŸ“ã€‚</li></ul><h3 id="_2-3-jsp" tabindex="-1"><a class="header-anchor" href="#_2-3-jsp"><span>2.3 JSP</span></a></h3><p>JSPï¼ˆJavaServer Pagesï¼‰æ˜¯ Java Web å¼€å‘çš„ä¼ ç»ŸæŠ€æœ¯ï¼Œè™½ç„¶è¢« Thymeleaf å’Œ Freemarker æ›¿ä»£çš„è¶‹åŠ¿é€æ¸å¢å¼ºï¼Œä½†ä»ç„¶è¢«ä¸€äº›è€æ—§çš„é¡¹ç›®ä½¿ç”¨ã€‚JSP æ–‡ä»¶ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šç¼–è¯‘æˆ Servlets å¹¶æ¸²æŸ“ã€‚</p><h4 id="é…ç½®-jsp" tabindex="-1"><a class="header-anchor" href="#é…ç½®-jsp"><span>é…ç½® JSPï¼š</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> WebConfig</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> WebMvcConfigurer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> configureViewResolvers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ViewResolverRegistry</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> registry</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        registry</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">jsp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/WEB-INF/views/&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;.jsp&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-6" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-6"><span>ç¤ºä¾‹ï¼š</span></a></h4><div class="language-jsp line-numbers-mode" data-highlighter="shiki" data-ext="jsp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>&lt;!-- home.jsp --&gt;</span></span>
<span class="line"><span>&lt;!DOCTYPE html&gt;</span></span>
<span class="line"><span>&lt;html&gt;</span></span>
<span class="line"><span>&lt;head&gt;</span></span>
<span class="line"><span>    &lt;title&gt;Welcome&lt;/title&gt;</span></span>
<span class="line"><span>&lt;/head&gt;</span></span>
<span class="line"><span>&lt;body&gt;</span></span>
<span class="line"><span>    &lt;h1&gt;\${message}&lt;/h1&gt;</span></span>
<span class="line"><span>&lt;/body&gt;</span></span>
<span class="line"><span>&lt;/html&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ğŸ¯ å®è·µå»ºè®®ï¼š</p><ul><li>å¯¹äºæ–°çš„ Spring é¡¹ç›®ï¼Œæ¨èä½¿ç”¨ Thymeleaf ä½œä¸ºæ¨¡æ¿å¼•æ“ï¼Œå®ƒä¸ Spring çš„é›†æˆéå¸¸å¥½ï¼Œä¸”æ”¯æŒç°ä»£åŒ–çš„ Web å¼€å‘ã€‚</li><li>å¯¹äºä¼ ç»Ÿé¡¹ç›®ï¼ŒFreemarker å’Œ JSP ä»ç„¶æ˜¯æœ‰æ•ˆçš„é€‰æ‹©ï¼Œå°¤å…¶æ˜¯åœ¨ä¸€äº›å¤§å‹ä¼ä¸šçº§åº”ç”¨ä¸­ã€‚</li></ul></blockquote><hr><h2 id="_3-è§†å›¾ä¸æ•°æ®æ¨¡å‹çš„äº¤äº’-modelã€modelandview" tabindex="-1"><a class="header-anchor" href="#_3-è§†å›¾ä¸æ•°æ®æ¨¡å‹çš„äº¤äº’-modelã€modelandview"><span>3. è§†å›¾ä¸æ•°æ®æ¨¡å‹çš„äº¤äº’ï¼š<code>Model</code>ã€<code>ModelAndView</code></span></a></h2><p>åœ¨ Spring MVC ä¸­ï¼Œæ§åˆ¶å™¨æ–¹æ³•é€šå¸¸è¿”å› <code>Model</code> æˆ– <code>ModelAndView</code> å¯¹è±¡ï¼Œè´Ÿè´£å°†æ•°æ®ä¼ é€’ç»™è§†å›¾ã€‚</p><h3 id="_3-1-model-æ¥å£" tabindex="-1"><a class="header-anchor" href="#_3-1-model-æ¥å£"><span>3.1 <code>Model</code> æ¥å£</span></a></h3><p><code>Model</code> æ˜¯ä¸€ä¸ªç®€å•çš„å®¹å™¨ï¼Œå­˜å‚¨ä¼ é€’ç»™è§†å›¾çš„æ•°æ®ã€‚æ§åˆ¶å™¨æ–¹æ³•é€šè¿‡å‘ <code>Model</code> æ·»åŠ å±æ€§æ¥å°†æ•°æ®ä¼ é€’ç»™è§†å›¾ã€‚</p><h4 id="ç¤ºä¾‹-7" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-7"><span>ç¤ºä¾‹ï¼š</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Controller</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> HomeController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/home&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> home</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Model</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> model</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        model</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addAttribute</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;message&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Welcome to Spring MVC!&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;home&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// è¿”å›é€»è¾‘è§†å›¾å</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ<code>Model</code> ç”¨äºå°† <code>message</code> æ•°æ®ä¼ é€’ç»™è§†å›¾ã€‚</p><h3 id="_3-2-modelandview-ç±»" tabindex="-1"><a class="header-anchor" href="#_3-2-modelandview-ç±»"><span>3.2 <code>ModelAndView</code> ç±»</span></a></h3><p><code>ModelAndView</code> æ˜¯ Spring MVC ä¸­æ›´å¤æ‚çš„è§†å›¾å’Œæ•°æ®æ¨¡å‹äº¤äº’æ–¹å¼ï¼Œæ—¢å¯ä»¥ä¼ é€’æ•°æ®æ¨¡å‹ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šè§†å›¾åã€‚</p><h4 id="ç¤ºä¾‹-8" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-8"><span>ç¤ºä¾‹ï¼š</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Controller</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> HomeController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/home&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ModelAndView</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> home</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        ModelAndView</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mv</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ModelAndView</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;home&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        mv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addObject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;message&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Welcome to Spring MVC!&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> mv;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// è¿”å› ModelAndView å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>ModelAndView</code> å¯¹è±¡åŒ…å«äº†è§†å›¾åå’Œæ•°æ®ï¼Œå¯ä»¥çµæ´»åœ°å°†æ•°æ®ä¸è§†å›¾ä¸€èµ·ä¼ é€’ã€‚</p><hr><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h2><p>Spring MVC çš„è§†å›¾è§£ææœºåˆ¶é€šè¿‡ <code>ViewResolver</code> å®Œæˆè§†å›¾åç§°ä¸è§†å›¾å®ç°çš„æ˜ å°„ï¼Œæ”¯æŒå¤šç§æ¨¡æ¿å¼•æ“ï¼Œå¦‚ Thymeleafã€Freemarker å’Œ JSPã€‚<code>Model</code> å’Œ <code>ModelAndView</code> ä½œä¸ºæ•°æ®ä¸è§†å›¾äº¤äº’çš„æ–¹å¼ï¼Œæä¾›äº†çµæ´»çš„è§£å†³æ–¹æ¡ˆï¼Œå¸®åŠ©å¼€å‘è€…å°†æ•°æ®åŠ¨æ€æ¸²æŸ“åˆ°é¡µé¢ä¸­ã€‚é€šè¿‡åˆç†é€‰æ‹©æ¨¡æ¿å¼•æ“å’Œè§†å›¾äº¤äº’æ–¹å¼ï¼Œå¯ä»¥å®ç°é«˜æ•ˆã€å¯ç»´æŠ¤çš„è§†å›¾æ¸²æŸ“ã€‚</p><h1 id="ä¸ƒã€æ‹¦æˆªå™¨ä¸è¿‡æ»¤å™¨æœºåˆ¶-1" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€æ‹¦æˆªå™¨ä¸è¿‡æ»¤å™¨æœºåˆ¶-1"><span>ä¸ƒã€æ‹¦æˆªå™¨ä¸è¿‡æ»¤å™¨æœºåˆ¶</span></a></h1><p>åœ¨ Spring MVC ä¸­ï¼Œæ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰å’Œè¿‡æ»¤å™¨ï¼ˆFilterï¼‰ç”¨äºå¤„ç†è¯·æ±‚å’Œå“åº”ï¼Œèƒ½å¤Ÿåœ¨è¯·æ±‚å¤„ç†çš„ä¸åŒé˜¶æ®µæ‰§è¡Œè‡ªå®šä¹‰æ“ä½œã€‚ä¸¤è€…è™½ç„¶çœ‹ä¼¼ç›¸ä¼¼ï¼Œä½†å®ƒä»¬çš„ä½œç”¨èŒƒå›´ã€åº”ç”¨åœºæ™¯å’Œå®ç°æ–¹å¼æœ‰æ‰€ä¸åŒã€‚æœ¬ç« å°†è¯¦ç»†è®²è§£æ‹¦æˆªå™¨ä¸è¿‡æ»¤å™¨çš„åŒºåˆ«ã€ä½¿ç”¨æ–¹å¼åŠå…¶å¸¸è§åº”ç”¨åœºæ™¯ã€‚</p><hr><h2 id="_1-æ‹¦æˆªå™¨-interceptor-ä¸-filter-çš„åŒºåˆ«ä¸åº”ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#_1-æ‹¦æˆªå™¨-interceptor-ä¸-filter-çš„åŒºåˆ«ä¸åº”ç”¨åœºæ™¯"><span>1. æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰ä¸ Filter çš„åŒºåˆ«ä¸åº”ç”¨åœºæ™¯</span></a></h2><h3 id="_1-1-æ‹¦æˆªå™¨-interceptor" tabindex="-1"><a class="header-anchor" href="#_1-1-æ‹¦æˆªå™¨-interceptor"><span>1.1 æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰</span></a></h3><ul><li><strong>ä½œç”¨èŒƒå›´</strong>ï¼šæ‹¦æˆªå™¨æ˜¯ Spring MVC ç‰¹æœ‰çš„ç»„ä»¶ï¼Œä¸»è¦ç”¨äºå¤„ç†è¯·æ±‚å’Œå“åº”çš„å¤„ç†é“¾ä¸­ã€‚å®ƒå¯ä»¥æ‹¦æˆª Controller æ–¹æ³•çš„æ‰§è¡Œï¼Œé€‚ç”¨äºä¸šåŠ¡é€»è¾‘å¤„ç†é˜¶æ®µã€‚</li><li><strong>å·¥ä½œæ—¶æœº</strong>ï¼šæ‹¦æˆªå™¨å·¥ä½œåœ¨ Spring MVC çš„ DispatcherServlet ä¹‹å‰å’Œä¹‹åï¼Œèƒ½å¤Ÿåœ¨å¤„ç†è¯·æ±‚æ—¶åšä¸€äº›å¤„ç†ï¼Œä¹Ÿå¯ä»¥åœ¨å“åº”è¿”å›å‰åšä¸€äº›é¢å¤–çš„æ“ä½œã€‚</li><li><strong>æ”¯æŒæ¨¡å‹æ•°æ®</strong>ï¼šæ‹¦æˆªå™¨å¯ä»¥è®¿é—® Spring MVC çš„ <code>ModelAndView</code> å¯¹è±¡ï¼Œé€‚åˆç”¨äºå¤„ç†è§†å›¾å’Œæ¨¡å‹æ•°æ®ã€‚</li><li><strong>é…ç½®æ–¹å¼</strong>ï¼šæ‹¦æˆªå™¨æ˜¯åŸºäº Spring é…ç½®çš„ï¼Œéœ€è¦å®ç° <code>HandlerInterceptor</code> æ¥å£å¹¶æ³¨å†Œåˆ° Spring MVC çš„é…ç½®ä¸­ã€‚</li></ul><h4 id="åº”ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#åº”ç”¨åœºæ™¯"><span>åº”ç”¨åœºæ™¯ï¼š</span></a></h4><ul><li>æƒé™æ ¡éªŒ</li><li>ç»Ÿä¸€æ—¥å¿—è®°å½•</li><li>æ€§èƒ½ç›‘æ§</li><li>è¯·æ±‚å’Œå“åº”çš„æ•°æ®å¤„ç†</li></ul><h3 id="_1-2-è¿‡æ»¤å™¨-filter" tabindex="-1"><a class="header-anchor" href="#_1-2-è¿‡æ»¤å™¨-filter"><span>1.2 è¿‡æ»¤å™¨ï¼ˆFilterï¼‰</span></a></h3><ul><li><strong>ä½œç”¨èŒƒå›´</strong>ï¼šè¿‡æ»¤å™¨æ˜¯ Servlet è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥å¯¹ HTTP è¯·æ±‚å’Œå“åº”åšå‰å¤„ç†å’Œåå¤„ç†ï¼Œé€‚ç”¨äºæ‰€æœ‰çš„ HTTP è¯·æ±‚ã€‚</li><li><strong>å·¥ä½œæ—¶æœº</strong>ï¼šè¿‡æ»¤å™¨åœ¨ Servlet å®¹å™¨çº§åˆ«è¿è¡Œï¼Œåœ¨ Spring MVC çš„ DispatcherServlet ä¹‹å‰æ‰§è¡Œã€‚å®ƒå¯ä»¥å¯¹è¯·æ±‚è¿›è¡Œè¿‡æ»¤ï¼Œä½†ä¸èƒ½è®¿é—® <code>ModelAndView</code> å¯¹è±¡ã€‚</li><li><strong>ä¸èƒ½è®¿é—® Spring MVC çš„ä¸Šä¸‹æ–‡</strong>ï¼šè¿‡æ»¤å™¨ä¸æ”¯æŒè®¿é—® Spring ç‰¹å®šçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆå¦‚ <code>Model</code> æˆ– <code>Controller</code>ï¼‰ã€‚</li><li><strong>é…ç½®æ–¹å¼</strong>ï¼šè¿‡æ»¤å™¨éœ€è¦åœ¨ <code>web.xml</code> æˆ– Java é…ç½®ç±»ä¸­è¿›è¡Œé…ç½®ï¼Œæˆ–è€…é€šè¿‡ Spring Boot æä¾›çš„è¿‡æ»¤å™¨æ³¨å†Œæœºåˆ¶è¿›è¡Œæ³¨å†Œã€‚</li></ul><h4 id="åº”ç”¨åœºæ™¯-1" tabindex="-1"><a class="header-anchor" href="#åº”ç”¨åœºæ™¯-1"><span>åº”ç”¨åœºæ™¯ï¼š</span></a></h4><ul><li>è¯·æ±‚æ—¥å¿—è®°å½•</li><li>è¯·æ±‚ç¼–ç å¤„ç†</li><li>å®‰å…¨æ§åˆ¶ï¼ˆå¦‚è·¨ç«™è¯·æ±‚ä¼ªé€ é˜²æŠ¤ï¼‰</li><li>èµ„æºå‹ç¼©ï¼ˆå¦‚ GZIPï¼‰</li></ul><h3 id="_1-3-æ‹¦æˆªå™¨ä¸è¿‡æ»¤å™¨çš„é€‰æ‹©" tabindex="-1"><a class="header-anchor" href="#_1-3-æ‹¦æˆªå™¨ä¸è¿‡æ»¤å™¨çš„é€‰æ‹©"><span>1.3 æ‹¦æˆªå™¨ä¸è¿‡æ»¤å™¨çš„é€‰æ‹©</span></a></h3><ul><li><strong>å½“éœ€è¦å¤„ç† Spring MVC çš„ Controller è¯·æ±‚æ—¶</strong>ï¼Œä½¿ç”¨æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰ã€‚</li><li><strong>å½“éœ€è¦åœ¨ Servlet å®¹å™¨çº§åˆ«å¤„ç†è¯·æ±‚æ—¶</strong>ï¼Œä½¿ç”¨è¿‡æ»¤å™¨ï¼ˆFilterï¼‰ï¼Œæ¯”å¦‚è·¨åŸŸè¯·æ±‚ã€GZIP å‹ç¼©ç­‰ã€‚</li></ul><hr><h2 id="_2-å®ç°-handlerinterceptor-æ¥å£çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_2-å®ç°-handlerinterceptor-æ¥å£çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•"><span>2. å®ç° <code>HandlerInterceptor</code> æ¥å£çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</span></a></h2><p>Spring MVC çš„æ‹¦æˆªå™¨é€šè¿‡å®ç° <code>HandlerInterceptor</code> æ¥å£æ¥å®šä¹‰ã€‚è¯¥æ¥å£æœ‰ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼š</p><h3 id="_2-1-prehandle-è¯·æ±‚å¤„ç†å‰" tabindex="-1"><a class="header-anchor" href="#_2-1-prehandle-è¯·æ±‚å¤„ç†å‰"><span>2.1 <code>preHandle()</code>ï¼šè¯·æ±‚å¤„ç†å‰</span></a></h3><p><code>preHandle()</code> æ–¹æ³•ä¼šåœ¨è¯·æ±‚å¤„ç†ä¹‹å‰è¢«è°ƒç”¨ã€‚è¿”å› <code>true</code> è¡¨ç¤ºè¯·æ±‚ç»§ç»­ä¼ é€’åˆ° Controllerï¼Œè¿”å› <code>false</code> ä¼šé˜»æ­¢è¯·æ±‚ç»§ç»­å‘åä¼ é€’ï¼Œç›´æ¥è¿”å›å“åº”ã€‚</p><h4 id="ç¤ºä¾‹-9" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-9"><span>ç¤ºä¾‹ï¼š</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> MyInterceptor</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> HandlerInterceptor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> preHandle</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;è¯·æ±‚å¤„ç†å‰æ‰§è¡Œ&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ç»§ç»­å¤„ç†è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-posthandle-è¯·æ±‚å¤„ç†å-è§†å›¾æ¸²æŸ“å‰" tabindex="-1"><a class="header-anchor" href="#_2-2-posthandle-è¯·æ±‚å¤„ç†å-è§†å›¾æ¸²æŸ“å‰"><span>2.2 <code>postHandle()</code>ï¼šè¯·æ±‚å¤„ç†åï¼Œè§†å›¾æ¸²æŸ“å‰</span></a></h3><p><code>postHandle()</code> æ–¹æ³•ä¼šåœ¨ Controller æ–¹æ³•æ‰§è¡Œåï¼Œä½†åœ¨è§†å›¾æ¸²æŸ“ä¹‹å‰è°ƒç”¨ã€‚å¯ä»¥ç”¨æ¥ä¿®æ”¹ <code>ModelAndView</code> å¯¹è±¡ï¼Œè¿›ä¸€æ­¥å¤„ç†æ¨¡å‹æ•°æ®æˆ–è§†å›¾ã€‚</p><h4 id="ç¤ºä¾‹-10" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-10"><span>ç¤ºä¾‹ï¼š</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> MyInterceptor</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> HandlerInterceptor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> preHandle</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> postHandle</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ModelAndView</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> modelAndView</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;è¯·æ±‚å¤„ç†åï¼Œè§†å›¾æ¸²æŸ“å‰æ‰§è¡Œ&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (modelAndView </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            modelAndView</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addObject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;message&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Intercepted!&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-aftercompletion-è¯·æ±‚å¤„ç†å-è§†å›¾æ¸²æŸ“å" tabindex="-1"><a class="header-anchor" href="#_2-3-aftercompletion-è¯·æ±‚å¤„ç†å-è§†å›¾æ¸²æŸ“å"><span>2.3 <code>afterCompletion()</code>ï¼šè¯·æ±‚å¤„ç†åï¼Œè§†å›¾æ¸²æŸ“å</span></a></h3><p><code>afterCompletion()</code> æ–¹æ³•ä¼šåœ¨æ•´ä¸ªè¯·æ±‚å¤„ç†å®Œæ¯•ä¹‹åè°ƒç”¨ï¼Œç”¨äºæ¸…ç†èµ„æºã€æ—¥å¿—è®°å½•ç­‰æ“ä½œã€‚æ­¤æ—¶è§†å›¾å·²ç»æ¸²æŸ“å®Œæ¯•ï¼Œå¯ä»¥è¿›è¡Œæœ€åçš„æ¸…ç†å·¥ä½œã€‚</p><h4 id="ç¤ºä¾‹-11" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-11"><span>ç¤ºä¾‹ï¼š</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> MyInterceptor</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> HandlerInterceptor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> preHandle</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> postHandle</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ModelAndView</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> modelAndView</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> afterCompletion</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;è¯·æ±‚å¤„ç†å®Œæ¯•ï¼Œè§†å›¾æ¸²æŸ“åæ‰§è¡Œ&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_3-æ³¨å†Œä¸é…ç½®å¤šä¸ªæ‹¦æˆªå™¨çš„é¡ºåº" tabindex="-1"><a class="header-anchor" href="#_3-æ³¨å†Œä¸é…ç½®å¤šä¸ªæ‹¦æˆªå™¨çš„é¡ºåº"><span>3. æ³¨å†Œä¸é…ç½®å¤šä¸ªæ‹¦æˆªå™¨çš„é¡ºåº</span></a></h2><p>åœ¨ Spring MVC ä¸­ï¼Œæ‹¦æˆªå™¨çš„æ³¨å†Œå’Œæ‰§è¡Œé¡ºåºç”± <code>WebMvcConfigurer</code> æ¥é…ç½®ã€‚é€šè¿‡å®ç° <code>addInterceptors()</code> æ–¹æ³•ï¼Œå¯ä»¥å°†è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨æ³¨å†Œåˆ° Spring å®¹å™¨ä¸­ã€‚</p><h3 id="_3-1-é…ç½®å¤šä¸ªæ‹¦æˆªå™¨çš„é¡ºåº" tabindex="-1"><a class="header-anchor" href="#_3-1-é…ç½®å¤šä¸ªæ‹¦æˆªå™¨çš„é¡ºåº"><span>3.1 é…ç½®å¤šä¸ªæ‹¦æˆªå™¨çš„é¡ºåº</span></a></h3><p>æ‹¦æˆªå™¨çš„é¡ºåºæ˜¯é€šè¿‡åœ¨é…ç½®ç±»ä¸­æ³¨å†Œæ‹¦æˆªå™¨çš„é¡ºåºæ¥ç¡®å®šçš„ï¼Œæ³¨å†Œçš„å…ˆåé¡ºåºå†³å®šäº†æ‹¦æˆªå™¨çš„æ‰§è¡Œé¡ºåºã€‚</p><h4 id="ç¤ºä¾‹-12" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-12"><span>ç¤ºä¾‹ï¼š</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> WebConfig</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> WebMvcConfigurer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> addInterceptors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">InterceptorRegistry</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> registry</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        registry</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addInterceptor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> MyInterceptor1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addPathPatterns</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/**&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        registry</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addInterceptor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> MyInterceptor2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addPathPatterns</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/admin/**&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>MyInterceptor1</code> ä¼šåœ¨ <code>MyInterceptor2</code> ä¹‹å‰æ‰§è¡Œï¼Œå› ä¸ºå®ƒè¢«å…ˆæ³¨å†Œã€‚</li></ul><hr><h2 id="_4-å®æˆ˜-ç”¨æˆ·æƒé™æ ¡éªŒã€æ¥å£ç­¾åæ ¡éªŒç­‰" tabindex="-1"><a class="header-anchor" href="#_4-å®æˆ˜-ç”¨æˆ·æƒé™æ ¡éªŒã€æ¥å£ç­¾åæ ¡éªŒç­‰"><span>4. å®æˆ˜ï¼šç”¨æˆ·æƒé™æ ¡éªŒã€æ¥å£ç­¾åæ ¡éªŒç­‰</span></a></h2><h3 id="_4-1-ç”¨æˆ·æƒé™æ ¡éªŒ" tabindex="-1"><a class="header-anchor" href="#_4-1-ç”¨æˆ·æƒé™æ ¡éªŒ"><span>4.1 ç”¨æˆ·æƒé™æ ¡éªŒ</span></a></h3><p>åœ¨å¼€å‘ Web åº”ç”¨æ—¶ï¼Œç»å¸¸éœ€è¦å¯¹ç”¨æˆ·æƒé™è¿›è¡Œæ ¡éªŒï¼Œç¡®ä¿åªæœ‰åˆæ³•ç”¨æˆ·æ‰èƒ½è®¿é—®ç‰¹å®šèµ„æºã€‚æ­¤æ—¶ï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰æ‹¦æˆªå™¨æ¥å®ç°æƒé™éªŒè¯ã€‚</p><h4 id="ç¤ºä¾‹-æƒé™æ ¡éªŒæ‹¦æˆªå™¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-æƒé™æ ¡éªŒæ‹¦æˆªå™¨"><span>ç¤ºä¾‹ï¼šæƒé™æ ¡éªŒæ‹¦æˆªå™¨</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> PermissionInterceptor</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> HandlerInterceptor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> preHandle</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> userRole</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (String) </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getSession</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getAttribute</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;role&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ADMIN&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">equals</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(userRole)) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ç”¨æˆ·æœ‰æƒé™ï¼Œç»§ç»­è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sendRedirect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/access-denied&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ— æƒé™ï¼Œé‡å®šå‘</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-æ¥å£ç­¾åæ ¡éªŒ" tabindex="-1"><a class="header-anchor" href="#_4-2-æ¥å£ç­¾åæ ¡éªŒ"><span>4.2 æ¥å£ç­¾åæ ¡éªŒ</span></a></h3><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒAPI çš„æ¥å£ç­¾åæ ¡éªŒéå¸¸é‡è¦ï¼Œç¡®ä¿è¯·æ±‚æ˜¯ç”±åˆæ³•å®¢æˆ·ç«¯å‘èµ·çš„ã€‚å¯ä»¥é€šè¿‡æ‹¦æˆªå™¨æ¥å®ç°ç­¾åæ ¡éªŒã€‚</p><h4 id="ç¤ºä¾‹-æ¥å£ç­¾åæ ¡éªŒæ‹¦æˆªå™¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-æ¥å£ç­¾åæ ¡éªŒæ‹¦æˆªå™¨"><span>ç¤ºä¾‹ï¼šæ¥å£ç­¾åæ ¡éªŒæ‹¦æˆªå™¨</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> SignatureInterceptor</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> HandlerInterceptor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> preHandle</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> signature</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getHeader</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Signature&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> secret</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;secretKey&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// å‡è®¾ç”¨ä¸€ä¸ªå›ºå®šçš„å¯†é’¥ç­¾å</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> expectedSignature</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> generateSignature</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getParameterMap</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), secret);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">signature</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">equals</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(expectedSignature)) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ ¡éªŒé€šè¿‡</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sendError</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">SC_FORBIDDEN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Invalid signature&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ ¡éªŒå¤±è´¥ï¼Œæ‹’ç»è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> generateSignature</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[]&gt; </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">parameters</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> secret</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // ç®€å•çš„ç­¾åç”Ÿæˆé€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        StringBuilder</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> sb</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> StringBuilder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(secret);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        parameters</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">forEach</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">((key, value) </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> sb</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">append</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(key).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">append</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;=&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">append</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(value[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]));</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> DigestUtils</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">md5DigestAsHex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">sb</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBytes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="æ€»ç»“-1" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-1"><span>æ€»ç»“</span></a></h2><p>æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨æ˜¯ Spring MVC ä¸­é‡è¦çš„ç»„ä»¶ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…åœ¨è¯·æ±‚å’Œå“åº”è¿‡ç¨‹ä¸­æ‰§è¡Œå„ç§è‡ªå®šä¹‰æ“ä½œã€‚é€šè¿‡åˆç†ä½¿ç”¨æ‹¦æˆªå™¨ï¼Œå¯ä»¥æœ‰æ•ˆå®ç°æƒé™æ ¡éªŒã€æ—¥å¿—è®°å½•ã€æ€§èƒ½ç›‘æ§ç­‰åŠŸèƒ½ï¼›è€Œè¿‡æ»¤å™¨é€‚ç”¨äºæ›´åº•å±‚çš„ HTTP è¯·æ±‚å¤„ç†ï¼Œå¦‚è·¨åŸŸã€ç¼–ç å’Œå‹ç¼©ç­‰ã€‚æŒæ¡æ‹¦æˆªå™¨çš„ç”Ÿå‘½å‘¨æœŸå’Œé…ç½®æŠ€å·§ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…æ›´åŠ çµæ´»åœ°æ§åˆ¶è¯·æ±‚çš„å¤„ç†æµç¨‹ã€‚</p><h1 id="å…«ã€å¼‚æ­¥è¯·æ±‚ä¸å“åº”å¤„ç†-1" tabindex="-1"><a class="header-anchor" href="#å…«ã€å¼‚æ­¥è¯·æ±‚ä¸å“åº”å¤„ç†-1"><span>å…«ã€å¼‚æ­¥è¯·æ±‚ä¸å“åº”å¤„ç†</span></a></h1><p>åœ¨ç°ä»£ Web åº”ç”¨ä¸­ï¼Œå¼‚æ­¥å¤„ç†æ˜¯æå‡æ€§èƒ½çš„é‡è¦æ‰‹æ®µï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†è€—æ—¶æ“ä½œæ—¶ã€‚Spring MVC æä¾›äº†å¤šç§æœºåˆ¶æ¥æ”¯æŒå¼‚æ­¥è¯·æ±‚ä¸å“åº”å¤„ç†ï¼ŒåŒ…æ‹¬ <code>@Async</code>ã€<code>Callable</code>ã€<code>DeferredResult</code> å’Œ <code>WebAsyncTask</code> ç­‰ã€‚æœ¬ç« å°†é‡ç‚¹ä»‹ç»å¦‚ä½•åˆ©ç”¨è¿™äº›æœºåˆ¶å®ç°å¼‚æ­¥è¯·æ±‚å¤„ç†ï¼Œä»¥åŠå®ƒä»¬èƒŒåçš„å·¥ä½œåŸç†ã€‚</p><hr><h2 id="_1-ä½¿ç”¨-async-ä¸-callable-å®ç°å¼‚æ­¥æ§åˆ¶å™¨" tabindex="-1"><a class="header-anchor" href="#_1-ä½¿ç”¨-async-ä¸-callable-å®ç°å¼‚æ­¥æ§åˆ¶å™¨"><span>1. ä½¿ç”¨ <code>@Async</code> ä¸ <code>Callable</code> å®ç°å¼‚æ­¥æ§åˆ¶å™¨</span></a></h2><h3 id="_1-1-async-æ³¨è§£" tabindex="-1"><a class="header-anchor" href="#_1-1-async-æ³¨è§£"><span>1.1 <code>@Async</code> æ³¨è§£</span></a></h3><p><code>@Async</code> æ˜¯ Spring æä¾›çš„å¼‚æ­¥æ–¹æ³•æ‰§è¡Œæ”¯æŒï¼Œé€šå¸¸ç”¨äºå°†æ–¹æ³•çš„æ‰§è¡Œä»ä¸»çº¿ç¨‹ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå¼‚æ­¥æ‰§è¡Œã€‚è¿™åœ¨å¤„ç†è€—æ—¶æ“ä½œæ—¶éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚æ•°æ®åº“æŸ¥è¯¢ã€å¤–éƒ¨æœåŠ¡è°ƒç”¨ç­‰ã€‚</p><h4 id="é…ç½®ä¸ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#é…ç½®ä¸ä½¿ç”¨"><span>é…ç½®ä¸ä½¿ç”¨ï¼š</span></a></h4><p>é¦–å…ˆï¼Œéœ€è¦åœ¨ Spring é…ç½®ç±»ä¸­å¯ç”¨å¼‚æ­¥æ”¯æŒï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">EnableAsync</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // å¯ç”¨å¼‚æ­¥æ”¯æŒ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> AsyncConfig</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Bean</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Executor</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> taskExecutor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Executors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">newFixedThreadPool</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// é…ç½®çº¿ç¨‹æ± </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œå¯ä»¥åœ¨éœ€è¦å¼‚æ­¥æ‰§è¡Œçš„æ–¹æ³•ä¸Šä½¿ç”¨ <code>@Async</code> æ³¨è§£ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Service</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> AsyncService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Async</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> performTask</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œä¸­...&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-2-callable-æ¥å£" tabindex="-1"><a class="header-anchor" href="#_1-2-callable-æ¥å£"><span>1.2 <code>Callable</code> æ¥å£</span></a></h3><p><code>Callable</code> æ˜¯ Java åŸç”Ÿçš„æ¥å£ï¼Œç”¨äºå®šä¹‰èƒ½å¤Ÿåœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­æ‰§è¡Œçš„ä»»åŠ¡ã€‚åœ¨ Spring MVC ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>Callable</code> æ¥å°†è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹å¼‚æ­¥åŒ–ã€‚</p><h4 id="ç¤ºä¾‹-13" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-13"><span>ç¤ºä¾‹ï¼š</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Controller</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> AsyncController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/async&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Callable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> asyncMethod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ¨¡æ‹Ÿé•¿æ—¶é—´ä»»åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;å¼‚æ­¥è¯·æ±‚å¤„ç†å®Œæˆ&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        };</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå½“è®¿é—® <code>/async</code> è·¯å¾„æ—¶ï¼Œæ§åˆ¶å™¨ä¼šç«‹å³è¿”å›ä¸€ä¸ª <code>Callable</code> å¯¹è±¡ï¼Œè€Œå®é™…çš„å¤„ç†è¿‡ç¨‹åˆ™åœ¨åå°çº¿ç¨‹ä¸­å¼‚æ­¥æ‰§è¡Œã€‚</p><hr><h2 id="_2-ä½¿ç”¨-deferredresultã€webasynctask-å®ç°é•¿è½®è¯¢" tabindex="-1"><a class="header-anchor" href="#_2-ä½¿ç”¨-deferredresultã€webasynctask-å®ç°é•¿è½®è¯¢"><span>2. ä½¿ç”¨ <code>DeferredResult</code>ã€<code>WebAsyncTask</code> å®ç°é•¿è½®è¯¢</span></a></h2><h3 id="_2-1-deferredresult-é•¿æ—¶é—´å¼‚æ­¥å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_2-1-deferredresult-é•¿æ—¶é—´å¼‚æ­¥å¤„ç†"><span>2.1 <code>DeferredResult</code>ï¼šé•¿æ—¶é—´å¼‚æ­¥å¤„ç†</span></a></h3><p><code>DeferredResult</code> æ˜¯ä¸€ç§å¼ºå¤§çš„æœºåˆ¶ï¼Œå¯ä»¥å¤„ç†éœ€è¦è¾ƒé•¿æ—¶é—´å®Œæˆçš„å¼‚æ­¥ä»»åŠ¡ï¼Œä¾‹å¦‚ä¸å¤–éƒ¨ç³»ç»Ÿçš„äº¤äº’æˆ–å¤æ‚çš„è®¡ç®—è¿‡ç¨‹ã€‚å®ƒå…è®¸åœ¨å¼‚æ­¥å¤„ç†å®Œæˆæ—¶ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ç»“æœã€‚</p><h4 id="ç¤ºä¾‹-ä½¿ç”¨-deferredresult" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-ä½¿ç”¨-deferredresult"><span>ç¤ºä¾‹ï¼šä½¿ç”¨ <code>DeferredResult</code></span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Controller</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> DeferredResultController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/deferred&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> DeferredResult</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> deferredResult</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        DeferredResult</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> DeferredResult</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            try</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ¨¡æ‹Ÿè€—æ—¶ä»»åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                result</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setResult</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;å¼‚æ­¥å¤„ç†å®Œæˆ&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">InterruptedException</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                result</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setErrorResult</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ä»»åŠ¡å¤±è´¥&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> result;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ<code>DeferredResult</code> åœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œå¹¶å°†ç»“æœä¼ é€’ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯ä¼šåœ¨ 5 ç§’åæ”¶åˆ°å“åº”ã€‚</p><h3 id="_2-2-webasynctask-å¤„ç†å¼‚æ­¥è¯·æ±‚å’Œå“åº”" tabindex="-1"><a class="header-anchor" href="#_2-2-webasynctask-å¤„ç†å¼‚æ­¥è¯·æ±‚å’Œå“åº”"><span>2.2 <code>WebAsyncTask</code>ï¼šå¤„ç†å¼‚æ­¥è¯·æ±‚å’Œå“åº”</span></a></h3><p><code>WebAsyncTask</code> æ˜¯ Spring 3.2 å¼•å…¥çš„ä¸€ç§å¢å¼ºçš„å¼‚æ­¥å¤„ç†æ–¹å¼ï¼Œå®ƒç±»ä¼¼äº <code>DeferredResult</code>ï¼Œä½†æä¾›äº†æ›´ç²¾ç»†çš„æ§åˆ¶ï¼Œå¦‚è¶…æ—¶è®¾ç½®å’Œé”™è¯¯å¤„ç†ã€‚</p><h4 id="ç¤ºä¾‹-ä½¿ç”¨-webasynctask" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-ä½¿ç”¨-webasynctask"><span>ç¤ºä¾‹ï¼šä½¿ç”¨ <code>WebAsyncTask</code></span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Controller</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> WebAsyncTaskController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/webAsyncTask&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> WebAsyncTask</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> webAsyncTask</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        Callable</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">callable</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ¨¡æ‹Ÿè€—æ—¶ä»»åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;WebAsyncTask å®Œæˆ&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        WebAsyncTask</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">asyncTask</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> WebAsyncTask</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;(callable);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        asyncTask</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">onTimeout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;è¶…æ—¶æœªå®Œæˆ&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        asyncTask</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">onError</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;ä»»åŠ¡æ‰§è¡Œå‡ºé”™&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> asyncTask;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>WebAsyncTask</code> å…è®¸å¼€å‘è€…è®¾ç½®è¶…æ—¶å’Œé”™è¯¯å¤„ç†é€»è¾‘ï¼Œæ˜¯ä¸€ä¸ªæ›´çµæ´»çš„å¼‚æ­¥å¤„ç†æœºåˆ¶ã€‚</p><hr><h2 id="_3-å¼‚æ­¥å¤„ç†åŸç†ä¸çº¿ç¨‹æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#_3-å¼‚æ­¥å¤„ç†åŸç†ä¸çº¿ç¨‹æ¨¡å‹"><span>3. å¼‚æ­¥å¤„ç†åŸç†ä¸çº¿ç¨‹æ¨¡å‹</span></a></h2><p>Spring MVC çš„å¼‚æ­¥å¤„ç†æœºåˆ¶åŸºäº Java çš„çº¿ç¨‹æ± å’Œ <code>Executor</code>ã€‚åœ¨å¼‚æ­¥æ¨¡å¼ä¸‹ï¼ŒSpring MVC å°†è¯·æ±‚å¤„ç†çš„ä»»åŠ¡äº¤ç»™ç‹¬ç«‹çš„çº¿ç¨‹æ¥æ‰§è¡Œï¼Œè€Œä¸å ç”¨ä¸»çº¿ç¨‹ï¼Œä»è€Œå®ç°éé˜»å¡çš„è¯·æ±‚å¤„ç†ã€‚è¿™ç§æ–¹å¼èƒ½å¤Ÿæ˜¾è‘—æå‡ Web åº”ç”¨çš„æ€§èƒ½ï¼Œå°¤å…¶åœ¨å¤„ç† I/O å¯†é›†å‹æ“ä½œæ—¶ã€‚</p><h3 id="_3-1-å¼‚æ­¥å¤„ç†åŸç†" tabindex="-1"><a class="header-anchor" href="#_3-1-å¼‚æ­¥å¤„ç†åŸç†"><span>3.1 å¼‚æ­¥å¤„ç†åŸç†</span></a></h3><ol><li><strong>è¯·æ±‚åˆ°è¾¾ DispatcherServlet</strong>ï¼šå½“å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚æ—¶ï¼ŒSpring MVC çš„ <code>DispatcherServlet</code> ä¼šæ ¹æ®è¯·æ±‚ç±»å‹åˆ¤æ–­æ˜¯å¦éœ€è¦å¼‚æ­¥å¤„ç†ã€‚</li><li><strong>å¼‚æ­¥å¤„ç†å¯åŠ¨</strong>ï¼šå¦‚æœè¯·æ±‚è¢«æ ‡è®°ä¸ºå¼‚æ­¥å¤„ç†ï¼ˆé€šè¿‡ <code>@Async</code> æˆ– <code>Callable</code> ç­‰ï¼‰ï¼ŒSpring MVC ä¼šå°†è¯·æ±‚åˆ†æ´¾åˆ°åå°çº¿ç¨‹æ± å¤„ç†ï¼Œè€Œä¸»çº¿ç¨‹åˆ™ç«‹å³é‡Šæ”¾ï¼Œç»§ç»­å¤„ç†å…¶ä»–è¯·æ±‚ã€‚</li><li><strong>ä»»åŠ¡å®Œæˆé€šçŸ¥</strong>ï¼šåå°çº¿ç¨‹å¤„ç†å®Œæˆåï¼Œä¼šé€šè¿‡ <code>DeferredResult</code> æˆ– <code>WebAsyncTask</code> å°†ç»“æœè¿”å›ç»™ä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹å†å°†æœ€ç»ˆçš„å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ol><h3 id="_3-2-å¼‚æ­¥çº¿ç¨‹æ± " tabindex="-1"><a class="header-anchor" href="#_3-2-å¼‚æ­¥çº¿ç¨‹æ± "><span>3.2 å¼‚æ­¥çº¿ç¨‹æ± </span></a></h3><p>Spring æä¾›äº†ä¸€ä¸ªé»˜è®¤çš„å¼‚æ­¥çº¿ç¨‹æ± ï¼Œä½†ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦è‡ªå®šä¹‰çº¿ç¨‹æ± é…ç½®ã€‚é€šè¿‡ <code>@EnableAsync</code> æ³¨è§£å¯ä»¥å¯ç”¨å¼‚æ­¥æ‰§è¡Œï¼Œå¹¶é€šè¿‡ <code>Executor</code> é…ç½®æ¥æŒ‡å®šçº¿ç¨‹æ± ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">EnableAsync</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> AsyncConfig</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Bean</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Executor</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> asyncExecutor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Executors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">newFixedThreadPool</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// é…ç½®çº¿ç¨‹æ± </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-å¼‚æ­¥å¤„ç†çš„ä¼˜ç¼ºç‚¹" tabindex="-1"><a class="header-anchor" href="#_3-3-å¼‚æ­¥å¤„ç†çš„ä¼˜ç¼ºç‚¹"><span>3.3 å¼‚æ­¥å¤„ç†çš„ä¼˜ç¼ºç‚¹</span></a></h3><h4 id="ä¼˜ç‚¹" tabindex="-1"><a class="header-anchor" href="#ä¼˜ç‚¹"><span>ä¼˜ç‚¹ï¼š</span></a></h4><ul><li><strong>æé«˜å¹¶å‘æ€§èƒ½</strong>ï¼šå¼‚æ­¥å¤„ç†èƒ½æ˜¾è‘—æå‡ Web åº”ç”¨çš„ååé‡å’Œå“åº”èƒ½åŠ›ï¼Œç‰¹åˆ«æ˜¯åœ¨ I/O å¯†é›†å‹çš„åº”ç”¨åœºæ™¯ä¸‹ã€‚</li><li><strong>é™ä½é˜»å¡</strong>ï¼šé•¿æ—¶é—´æ“ä½œä¸å†é˜»å¡ä¸»çº¿ç¨‹ï¼Œä½¿å¾—æœåŠ¡å™¨èƒ½å¤ŸåŒæ—¶å¤„ç†æ›´å¤šè¯·æ±‚ã€‚</li></ul><h4 id="ç¼ºç‚¹" tabindex="-1"><a class="header-anchor" href="#ç¼ºç‚¹"><span>ç¼ºç‚¹ï¼š</span></a></h4><ul><li><strong>å¤æ‚æ€§å¢åŠ </strong>ï¼šå¼‚æ­¥å¤„ç†å¼•å…¥äº†çº¿ç¨‹ç®¡ç†å’Œå¼‚å¸¸å¤„ç†ç­‰å¤æ‚æ€§ï¼Œéœ€è¦å¼€å‘è€…ç‰¹åˆ«å°å¿ƒã€‚</li><li><strong>çº¿ç¨‹ç®¡ç†å¼€é”€</strong>ï¼šåˆ›å»ºå’Œç»´æŠ¤å¤šä¸ªçº¿ç¨‹ä¼šæ¶ˆè€—ä¸€å®šçš„èµ„æºï¼Œè¿‡å¤šçš„å¹¶å‘è¯·æ±‚å¯èƒ½ä¼šå¸¦æ¥çº¿ç¨‹æ± è€—å°½æˆ–ç³»ç»Ÿèµ„æºä¸è¶³çš„é—®é¢˜ã€‚</li></ul><hr><h2 id="æ€»ç»“-2" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-2"><span>æ€»ç»“</span></a></h2><p>Spring MVC æä¾›äº†å¼ºå¤§çš„å¼‚æ­¥å¤„ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬ <code>@Async</code>ã€<code>Callable</code>ã€<code>DeferredResult</code> å’Œ <code>WebAsyncTask</code> ç­‰æœºåˆ¶ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…å¤„ç†é«˜å¹¶å‘å’Œé•¿æ—¶é—´æ“ä½œçš„ä»»åŠ¡ã€‚ç†è§£è¿™äº›å¼‚æ­¥æœºåˆ¶çš„å·¥ä½œåŸç†åŠå…¶é€‚ç”¨åœºæ™¯ï¼Œå¯¹äºæ„å»ºé«˜æ•ˆã€å“åº”è¿…é€Ÿçš„ Web åº”ç”¨è‡³å…³é‡è¦ã€‚åŒæ—¶ï¼Œåˆç†é…ç½®çº¿ç¨‹æ± å’Œä»»åŠ¡ç®¡ç†ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œé«˜æ€§èƒ½ã€‚</p><h1 id="ä¹ã€è·¨åŸŸè¯·æ±‚ä¸-cors-æ”¯æŒ-1" tabindex="-1"><a class="header-anchor" href="#ä¹ã€è·¨åŸŸè¯·æ±‚ä¸-cors-æ”¯æŒ-1"><span>ä¹ã€è·¨åŸŸè¯·æ±‚ä¸ CORS æ”¯æŒ</span></a></h1><p>è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼ŒCross-Origin Resource Sharingï¼‰æ˜¯ Web åº”ç”¨ä¸­å¸¸è§çš„éœ€æ±‚ï¼Œå°¤å…¶æ˜¯åœ¨å‰åç«¯åˆ†ç¦»çš„æ¶æ„ä¸­ï¼Œå‰ç«¯å’Œåç«¯å¯èƒ½æ‰˜ç®¡åœ¨ä¸åŒçš„åŸŸåä¸‹ã€‚è·¨åŸŸé—®é¢˜ä¼šå¯¼è‡´æµè§ˆå™¨æ‹’ç»è¿›è¡Œè¯·æ±‚ã€‚Spring MVC æä¾›äº†å¯¹ CORS çš„å†…å»ºæ”¯æŒï¼Œå¸®åŠ©å¼€å‘è€…æ–¹ä¾¿åœ°é…ç½®å’Œå¤„ç†è·¨åŸŸè¯·æ±‚ã€‚æœ¬ç« å°†è¯¦ç»†è®²è§£è·¨åŸŸçš„æ¦‚å¿µã€Spring MVC ä¸­çš„ CORS é…ç½®æ–¹å¼ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡ <code>@CrossOrigin</code> æ³¨è§£å¤„ç†è·¨åŸŸè¯·æ±‚ã€‚</p><hr><h2 id="_1-ä»€ä¹ˆæ˜¯è·¨åŸŸåŠå…¶æœ¬è´¨" tabindex="-1"><a class="header-anchor" href="#_1-ä»€ä¹ˆæ˜¯è·¨åŸŸåŠå…¶æœ¬è´¨"><span>1. ä»€ä¹ˆæ˜¯è·¨åŸŸåŠå…¶æœ¬è´¨</span></a></h2><h3 id="_1-1-è·¨åŸŸå®šä¹‰" tabindex="-1"><a class="header-anchor" href="#_1-1-è·¨åŸŸå®šä¹‰"><span>1.1 è·¨åŸŸå®šä¹‰</span></a></h3><p>è·¨åŸŸæ˜¯æŒ‡æµè§ˆå™¨ä¸­çš„ä¸€ä¸ªåŸŸåï¼ˆoriginï¼‰è®¿é—®å¦ä¸€ä¸ªåŸŸåä¸Šçš„èµ„æºæ—¶ï¼Œè§¦å‘äº†æµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼ˆSame-Origin Policyï¼‰ã€‚åŒæºç­–ç•¥æ˜¯æµè§ˆå™¨çš„å®‰å…¨æœºåˆ¶ï¼Œç¦æ­¢æ¥è‡ªä¸åŒæºçš„è„šæœ¬è®¿é—®ç½‘é¡µçš„èµ„æºï¼Œé˜²æ­¢æ¶æ„ç½‘ç«™çªƒå–ç”¨æˆ·æ•°æ®æˆ–è¿›è¡Œè·¨ç«™è¯·æ±‚ã€‚</p><p>åŒæºç­–ç•¥è¦æ±‚ï¼šåè®®ã€ä¸»æœºã€ç«¯å£å¿…é¡»å®Œå…¨ç›¸åŒã€‚å¦‚æœå®ƒä»¬å…¶ä¸­ä¸€ä¸ªä¸åŒï¼Œå°±ä¼šè¢«è®¤ä¸ºæ˜¯è·¨åŸŸè¯·æ±‚ã€‚</p><p>ä¾‹å¦‚ï¼Œ<code>http://example.com</code> å’Œ <code>http://api.example.com</code> ä¹‹é—´çš„è¯·æ±‚å°±å±äºè·¨åŸŸè¯·æ±‚ï¼Œå› ä¸ºå®ƒä»¬çš„åŸŸåä¸åŒã€‚</p><h3 id="_1-2-è·¨åŸŸæœ¬è´¨" tabindex="-1"><a class="header-anchor" href="#_1-2-è·¨åŸŸæœ¬è´¨"><span>1.2 è·¨åŸŸæœ¬è´¨</span></a></h3><p>è·¨åŸŸé—®é¢˜çš„æœ¬è´¨æ˜¯å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæµè§ˆå™¨ä¸å…è®¸ä¸åŒæºä¹‹é—´çš„èµ„æºå…±äº«ã€‚ä¸ºäº†å…è®¸è·¨åŸŸè¯·æ±‚ï¼Œç›®æ ‡æœåŠ¡å™¨éœ€è¦æ˜¾å¼åœ°æŒ‡ç¤ºæµè§ˆå™¨å…è®¸æŸä¸ªæºçš„è®¿é—®ï¼Œè¿™ä¸ªæœºåˆ¶è¢«ç§°ä¸º CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰ã€‚</p><p>CORS æ˜¯ä¸€ç§æ ‡å‡†åŒ–çš„åè®®ï¼Œå®ƒé€šè¿‡ HTTP è¯·æ±‚å¤´æ¥å‘ŠçŸ¥æµè§ˆå™¨æ˜¯å¦å…è®¸è·¨åŸŸè¯·æ±‚ã€‚</p><hr><h2 id="_2-spring-mvc-ä¸­é…ç½®è·¨åŸŸæ”¯æŒçš„ä¸‰ç§æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_2-spring-mvc-ä¸­é…ç½®è·¨åŸŸæ”¯æŒçš„ä¸‰ç§æ–¹å¼"><span>2. Spring MVC ä¸­é…ç½®è·¨åŸŸæ”¯æŒçš„ä¸‰ç§æ–¹å¼</span></a></h2><p>Spring MVC æä¾›äº†å¤šç§æ–¹å¼æ¥æ”¯æŒ CORSï¼Œä»¥ä¸‹æ˜¯ä¸‰ç§å¸¸è§çš„é…ç½®æ–¹å¼ï¼š</p><h3 id="_2-1-å…¨å±€-cors-é…ç½®-é€šè¿‡-webmvcconfigurer" tabindex="-1"><a class="header-anchor" href="#_2-1-å…¨å±€-cors-é…ç½®-é€šè¿‡-webmvcconfigurer"><span>2.1 å…¨å±€ CORS é…ç½®ï¼ˆé€šè¿‡ <code>WebMvcConfigurer</code>ï¼‰</span></a></h3><p>Spring å…è®¸åœ¨å…¨å±€èŒƒå›´å†…é…ç½® CORS ç­–ç•¥ï¼Œä½¿å¾—æ‰€æœ‰çš„è¯·æ±‚éƒ½æ”¯æŒè·¨åŸŸã€‚å¯ä»¥é€šè¿‡å®ç° <code>WebMvcConfigurer</code> æ¥å£å¹¶é‡å†™ <code>addCorsMappings()</code> æ–¹æ³•æ¥å®ç°å…¨å±€é…ç½®ã€‚</p><h4 id="ç¤ºä¾‹-14" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-14"><span>ç¤ºä¾‹ï¼š</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> WebConfig</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> WebMvcConfigurer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> addCorsMappings</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">CorsRegistry</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> registry</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        registry</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/**&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// è®¾ç½®å…è®¸è·¨åŸŸçš„è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">allowedOrigins</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://localhost:3000&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// å…è®¸æ¥è‡ªè¿™ä¸ªåŸŸçš„è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">allowedMethods</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;GET&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;POST&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;PUT&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;DELETE&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// å…è®¸çš„ HTTP æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">allowedHeaders</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// å…è®¸çš„è¯·æ±‚å¤´</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">allowCredentials</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ˜¯å¦å…è®¸å‘é€ cookie</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">maxAge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3600</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ç¼“å­˜é¢„æ£€è¯·æ±‚çš„æœ€å¤§æ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-æ§åˆ¶å™¨æ–¹æ³•çº§åˆ«-cors-é…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-2-æ§åˆ¶å™¨æ–¹æ³•çº§åˆ«-cors-é…ç½®"><span>2.2 æ§åˆ¶å™¨æ–¹æ³•çº§åˆ« CORS é…ç½®</span></a></h3><p>é™¤äº†å…¨å±€é…ç½®ï¼Œè¿˜å¯ä»¥åœ¨å•ä¸ªæ§åˆ¶å™¨æ–¹æ³•ä¸Šè¿›è¡Œ CORS é…ç½®ï¼Œé€šè¿‡ <code>@CrossOrigin</code> æ³¨è§£ç›´æ¥è®¾ç½®è·¨åŸŸç­–ç•¥ã€‚</p><h4 id="ç¤ºä¾‹-15" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-15"><span>ç¤ºä¾‹ï¼š</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RestController</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/api&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ApiController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/hello&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">CrossOrigin</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">origins</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;http://localhost:3000&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ä»…å…è®¸æ¥è‡ªè¿™ä¸ªåŸŸçš„è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> hello</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;Hello, World!&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç§æ–¹å¼ä½¿å¾—å¼€å‘è€…å¯ä»¥ç²¾ç»†åœ°æ§åˆ¶å“ªäº›æ–¹æ³•æ”¯æŒè·¨åŸŸè¯·æ±‚ã€‚</p><h3 id="_2-3-é€šè¿‡-filter-é…ç½®-cors" tabindex="-1"><a class="header-anchor" href="#_2-3-é€šè¿‡-filter-é…ç½®-cors"><span>2.3 é€šè¿‡ Filter é…ç½® CORS</span></a></h3><p>å¦å¤–ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡è‡ªå®šä¹‰ <code>Filter</code> æ¥å®ç° CORSã€‚Spring Boot æä¾›äº† <code>CorsFilter</code>ï¼Œå¯ä»¥é€šè¿‡æ³¨å†Œ <code>CorsFilter</code> Bean æ¥å…¨å±€é…ç½®è·¨åŸŸã€‚</p><h4 id="ç¤ºä¾‹-16" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-16"><span>ç¤ºä¾‹ï¼š</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Bean</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> CorsFilter</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> corsFilter</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    UrlBasedCorsConfigurationSource</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> source </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> UrlBasedCorsConfigurationSource</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    CorsConfiguration</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> config </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> CorsConfiguration</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setAllowCredentials</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // å…è®¸å‘é€ cookie</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addAllowedOrigin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://localhost:3000&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // å…è®¸çš„åŸŸ</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addAllowedHeader</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // å…è®¸æ‰€æœ‰è¯·æ±‚å¤´</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addAllowedMethod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // å…è®¸æ‰€æœ‰æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    source</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">registerCorsConfiguration</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/**&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, config);</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // é…ç½®è·¨åŸŸè§„åˆ™</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> CorsFilter</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(source)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç§æ–¹å¼å¯ä»¥æ›´çµæ´»åœ°æ§åˆ¶è·¨åŸŸè¯·æ±‚çš„å¤„ç†ï¼Œé€‚ç”¨äºéœ€è¦æ›´å¤æ‚è·¨åŸŸé…ç½®çš„åœºæ™¯ã€‚</p><hr><h2 id="_3-ä½¿ç”¨-crossorigin-æ³¨è§£å¤„ç†è·¨åŸŸ" tabindex="-1"><a class="header-anchor" href="#_3-ä½¿ç”¨-crossorigin-æ³¨è§£å¤„ç†è·¨åŸŸ"><span>3. ä½¿ç”¨ <code>@CrossOrigin</code> æ³¨è§£å¤„ç†è·¨åŸŸ</span></a></h2><p><code>@CrossOrigin</code> æ˜¯ Spring 4.2 å¼•å…¥çš„æ³¨è§£ï¼Œç”¨äºåœ¨æ§åˆ¶å™¨æ–¹æ³•ä¸Šé…ç½®è·¨åŸŸç­–ç•¥ã€‚å®ƒå…è®¸å¼€å‘è€…ä¸ºæŸä¸ªç‰¹å®šçš„è¯·æ±‚æŒ‡å®šè·¨åŸŸè§„åˆ™ï¼Œç®€åŒ–äº†é…ç½®çš„å¤æ‚åº¦ã€‚</p><h3 id="_3-1-crossorigin-æ³¨è§£çš„å¸¸ç”¨å±æ€§" tabindex="-1"><a class="header-anchor" href="#_3-1-crossorigin-æ³¨è§£çš„å¸¸ç”¨å±æ€§"><span>3.1 <code>@CrossOrigin</code> æ³¨è§£çš„å¸¸ç”¨å±æ€§</span></a></h3><table><thead><tr><th>å±æ€§</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>origins</code></td><td>å…è®¸çš„è·¨åŸŸè¯·æ±‚çš„æ¥æºåœ°å€ï¼Œæ”¯æŒæ•°ç»„å½¢å¼ï¼Œå¦‚ <code>@CrossOrigin(origins = {&quot;http://localhost:3000&quot;, &quot;http://localhost:4000&quot;})</code>ã€‚</td></tr><tr><td><code>methods</code></td><td>å…è®¸çš„ HTTP è¯·æ±‚æ–¹æ³•ï¼Œå¦‚ <code>GET</code>, <code>POST</code> ç­‰ï¼Œé»˜è®¤ä¸º <code>GET</code> å’Œ <code>POST</code>ã€‚</td></tr><tr><td><code>allowedHeaders</code></td><td>å…è®¸çš„è¯·æ±‚å¤´ï¼Œé»˜è®¤ä¸º <code>*</code>ï¼Œå³æ‰€æœ‰å¤´éƒ¨éƒ½å…è®¸ã€‚</td></tr><tr><td><code>exposedHeaders</code></td><td>è®¾ç½®å“ªäº›å“åº”å¤´å¯ä»¥æš´éœ²ç»™å®¢æˆ·ç«¯ã€‚</td></tr><tr><td><code>allowCredentials</code></td><td>æ˜¯å¦å…è®¸å‘é€ cookieï¼Œé»˜è®¤ä¸º <code>false</code>ã€‚</td></tr><tr><td><code>maxAge</code></td><td>é¢„æ£€è¯·æ±‚çš„ç¼“å­˜æ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚</td></tr></tbody></table><h3 id="_3-2-ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#_3-2-ç¤ºä¾‹"><span>3.2 ç¤ºä¾‹</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RestController</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> CrossOriginController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/greet&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">CrossOrigin</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">origins</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;http://localhost:3000&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ä»…å…è®¸æ¥è‡ª http://localhost:3000 çš„è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> greet</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;Hello from the server!&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PostMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/submit&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">CrossOrigin</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">origins</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;*&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> allowedHeaders</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;*&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> methods</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">RequestMethod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">POST</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">})</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> submitData</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestBody</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Data</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;Data submitted successfully!&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ <code>@CrossOrigin</code> æ³¨è§£ï¼Œå¼€å‘è€…å¯ä»¥æ–¹ä¾¿åœ°ä¸ºå•ä¸ªæ§åˆ¶å™¨æ–¹æ³•æˆ–ç±»çº§åˆ«è®¾ç½®è·¨åŸŸè§„åˆ™ã€‚</p><hr><h2 id="_4-è·¨åŸŸè¯·æ±‚ä¸è®¤è¯å®‰å…¨æ€§é£é™©é˜²èŒƒ" tabindex="-1"><a class="header-anchor" href="#_4-è·¨åŸŸè¯·æ±‚ä¸è®¤è¯å®‰å…¨æ€§é£é™©é˜²èŒƒ"><span>4. è·¨åŸŸè¯·æ±‚ä¸è®¤è¯å®‰å…¨æ€§é£é™©é˜²èŒƒ</span></a></h2><p>è™½ç„¶è·¨åŸŸè¯·æ±‚æå¤§åœ°æé«˜äº† Web åº”ç”¨çš„çµæ´»æ€§ï¼Œä½†å®ƒä¹Ÿå¼•å…¥äº†ä¸€äº›å®‰å…¨é£é™©ï¼Œå°¤å…¶æ˜¯åœ¨ä¸ç”¨æˆ·è®¤è¯ç›¸å…³çš„åœºæ™¯ä¸­ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„è·¨åŸŸå®‰å…¨é£é™©å’Œé˜²èŒƒæªæ–½ï¼š</p><h3 id="_4-1-csrf-è·¨ç«™è¯·æ±‚ä¼ªé€ " tabindex="-1"><a class="header-anchor" href="#_4-1-csrf-è·¨ç«™è¯·æ±‚ä¼ªé€ "><span>4.1 CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰</span></a></h3><p>è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰æ˜¯æŒ‡æ¶æ„ç½‘ç«™é€šè¿‡ä¼ªé€ ç”¨æˆ·è¯·æ±‚ï¼Œåœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæ“ä½œã€‚ä¸ºé˜²æ­¢ CSRF æ”»å‡»ï¼ŒSpring æä¾›äº†é˜²æŠ¤æœºåˆ¶ï¼šåœ¨è·¨åŸŸè¯·æ±‚ä¸­ï¼Œéœ€è¦æ˜¾å¼åœ°å¯ç”¨ <code>allowCredentials</code> å±æ€§å¹¶ç¡®ä¿åªæœ‰å—ä¿¡ä»»çš„æºèƒ½å¤Ÿå‘é€è¯·æ±‚ã€‚</p><h4 id="é˜²èŒƒæªæ–½" tabindex="-1"><a class="header-anchor" href="#é˜²èŒƒæªæ–½"><span>é˜²èŒƒæªæ–½ï¼š</span></a></h4><ul><li>åœ¨è·¨åŸŸé…ç½®ä¸­å¯ç”¨ <code>allowCredentials = true</code>ï¼Œå¹¶ç¡®ä¿æ­£ç¡®é…ç½® <code>origins</code>ï¼Œé¿å…å¼€æ”¾è¿‡å¤šçš„æºã€‚</li><li>ä½¿ç”¨ Spring Security çš„ CSRF é˜²æŠ¤æœºåˆ¶ï¼Œç¡®ä¿è¯·æ±‚çš„å®‰å…¨æ€§ã€‚</li></ul><h3 id="_4-2-cors-é¢„æ£€è¯·æ±‚æ»¥ç”¨" tabindex="-1"><a class="header-anchor" href="#_4-2-cors-é¢„æ£€è¯·æ±‚æ»¥ç”¨"><span>4.2 CORS é¢„æ£€è¯·æ±‚æ»¥ç”¨</span></a></h3><p>CORS é¢„æ£€è¯·æ±‚ï¼ˆOPTIONS è¯·æ±‚ï¼‰æ˜¯æµè§ˆå™¨åœ¨å‘é€å®é™…è¯·æ±‚ä¹‹å‰å‘å‡ºçš„ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œç”¨äºç¡®è®¤æ˜¯å¦å…è®¸è·¨åŸŸè¯·æ±‚ã€‚æ¶æ„è¯·æ±‚å¯èƒ½æ»¥ç”¨è¿™ä¸ªæœºåˆ¶ã€‚</p><h4 id="é˜²èŒƒæªæ–½-1" tabindex="-1"><a class="header-anchor" href="#é˜²èŒƒæªæ–½-1"><span>é˜²èŒƒæªæ–½ï¼š</span></a></h4><ul><li>é…ç½®åˆç†çš„ <code>maxAge</code>ï¼Œé™åˆ¶é¢„æ£€è¯·æ±‚çš„ç¼“å­˜æ—¶é—´ï¼Œé˜²æ­¢æ»¥ç”¨ã€‚</li><li>ä¸¥æ ¼é™åˆ¶ <code>origins</code> å’Œ <code>methods</code>ï¼Œåªå…è®¸ä¿¡ä»»çš„æºå’Œè¯·æ±‚æ–¹æ³•ã€‚</li></ul><h3 id="_4-3-xss-è·¨ç«™è„šæœ¬æ”»å‡»" tabindex="-1"><a class="header-anchor" href="#_4-3-xss-è·¨ç«™è„šæœ¬æ”»å‡»"><span>4.3 XSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰</span></a></h3><p>XSS æ”»å‡»å…è®¸æ”»å‡»è€…é€šè¿‡è„šæœ¬æ³¨å…¥æ‰§è¡Œæ¶æ„ä»£ç ã€‚ä¸ºäº†é¿å… XSS æ”»å‡»ï¼ŒåŠ¡å¿…å¯¹ä¼ å…¥çš„ç”¨æˆ·æ•°æ®è¿›è¡Œä¸¥æ ¼éªŒè¯å’Œæ¸…ç†ã€‚</p><h4 id="é˜²èŒƒæªæ–½-2" tabindex="-1"><a class="header-anchor" href="#é˜²èŒƒæªæ–½-2"><span>é˜²èŒƒæªæ–½ï¼š</span></a></h4><ul><li>ä½¿ç”¨ HTTPS åŠ å¯†æ‰€æœ‰è¯·æ±‚ï¼Œé¿å…æ•æ„Ÿæ•°æ®æ³„éœ²ã€‚</li><li>å¯¹è¾“å…¥æ•°æ®è¿›è¡ŒéªŒè¯å’Œè½¬ä¹‰ï¼Œé¿å…æ¶æ„è„šæœ¬çš„æ‰§è¡Œã€‚</li></ul><hr><h2 id="æ€»ç»“-3" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-3"><span>æ€»ç»“</span></a></h2><p>è·¨åŸŸè¯·æ±‚æ˜¯ç°ä»£ Web å¼€å‘ä¸­çš„å¸¸è§éœ€æ±‚ï¼ŒSpring MVC æä¾›äº†å¤šç§æ–¹å¼æ¥æ”¯æŒè·¨åŸŸè¯·æ±‚ï¼ŒåŒ…æ‹¬å…¨å±€é…ç½®ã€æ§åˆ¶å™¨æ–¹æ³•çº§é…ç½®å’Œé€šè¿‡ Filter é…ç½®ã€‚é€šè¿‡ <code>@CrossOrigin</code> æ³¨è§£ï¼Œå¼€å‘è€…å¯ä»¥çµæ´»åœ°ä¸ºå…·ä½“è¯·æ±‚æ·»åŠ è·¨åŸŸæ”¯æŒã€‚ä½†åœ¨å¼€å¯è·¨åŸŸæ”¯æŒçš„åŒæ—¶ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„è®¤è¯ä¸å®‰å…¨æ€§é—®é¢˜ï¼Œç¡®ä¿é˜²èŒƒå¸¸è§çš„è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰å’Œè·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰ç­‰å®‰å…¨é£é™©ã€‚</p><h1 id="åã€spring-mvc-æ€§èƒ½ä¼˜åŒ–ä¸è°ƒè¯•æŠ€å·§-1" tabindex="-1"><a class="header-anchor" href="#åã€spring-mvc-æ€§èƒ½ä¼˜åŒ–ä¸è°ƒè¯•æŠ€å·§-1"><span>åã€Spring MVC æ€§èƒ½ä¼˜åŒ–ä¸è°ƒè¯•æŠ€å·§</span></a></h1><p>åœ¨å¼€å‘é«˜æ€§èƒ½çš„ Web åº”ç”¨æ—¶ï¼ŒSpring MVC æä¾›äº†å¤šä¸ªä¼˜åŒ–ç‚¹æ¥æé«˜ç³»ç»Ÿçš„å“åº”é€Ÿåº¦å’Œå¯æ‰©å±•æ€§ã€‚ä¼˜åŒ–ä¸ä»…ä»…æ˜¯ä¸ºäº†åŠ é€Ÿè¯·æ±‚å¤„ç†ï¼Œè¿˜åŒ…æ‹¬é™æ€èµ„æºçš„ç¼“å­˜ã€JSON è½¬æ¢çš„ä¼˜åŒ–ç­‰æ–¹é¢ã€‚æœ¬ç« å°†ä»‹ç» Spring MVC æ€§èƒ½ä¼˜åŒ–çš„å¸¸è§æŠ€å·§ï¼Œå¹¶ç»™å‡ºè°ƒè¯•å»ºè®®ï¼Œå¸®åŠ©å¼€å‘è€…è¯Šæ–­å’Œè§£å†³å¸¸è§çš„æ€§èƒ½ç“¶é¢ˆã€‚</p><hr><h2 id="_1-è¯·æ±‚å¤„ç†é“¾è°ƒä¼˜å»ºè®®" tabindex="-1"><a class="header-anchor" href="#_1-è¯·æ±‚å¤„ç†é“¾è°ƒä¼˜å»ºè®®"><span>1. è¯·æ±‚å¤„ç†é“¾è°ƒä¼˜å»ºè®®</span></a></h2><p>Spring MVC ä¸­ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šç»è¿‡ä¸€ç³»åˆ—çš„å¤„ç†å™¨ã€æ‹¦æˆªå™¨å’Œè§†å›¾è§£æç­‰é˜¶æ®µï¼Œä¼˜åŒ–è¯·æ±‚å¤„ç†é“¾æ˜¯æå‡æ€§èƒ½çš„å…³é”®ä¹‹ä¸€ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›è°ƒä¼˜å»ºè®®ï¼š</p><h3 id="_1-1-å‡å°‘ä¸å¿…è¦çš„æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨" tabindex="-1"><a class="header-anchor" href="#_1-1-å‡å°‘ä¸å¿…è¦çš„æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨"><span>1.1 å‡å°‘ä¸å¿…è¦çš„æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨</span></a></h3><p>æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰å’Œè¿‡æ»¤å™¨ï¼ˆFilterï¼‰æ˜¯è¯·æ±‚å¤„ç†é“¾ä¸­çš„é‡è¦ç»„ä»¶ï¼Œå®ƒä»¬å¯ä»¥æ‹¦æˆªè¯·æ±‚å¹¶è¿›è¡Œé¢„å¤„ç†æˆ–åå¤„ç†ã€‚ä½†è¿‡å¤šçš„æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨ä¼šå¢åŠ è¯·æ±‚çš„å¤„ç†æ—¶é—´ï¼Œå½±å“ç³»ç»Ÿçš„å“åº”é€Ÿåº¦ã€‚</p><h4 id="è°ƒä¼˜å»ºè®®" tabindex="-1"><a class="header-anchor" href="#è°ƒä¼˜å»ºè®®"><span>è°ƒä¼˜å»ºè®®ï¼š</span></a></h4><ul><li>ç§»é™¤ä¸å¿…è¦çš„æ‹¦æˆªå™¨æˆ–è¿‡æ»¤å™¨ã€‚</li><li>å°†æ‹¦æˆªå™¨é…ç½®ä¸ºåªæ‹¦æˆªå¿…è¦çš„è·¯å¾„ï¼Œé¿å…å…¨å±€æ‹¦æˆªã€‚</li><li>ä½¿ç”¨ <code>HandlerInterceptor</code> å’Œ <code>Filter</code> æ—¶ï¼Œç¡®ä¿å®ƒä»¬çš„æ‰§è¡Œæ•ˆç‡ï¼Œé¿å…åšè€—æ—¶æ“ä½œã€‚</li></ul><h3 id="_1-2-ä¼˜åŒ–-dispatcherservlet-çš„åˆå§‹åŒ–å’Œæ˜ å°„" tabindex="-1"><a class="header-anchor" href="#_1-2-ä¼˜åŒ–-dispatcherservlet-çš„åˆå§‹åŒ–å’Œæ˜ å°„"><span>1.2 ä¼˜åŒ– <code>DispatcherServlet</code> çš„åˆå§‹åŒ–å’Œæ˜ å°„</span></a></h3><p><code>DispatcherServlet</code> æ˜¯ Spring MVC çš„æ ¸å¿ƒç»„ä»¶ï¼Œå®ƒè´Ÿè´£è¯·æ±‚çš„è°ƒåº¦å’Œåˆ†å‘ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>DispatcherServlet</code> ä¼šæ‰«æå’Œåˆå§‹åŒ–æ•´ä¸ªåº”ç”¨çš„æ‰€æœ‰ Beanï¼Œè¿™ä¼šå½±å“åº”ç”¨çš„å¯åŠ¨æ—¶é—´ã€‚</p><h4 id="è°ƒä¼˜å»ºè®®-1" tabindex="-1"><a class="header-anchor" href="#è°ƒä¼˜å»ºè®®-1"><span>è°ƒä¼˜å»ºè®®ï¼š</span></a></h4><ul><li>ä½¿ç”¨ Spring Boot çš„å»¶è¿Ÿåˆå§‹åŒ–ç‰¹æ€§ï¼Œæ¨è¿Ÿéå…³é”® Bean çš„åˆå§‹åŒ–ã€‚</li><li>é€šè¿‡ <code>servlet-mapping</code> é…ç½®ï¼Œç²¾ç¡®æ§åˆ¶ <code>DispatcherServlet</code> æ˜ å°„çš„è·¯å¾„ï¼Œé¿å…ä¸å¿…è¦çš„è¯·æ±‚è¿›å…¥ Spring MVC çš„å¤„ç†æµç¨‹ã€‚</li></ul><h3 id="_1-3-ç²¾ç®€è¯·æ±‚è·¯å¾„å’Œ-url-æ˜ å°„" tabindex="-1"><a class="header-anchor" href="#_1-3-ç²¾ç®€è¯·æ±‚è·¯å¾„å’Œ-url-æ˜ å°„"><span>1.3 ç²¾ç®€è¯·æ±‚è·¯å¾„å’Œ URL æ˜ å°„</span></a></h3><p>åœ¨ Spring MVC ä¸­ï¼Œæ¯ä¸ªè¯·æ±‚è·¯å¾„éƒ½ä¼šç»è¿‡ä¸€ç³»åˆ—çš„åŒ¹é…å’Œå¤„ç†ã€‚è·¯å¾„è¿‡é•¿æˆ–è¿‡å¤šçš„ URL æ˜ å°„ä¼šé™ä½è·¯ç”±åŒ¹é…çš„æ•ˆç‡ã€‚</p><h4 id="è°ƒä¼˜å»ºè®®-2" tabindex="-1"><a class="header-anchor" href="#è°ƒä¼˜å»ºè®®-2"><span>è°ƒä¼˜å»ºè®®ï¼š</span></a></h4><ul><li>ä½¿ç”¨ç®€æ´çš„è·¯å¾„å’Œæ˜ å°„è§„åˆ™ï¼Œé¿å…å¤æ‚çš„ URL è§„åˆ™ã€‚</li><li>é¿å…åœ¨è·¯å¾„ä¸­ä½¿ç”¨å¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚</li></ul><hr><h2 id="_2-json-è½¬æ¢æ€§èƒ½ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_2-json-è½¬æ¢æ€§èƒ½ä¼˜åŒ–"><span>2. JSON è½¬æ¢æ€§èƒ½ä¼˜åŒ–</span></a></h2><p>åœ¨ç°ä»£ Web åº”ç”¨ä¸­ï¼ŒJSON å·²æˆä¸ºæ•°æ®äº¤æ¢çš„æ ‡å‡†æ ¼å¼ã€‚ç„¶è€Œï¼ŒJSON åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ˜¯ä¸€ä¸ªæ¯”è¾ƒè€—æ—¶çš„è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ã€‚å› æ­¤ï¼Œä¼˜åŒ– JSON è½¬æ¢çš„æ€§èƒ½å¯¹äºæé«˜åº”ç”¨å“åº”é€Ÿåº¦è‡³å…³é‡è¦ã€‚</p><h3 id="_2-1-ä½¿ç”¨é«˜æ•ˆçš„-json-åºåˆ—åŒ–æ¡†æ¶" tabindex="-1"><a class="header-anchor" href="#_2-1-ä½¿ç”¨é«˜æ•ˆçš„-json-åºåˆ—åŒ–æ¡†æ¶"><span>2.1 ä½¿ç”¨é«˜æ•ˆçš„ JSON åºåˆ—åŒ–æ¡†æ¶</span></a></h3><p>Spring é»˜è®¤ä½¿ç”¨ Jackson æ¥å¤„ç† JSON è½¬æ¢ã€‚Jackson æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„ JSON åºåˆ—åŒ–/ååºåˆ—åŒ–åº“ï¼Œä½†å¯¹äºå¤§æ•°æ®é‡çš„å¤„ç†ï¼Œä¾ç„¶å­˜åœ¨ä¸€å®šçš„æ€§èƒ½ç“¶é¢ˆã€‚</p><h4 id="è°ƒä¼˜å»ºè®®-3" tabindex="-1"><a class="header-anchor" href="#è°ƒä¼˜å»ºè®®-3"><span>è°ƒä¼˜å»ºè®®ï¼š</span></a></h4><ul><li><strong>å®šåˆ¶ Jackson çš„é…ç½®</strong>ï¼šé€šè¿‡å®šåˆ¶ <code>ObjectMapper</code> é…ç½®ï¼Œä¼˜åŒ– JSON è½¬æ¢çš„æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œå…³é—­è‡ªåŠ¨æ ¼å¼åŒ–å’Œå¯ç”¨æµå¼å¤„ç†ã€‚</li><li><strong>ä½¿ç”¨æ›´é«˜æ•ˆçš„ JSON åºåˆ—åŒ–åº“</strong>ï¼šé™¤äº† Jacksonï¼ŒGson å’Œ Fastjson ç­‰åº“ä¹Ÿå¯ä»¥ä¸ Spring é›†æˆï¼Œè¿™äº›åº“åœ¨å¤„ç†æŸäº›åœºæ™¯ä¸‹å¯èƒ½ä¼šæ›´åŠ é«˜æ•ˆã€‚</li><li><strong>å¼€å¯ Jackson ç¼“å­˜</strong>ï¼šå¯ç”¨ Jackson çš„ç¼“å­˜æœºåˆ¶ï¼Œå‡å°‘é‡å¤çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ã€‚</li></ul><h4 id="ç¤ºä¾‹-17" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-17"><span>ç¤ºä¾‹ï¼š</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Bean</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ObjectMapper</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> objectMapper</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    ObjectMapper</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> objectMapper </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ObjectMapper</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    objectMapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">configure</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">DeserializationFeature</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">FAIL_ON_UNKNOWN_PROPERTIES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // ç¦ç”¨æœªçŸ¥å±æ€§å¼‚å¸¸</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    objectMapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">configure</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">SerializationFeature</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">WRITE_DATES_AS_TIMESTAMPS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // ç¦ç”¨æ—¥æœŸæ ¼å¼åŒ–</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> objectMapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-æ§åˆ¶-json-å“åº”å¤§å°" tabindex="-1"><a class="header-anchor" href="#_2-2-æ§åˆ¶-json-å“åº”å¤§å°"><span>2.2 æ§åˆ¶ JSON å“åº”å¤§å°</span></a></h3><p>å¦‚æœå“åº”çš„ JSON æ•°æ®é‡å¾ˆå¤§ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚å‡å°‘è¿”å›çš„æ•°æ®é‡æ˜¯æå‡æ€§èƒ½çš„æœ‰æ•ˆæ–¹æ³•ã€‚</p><h4 id="è°ƒä¼˜å»ºè®®-4" tabindex="-1"><a class="header-anchor" href="#è°ƒä¼˜å»ºè®®-4"><span>è°ƒä¼˜å»ºè®®ï¼š</span></a></h4><ul><li>åªè¿”å›å¿…è¦çš„å­—æ®µï¼Œä½¿ç”¨ <code>@JsonView</code> æˆ– DTOï¼ˆæ•°æ®ä¼ è¾“å¯¹è±¡ï¼‰æ¥è¿‡æ»¤ä¸å¿…è¦çš„å­—æ®µã€‚</li><li>ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢æ¥é¿å…ä¸€æ¬¡æ€§è¿”å›è¿‡å¤šæ•°æ®ã€‚</li></ul><hr><h2 id="_3-é™æ€èµ„æºä¼˜åŒ–ä¸ç¼“å­˜é…ç½®" tabindex="-1"><a class="header-anchor" href="#_3-é™æ€èµ„æºä¼˜åŒ–ä¸ç¼“å­˜é…ç½®"><span>3. é™æ€èµ„æºä¼˜åŒ–ä¸ç¼“å­˜é…ç½®</span></a></h2><p>é™æ€èµ„æºï¼ˆå¦‚å›¾ç‰‡ã€CSS æ–‡ä»¶ã€JavaScript æ–‡ä»¶ç­‰ï¼‰åœ¨ Web åº”ç”¨ä¸­å æ®äº†å¾ˆå¤§æ¯”ä¾‹ï¼Œä¼˜åŒ–é™æ€èµ„æºçš„åŠ è½½é€Ÿåº¦å’Œç¼“å­˜ç­–ç•¥ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡é¡µé¢åŠ è½½æ—¶é—´ã€‚</p><h3 id="_3-1-ä½¿ç”¨-cdn-åŠ é€Ÿé™æ€èµ„æºåŠ è½½" tabindex="-1"><a class="header-anchor" href="#_3-1-ä½¿ç”¨-cdn-åŠ é€Ÿé™æ€èµ„æºåŠ è½½"><span>3.1 ä½¿ç”¨ CDN åŠ é€Ÿé™æ€èµ„æºåŠ è½½</span></a></h3><p>å°†é™æ€èµ„æºæ‰˜ç®¡åœ¨å†…å®¹åˆ†å‘ç½‘ç»œï¼ˆCDNï¼‰ä¸Šï¼Œå¯ä»¥å‡å°‘æœåŠ¡å™¨è´Ÿè½½ï¼Œæé«˜èµ„æºåŠ è½½é€Ÿåº¦ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå…¨çƒè®¿é—®çš„åº”ç”¨ã€‚</p><h4 id="è°ƒä¼˜å»ºè®®-5" tabindex="-1"><a class="header-anchor" href="#è°ƒä¼˜å»ºè®®-5"><span>è°ƒä¼˜å»ºè®®ï¼š</span></a></h4><ul><li>å°†é™æ€èµ„æºä¸Šä¼ åˆ° CDNï¼Œå¹¶é€šè¿‡é…ç½®æœåŠ¡å™¨å°†è¯·æ±‚é‡å®šå‘åˆ° CDN æœåŠ¡å™¨ã€‚</li><li>é…ç½®é™æ€èµ„æºçš„ç‰ˆæœ¬å·å’Œæ–‡ä»¶åå“ˆå¸Œï¼Œç¡®ä¿æµè§ˆå™¨èƒ½å¤Ÿæ­£ç¡®ç¼“å­˜æ–‡ä»¶ã€‚</li></ul><h3 id="_3-2-é…ç½®æµè§ˆå™¨ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_3-2-é…ç½®æµè§ˆå™¨ç¼“å­˜"><span>3.2 é…ç½®æµè§ˆå™¨ç¼“å­˜</span></a></h3><p>é€šè¿‡è®¾ç½®åˆç†çš„ HTTP ç¼“å­˜å¤´ï¼Œå…è®¸æµè§ˆå™¨ç¼“å­˜é™æ€èµ„æºï¼Œä»è€Œé¿å…æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦é‡æ–°åŠ è½½ã€‚</p><h4 id="ç¤ºä¾‹-18" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-18"><span>ç¤ºä¾‹ï¼š</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> WebConfig</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> WebMvcConfigurer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> addResourceHandlers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ResourceHandlerRegistry</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> registry</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        registry</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addResourceHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/static/**&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addResourceLocations</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;classpath:/static/&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setCachePeriod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3600</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// è®¾ç½®é™æ€èµ„æºç¼“å­˜æ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-å‹ç¼©é™æ€èµ„æº" tabindex="-1"><a class="header-anchor" href="#_3-3-å‹ç¼©é™æ€èµ„æº"><span>3.3 å‹ç¼©é™æ€èµ„æº</span></a></h3><p>é™æ€èµ„æºï¼ˆå¦‚ CSSã€JavaScriptã€HTMLï¼‰å¯ä»¥é€šè¿‡ Gzip æˆ– Brotli ç­‰å‹ç¼©ç®—æ³•æ¥å‹ç¼©ï¼Œä»è€Œå‡å°‘æ–‡ä»¶çš„å¤§å°ï¼Œæé«˜åŠ è½½é€Ÿåº¦ã€‚</p><h4 id="è°ƒä¼˜å»ºè®®-6" tabindex="-1"><a class="header-anchor" href="#è°ƒä¼˜å»ºè®®-6"><span>è°ƒä¼˜å»ºè®®ï¼š</span></a></h4><ul><li>å¯ç”¨ Gzip æˆ– Brotli å‹ç¼©ï¼Œå‡å°é™æ€èµ„æºçš„ä¼ è¾“å¤§å°ã€‚</li><li>ä½¿ç”¨ Webpack ç­‰å·¥å…·å¯¹ JavaScript å’Œ CSS è¿›è¡Œå‹ç¼©å’Œæ··æ·†ã€‚</li></ul><hr><h2 id="_4-å¸¸è§æ€§èƒ½é—®é¢˜è¯Šæ–­æŠ€å·§" tabindex="-1"><a class="header-anchor" href="#_4-å¸¸è§æ€§èƒ½é—®é¢˜è¯Šæ–­æŠ€å·§"><span>4. å¸¸è§æ€§èƒ½é—®é¢˜è¯Šæ–­æŠ€å·§</span></a></h2><p>åœ¨ Spring MVC ä¸­ï¼Œæ€§èƒ½é—®é¢˜å¯èƒ½å‘ç”Ÿåœ¨è¯·æ±‚å¤„ç†é“¾çš„å¤šä¸ªé˜¶æ®µï¼Œå¦‚è¯·æ±‚æ‹¦æˆªã€JSON è½¬æ¢ã€è§†å›¾æ¸²æŸ“ç­‰ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„æ€§èƒ½ç“¶é¢ˆåŠå…¶è¯Šæ–­æŠ€å·§ã€‚</p><h3 id="_4-1-è¯·æ±‚é˜»å¡" tabindex="-1"><a class="header-anchor" href="#_4-1-è¯·æ±‚é˜»å¡"><span>4.1 è¯·æ±‚é˜»å¡</span></a></h3><p>è¯·æ±‚é˜»å¡é€šå¸¸å‘ç”Ÿåœ¨é•¿æ—¶é—´è¿è¡Œçš„æ“ä½œï¼Œå¦‚æ•°æ®åº“æŸ¥è¯¢ã€å¤–éƒ¨ API è°ƒç”¨ç­‰ã€‚æ­¤æ—¶è¯·æ±‚ä¼šè¢«æŒ‚èµ·ï¼Œç›´åˆ°æ“ä½œå®Œæˆã€‚</p><h4 id="è°ƒä¼˜å»ºè®®-7" tabindex="-1"><a class="header-anchor" href="#è°ƒä¼˜å»ºè®®-7"><span>è°ƒä¼˜å»ºè®®ï¼š</span></a></h4><ul><li>ä½¿ç”¨å¼‚æ­¥è¯·æ±‚å¤„ç†ï¼ˆ<code>@Async</code>ã€<code>DeferredResult</code> ç­‰ï¼‰æ¥é¿å…é˜»å¡ã€‚</li><li>å¯¹äºé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ï¼Œå¯ä»¥å°†å…¶ç§»è‡³åå°å¤„ç†ï¼Œä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚ Kafkaã€RabbitMQï¼‰ç­‰å¼‚æ­¥æœºåˆ¶ã€‚</li></ul><h3 id="_4-2-è§†å›¾æ¸²æŸ“æ…¢" tabindex="-1"><a class="header-anchor" href="#_4-2-è§†å›¾æ¸²æŸ“æ…¢"><span>4.2 è§†å›¾æ¸²æŸ“æ…¢</span></a></h3><p>è§†å›¾æ¸²æŸ“æ…¢é€šå¸¸å‘ç”Ÿåœ¨ä½¿ç”¨å¤æ‚æ¨¡æ¿å¼•æ“ï¼ˆå¦‚ Thymeleafã€Freemarkerï¼‰æ—¶ã€‚æ¨¡æ¿å¼•æ“ä¼šæ ¹æ®æ•°æ®æ¨¡å‹ç”Ÿæˆæœ€ç»ˆçš„ HTMLï¼Œè¿‡äºå¤æ‚çš„æ¨¡æ¿æˆ–ä¸åˆç†çš„æ•°æ®å¤„ç†ä¼šå¯¼è‡´æ¸²æŸ“é€Ÿåº¦å˜æ…¢ã€‚</p><h4 id="è°ƒä¼˜å»ºè®®-8" tabindex="-1"><a class="header-anchor" href="#è°ƒä¼˜å»ºè®®-8"><span>è°ƒä¼˜å»ºè®®ï¼š</span></a></h4><ul><li>ä¼˜åŒ–æ¨¡æ¿å¼•æ“çš„ä½¿ç”¨ï¼Œé¿å…è¿‡å¤šçš„å¾ªç¯å’Œæ¡ä»¶åˆ¤æ–­ã€‚</li><li>å‡å°‘ä¸å¿…è¦çš„è§†å›¾åˆ·æ–°ï¼Œç¼“å­˜æ¸²æŸ“ç»“æœã€‚</li><li>ä½¿ç”¨å·¥å…·å¦‚ Thymeleaf çš„ç¼“å­˜æœºåˆ¶æˆ–æœåŠ¡å™¨çº§åˆ«çš„ç¼“å­˜æ¥æå‡æ€§èƒ½ã€‚</li></ul><h3 id="_4-3-æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½" tabindex="-1"><a class="header-anchor" href="#_4-3-æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½"><span>4.3 æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½</span></a></h3><p>æ•°æ®åº“æŸ¥è¯¢å¾€å¾€æ˜¯ Web åº”ç”¨ä¸­çš„ç“¶é¢ˆï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ã€‚å¦‚æœæ•°æ®åº“æŸ¥è¯¢æ²¡æœ‰è¿›è¡Œä¼˜åŒ–ï¼Œå¯èƒ½ä¼šå¯¼è‡´å“åº”é€Ÿåº¦å˜æ…¢ã€‚</p><h4 id="è°ƒä¼˜å»ºè®®-9" tabindex="-1"><a class="header-anchor" href="#è°ƒä¼˜å»ºè®®-9"><span>è°ƒä¼˜å»ºè®®ï¼š</span></a></h4><ul><li>ä½¿ç”¨ç¼“å­˜ï¼ˆå¦‚ Redisï¼‰ç¼“å­˜å¸¸ç”¨æ•°æ®ï¼Œé¿å…é¢‘ç¹æŸ¥è¯¢æ•°æ®åº“ã€‚</li><li>ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢ï¼Œé¿å…ä¸€æ¬¡æ€§æŸ¥è¯¢è¿‡å¤šæ•°æ®ã€‚</li><li>ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢è¯­å¥ï¼Œä½¿ç”¨ç´¢å¼•ã€é¿å… N+1 æŸ¥è¯¢ç­‰ã€‚</li></ul><h3 id="_4-4-å†…å­˜æ³„æ¼" tabindex="-1"><a class="header-anchor" href="#_4-4-å†…å­˜æ³„æ¼"><span>4.4 å†…å­˜æ³„æ¼</span></a></h3><p>å†…å­˜æ³„æ¼å¯èƒ½å¯¼è‡´åº”ç”¨åœ¨é•¿æ—¶é—´è¿è¡Œåæ€§èƒ½ä¸‹é™ï¼Œç”šè‡³å´©æºƒã€‚</p><h4 id="è°ƒä¼˜å»ºè®®-10" tabindex="-1"><a class="header-anchor" href="#è°ƒä¼˜å»ºè®®-10"><span>è°ƒä¼˜å»ºè®®ï¼š</span></a></h4><ul><li>ä½¿ç”¨å†…å­˜åˆ†æå·¥å…·ï¼ˆå¦‚ VisualVMã€JProfilerï¼‰æ¥æ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µã€‚</li><li>ç¡®ä¿å®šæ—¶é‡Šæ”¾ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</li></ul><hr><h2 id="æ€»ç»“-4" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-4"><span>æ€»ç»“</span></a></h2><p>Spring MVC çš„æ€§èƒ½ä¼˜åŒ–ä¸ä»…ä»…å±€é™äºä»£ç çš„æ”¹è¿›ï¼Œè¿˜åŒ…æ‹¬æœåŠ¡å™¨é…ç½®ã€ç¼“å­˜ç­–ç•¥å’Œå¤–éƒ¨èµ„æºçš„ç®¡ç†ã€‚é€šè¿‡ä¼˜åŒ–è¯·æ±‚å¤„ç†é“¾ã€JSON è½¬æ¢ã€é™æ€èµ„æºå’Œæ•°æ®åº“æŸ¥è¯¢ç­‰æ–¹é¢ï¼Œå¯ä»¥æ˜¾è‘—æå‡ Web åº”ç”¨çš„æ€§èƒ½ã€‚åŒæ—¶ï¼Œå¼€å‘è€…è¿˜åº”æŒæ¡å¸¸è§çš„æ€§èƒ½ç“¶é¢ˆè¯Šæ–­æŠ€å·§ï¼Œç¡®ä¿åœ¨ç”Ÿäº§ç¯å¢ƒä¸­èƒ½å¤Ÿå¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜ã€‚</p><h1 id="åä¸€ã€æµ‹è¯•ä¸è°ƒè¯•æ”¯æŒ-1" tabindex="-1"><a class="header-anchor" href="#åä¸€ã€æµ‹è¯•ä¸è°ƒè¯•æ”¯æŒ-1"><span>åä¸€ã€æµ‹è¯•ä¸è°ƒè¯•æ”¯æŒ</span></a></h1><p>åœ¨ Spring MVC å¼€å‘ä¸­ï¼Œå•å…ƒæµ‹è¯•å’Œè°ƒè¯•æ”¯æŒæ˜¯ç¡®ä¿ç³»ç»Ÿè´¨é‡å’Œç¨³å®šæ€§çš„å…³é”®éƒ¨åˆ†ã€‚æœ‰æ•ˆçš„æµ‹è¯•èƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…åœ¨ä»£ç å˜æ›´åç¡®ä¿ç³»ç»Ÿçš„æ­£ç¡®æ€§ï¼Œå°¤å…¶æ˜¯å¯¹äº Web å±‚çš„æ§åˆ¶å™¨å’Œè¯·æ±‚å¤„ç†æµç¨‹ã€‚Spring æä¾›äº†å¤šç§å·¥å…·æ¥æ”¯æŒæ§åˆ¶å™¨çš„æµ‹è¯•ï¼Œç‰¹åˆ«æ˜¯ <code>MockMvc</code>ï¼Œå®ƒå¯ä»¥æ¨¡æ‹Ÿ HTTP è¯·æ±‚ï¼Œå¹¶å¸®åŠ©å¼€å‘è€…éªŒè¯è¯·æ±‚å¤„ç†çš„ç»“æœã€‚æœ¬ç« å°†è¯¦ç»†è®²è§£ Spring MVC ä¸­çš„æµ‹è¯•ä¸è°ƒè¯•æ”¯æŒï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•çš„å®ç°ã€è¯·æ±‚å‚æ•°æ¨¡æ‹Ÿå’Œå¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚</p><hr><h2 id="_1-å•å…ƒæµ‹è¯•ä¸æ§åˆ¶å™¨-mock-æµ‹è¯•-mockmvc" tabindex="-1"><a class="header-anchor" href="#_1-å•å…ƒæµ‹è¯•ä¸æ§åˆ¶å™¨-mock-æµ‹è¯•-mockmvc"><span>1. å•å…ƒæµ‹è¯•ä¸æ§åˆ¶å™¨ Mock æµ‹è¯•ï¼ˆMockMvcï¼‰</span></a></h2><h3 id="_1-1-mockmvc-æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#_1-1-mockmvc-æ¦‚è¿°"><span>1.1 MockMvc æ¦‚è¿°</span></a></h3><p><code>MockMvc</code> æ˜¯ Spring æä¾›çš„ä¸€ç§ç”¨äºæµ‹è¯•æ§åˆ¶å™¨ï¼ˆControllerï¼‰çš„æ–¹æ³•ï¼Œå®ƒæ¨¡æ‹Ÿ HTTP è¯·æ±‚å¹¶éªŒè¯è¿”å›çš„ç»“æœï¼Œè€Œæ— éœ€å¯åŠ¨å®Œæ•´çš„ Web æœåŠ¡å™¨ã€‚é€šè¿‡ <code>MockMvc</code>ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•è¯·æ±‚æ˜ å°„ã€è¯·æ±‚å¤„ç†å’Œè§†å›¾æ¸²æŸ“ç­‰åŠŸèƒ½ï¼Œè€Œæ— éœ€ä¸å‰ç«¯æˆ–å®é™… HTTP æœåŠ¡è¿›è¡Œäº¤äº’ã€‚</p><h4 id="ç¤ºä¾‹-19" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-19"><span>ç¤ºä¾‹ï¼š</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RunWith</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">SpringRunner</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">WebMvcTest</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">UserController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserControllerTest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> MockMvc</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mockMvc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">MockBean</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserService</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> userService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> testGetUser</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        User</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> user</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> User</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1L</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Tom&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">25</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        Mockito</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">when</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">userService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getUserById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1L</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">thenReturn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(user);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        mockMvc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">perform</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/user/{id}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1L</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">status</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">isOk</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">jsonPath</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;$.name&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Tom&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">               .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">jsonPath</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;$.age&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">25</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>@WebMvcTest</code> æ³¨è§£åŠ è½½ <code>UserController</code> ç±»ï¼Œæ¨¡æ‹Ÿ GET è¯·æ±‚ï¼ŒéªŒè¯è¿”å›çš„ JSON å“åº”æ•°æ®æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚</p><h3 id="_1-2-æµ‹è¯•æ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#_1-2-æµ‹è¯•æ­¥éª¤"><span>1.2 æµ‹è¯•æ­¥éª¤</span></a></h3><ol><li><strong>ä½¿ç”¨ <code>@WebMvcTest</code></strong>ï¼šè¿™ä¸ªæ³¨è§£ä¼šåˆå§‹åŒ– Spring MVC çš„ç›¸å…³é…ç½®ï¼ŒåªåŠ è½½ Web å±‚çš„ Beanï¼Œé¿å…åŠ è½½æ•´ä¸ª Spring ä¸Šä¸‹æ–‡ï¼Œæå‡æµ‹è¯•é€Ÿåº¦ã€‚</li><li><strong><code>MockMvc</code> æ¨¡æ‹Ÿè¯·æ±‚</strong>ï¼šé€šè¿‡ <code>MockMvc</code> æ¥æ¨¡æ‹Ÿ HTTP è¯·æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ <code>get()</code>ã€<code>post()</code>ã€<code>put()</code>ã€<code>delete()</code> ç­‰æ–¹æ³•æ¨¡æ‹Ÿä¸åŒçš„ HTTP æ–¹æ³•ã€‚</li><li><strong>æ–­è¨€éªŒè¯å“åº”</strong>ï¼šä½¿ç”¨ <code>andExpect()</code> æ–¹æ³•å¯¹å“åº”ç»“æœè¿›è¡Œæ–­è¨€éªŒè¯ï¼Œå¸¸è§çš„éªŒè¯æœ‰çŠ¶æ€ç ã€å“åº”ä½“ã€å“åº”å¤´ç­‰ã€‚</li></ol><hr><h2 id="_2-æ¨¡æ‹Ÿè¯·æ±‚å‚æ•°ä¸çŠ¶æ€æ ¡éªŒ" tabindex="-1"><a class="header-anchor" href="#_2-æ¨¡æ‹Ÿè¯·æ±‚å‚æ•°ä¸çŠ¶æ€æ ¡éªŒ"><span>2. æ¨¡æ‹Ÿè¯·æ±‚å‚æ•°ä¸çŠ¶æ€æ ¡éªŒ</span></a></h2><h3 id="_2-1-æ¨¡æ‹Ÿè¯·æ±‚å‚æ•°" tabindex="-1"><a class="header-anchor" href="#_2-1-æ¨¡æ‹Ÿè¯·æ±‚å‚æ•°"><span>2.1 æ¨¡æ‹Ÿè¯·æ±‚å‚æ•°</span></a></h3><p>åœ¨æµ‹è¯•æ§åˆ¶å™¨æ—¶ï¼Œæ¨¡æ‹Ÿè¯·æ±‚å‚æ•°æ˜¯å¿…ä¸å¯å°‘çš„ç¯èŠ‚ã€‚å¯ä»¥é€šè¿‡ <code>MockMvc</code> æ¨¡æ‹Ÿè·¯å¾„å˜é‡ã€æŸ¥è¯¢å‚æ•°ã€è¯·æ±‚ä½“ç­‰ï¼Œæ¥éªŒè¯æ§åˆ¶å™¨æ˜¯å¦æ­£ç¡®å¤„ç†è¿™äº›å‚æ•°ã€‚</p><h4 id="ç¤ºä¾‹-æ¨¡æ‹ŸæŸ¥è¯¢å‚æ•°" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-æ¨¡æ‹ŸæŸ¥è¯¢å‚æ•°"><span>ç¤ºä¾‹ï¼šæ¨¡æ‹ŸæŸ¥è¯¢å‚æ•°</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> testSearchUser</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">() throws Exception {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mockMvc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">perform</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/search&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">param</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;q&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Tom&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">           .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">status</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">isOk</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">           .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">jsonPath</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;$.name&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Tom&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ <code>.param(&quot;q&quot;, &quot;Tom&quot;)</code> æ¨¡æ‹ŸæŸ¥è¯¢å‚æ•°ï¼ŒéªŒè¯æ§åˆ¶å™¨æ˜¯å¦èƒ½å¤Ÿæ­£ç¡®æ¥æ”¶å¹¶å¤„ç†è¯¥å‚æ•°ã€‚</p><h3 id="_2-2-æ¨¡æ‹Ÿè¯·æ±‚ä½“" tabindex="-1"><a class="header-anchor" href="#_2-2-æ¨¡æ‹Ÿè¯·æ±‚ä½“"><span>2.2 æ¨¡æ‹Ÿè¯·æ±‚ä½“</span></a></h3><p>å¯¹äº <code>POST</code>ã€<code>PUT</code> ç­‰è¯·æ±‚æ–¹æ³•ï¼Œé€šå¸¸éœ€è¦æ¨¡æ‹Ÿè¯·æ±‚ä½“ä¸­çš„ JSON æ•°æ®ã€‚å¯ä»¥ä½¿ç”¨ <code>MockMvc</code> æä¾›çš„ <code>content()</code> æ–¹æ³•æ¥è®¾ç½®è¯·æ±‚ä½“ã€‚</p><h4 id="ç¤ºä¾‹-æ¨¡æ‹Ÿè¯·æ±‚ä½“" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-æ¨¡æ‹Ÿè¯·æ±‚ä½“"><span>ç¤ºä¾‹ï¼šæ¨¡æ‹Ÿè¯·æ±‚ä½“</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> testCreateUser</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">() throws Exception {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    User</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> user </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> User</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Tom&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 25</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> json </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ObjectMapper</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">writeValueAsString</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(user);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mockMvc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">perform</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">post</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/user&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">contentType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">MediaType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">APPLICATION_JSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">content</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(json))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">           .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">status</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">isCreated</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">           .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">jsonPath</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;$.name&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Tom&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">           .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">jsonPath</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;$.age&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">25</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Jackson å°† <code>User</code> å¯¹è±¡è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²ï¼Œç„¶åé€šè¿‡ <code>content()</code> æ–¹æ³•å°†å…¶ä½œä¸ºè¯·æ±‚ä½“å‘é€ã€‚</p><h3 id="_2-3-æ¨¡æ‹ŸçŠ¶æ€æ ¡éªŒ" tabindex="-1"><a class="header-anchor" href="#_2-3-æ¨¡æ‹ŸçŠ¶æ€æ ¡éªŒ"><span>2.3 æ¨¡æ‹ŸçŠ¶æ€æ ¡éªŒ</span></a></h3><p>çŠ¶æ€æ ¡éªŒæ˜¯æµ‹è¯•ä¸­å¸¸è§çš„éœ€æ±‚ï¼Œç¡®ä¿è¯·æ±‚è¿”å›çš„çŠ¶æ€ç å’Œå“åº”ä½“ç¬¦åˆé¢„æœŸã€‚å¸¸ç”¨çš„æ–­è¨€åŒ…æ‹¬ï¼š</p><ul><li><strong>çŠ¶æ€ç æ–­è¨€</strong>ï¼šä½¿ç”¨ <code>andExpect(status().isOk())</code> æ¥æ–­è¨€ HTTP çŠ¶æ€ç ã€‚</li><li><strong>JSON æ–­è¨€</strong>ï¼šä½¿ç”¨ <code>jsonPath()</code> æ¥éªŒè¯ JSON å“åº”å†…å®¹ã€‚</li></ul><h4 id="ç¤ºä¾‹-éªŒè¯-http-çŠ¶æ€ç å’Œå“åº”ä½“" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-éªŒè¯-http-çŠ¶æ€ç å’Œå“åº”ä½“"><span>ç¤ºä¾‹ï¼šéªŒè¯ HTTP çŠ¶æ€ç å’Œå“åº”ä½“</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> testGetUserNotFound</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">() throws Exception {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    mockMvc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">perform</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/user/{id}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">999L</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">           .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">status</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">isNotFound</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿè¯·æ±‚ä¸€ä¸ªä¸å­˜åœ¨çš„ç”¨æˆ· IDï¼Œå¹¶éªŒè¯è¿”å›çŠ¶æ€ä¸º <code>404 Not Found</code>ã€‚</p><hr><h2 id="_3-spring-mvc-æµ‹è¯•ä¸­å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_3-spring-mvc-æµ‹è¯•ä¸­å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"><span>3. Spring MVC æµ‹è¯•ä¸­å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</span></a></h2><h3 id="_3-1-é—®é¢˜-autowired-æ— æ³•æ³¨å…¥-mockmvc" tabindex="-1"><a class="header-anchor" href="#_3-1-é—®é¢˜-autowired-æ— æ³•æ³¨å…¥-mockmvc"><span>3.1 é—®é¢˜ï¼š<code>@Autowired</code> æ— æ³•æ³¨å…¥ <code>MockMvc</code></span></a></h3><p>åœ¨æµ‹è¯•æ§åˆ¶å™¨æ—¶ï¼Œå¦‚æœæ— æ³•æ­£ç¡®æ³¨å…¥ <code>MockMvc</code>ï¼Œé€šå¸¸æ˜¯ç”±äºæµ‹è¯•ç¯å¢ƒçš„é…ç½®ä¸æ­£ç¡®ï¼Œå¯èƒ½æ²¡æœ‰æ­£ç¡®åŠ è½½ Spring çš„ Web ç¯å¢ƒã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆ"><span>è§£å†³æ–¹æ¡ˆï¼š</span></a></h4><p>ç¡®ä¿åœ¨æµ‹è¯•ç±»ä¸­ä½¿ç”¨äº† <code>@RunWith(SpringRunner.class)</code> å’Œ <code>@WebMvcTest</code> æ³¨è§£ï¼Œç¡®ä¿ Spring MVC é…ç½®æ­£ç¡®åŠ è½½ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RunWith</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">SpringRunner</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">WebMvcTest</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">UserController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserControllerTest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> MockMvc</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mockMvc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-é—®é¢˜-æ— æ³•æ¨¡æ‹Ÿè¯·æ±‚ä½“-request-body" tabindex="-1"><a class="header-anchor" href="#_3-2-é—®é¢˜-æ— æ³•æ¨¡æ‹Ÿè¯·æ±‚ä½“-request-body"><span>3.2 é—®é¢˜ï¼šæ— æ³•æ¨¡æ‹Ÿè¯·æ±‚ä½“ï¼ˆRequest Bodyï¼‰</span></a></h3><p>å¦‚æœåœ¨æ¨¡æ‹Ÿ <code>POST</code> è¯·æ±‚æ—¶ï¼Œå‘ç°æ— æ³•æ­£ç¡®ä¼ é€’è¯·æ±‚ä½“ï¼ˆå¦‚ JSON æ•°æ®ï¼‰ï¼Œå¯èƒ½æ˜¯å› ä¸ºæ²¡æœ‰è®¾ç½®è¯·æ±‚çš„ <code>Content-Type</code>ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ-1" tabindex="-1"><a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆ-1"><span>è§£å†³æ–¹æ¡ˆï¼š</span></a></h4><p>ç¡®ä¿è¯·æ±‚è®¾ç½®äº†æ­£ç¡®çš„ <code>Content-Type</code>ï¼Œä¾‹å¦‚ <code>application/json</code>ï¼Œå¹¶ä½¿ç”¨ <code>.content()</code> æ–¹æ³•ä¼ é€’è¯·æ±‚ä½“ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">mockMvc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">perform</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">post</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/user&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">contentType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">MediaType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">APPLICATION_JSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">content</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(json))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">status</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">isCreated</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-é—®é¢˜-æ— æ³•è§£æå“åº”ä½“" tabindex="-1"><a class="header-anchor" href="#_3-3-é—®é¢˜-æ— æ³•è§£æå“åº”ä½“"><span>3.3 é—®é¢˜ï¼šæ— æ³•è§£æå“åº”ä½“</span></a></h3><p>å¦‚æœåœ¨æ–­è¨€å“åº”ä½“æ—¶ï¼Œå‘ç°æ— æ³•æ­£ç¡®è§£æ JSON æ•°æ®ï¼Œé€šå¸¸æ˜¯å› ä¸ºè¿”å›çš„ JSON æ ¼å¼ä¸ç¬¦åˆé¢„æœŸï¼Œæˆ–è€… JSON å­—æ®µåä¸åŒ¹é…ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ-2" tabindex="-1"><a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆ-2"><span>è§£å†³æ–¹æ¡ˆï¼š</span></a></h4><p>ä½¿ç”¨ <code>jsonPath()</code> å¯¹è¿”å›çš„ JSON æ•°æ®è¿›è¡Œæ–­è¨€æ—¶ï¼Œç¡®ä¿å­—æ®µåå’Œç±»å‹ä¸è¿”å›çš„å“åº”ä½“ä¸€è‡´ã€‚è¿˜å¯ä»¥ä½¿ç”¨ <code>ObjectMapper</code> å¯¹è¿”å›çš„å“åº”ä½“è¿›è¡Œåºåˆ—åŒ–ï¼Œæ‰‹åŠ¨æ£€æŸ¥å…¶ç»“æ„ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">mockMvc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">perform</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/user/{id}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1L</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">jsonPath</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;$.name&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Tom&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">jsonPath</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;$.age&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">25</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-é—®é¢˜-æµ‹è¯•å¤±è´¥æ—¶è°ƒè¯•å›°éš¾" tabindex="-1"><a class="header-anchor" href="#_3-4-é—®é¢˜-æµ‹è¯•å¤±è´¥æ—¶è°ƒè¯•å›°éš¾"><span>3.4 é—®é¢˜ï¼šæµ‹è¯•å¤±è´¥æ—¶è°ƒè¯•å›°éš¾</span></a></h3><p>å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œéš¾ä»¥å¿«é€Ÿå®šä½é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ <code>ResultActions</code> çš„ <code>andDo(print())</code> æ–¹æ³•ï¼Œæ‰“å°å‡ºè¯·æ±‚å’Œå“åº”çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ-3" tabindex="-1"><a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆ-3"><span>è§£å†³æ–¹æ¡ˆï¼š</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">mockMvc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">perform</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/user/{id}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1L</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">andDo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">())</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // æ‰“å°è¯·æ±‚å’Œå“åº”</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">status</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">isOk</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ <code>andDo(print())</code>ï¼Œä½ å¯ä»¥æŸ¥çœ‹è¯·æ±‚çš„ URIã€è¯·æ±‚å‚æ•°ã€è¯·æ±‚ä½“å’Œå“åº”ä½“ç­‰è¯¦ç»†ä¿¡æ¯ï¼Œå¸®åŠ©å¿«é€Ÿå®šä½é—®é¢˜ã€‚</p><hr><h2 id="æ€»ç»“-5" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-5"><span>æ€»ç»“</span></a></h2><p>åœ¨ Spring MVC ä¸­ï¼Œæµ‹è¯•æ˜¯ä¿è¯ Web å±‚æ­£ç¡®æ€§å’Œç¨³å®šæ€§çš„é‡è¦æ‰‹æ®µã€‚é€šè¿‡ <code>MockMvc</code>ï¼Œå¼€å‘è€…å¯ä»¥è½»æ¾åœ°æ¨¡æ‹Ÿ HTTP è¯·æ±‚ï¼ŒéªŒè¯æ§åˆ¶å™¨çš„è¡Œä¸ºã€‚æ¨¡æ‹Ÿè¯·æ±‚å‚æ•°ã€è¯·æ±‚ä½“ã€éªŒè¯çŠ¶æ€ç å’Œå“åº”ä½“ç­‰å¸¸è§æ“ä½œï¼Œéƒ½æ˜¯æµ‹è¯•ä¸­çš„åŸºæœ¬éœ€æ±‚ã€‚åŒæ—¶ï¼Œäº†è§£ä¸€äº›å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼Œæœ‰åŠ©äºå¼€å‘è€…æ›´é«˜æ•ˆåœ°è¿›è¡Œæµ‹è¯•ä¸è°ƒè¯•ï¼Œç¡®ä¿ç³»ç»Ÿçš„é«˜è´¨é‡è¿è¡Œã€‚</p><h1 id="åäºŒã€spring-mvc-å¸¸è§é¢è¯•é¢˜ä¸è®¾è®¡é¢˜-1" tabindex="-1"><a class="header-anchor" href="#åäºŒã€spring-mvc-å¸¸è§é¢è¯•é¢˜ä¸è®¾è®¡é¢˜-1"><span>åäºŒã€Spring MVC å¸¸è§é¢è¯•é¢˜ä¸è®¾è®¡é¢˜</span></a></h1><p>Spring MVC æ˜¯ Java Web å¼€å‘ä¸­çš„é‡è¦æ¡†æ¶ï¼Œæ·±å…¥ç†è§£å…¶åŸç†å’Œæ ¸å¿ƒç»„ä»¶ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…åœ¨é¢è¯•ä¸­è„±é¢–è€Œå‡ºã€‚æœ¬ç« å°†åˆ—ä¸¾ä¸€äº›å¸¸è§çš„é¢è¯•é¢˜å’Œè®¾è®¡é¢˜ï¼Œæ¶µç›– Spring MVC æ‰§è¡Œæµç¨‹ã€DispatcherServlet çš„å·¥ä½œåŸç†ã€å‚æ•°ç»‘å®šã€å…¨å±€å¼‚å¸¸å¤„ç†ç­‰å…³é”®æŠ€æœ¯ç‚¹ï¼Œå¹¶æä¾›å¯¹è¿™äº›é—®é¢˜çš„è¯¦ç»†è§£ç­”å’Œæ€è€ƒã€‚</p><hr><h2 id="_1-spring-mvc-æ‰§è¡Œæµç¨‹èƒ½å¦è¯¦ç»†æè¿°" tabindex="-1"><a class="header-anchor" href="#_1-spring-mvc-æ‰§è¡Œæµç¨‹èƒ½å¦è¯¦ç»†æè¿°"><span>1. Spring MVC æ‰§è¡Œæµç¨‹èƒ½å¦è¯¦ç»†æè¿°ï¼Ÿ</span></a></h2><h3 id="spring-mvc-æ‰§è¡Œæµç¨‹æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#spring-mvc-æ‰§è¡Œæµç¨‹æ¦‚è¿°"><span><strong>Spring MVC æ‰§è¡Œæµç¨‹æ¦‚è¿°</strong></span></a></h3><p>Spring MVC çš„æ‰§è¡Œæµç¨‹å¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li><strong>å®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾ DispatcherServlet</strong> å®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚é¦–å…ˆåˆ°è¾¾ <code>DispatcherServlet</code>ï¼Œå®ƒæ˜¯ Spring MVC çš„å‰ç«¯æ§åˆ¶å™¨ï¼Œè´Ÿè´£è¯·æ±‚çš„åˆ†å‘å’Œå¤„ç†ã€‚</li><li><strong>DispatcherServlet æŸ¥æ‰¾ HandlerMapping</strong><code>DispatcherServlet</code> ä¼šé€šè¿‡ <code>HandlerMapping</code> æŸ¥æ‰¾å¯¹åº”çš„æ§åˆ¶å™¨ï¼ˆControllerï¼‰æ¥å¤„ç†è¯¥è¯·æ±‚ã€‚<code>HandlerMapping</code> æ ¹æ®è¯·æ±‚çš„ URLã€è¯·æ±‚æ–¹æ³•ç­‰ä¿¡æ¯æ¥ç¡®å®šå…·ä½“çš„å¤„ç†æ–¹æ³•ã€‚</li><li><strong>HandlerAdapter è°ƒç”¨æ–¹æ³•</strong> æ‰¾åˆ°å¯¹åº”çš„æ§åˆ¶å™¨åï¼Œ<code>HandlerAdapter</code> è´Ÿè´£è°ƒç”¨æ§åˆ¶å™¨çš„æ–¹æ³•æ¥å¤„ç†è¯·æ±‚ï¼Œå¹¶å°†è¿”å›å€¼ä¼ é€’ç»™ <code>DispatcherServlet</code>ã€‚</li><li><strong>è§†å›¾è§£æï¼ˆViewResolverï¼‰</strong> å¦‚æœæ§åˆ¶å™¨è¿”å›çš„æ˜¯ä¸€ä¸ªè§†å›¾åï¼Œ<code>DispatcherServlet</code> ä¼šå°†è§†å›¾åä¼ é€’ç»™ <code>ViewResolver</code>ï¼Œé€šè¿‡è§†å›¾è§£æå™¨æ‰¾åˆ°ç›¸åº”çš„è§†å›¾å¯¹è±¡ï¼ˆå¦‚ JSP é¡µé¢ï¼‰ã€‚</li><li><strong>æ¸²æŸ“è§†å›¾</strong> æœ€åï¼Œè§†å›¾ä¼šè¢«æ¸²æŸ“å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®Œæˆè¯·æ±‚çš„å“åº”ã€‚</li></ol><hr><h2 id="_2-dispatcherservlet-æ˜¯å¦‚ä½•è°ƒåº¦è¯·æ±‚çš„" tabindex="-1"><a class="header-anchor" href="#_2-dispatcherservlet-æ˜¯å¦‚ä½•è°ƒåº¦è¯·æ±‚çš„"><span>2. DispatcherServlet æ˜¯å¦‚ä½•è°ƒåº¦è¯·æ±‚çš„ï¼Ÿ</span></a></h2><p><code>DispatcherServlet</code> æ˜¯ Spring MVC ä¸­çš„æ ¸å¿ƒç»„ä»¶ï¼Œå®ƒè´Ÿè´£æ•´ä¸ªè¯·æ±‚å¤„ç†è¿‡ç¨‹ã€‚å®ƒçš„è°ƒåº¦æµç¨‹å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li><strong>æ¥æ”¶è¯·æ±‚</strong><code>DispatcherServlet</code> ä½œä¸ºå‰ç«¯æ§åˆ¶å™¨æ¥æ”¶æ‰€æœ‰è¿›å…¥çš„ HTTP è¯·æ±‚ã€‚</li><li><strong>æŸ¥æ‰¾ HandlerMapping</strong><code>DispatcherServlet</code> æ ¹æ®è¯·æ±‚çš„ URLã€è¯·æ±‚æ–¹æ³•ç­‰ä¿¡æ¯ï¼Œé€šè¿‡é…ç½®çš„ <code>HandlerMapping</code> æŸ¥æ‰¾å¯¹åº”çš„æ§åˆ¶å™¨ï¼ˆHandlerï¼‰å’Œæ–¹æ³•ï¼ˆHandlerMethodï¼‰ã€‚</li><li><strong>è°ƒç”¨ HandlerAdapter</strong> æ‰¾åˆ°åˆé€‚çš„æ§åˆ¶å™¨åï¼Œ<code>DispatcherServlet</code> ä½¿ç”¨ <code>HandlerAdapter</code> è°ƒç”¨æ§åˆ¶å™¨çš„æ–¹æ³•æ¥å¤„ç†è¯·æ±‚ã€‚<code>HandlerAdapter</code> æä¾›äº†å¯¹ä¸åŒç±»å‹çš„æ§åˆ¶å™¨çš„æ”¯æŒï¼Œä¾‹å¦‚ <code>@Controller</code> æˆ– <code>@RestController</code>ã€‚</li><li><strong>è§†å›¾è§£æä¸å“åº”</strong> å¦‚æœæ§åˆ¶å™¨è¿”å›çš„æ˜¯è§†å›¾åç§°ï¼ˆä¾‹å¦‚ <code>ModelAndView</code>ï¼‰ï¼Œ<code>DispatcherServlet</code> ä¼šé€šè¿‡ <code>ViewResolver</code> æ‰¾åˆ°å¹¶æ¸²æŸ“è¯¥è§†å›¾ã€‚æœ€ç»ˆï¼Œå“åº”å†…å®¹é€šè¿‡ <code>HttpServletResponse</code> è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ol><hr><h2 id="_3-å‚æ•°ç»‘å®šåº•å±‚åŸç†ä¸è‡ªå®šä¹‰ç»‘å®š" tabindex="-1"><a class="header-anchor" href="#_3-å‚æ•°ç»‘å®šåº•å±‚åŸç†ä¸è‡ªå®šä¹‰ç»‘å®š"><span>3. å‚æ•°ç»‘å®šåº•å±‚åŸç†ä¸è‡ªå®šä¹‰ç»‘å®šï¼Ÿ</span></a></h2><h3 id="å‚æ•°ç»‘å®šåŸç†" tabindex="-1"><a class="header-anchor" href="#å‚æ•°ç»‘å®šåŸç†"><span><strong>å‚æ•°ç»‘å®šåŸç†</strong></span></a></h3><p>Spring MVC çš„å‚æ•°ç»‘å®šæœºåˆ¶ä¾èµ–äº <code>WebDataBinder</code>ï¼Œå®ƒå°† HTTP è¯·æ±‚çš„å‚æ•°ç»‘å®šåˆ°æ§åˆ¶å™¨æ–¹æ³•çš„å‚æ•°æˆ– JavaBean å±æ€§ä¸Šã€‚å¸¸è§çš„ç»‘å®šæ–¹å¼æœ‰ï¼š</p><ol><li><p><strong>è¯·æ±‚å‚æ•°ç»‘å®š</strong><code>@RequestParam</code> ç”¨äºç»‘å®šæŸ¥è¯¢å‚æ•°ã€è¡¨å•å‚æ•°åˆ°æ§åˆ¶å™¨æ–¹æ³•çš„å‚æ•°ã€‚ä¾‹å¦‚ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/user&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getUser</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestParam</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;id&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Long</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> userId) { </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>è·¯å¾„å˜é‡ç»‘å®š</strong><code>@PathVariable</code> ç”¨äºç»‘å®š URL è·¯å¾„ä¸­çš„å˜é‡ã€‚ä¾‹å¦‚ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/user/{id}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getUser</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Long</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> id) { </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>è¯·æ±‚ä½“ç»‘å®š</strong><code>@RequestBody</code> ç”¨äºç»‘å®šè¯·æ±‚ä½“ï¼ˆé€šå¸¸ä¸º JSONï¼‰åˆ°æ§åˆ¶å™¨æ–¹æ³•çš„å‚æ•°ã€‚ä¾‹å¦‚ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PostMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/user&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> createUser</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestBody</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> User</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> user) { </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æ¨¡å‹å¯¹è±¡ç»‘å®š</strong><code>@ModelAttribute</code> ç”¨äºç»‘å®šè¡¨å•æ•°æ®åˆ° JavaBean å¯¹è±¡ã€‚Spring ä¼šè‡ªåŠ¨å°†è¯·æ±‚å‚æ•°å¡«å……åˆ°è¯¥å¯¹è±¡çš„å±æ€§ä¸­ã€‚ä¾‹å¦‚ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PostMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/register&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> register</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">ModelAttribute</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserForm</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> userForm) { </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="è‡ªå®šä¹‰ç»‘å®š" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰ç»‘å®š"><span><strong>è‡ªå®šä¹‰ç»‘å®š</strong></span></a></h3><p>Spring æä¾›äº†è‡ªå®šä¹‰ç±»å‹è½¬æ¢å’Œç»‘å®šçš„èƒ½åŠ›ã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡å®ç° <code>PropertyEditor</code> æˆ–ä½¿ç”¨ <code>@InitBinder</code> æ³¨è§£æ¥æ³¨å†Œè‡ªå®šä¹‰çš„å±æ€§ç¼–è¾‘å™¨ï¼Œå®ç°å¤æ‚çš„ç»‘å®šéœ€æ±‚ã€‚</p><h4 id="ç¤ºä¾‹-è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨"><span>ç¤ºä¾‹ï¼šè‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">InitBinder</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> initBinder</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">WebDataBinder</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> binder) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    binder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">registerCustomEditor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Date</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> CustomDateEditor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> SimpleDateFormat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;yyyy-MM-dd&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_4-å¦‚ä½•ä¼˜é›…åœ°å¤„ç†å…¨å±€å¼‚å¸¸-æ˜¯å¦å¯ä»¥æŒ‰æ¨¡å—åˆ‡åˆ†" tabindex="-1"><a class="header-anchor" href="#_4-å¦‚ä½•ä¼˜é›…åœ°å¤„ç†å…¨å±€å¼‚å¸¸-æ˜¯å¦å¯ä»¥æŒ‰æ¨¡å—åˆ‡åˆ†"><span>4. å¦‚ä½•ä¼˜é›…åœ°å¤„ç†å…¨å±€å¼‚å¸¸ï¼Ÿæ˜¯å¦å¯ä»¥æŒ‰æ¨¡å—åˆ‡åˆ†ï¼Ÿ</span></a></h2><h3 id="å…¨å±€å¼‚å¸¸å¤„ç†" tabindex="-1"><a class="header-anchor" href="#å…¨å±€å¼‚å¸¸å¤„ç†"><span><strong>å…¨å±€å¼‚å¸¸å¤„ç†</strong></span></a></h3><p>åœ¨ Spring MVC ä¸­ï¼Œå¸¸ç”¨çš„å…¨å±€å¼‚å¸¸å¤„ç†æ–¹æ¡ˆæ˜¯ä½¿ç”¨ <code>@ControllerAdvice</code>ã€‚å®ƒå…è®¸æˆ‘ä»¬é›†ä¸­å¤„ç†æ‰€æœ‰æ§åˆ¶å™¨ä¸­çš„å¼‚å¸¸ï¼Œæä¾›ç»Ÿä¸€çš„å¼‚å¸¸å“åº”æ ¼å¼ã€‚</p><h4 id="ç¤ºä¾‹-å…¨å±€å¼‚å¸¸å¤„ç†" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-å…¨å±€å¼‚å¸¸å¤„ç†"><span>ç¤ºä¾‹ï¼šå…¨å±€å¼‚å¸¸å¤„ç†</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">ControllerAdvice</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> GlobalExceptionHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">ExceptionHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ResponseEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ApiResponse</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> handleException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        ApiResponse</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> response</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ApiResponse</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">500</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Internal Server Error&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getMessage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ResponseEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;(response, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">HttpStatus</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">INTERNAL_SERVER_ERROR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æŒ‰æ¨¡å—åˆ‡åˆ†å¼‚å¸¸å¤„ç†" tabindex="-1"><a class="header-anchor" href="#æŒ‰æ¨¡å—åˆ‡åˆ†å¼‚å¸¸å¤„ç†"><span><strong>æŒ‰æ¨¡å—åˆ‡åˆ†å¼‚å¸¸å¤„ç†</strong></span></a></h3><p>å¦‚æœåº”ç”¨ç¨‹åºåŒ…å«å¤šä¸ªæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—æœ‰ä¸åŒçš„å¼‚å¸¸å¤„ç†éœ€æ±‚ï¼Œå¯ä»¥é€šè¿‡æŒ‰æ¨¡å—åˆ’åˆ†ä¸åŒçš„ <code>@ControllerAdvice</code> æ¥å®ç°ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">ControllerAdvice</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">basePackages</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;com.example.user&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserExceptionHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">ExceptionHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">UserNotFoundException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ResponseEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ApiResponse</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> handleUserNotFound</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">UserNotFoundException</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        ApiResponse</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> response</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ApiResponse</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">404</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;User Not Found&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getMessage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ResponseEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;(response, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">HttpStatus</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">NOT_FOUND</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_5-å¦‚ä½•åº”å¯¹é«˜å¹¶å‘ä¸‹-controller-æ€§èƒ½ç“¶é¢ˆ" tabindex="-1"><a class="header-anchor" href="#_5-å¦‚ä½•åº”å¯¹é«˜å¹¶å‘ä¸‹-controller-æ€§èƒ½ç“¶é¢ˆ"><span>5. å¦‚ä½•åº”å¯¹é«˜å¹¶å‘ä¸‹ Controller æ€§èƒ½ç“¶é¢ˆï¼Ÿ</span></a></h2><h3 id="æ€§èƒ½ç“¶é¢ˆåˆ†æ" tabindex="-1"><a class="header-anchor" href="#æ€§èƒ½ç“¶é¢ˆåˆ†æ"><span><strong>æ€§èƒ½ç“¶é¢ˆåˆ†æ</strong></span></a></h3><p>åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼ŒController å±‚å¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œå¸¸è§çš„ç“¶é¢ˆæœ‰ï¼š</p><ol><li><strong>é˜»å¡ I/O æ“ä½œ</strong> å¦‚æœ Controller ä¸­å­˜åœ¨é˜»å¡çš„ I/O æ“ä½œï¼ˆä¾‹å¦‚æ•°æ®åº“æŸ¥è¯¢ã€æ–‡ä»¶æ“ä½œï¼‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Œå½±å“æ•´ä½“æ€§èƒ½ã€‚</li><li><strong>å¤æ‚è®¡ç®—</strong> å¦‚æœ Controller è¿›è¡Œå¤æ‚çš„è®¡ç®—ï¼Œå¯èƒ½å¯¼è‡´å¤„ç†æ—¶é—´è¾ƒé•¿ï¼Œä»è€Œå½±å“å“åº”é€Ÿåº¦ã€‚</li></ol><h3 id="è§£å†³æ–¹æ¡ˆ-4" tabindex="-1"><a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆ-4"><span><strong>è§£å†³æ–¹æ¡ˆ</strong></span></a></h3><ol><li><p><strong>å¼‚æ­¥å¤„ç†</strong> ä½¿ç”¨ <code>@Async</code> æ³¨è§£æˆ– <code>DeferredResult</code> æ¥å®ç°å¼‚æ­¥è¯·æ±‚å¤„ç†ï¼Œå‡å°‘çº¿ç¨‹é˜»å¡çš„å½±å“ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Async</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/process&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> CompletableFuture</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> processData</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // å¤æ‚è®¡ç®—æˆ– I/O æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> CompletableFuture</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">completedFuture</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Processed&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ç¼“å­˜æœºåˆ¶</strong> ä½¿ç”¨ç¼“å­˜ï¼ˆå¦‚ <code>@Cacheable</code>ï¼‰æ¥å‡å°‘é‡å¤è®¡ç®—å’Œæ•°æ®åº“æŸ¥è¯¢ï¼Œæå‡ç³»ç»Ÿå“åº”é€Ÿåº¦ã€‚</p></li><li><p><strong>è´Ÿè½½å‡è¡¡</strong> åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä½¿ç”¨è´Ÿè½½å‡è¡¡æŠ€æœ¯å°†è¯·æ±‚å‡åŒ€åˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å™¨ï¼Œé¿å…å•ç‚¹å‹åŠ›è¿‡å¤§ã€‚</p></li><li><p><strong>æ•°æ®åº“ä¼˜åŒ–</strong> ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢ï¼Œé¿å…å…¨è¡¨æ‰«æï¼Œä½¿ç”¨ç´¢å¼•ã€æŸ¥è¯¢ç¼“å­˜ç­‰æŠ€æœ¯æé«˜æ•°æ®åº“å“åº”é€Ÿåº¦ã€‚</p></li><li><p><strong>çº¿ç¨‹æ± é…ç½®</strong> é…ç½®é€‚å½“å¤§å°çš„çº¿ç¨‹æ± ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨é«˜å¹¶å‘ä¸‹èƒ½å¤Ÿé«˜æ•ˆå¤„ç†è¯·æ±‚ã€‚</p></li></ol><hr><h2 id="æ€»ç»“-6" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-6"><span>æ€»ç»“</span></a></h2><p>Spring MVC é¢è¯•é¢˜æ¶‰åŠçš„å†…å®¹æ¶µç›–äº†ä»æ¡†æ¶åŸç†ã€è¯·æ±‚è°ƒåº¦åˆ°æ€§èƒ½ä¼˜åŒ–ã€å¼‚å¸¸å¤„ç†ç­‰å¤šä¸ªæ–¹é¢ã€‚é€šè¿‡å¯¹è¿™äº›é—®é¢˜çš„æ·±å…¥ç†è§£å’ŒæŒæ¡ï¼Œä¸ä»…èƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°åº”å¯¹é¢è¯•ï¼Œè¿˜èƒ½å¤Ÿæå‡åœ¨å®é™…å¼€å‘ä¸­çš„è®¾è®¡ä¸ä¼˜åŒ–èƒ½åŠ›ã€‚æŒæ¡è¿™äº›å¸¸è§çš„é¢è¯•é¢˜ï¼Œä¸ä»…æ˜¯ç†è§£ Spring MVC çš„ä¸€ä¸ªçª—å£ï¼Œä¹Ÿæ˜¯æ·±å…¥å¼€å‘æŠ€èƒ½çš„ä¸€ä¸ªé‡è¦ç¯èŠ‚ã€‚</p><h2 id="åä¸‰ã€æœ€ä½³å®è·µä¸æ¶æ„å»ºè®®-1" tabindex="-1"><a class="header-anchor" href="#åä¸‰ã€æœ€ä½³å®è·µä¸æ¶æ„å»ºè®®-1"><span>åä¸‰ã€æœ€ä½³å®è·µä¸æ¶æ„å»ºè®®</span></a></h2><p>åœ¨å¼€å‘å¤§å‹ Spring MVC é¡¹ç›®æ—¶ï¼Œè‰¯å¥½çš„æ¶æ„è®¾è®¡å’Œå®è·µèƒ½å¸®åŠ©æå‡ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œæ€§èƒ½ã€‚æœ¬ç« å°†æ¢è®¨ä¸€äº›æœ€ä½³å®è·µä¸æ¶æ„å»ºè®®ï¼Œæ¶µç›– Controller å±‚è®¾è®¡ã€å“åº”å°è£…ã€æ¨¡å—åŒ–è®¾è®¡ä»¥åŠå¦‚ä½•ä½¿ç”¨æ‹¦æˆªå™¨ä¸ AOP è¿›è¡Œåˆ‡é¢é€»è¾‘å¤„ç†ç­‰å†…å®¹ã€‚</p><hr><h2 id="_1-åˆ†å±‚-controller-è®¾è®¡-api-å±‚ã€ä¸šåŠ¡å±‚è§£è€¦" tabindex="-1"><a class="header-anchor" href="#_1-åˆ†å±‚-controller-è®¾è®¡-api-å±‚ã€ä¸šåŠ¡å±‚è§£è€¦"><span>1. åˆ†å±‚ Controller è®¾è®¡ï¼šAPI å±‚ã€ä¸šåŠ¡å±‚è§£è€¦</span></a></h2><p>åœ¨ Spring MVC ä¸­ï¼ŒController å±‚é€šå¸¸ä¼šæ‰¿æ‹…å¤„ç† HTTP è¯·æ±‚ã€è§£æå‚æ•°ã€è°ƒç”¨ä¸šåŠ¡é€»è¾‘ç­‰è´£ä»»ã€‚ä¸ºäº†æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œçµæ´»æ€§ï¼Œå»ºè®®å°†ä¸šåŠ¡é€»è¾‘ä¸ Controller å±‚è§£è€¦ï¼Œé‡‡ç”¨åˆ†å±‚è®¾è®¡ã€‚</p><h3 id="åˆ†å±‚è®¾è®¡æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#åˆ†å±‚è®¾è®¡æ¦‚è¿°"><span><strong>åˆ†å±‚è®¾è®¡æ¦‚è¿°ï¼š</strong></span></a></h3><ol><li><strong>Controller å±‚</strong>ï¼šè´Ÿè´£æ¥æ”¶ HTTP è¯·æ±‚ï¼Œå‚æ•°æ ¡éªŒï¼Œè°ƒç”¨ä¸šåŠ¡é€»è¾‘ï¼Œæœ€ç»ˆè¿”å›è§†å›¾æˆ– JSON æ•°æ®ã€‚Controller å±‚åº”è¯¥å°½é‡ç²¾ç®€ï¼Œé¿å…ä¸šåŠ¡é€»è¾‘çš„å®ç°ã€‚</li><li><strong>Service å±‚</strong>ï¼šä¸šåŠ¡é€»è¾‘é€šå¸¸æ”¾åœ¨ Service å±‚ï¼ŒController åªè´Ÿè´£è°ƒç”¨ Service å±‚çš„æ–¹æ³•ï¼Œå¤„ç†å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚ã€‚è¿™æ ·ï¼Œä¸šåŠ¡é€»è¾‘å’Œ HTTP è¯·æ±‚çš„å¤„ç†è¢«è§£è€¦ï¼Œä½¿å¾—ä»£ç æ›´æ˜“äºæµ‹è¯•å’Œç»´æŠ¤ã€‚</li><li><strong>Repository å±‚</strong>ï¼šæ•°æ®æŒä¹…åŒ–å±‚ï¼Œè´Ÿè´£ä¸æ•°æ®åº“äº¤äº’ã€‚å¯ä»¥ä½¿ç”¨ Spring Data JPAã€MyBatis ç­‰æŒä¹…å±‚æ¡†æ¶ã€‚</li></ol><h4 id="ç¤ºä¾‹-controller-å±‚è°ƒç”¨-service-å±‚" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-controller-å±‚è°ƒç”¨-service-å±‚"><span>ç¤ºä¾‹ï¼šController å±‚è°ƒç”¨ Service å±‚</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Controller</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/user&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserService</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> userService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> UserController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">UserService</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> userService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">userService</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> userService;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/{id}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">ResponseBody</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> User</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getUser</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Long</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> userService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getUserById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(id);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-service-å±‚å®ç°" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-service-å±‚å®ç°"><span>ç¤ºä¾‹ï¼šService å±‚å®ç°</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Service</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserRepository</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> userRepository</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> UserService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">UserRepository</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> userRepository</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">userRepository</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> userRepository;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> User</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getUserById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Long</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> userRepository</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">findById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(id).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">orElseThrow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> UserNotFoundException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;User not found&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_2-ç»Ÿä¸€è¿”å›å€¼ç»“æ„ä¸å“åº”å°è£…æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_2-ç»Ÿä¸€è¿”å›å€¼ç»“æ„ä¸å“åº”å°è£…æ–¹æ¡ˆ"><span>2. ç»Ÿä¸€è¿”å›å€¼ç»“æ„ä¸å“åº”å°è£…æ–¹æ¡ˆ</span></a></h2><p>ä¸ºäº†ç¡®ä¿ç³»ç»Ÿä¸­çš„å“åº”æ ¼å¼ç»Ÿä¸€ï¼Œå»ºè®®é‡‡ç”¨ç»Ÿä¸€çš„å“åº”å°è£…æ–¹æ¡ˆã€‚æ— è®ºæ˜¯è¿”å›æ•°æ®ï¼Œè¿˜æ˜¯è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œç»Ÿä¸€çš„æ ¼å¼èƒ½å¤Ÿç®€åŒ–å‰ç«¯å¤„ç†å’Œè°ƒè¯•ã€‚</p><h3 id="ç»Ÿä¸€è¿”å›å€¼æ ¼å¼" tabindex="-1"><a class="header-anchor" href="#ç»Ÿä¸€è¿”å›å€¼æ ¼å¼"><span><strong>ç»Ÿä¸€è¿”å›å€¼æ ¼å¼</strong></span></a></h3><p>ä¸€ä¸ªå¸¸è§çš„ç»Ÿä¸€è¿”å›å€¼ç»“æ„å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ApiResponse</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> code</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> message</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> T</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ApiResponse</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> code</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> message</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">code</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> code;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">message</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> message;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">data</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> data;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // Getters and setters</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¤ºä¾‹-controller-å±‚è¿”å›ç»Ÿä¸€å“åº”" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-controller-å±‚è¿”å›ç»Ÿä¸€å“åº”"><span><strong>ç¤ºä¾‹ï¼šController å±‚è¿”å›ç»Ÿä¸€å“åº”</strong></span></a></h3><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Controller</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/user&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserService</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> userService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> UserController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">UserService</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> userService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">userService</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> userService;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/{id}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">ResponseBody</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ApiResponse</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">User</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getUser</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Long</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        User</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> user</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> userService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getUserById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(id);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ApiResponse</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Success&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, user);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ğŸ¯ <strong>å®è·µå»ºè®®</strong>ï¼š</p><ul><li>ä½¿ç”¨æ ‡å‡†çš„ HTTP çŠ¶æ€ç ï¼ˆå¦‚ 200ã€404ã€500ï¼‰è¡¨ç¤ºè¯·æ±‚å¤„ç†çŠ¶æ€ã€‚</li><li><code>code</code> å­—æ®µé€šå¸¸ç”¨äºæ ‡è¯†ä¸šåŠ¡é€»è¾‘çš„å¤„ç†ç»“æœã€‚</li><li><code>message</code> å­—æ®µç”¨äºæä¾›æ›´å¤šçš„é”™è¯¯ä¿¡æ¯æˆ–æˆåŠŸæç¤ºã€‚</li><li><code>data</code> å­—æ®µå­˜å‚¨è¿”å›çš„æ•°æ®å¯¹è±¡ã€‚</li></ul></blockquote><hr><h2 id="_3-æ¨¡å—åŒ–-mvc-æ¶æ„å»ºè®®-å¦‚å¤šæ¨¡å—æ§åˆ¶å™¨æ³¨å†Œ" tabindex="-1"><a class="header-anchor" href="#_3-æ¨¡å—åŒ–-mvc-æ¶æ„å»ºè®®-å¦‚å¤šæ¨¡å—æ§åˆ¶å™¨æ³¨å†Œ"><span>3. æ¨¡å—åŒ– MVC æ¶æ„å»ºè®®ï¼ˆå¦‚å¤šæ¨¡å—æ§åˆ¶å™¨æ³¨å†Œï¼‰</span></a></h2><p>å¯¹äºå¤§å‹åº”ç”¨ï¼Œé‡‡ç”¨æ¨¡å—åŒ–æ¶æ„æ˜¯éå¸¸å¿…è¦çš„ã€‚Spring MVC æ”¯æŒé€šè¿‡ä¸åŒçš„ <code>@Controller</code> å’Œ <code>@RequestMapping</code> å®ç°æ¨¡å—åŒ–çš„è¯·æ±‚æ˜ å°„ã€‚ä¸ºäº†æé«˜ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ï¼Œå»ºè®®å°†ä¸åŒåŠŸèƒ½æ¨¡å—çš„ Controller åˆ†å¼€ï¼ŒæŒ‰æ¨¡å—è¿›è¡Œç®¡ç†ã€‚</p><h3 id="æ¨¡å—åŒ–è®¾è®¡è¦ç‚¹" tabindex="-1"><a class="header-anchor" href="#æ¨¡å—åŒ–è®¾è®¡è¦ç‚¹"><span><strong>æ¨¡å—åŒ–è®¾è®¡è¦ç‚¹ï¼š</strong></span></a></h3><ol><li><strong>æ¯ä¸ªæ¨¡å—æ‹¥æœ‰è‡ªå·±çš„ Controller å±‚</strong>ï¼šä¾‹å¦‚ç”¨æˆ·ç®¡ç†ã€è®¢å•ç®¡ç†ç­‰åŠŸèƒ½æ¨¡å—åˆ†åˆ«æ‹¥æœ‰ç‹¬ç«‹çš„ Controller å±‚ã€‚</li><li><strong>ä½¿ç”¨ <code>@ComponentScan</code> æ‰«æä¸åŒæ¨¡å—çš„ Controller</strong>ï¼šé€šè¿‡ä¸åŒçš„é…ç½®ç±»æ‰«æä¸åŒçš„æ¨¡å—ï¼Œé¿å…æ··æ‚åœ¨ä¸€èµ·ã€‚</li><li><strong>æ¨¡å—é—´è§£è€¦</strong>ï¼šæ¯ä¸ªæ¨¡å—åº”è¯¥ç‹¬ç«‹å¼€å‘ï¼Œä¾èµ–æ¥å£è€Œéå®ç°ç±»ï¼Œé™ä½è€¦åˆåº¦ã€‚</li></ol><h4 id="ç¤ºä¾‹-æ¨¡å—åŒ–-controller-æ³¨å†Œ" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-æ¨¡å—åŒ–-controller-æ³¨å†Œ"><span>ç¤ºä¾‹ï¼šæ¨¡å—åŒ– Controller æ³¨å†Œ</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">ComponentScan</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">basePackages</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;com.example.user&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserModuleConfig</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // æ‰«æ User æ¨¡å—ç›¸å…³ç»„ä»¶</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">ComponentScan</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">basePackages</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;com.example.order&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> OrderModuleConfig</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // æ‰«æ Order æ¨¡å—ç›¸å…³ç»„ä»¶</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_4-å¦‚ä½•åˆç†ä½¿ç”¨æ‹¦æˆªå™¨ä¸-aop-åšåˆ‡é¢é€»è¾‘å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_4-å¦‚ä½•åˆç†ä½¿ç”¨æ‹¦æˆªå™¨ä¸-aop-åšåˆ‡é¢é€»è¾‘å¤„ç†"><span>4. å¦‚ä½•åˆç†ä½¿ç”¨æ‹¦æˆªå™¨ä¸ AOP åšåˆ‡é¢é€»è¾‘å¤„ç†</span></a></h2><h3 id="æ‹¦æˆªå™¨-interceptor-ä¸-aop-é¢å‘åˆ‡é¢ç¼–ç¨‹" tabindex="-1"><a class="header-anchor" href="#æ‹¦æˆªå™¨-interceptor-ä¸-aop-é¢å‘åˆ‡é¢ç¼–ç¨‹"><span><strong>æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰ä¸ AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰</strong></span></a></h3><p>åœ¨ Spring MVC ä¸­ï¼Œæ‹¦æˆªå™¨å’Œ AOP æä¾›äº†éå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬åœ¨è¯·æ±‚å¤„ç†çš„å„ä¸ªç¯èŠ‚æ’å…¥ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚æ—¥å¿—è®°å½•ã€æƒé™æ ¡éªŒã€äº‹åŠ¡ç®¡ç†ç­‰ã€‚</p><h4 id="æ‹¦æˆªå™¨-interceptor" tabindex="-1"><a class="header-anchor" href="#æ‹¦æˆªå™¨-interceptor"><span><strong>æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰</strong>ï¼š</span></a></h4><p>æ‹¦æˆªå™¨ç”¨äºå¤„ç†è¯·æ±‚å’Œå“åº”çš„é¢„å¤„ç†å’Œåå¤„ç†ã€‚é€šè¿‡å®ç° <code>HandlerInterceptor</code> æ¥å£ï¼Œå¯ä»¥åœ¨è¯·æ±‚åˆ°è¾¾æ§åˆ¶å™¨ä¹‹å‰ã€æ‰§è¡Œå®Œæ§åˆ¶å™¨æ–¹æ³•åã€è§†å›¾æ¸²æŸ“ä¹‹å‰è¿›è¡Œä¸€äº›æ“ä½œã€‚</p><h4 id="ç¤ºä¾‹-æ‹¦æˆªå™¨å®ç°" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-æ‹¦æˆªå™¨å®ç°"><span>ç¤ºä¾‹ï¼šæ‹¦æˆªå™¨å®ç°</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Component</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> AuthInterceptor</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> HandlerInterceptor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> preHandle</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // åœ¨è¯·æ±‚åˆ°è¾¾æ§åˆ¶å™¨ä¹‹å‰è¿›è¡Œæƒé™æ ¡éªŒ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getSession</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getAttribute</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;user&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sendRedirect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/login&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="aop-é¢å‘åˆ‡é¢ç¼–ç¨‹" tabindex="-1"><a class="header-anchor" href="#aop-é¢å‘åˆ‡é¢ç¼–ç¨‹"><span><strong>AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰</strong>ï¼š</span></a></h4><p>AOP æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹çš„æ ¸å¿ƒï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°æ’å…¥ç‰¹å®šè¡Œä¸ºåˆ°ç›®æ ‡æ–¹æ³•ä¸­ï¼Œå¸¸ç”¨äºæ—¥å¿—è®°å½•ã€æ€§èƒ½ç›‘æ§ã€äº‹åŠ¡ç®¡ç†ç­‰åœºæ™¯ã€‚</p><h4 id="ç¤ºä¾‹-ä½¿ç”¨-aop-è®°å½•æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-ä½¿ç”¨-aop-è®°å½•æ—¥å¿—"><span>ç¤ºä¾‹ï¼šä½¿ç”¨ AOP è®°å½•æ—¥å¿—</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Aspect</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Component</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> LoggingAspect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Before</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;execution(* com.example.*.*(..))&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> logBefore</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">JoinPoint</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> joinPoint</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Method &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> joinPoint</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getSignature</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot; is about to be executed&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">After</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;execution(* com.example.*.*(..))&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> logAfter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">JoinPoint</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> joinPoint</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Method &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> joinPoint</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getSignature</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot; has been executed&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ‹¦æˆªå™¨ä¸-aop-çš„é€‰æ‹©" tabindex="-1"><a class="header-anchor" href="#æ‹¦æˆªå™¨ä¸-aop-çš„é€‰æ‹©"><span><strong>æ‹¦æˆªå™¨ä¸ AOP çš„é€‰æ‹©</strong></span></a></h3><ul><li><strong>æ‹¦æˆªå™¨</strong>ï¼šé€‚ç”¨äºéœ€è¦å¯¹è¯·æ±‚ã€å“åº”è¿›è¡Œå¤„ç†ï¼Œæˆ–è€…åœ¨æ§åˆ¶å™¨æ–¹æ³•è°ƒç”¨å‰åè¿›è¡Œæ“ä½œã€‚</li><li><strong>AOP</strong>ï¼šé€‚ç”¨äºè·¨å¤šä¸ªæ–¹æ³•ã€ç±»çš„é€»è¾‘ï¼Œå¦‚æ—¥å¿—è®°å½•ã€äº‹åŠ¡å¤„ç†ç­‰ï¼ŒAOP å¯ä»¥åœ¨ä¸æ”¹å˜æ–¹æ³•é€»è¾‘çš„æƒ…å†µä¸‹å¢åŠ é¢å¤–åŠŸèƒ½ã€‚</li></ul><hr><h2 id="æ€»ç»“-7" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-7"><span>æ€»ç»“</span></a></h2><p>Spring MVC æä¾›äº†å¼ºå¤§çš„åŠŸèƒ½æ”¯æŒï¼Œä½†æ­£ç¡®çš„æ¶æ„è®¾è®¡å’Œå®è·µæ˜¯æå‡åº”ç”¨æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§çš„å…³é”®ã€‚é€šè¿‡åˆç†çš„ Controller å±‚åˆ†å±‚è®¾è®¡ã€ç»Ÿä¸€çš„å“åº”ç»“æ„ã€æ¨¡å—åŒ–æ¶æ„ä»¥åŠä½¿ç”¨æ‹¦æˆªå™¨ä¸ AOP è¿›è¡Œåˆ‡é¢é€»è¾‘å¤„ç†ï¼Œå¯ä»¥ä½¿å¾—ç³»ç»Ÿæ›´åŠ æ¸…æ™°ã€æ˜“äºæ‰©å±•å’Œç»´æŠ¤ã€‚è¿™äº›æœ€ä½³å®è·µå°†å¸®åŠ©å¼€å‘è€…åœ¨æ—¥å¸¸å¼€å‘ä¸­æ›´åŠ é«˜æ•ˆï¼ŒåŒæ—¶ä¸ºæ„å»ºé«˜è´¨é‡ã€å¯æ‰©å±•çš„åº”ç”¨æ‰“ä¸‹åšå®çš„åŸºç¡€ã€‚</p>`,624)]))}const r=i(e,[["render",h]]),d=JSON.parse('{"path":"/1.%E5%AD%A6%E4%B9%A0%E7%AF%87/2.Spring%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F/3.Spring%20MVC.html","title":"3.Spring MVC","lang":"en-US","frontmatter":{"title":"3.Spring MVC"},"git":{},"readingTime":{"minutes":57.45,"words":17234},"filePathRelative":"1.å­¦ä¹ ç¯‡/2.Springç”Ÿæ€ç³»ç»Ÿ/3.Spring MVC.md"}');export{r as comp,d as data};
