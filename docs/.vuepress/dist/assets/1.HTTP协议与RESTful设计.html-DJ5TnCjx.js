import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as n,o as t}from"./app-2aldPGZG.js";const h={};function e(l,s){return t(),a("div",null,s[0]||(s[0]=[n(`<h1 id="目录" tabindex="-1"><a class="header-anchor" href="#目录"><span>目录</span></a></h1><hr><h2 id="一、http协议基础与核心机制" tabindex="-1"><a class="header-anchor" href="#一、http协议基础与核心机制"><span><strong>一、HTTP协议基础与核心机制</strong></span></a></h2><p>• <strong>什么是HTTP？为什么它是Web的基石？</strong><br> • 无状态、请求-响应模型、基于TCP/IP的协议本质<br> • HTTP协议版本演进史（0.9 → 1.0 → 1.1 → 2 → 3）<br> • <strong>HTTP报文结构解剖</strong>：<br> • 请求行（方法、URI、版本）、状态行（状态码）、首部字段（Header）、实体主体（Body）<br> • 核心方法对比：GET（幂等） vs POST（非幂等） vs PUT/DELETE/PATCH<br> • <strong>HTTP/1.1核心机制</strong>：<br> • 持久连接（Keep-Alive）、管线化（Pipelining）与队头阻塞（Head-of-Line Blocking）<br> • 状态码实战：200（OK）、301（永久重定向）、429（限流）、503（服务不可用）<br> • <strong>企业级案例</strong>：电商API如何合理使用状态码（如库存不足返回409 Conflict）</p><hr><h2 id="二、restful设计原则与最佳实践" tabindex="-1"><a class="header-anchor" href="#二、restful设计原则与最佳实践"><span><strong>二、RESTful设计原则与最佳实践</strong></span></a></h2><p>• <strong>REST是什么？为什么不是RPC？</strong><br> • 核心约束：无状态、统一接口、资源标识（URI）、HATEOAS<br> • REST vs RPC（如Dubbo/gRPC）设计哲学对比<br> • <strong>RESTful API设计规范</strong>：<br> • URI命名规范（名词复数、层级结构、避免动词）<br> • 版本控制策略（URL路径、Header、Accept头）<br> • 数据格式选择：JSON（默认） vs Protocol Buffers（性能敏感场景）<br> • <strong>HATEOAS实战</strong>：如何在响应中嵌入资源链接（如分页导航<code>next</code>/<code>prev</code>）<br> • <strong>设计陷阱</strong>：过度设计（如滥用HATEOAS）、资源粒度控制（微服务拆分边界）</p><hr><h2 id="三、http-2与http-3的革命性改进" tabindex="-1"><a class="header-anchor" href="#三、http-2与http-3的革命性改进"><span><strong>三、HTTP/2与HTTP/3的革命性改进</strong></span></a></h2><p>• <strong>HTTP/2核心优化</strong>：<br> • 多路复用（Multiplexing）：解决队头阻塞、提升并发性能<br> • 头部压缩（HPACK算法）：减少冗余Header传输<br> • 服务器推送（Server Push）：预加载静态资源<br> • <strong>HTTP/3与QUIC协议</strong>：<br> • 基于UDP的传输层协议：解决TCP队头阻塞、0-RTT快速握手<br> • 企业级部署挑战：Nginx配置、CDN兼容性（如Cloudflare支持）<br> • <strong>性能对比实验</strong>：HTTP/1.1 vs HTTP/2 vs HTTP/3在1k并发下的延迟与吞吐量</p><hr><h2 id="四、restful-api安全与防御" tabindex="-1"><a class="header-anchor" href="#四、restful-api安全与防御"><span><strong>四、RESTful API安全与防御</strong></span></a></h2><p>• <strong>HTTPS配置实战</strong>：<br> • Let’s Encrypt免费证书申请、NginxLS 1.3<br> • 混合内容（Mixed Content）风险与解决方案<br> • <strong>OAuth2.1安全实践</strong>：<br> • 授权码模式+（防御授权码截获攻击）<br> • JWT签名算法选择（HS256 vs RS256）、Token绑定（TLS证书指纹）<br> • <strong>API安全加固</strong>：<br> • 速率限制（Rate Limiting）：令牌桶算法实现<br> • 输入校验与过滤：防御SQL注入、XSS（JSON响应转义）</p><hr><h2 id="五、性能优化与高并发场景实战" tabindex="-1"><a class="header-anchor" href="#五、性能优化与高并发场景实战"><span><strong>五、性能优化与高并发场景实战</strong></span></a></h2><p>• <strong>连接管理优化</strong>：<br> • TCP参数调优（Keep-Alive超时、最大连接数）<br> HTTP/2服务端配置（最大并发流、窗口大小）<br> • <strong>缓存策略设计</strong>：<br> • 客户端缓存（Cache-Control、ETag）、CDN缓存规则<br> • 服务端缓存：Redis缓存热点响应（如商品详情页）<br> • <strong>高并发场景设计</strong>：<br> • 异步处理：非阻塞IO（Netty）、CompletableFuture编排<br> • 降级与熔断：Sentinel动态规则配置（QPS超过阈值返回兜底数据）</p><hr><h2 id="六、常见问题与面试题精选" tabindex="-1"><a class="header-anchor" href="#六、常见问题与面试题精选"><span><strong>六、常见问题与面试题精选</strong></span></a></h2><p>• <strong>高频面试题</strong>：<br> • RESTful和RPC的区别是什么？各自适用什么场景？<br> • 如何设计一个符合HATEOAS的API？举例说明。<br> • HTTP/2多路复用如何解决队头阻塞？QUIC协议的优势是什么？<br> • 如何防御JWT令牌被盗用？<br> • <strong>实战场景题</strong>：<br> • 设计一个支持版本控制的用户管理API（包含分页和过滤条件）<br> • 优化一个慢查询的订单列表接口（从HTTP协议到数据库的全链路分析）<br> • <strong>陷阱题</strong>：<br> • 为什么HTTP/1.1的管线化（Pipelining）在实践中很少被使用？<br> • 在RESTful API中，为什么PUT被定义为幂等而POST不是？</p><hr><h1 id="http协议基础与核心机制" tabindex="-1"><a class="header-anchor" href="#http协议基础与核心机制"><span>HTTP协议基础与核心机制</span></a></h1><hr><h2 id="_1-什么是http-为什么它是web的基石" tabindex="-1"><a class="header-anchor" href="#_1-什么是http-为什么它是web的基石"><span>1.什么是HTTP？为什么它是Web的基石？</span></a></h2><p>• <strong>无状态协议</strong>：<br> • 每次请求独立，不保留上下文（如浏览网页时服务器不知道用户是否登录）。<br> • <strong>解决方式</strong>：通过Cookie、Session、Token（如JWT）实现状态管理。<br> • <strong>请求-响应模型</strong>：<br> • 客户端发起请求 → 服务器返回响应，单向通信（如浏览器请求HTML页面）。<br> • <strong>底层依赖</strong>：基于TCP协议（可靠传输），默认端口80（HTTP）和443（HTTPS）。<br> • <strong>协议本质</strong>：<br> • 文本协议（可读性强），通过纯文本报文传输数据（现代可扩展为二进制如HTTP/2）。</p><hr><h2 id="_2-http协议版本演进史" tabindex="-1"><a class="header-anchor" href="#_2-http协议版本演进史"><span>2.HTTP协议版本演进史</span></a></h2><table><thead><tr><th><strong>版本</strong></th><th><strong>核心改进</strong></th><th><strong>典型场景</strong></th></tr></thead><tbody><tr><td><strong>0.9</strong></td><td>仅支持GET方法，无Header，响应纯HTML</td><td>1991年，首个HTTP版本（极简）</td></tr><tr><td><strong>1.0</strong></td><td>支持POST/HEAD方法，引入Header、状态码、Content-Type</td><td>动态内容（如表单提交）</td></tr><tr><td><strong>1.1</strong></td><td>持久连接（Keep-Alive）、Host头支持虚拟主机</td><td>现代Web默认版本（兼容性强）</td></tr><tr><td><strong>2</strong></td><td>多路复用、头部压缩、服务器推送（Server Push）</td><td>高并发场景（如实时聊天、视频流）</td></tr><tr><td><strong>3</strong></td><td>基于QUIC协议（UDP）、0-RTT握手、抗丢包优化</td><td>移动端弱网环境（如5G网络波动）</td></tr></tbody></table><hr><h2 id="_3-http报文结构解剖" tabindex="-1"><a class="header-anchor" href="#_3-http报文结构解剖"><span>3.HTTP报文结构解剖</span></a></h2><h3 id="请求报文" tabindex="-1"><a class="header-anchor" href="#请求报文"><span>请求报文</span></a></h3><div class="language-http line-numbers-mode" data-highlighter="shiki" data-ext="http" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">GET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /api/products?id=123 HTTP/1.1  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Host</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> example.com</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">User-Agent</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Mozilla/5.0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Accept</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> application/json</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>• <strong>请求行</strong>：<br> • 方法：GET（查询）、POST（提交）、PUT（更新）、DELETE（删除）、PATCH（部分更新）。<br> • URI：资源路径（如<code>/api/products</code>）。<br> • 协议版本：HTTP/1.1 或 HTTP/2。<br> • <strong>请求头</strong>（Header）：<br> • Host：指定目标服务器域名（虚拟主机支持）。<br> • Content-Type：请求体数据类型（如<code>application/json</code>）。<br> • Authorization：身份凭证（如Bearer Token）。</p><h3 id="响应报文" tabindex="-1"><a class="header-anchor" href="#响应报文"><span>响应报文</span></a></h3><div class="language-http line-numbers-mode" data-highlighter="shiki" data-ext="http" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">HTTP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 200</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OK  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Content-Type</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> application/json</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Content-Length</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 128</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;id&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">123</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;name&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;手机&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>• <strong>状态行</strong>：<br> • 版本：HTTP/1.1。<br> • 状态码：200（成功）、404（未找到）、500（服务器错误）。<br> • 状态描述：OK、Not Found等。<br> • <strong>响应头</strong>：<br> • Content-Type：响应体数据类型（如<code>text/html</code>）。<br> • Cache-Control：缓存策略（如<code>max-age=3600</code>）。<br> • <strong>响应体</strong>：实际数据（如HTML、JSON、图片二进制流）。</p><hr><h2 id="http方法对比与幂等性" tabindex="-1"><a class="header-anchor" href="#http方法对比与幂等性"><span>HTTP方法对比与幂等性</span></a></h2><table><thead><tr><th><strong>方法</strong></th><th><strong>幂等性</strong></th><th><strong>语义</strong></th><th><strong>适用场景</strong></th></tr></thead><tbody><tr><td><strong>GET</strong></td><td>是</td><td>获取资源</td><td>查询商品详情、用户信息</td></tr><tr><td><strong>POST</strong></td><td>否</td><td>创建资源或触发操作</td><td>提交订单、上传文件</td></tr><tr><td><strong>PUT</strong></td><td>是</td><td>全量更新资源</td><td>修改用户全部信息</td></tr><tr><td><strong>PATCH</strong></td><td>否</td><td>部分更新资源</td><td>修改用户昵称</td></tr><tr><td><strong>DELETE</strong></td><td>是</td><td>删除资源</td><td>删除订单记录</td></tr></tbody></table><p><strong>幂等性定义</strong>：多次相同请求对资源状态的影响一致（如GET、PUT、DELETE）。</p><hr><h2 id="_4-http-1-1核心机制" tabindex="-1"><a class="header-anchor" href="#_4-http-1-1核心机制"><span>4.HTTP/1.1核心机制</span></a></h2><h3 id="持久连接-keep-alive" tabindex="-1"><a class="header-anchor" href="#持久连接-keep-alive"><span>持久连接（Keep-Alive）</span></a></h3><p>• <strong>作用</strong>：复用TCP连接，避免频繁握手（降低延迟）。<br> • <strong>Header控制</strong>：</p><div class="language-http line-numbers-mode" data-highlighter="shiki" data-ext="http" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Connection</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Keep-Alive</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Keep-Alive</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> timeout=30, max=100  // 30秒超时，最多100次请求</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>• <strong>性能提升</strong>：页面加载时间减少40%（对比HTTP/1.0短连接）。</p><h3 id="管线化-pipelining" tabindex="-1"><a class="header-anchor" href="#管线化-pipelining"><span>管线化（Pipelining）</span></a></h3><p>• <strong>原理</strong>：客户端一次性发送多个请求，无需等待响应（类似并发）。<br> • <strong>缺陷</strong>：队头阻塞（Head-of-Line Blocking）——首个请求延迟影响后续响应。<br> • <strong>实践限制</strong>：浏览器默认禁用（兼容性问题）。</p><p>###码实战<br> • <strong>200 OK</strong>：成功响应（如返回用户数据）。<br> • <strong>301 Moved Permanently</strong>：永久重定向（旧URL跳转至新URL）。<br> • <strong>429 Too Many Requests</strong>：请求频率超限（如API限流）。<br> • <strong>503 Service Unavailable</strong>：服务不可用（如服务器维护）。</p><hr><h2 id="_5-企业级案例-电商api状态码设计" tabindex="-1"><a class="header-anchor" href="#_5-企业级案例-电商api状态码设计"><span>5.企业级案例：电商API状态码设计</span></a></h2><p>• <strong>库存不足</strong>：</p><div class="language-http line-numbers-mode" data-highlighter="shiki" data-ext="http" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">HTTP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 409</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Conflict  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Content-Type</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> application/json</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;code&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;STOCK_LOW&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;message&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;库存不足&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>• <strong>参数校验失败</strong>：</p><div class="language-http line-numbers-mode" data-highlighter="shiki" data-ext="http" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">HTTP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 400</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Bad Request  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Content-Type</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> application/json</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;code&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;INVALID_PARAM&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;message&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;用户ID格式错误&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>• <strong>限流拦截</strong>：</p><div class="language-http line-numbers-mode" data-highlighter="shiki" data-ext="http" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">HTTP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 429</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Too Many Requests  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Retry-After</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 60  // 60秒后重试</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="二、restful设计原则与最佳实践-1" tabindex="-1"><a class="header-anchor" href="#二、restful设计原则与最佳实践-1"><span>二、RESTful设计原则与最佳实践</span></a></h1><hr><h2 id="_1-rest是什么-为什么不是rpc" tabindex="-1"><a class="header-anchor" href="#_1-rest是什么-为什么不是rpc"><span><strong>1. REST是什么？为什么不是RPC？</strong></span></a></h2><h3 id="rest的核心约束" tabindex="-1"><a class="header-anchor" href="#rest的核心约束"><span><strong>REST的核心约束</strong></span></a></h3><p>REST（<strong>Re</strong>presentational <strong>S</strong>tate <strong>T</strong>ransfer）是一种架构风格，定义了一组约束条件，用于构建可扩展、松耦合的分布式系统。其核心约束包括：</p><ol><li><p><strong>无状态（Stateless）</strong>：<br> • 服务端不保存客户端会话状态，每次请求必须包含所有必要信息（如Token、请求参数）。<br> • <strong>示例</strong>：用户登录后，每次请求需携带JWT令牌，而非依赖服务端Session。</p></li><li><p><strong>统一接口（Uniform Interface）</strong>：<br> • 资源通过URI标识（如<code>/users/123</code>），通过HTTP方法（GET/POST等）操作资源。<br> • <strong>示例</strong>：<code>DELETE /users/123</code> 表示删除ID为123的用户。</p></li><li><p><strong>资源标识（Resource Identification）</strong>：<br> • 所有数据抽象为资源，通过URI唯一标识。<br> • <strong>示例</strong>：<code>GET /orders/456</code> 获取ID为456的订单。</p></li><li><p><strong>HATEOAS（Hypermedia as the Engine of Application State）</strong>：<br> • 响应中嵌入资源链接，驱动客户端状态流转（如分页导航、关联资源跳转）。<br> • <strong>示例</strong>：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;order_id&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">456</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;_links&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;self&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;href&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/orders/456&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> },  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;payment&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;href&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/orders/456/payment&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr><h3 id="rest-vs-rpc-如dubbo-grpc" tabindex="-1"><a class="header-anchor" href="#rest-vs-rpc-如dubbo-grpc"><span><strong>REST vs RPC（如Dubbo/gRPC）</strong></span></a></h3><table><thead><tr><th><strong>维度</strong></th><th><strong>REST</strong></th><th><strong>RPC</strong></th></tr></thead><tbody><tr><td><strong>设计哲学</strong></td><td>资源为中心（操作围绕资源）</td><td>动作为中心（通过接口方法调用）</td></tr><tr><td><strong>协议</strong></td><td>基于HTTP/HTTPS（文本协议）</td><td>自定义协议（如gRPC基于HTTP/2，Protobuf编码）</td></tr><tr><td><strong>适用场景</strong></td><td>跨平台、松耦合（如开放API）</td><td>内部服务通信（高性能、强类型）</td></tr><tr><td><strong>典型框架</strong></td><td>Spring MVC、JAX-RS</td><td>Dubbo、gRPC、Thrift</td></tr></tbody></table><p><strong>案例对比</strong>：<br> • <strong>REST</strong>：电商平台开放商品查询API（<code>GET /products/{id}</code>）。<br> • <strong>RPC</strong>：内部支付服务调用（<code>PaymentService.pay(orderId)</code>）。</p><hr><h2 id="_2-restful-api设计规范" tabindex="-1"><a class="header-anchor" href="#_2-restful-api设计规范"><span><strong>2. RESTful API设计规范</strong></span></a></h2><h3 id="uri命名规范" tabindex="-1"><a class="header-anchor" href="#uri命名规范"><span><strong>URI命名规范</strong></span></a></h3><p>• <strong>名词复数</strong>：<br> • ✅ <code>/users</code>（资源集合）、<code>/users/123</code>（单个资源）。<br> • ❌ <code>/getUser</code>（含动词）、<code>/userList</code>（非复数）。<br> • <strong>层级结构</strong>：<br> • 资源嵌套关系：<code>/users/123/orders</code>（用户123的所有订单）。<br> • 避免过度嵌套：<code>/users/123/orders/456/items/789</code> → 拆分微服务接口。<br> • <strong>过滤与分页</strong>：<br> • 查询参数：<code>/users?role=admin&amp;page=2&amp;size=20</code>。</p><hr><h3 id="版本控制策略" tabindex="-1"><a class="header-anchor" href="#版本控制策略"><span><strong>版本控制策略</strong></span></a></h3><table><thead><tr><th><strong>方案</strong></th><th><strong>实现方式</strong></th><th><strong>优缺点</strong></th></tr></thead><tbody><tr><td><strong>URL路径</strong></td><td><code>/v1/users</code></td><td>简单直观，但破坏URI语义（版本与资源耦合）</td></tr><tr><td><strong>Header</strong></td><td><code>Accept: application/vnd.myapi.v1+json</code></td><td>URI纯净，但客户端需显式设置Header</td></tr><tr><td><strong>Accept头扩展</strong></td><td><code>Accept: application/json; version=1</code></td><td>兼容性好，但解析复杂</td></tr></tbody></table><p><strong>企业实践</strong>：<br> • 开放API（如GitHub）常用URL路径版本（<code>/v3/users</code>）。<br> • 内部服务推荐Header版本控制（保持URI稳定性）。</p><hr><h3 id="数据格式选择" tabindex="-1"><a class="header-anchor" href="#数据格式选择"><span><strong>数据格式选择</strong></span></a></h3><table><thead><tr><th><strong>格式</strong></th><th><strong>适用场景</strong></th><th><strong>性能对比</strong></th></tr></thead><tbody><tr><td><strong>JSON</strong></td><td>默认选择（易读、跨平台）</td><td>文本体积大，解析速度较慢</td></tr><tr><td><strong>Protocol Buffers</strong></td><td>高性能场景（如物联网、游戏）</td><td>二进制编码，体积小、解析快</td></tr><tr><td><strong>MessagePack</strong></td><td>需要兼顾性能与可读性</td><td>二进制，性能接近Protobuf</td></tr></tbody></table><p><strong>示例</strong>：</p><div class="language-http line-numbers-mode" data-highlighter="shiki" data-ext="http" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># JSON  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Content-Type</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> application/json</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;id&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">123</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;name&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;手机&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"># Protobuf  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Content-Type: application/x-protobuf  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;二进制数据&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_3-hateoas实战" tabindex="-1"><a class="header-anchor" href="#_3-hateoas实战"><span><strong>3. HATEOAS实战</strong></span></a></h2><h3 id="超媒体驱动设计" tabindex="-1"><a class="header-anchor" href="#超媒体驱动设计"><span><strong>超媒体驱动设计</strong></span></a></h3><p>• <strong>核心价值</strong>：客户端通过响应中的链接发现资源，而非硬编码URI。<br> • <strong>实现方式</strong>：在响应体中添加<code>_links</code>字段，描述关联资源。</p><p><strong>示例：分页导航</strong></p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;data&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: [  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;id&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;title&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;商品A&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> },  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;id&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;title&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;商品B&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  ],  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;_links&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;self&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;href&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/products?page=1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> },  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;next&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;href&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/products?page=2&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> },  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;prev&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;href&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/products?page=0&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="适用场景" tabindex="-1"><a class="header-anchor" href="#适用场景"><span><strong>适用场景</strong></span></a></h3><p>• <strong>复杂业务流程</strong>：订单创建后返回支付链接、物流查询链接。<br> • <strong>动态资源关系</strong>：社交平台用户主页关联“好友列表”“相册”链接。</p><hr><h2 id="_4-设计陷阱与规避方案" tabindex="-1"><a class="header-anchor" href="#_4-设计陷阱与规避方案"><span><strong>4. 设计陷阱与规避方案</strong></span></a></h2><h3 id="陷阱1-过度设计hateoas" tabindex="-1"><a class="header-anchor" href="#陷阱1-过度设计hateoas"><span><strong>陷阱1：过度设计HATEOAS</strong></span></a></h3><p>• <strong>问题</strong>：为所有资源添加链接，导致响应臃肿、客户端逻辑复杂化。<br> • <strong>规避</strong>：仅在资源关系动态变化时使用（如分页、状态流转）。</p><h3 id="陷阱2-资源粒度过细或过粗" tabindex="-1"><a class="header-anchor" href="#陷阱2-资源粒度过细或过粗"><span><strong>陷阱2：资源粒度过细或过粗</strong></span></a></h3><p>• <strong>问题</strong>：<br> • 过细：<code>/users/123/addresses/456</code> → 拆分微服务边界混乱。<br> • 过粗：<code>/users</code>返回用户所有信息（包含敏感字段）。<br> • <strong>规避</strong>：<br> • 按领域模型划分资源（DDD限界上下文）。<br> • 使用<code>fields</code>参数控制返回字段：<code>/users/123?fields=name,email</code>。</p><hr><h2 id="企业级案例-电商订单状态流转" tabindex="-1"><a class="header-anchor" href="#企业级案例-电商订单状态流转"><span><strong>企业级案例：电商订单状态流转</strong></span></a></h2><ol><li><strong>创建订单</strong>：<div class="language-http line-numbers-mode" data-highlighter="shiki" data-ext="http" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">POST</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /orders  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;product_id&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">789</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;quantity&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><strong>响应</strong>：<div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;order_id&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">456</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;status&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;CREATED&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;_links&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;payment&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;href&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/orders/456/payment&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> },  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;cancel&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;href&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/orders/456&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>支付订单</strong>：<div class="language-http line-numbers-mode" data-highlighter="shiki" data-ext="http" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">POST</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /orders/456/payment  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;amount&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;method&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;alipay&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><strong>响应</strong>：<div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;order_id&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">456</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;status&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;PAID&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;_links&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;shipping&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;href&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/orders/456/shipping&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span><strong>总结</strong></span></a></h2><p>RESTful设计不仅是URI命名和HTTP方法的使用，更是对资源抽象、状态管理和系统扩展性的深度思考。遵循核心约束，规避常见陷阱，才能构建出灵活、易维护的API系统。</p><h1 id="三、http-2与http-3的革命性改进-1" tabindex="-1"><a class="header-anchor" href="#三、http-2与http-3的革命性改进-1"><span>三、HTTP/2与HTTP/3的革命性改进</span></a></h1><hr><h2 id="http-2核心优化" tabindex="-1"><a class="header-anchor" href="#http-2核心优化"><span><strong>HTTP/2核心优化</strong></span></a></h2><h3 id="_1-多路复用-multiplexing" tabindex="-1"><a class="header-anchor" href="#_1-多路复用-multiplexing"><span><strong>1. 多路复用（Multiplexing）</strong></span></a></h3><p>• <strong>问题背景</strong>：HTTP/1.1的队头阻塞（Head-of-Line Blocking）导致并发性能低下（同一TCP连接中，前序请求延迟会阻塞后续请求）。<br> • <strong>解决方案</strong>：<br> • <strong>多路复用</strong>：在单个TCP连接上并行传输多个请求/响应，无需按顺序等待。<br> • <strong>帧（Frame）机制</strong>：将HTTP报文拆分为二进制帧（Header Frame、Data Frame），通过流（Stream）标识符区分不同请求。<br> • <strong>性能提升</strong>：<br> • 页面加载时间减少30%~50%（尤其是资源密集型站点）。<br> 示例：一个页面加载10个资源，HTTP/1.1需6个TCP连接，HTTP/2仅需1个。</p><hr><h3 id="_2-头部压缩-hpack算法" tabindex="-1"><a class="header-anchor" href="#_2-头部压缩-hpack算法"><span><strong>2. 头部压缩（HPACK算法）</strong></span></a></h3><p>• <strong>问题背景</strong>：HTTP/1.1头部冗余（如Cookie、User-Agent重复传输）浪费带宽。<br> • <strong>解决方案</strong>：<br> • <strong>静态表</strong>：预定义61个常用Header字段（如<code>:method: GET</code>、<code>:path: /</code>）。<br> • <strong>动态表</strong>：缓存本次连接中发送过的Header字段，后续复用索引。<br> • <strong>Huffman编码</strong>：压缩字符，减少体积。<br> • <strong>压缩效果</strong>：<br> • 首次请求：头部体积减少约30%。<br> • 后续请求：减少90%（利用动态表缓存）。</p><hr><h3 id="_3-服务器推送-server-push" tabindex="-1"><a class="header-anchor" href="#_3-服务器推送-server-push"><span><strong>3. 服务器推送（Server Push）</strong></span></a></h3><p>• <strong>问题背景</strong>：传统模式需客户端解析HTML后，再请求CSS/JS等资源，增加RTT（Round-Trip Time）。<br> • <strong>解决方案</strong>：服务器主动推送关联资源，减少额外请求。<br> • <strong>实现示例</strong>：</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Nginx配置推送main.css  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">http2_push </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/static/main.css;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>• <strong>适用场景</strong>：<br> • 静态资源预加载（如首页CSS、JS、字体）。<br> • <strong>注意</strong>：过度推送会导致带宽浪费（需合理控制推送策略）。</p><hr><h2 id="http-3与quic协议" tabindex="-1"><a class="header-anchor" href="#http-3与quic协议"><span><strong>HTTP/3与QUIC协议</strong></span></a></h2><h3 id="_1-quic协议核心优势" tabindex="-1"><a class="header-anchor" href="#_1-quic协议核心优势"><span><strong>1. QUIC协议核心优势</strong></span></a></h3><p>• <strong>基于UDP</strong>：绕过TCP队头阻塞，独立管理流（Stream）传输。<br> • <strong>多路复用改进</strong>：每个流独立处理，单个流丢包不影响其他流。<br> • <strong>0-RTT握手</strong>：<br> • 首次连接：1-RTT（类似TCP+TLS）。<br> • 重连：0-RTT（缓存会话信息，立即发送数据）。<br> • <strong>案例</strong>：移动端网络切换（Wi-Fi→4G）后快速恢复连接。<br> • <strong>连接迁移</strong>：客户端IP变化时，连接无需重建（基于Connection ID标识）。</p><hr><h3 id="_2-企业级部署挑战" tabindex="-1"><a class="header-anchor" href="#_2-企业级部署挑战"><span><strong>2. 企业级部署挑战</strong></span></a></h3><p>• <strong>Nginx配置</strong>：</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启用HTTP/3  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">listen </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">443</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> quic reuseport;  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">listen </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">443</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ssl;  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ssl_protocols </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">TLSv1.3;  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">add_header </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Alt-Svc </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;h3=&quot;:443&quot;; ma=86400&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>• <strong>CDN兼容性</strong>：<br> • Cloudflare、Google Cloud已支持HTTP/3。<br> • 阿里云/腾讯云部分节点支持（需申请白名单）。<br> • <strong>调试工具</strong>：<br> • Wireshark（需安装QUIC插件）。<br> • Chrome浏览器：<code>chrome://flags/#enable</code> 启用QUIC协议。</p><hr><h2 id="性能对比实验" tabindex="-1"><a class="header-anchor" href="#性能对比实验"><span><strong>性能对比实验</strong></span></a></h2><h3 id="实验设计" tabindex="-1"><a class="header-anchor" href="#实验设计"><span><strong>实验设计</strong></span></a></h3><p>• <strong>环境</strong>：<br> • 服务端：Nginx 1.25 + 10Gbps带宽。<br> • 客户端：Apache Bench（ab）模拟1k并发请求。<br> • <strong>测试接口</strong>：返回10KB JSON数据。</p><h3 id="结果数据" tabindex="-1"><a class="header-anchor" href="#结果数据"><span><strong>结果数据</strong></span></a></h3><table><thead><tr><th><strong>协议</strong></th><th>平均延迟（ms）</th><th>吞吐量（req/s）</th><th>资源占用（CPU%）</th></tr></thead><tbody><tr><td><strong>HTTP/1.1</strong></td><td>120</td><td>8,500</td><td>75</td></tr><tr><td><strong>HTTP/2</strong></td><td>45</td><td>22,000</td><td>65</td></tr><tr><td><strong>HTTP/3</strong></td><td>30</td><td>28,000</td><td>60</td></tr></tbody></table><h3 id="结论" tabindex="-1"><a class="header-anchor" href="#结论"><span><strong>结论</strong></span></a></h3><p>• <strong>HTTP/2</strong>：显著降低延迟（减少62%）、提升吞吐量（2.5倍）。<br> • <strong>HTTP/3</strong>：进一步优化弱网性能（丢包率5%时，吞吐量比HTTP/2高30%）。</p><hr><h2 id="企业级案例-视频直播平台优化" tabindex="-1"><a class="header-anchor" href="#企业级案例-视频直播平台优化"><span><strong>企业级案例：视频直播平台优化</strong></span></a></h2><p>• <strong>痛点</strong>：<br> • 移动端网络波动导致卡顿（TCP重传效率低）。<br> • 高并发场景下服务器资源占用高。<br> • <strong>方案</strong>：<br> -流协议切换为HTTP/3（QUIC），减少卡顿率。<br> • 静态资源（如封面图）启用服务器推送，首屏加载时间降低40%。<br> • <strong>配置示例</strong>：</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 视频流媒体服务器配置  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">http3 </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">http3_hq </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">http3_stream_buffer_size </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1m</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="总结-1" tabindex="-1"><a class="header-anchor" href="#总结-1"><span><strong>总结</strong></span></a></h2><p>HTTP/2通过多路复用、头部压缩和服务器推送，解决了HTTP/1.1的性能瓶颈；HTTP/3基于QUIC协议，进一步优化传输层，成为移动互联网时代的下一代协议标准。企业需根据业务场景（如高并发API、实时音视频）选择合适的协议，并关注CDN和云服务商的支持进展。</p><h1 id="四、restful-api安全与防御-1" tabindex="-1"><a class="header-anchor" href="#四、restful-api安全与防御-1"><span>四、RESTful API安全与防御</span></a></h1><hr><h2 id="_1-https配置实战" tabindex="-1"><a class="header-anchor" href="#_1-https配置实战"><span><strong>1. HTTPS配置实战</strong></span></a></h2><h3 id="let-s-encrypt免费证书申请" tabindex="-1"><a class="header-anchor" href="#let-s-encrypt免费证书申请"><span><strong>Let’s Encrypt免费证书申请</strong></span></a></h3><ol><li><strong>安装Certbot工具</strong>：<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Ubuntu/Debian  </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> certbot</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> python3-certbot-nginx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># CentOS  </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> certbot</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> python3-certbot-nginx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>申请证书</strong>：<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> certbot</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> example.com</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> www.example.com</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>• 自动验证域名所有权（需提前配置DNS解析）。<br> • 证书存储路径：<code>/etc/letsencrypt/live/example.com/</code>。</li><li><strong>自动续期</strong>：<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 添加定时任务（每月续期）  </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> crontab</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> certbot</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> renew</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --quiet</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr><h3 id="nginx-tls-1-3配置" tabindex="-1"><a class="header-anchor" href="#nginx-tls-1-3配置"><span><strong>Nginx TLS 1.3配置</strong></span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    listen </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">443</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ssl;  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server_name </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">example.com;  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    ssl_certificate </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/etc/letsencrypt/live/example.com/fullchain.pem;  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    ssl_certificate_key </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/etc/letsencrypt/live/example.com/privkey.pem;  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 强制TLS 1.3 + 1.2兼容  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    ssl_protocols </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">TLSv1.3 TLSv1.2;  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 高性能加密套件  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    ssl_ciphers </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384;  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    ssl_prefer_server_ciphers </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 启用OCSP Stapling（减少握手延迟）  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    ssl_stapling </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    ssl_stapling_verify </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    resolver </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8.8.8.8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> valid=300s;  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="混合内容-mixed-content-风险与解决方案" tabindex="-1"><a class="header-anchor" href="#混合内容-mixed-content-风险与解决方案"><span><strong>混合内容（Mixed Content）风险与解决方案</strong></span></a></h3><p>• <strong>风险</strong>：HTTPS页面中加载HTTP资源（如图片、JS脚本），导致浏览器警告或功能失效。<br> • <strong>解决方案</strong>：</p><ol><li><strong>内容安全策略（CSP）</strong>：强制所有资源通过HTTPS加载。<div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">meta</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> http-equiv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Content-Security-Policy&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> content</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;default-src https:&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><strong>Nginx自动重定向HTTP请求</strong>：<div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    listen </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">80</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server_name </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">example.com;  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 301</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> https://$</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">host</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">request_uri</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>前端代码审查</strong>：确保所有API调用、图片/脚本引用使用相对协议（<code>//example.com/resource</code>）。</li></ol><hr><h2 id="_2-oauth2-1安全实践" tabindex="-1"><a class="header-anchor" href="#_2-oauth2-1安全实践"><span><strong>2. OAuth2.1安全实践</strong></span></a></h2><h3 id="授权码模式-pkce-防御授权码截获攻击" tabindex="-1"><a class="header-anchor" href="#授权码模式-pkce-防御授权码截获攻击"><span><strong>授权码模式+PKCE（防御授权码截获攻击）</strong></span></a></h3><ol><li><strong>PKCE流程</strong>：<br> • <strong>步骤1</strong>：客户端生成随机字符串<code>code_verifier</code>（如<code>k4s8d9...</code>）。<br> • <strong>步骤2</strong>：计算<code>code_challenge = SHA256(code_verifier)</code>，Base64编码。<br> • <strong>步骤3</strong>：授权请求携带<code>code_challenge</code>：<div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>GET /auth?response_type=code&amp;client_id=web&amp;code_challenge=k4s8d9...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>• <strong>步骤4</strong>：令牌请求提交<code>code_verifier</code>，服务器验证<code>code_challenge</code>合法性。</li><li><strong>代码示例</strong>（Spring Security OAuth2.1）：<div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 生成code_verifier  </span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> codeVerifier </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> SecureRandomString</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">generate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 计算code_challenge  </span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> codeChallenge </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Base64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getUrlEncoder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">encodeToString</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    MessageDigest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getInstance</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;SHA-256&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">digest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">codeVerifier</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBytes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">())  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr><h3 id="jwt签名算法选择与token绑定" tabindex="-1"><a class="header-anchor" href="#jwt签名算法选择与token绑定"><span><strong>JWT签名算法选择与Token绑定</strong></span></a></h3><table><thead><tr><th><strong>算法</strong></th><th><strong>类型</strong></th><th><strong>适用场景</strong></th><th><strong>安全性</strong></th></tr></thead><tbody><tr><td><strong>HS256</strong></td><td>对称加密</td><td>内部服务通信（需安全存储密钥）</td><td>密钥泄露风险高</td></tr><tr><td><strong>RS256</strong></td><td>非对称加密</td><td>开放API（公钥可公开分发）</td><td>私钥保护，安全性更高</td></tr></tbody></table><p>• <strong>Token绑定（Token Binding）</strong>：<br> • <strong>原理</strong>：将JWT与TLS会话绑定，防止令牌被窃取后重放。<br> • <strong>实现</strong>：在JWT Claims中添加TLS证书指纹（如<code>tbs</code>字段）。</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;sub&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;user123&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;tbs&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;sha256:9f86d081...&quot;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // TLS证书指纹  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_3-api安全加固" tabindex="-1"><a class="header-anchor" href="#_3-api安全加固"><span><strong>3. API安全加固</strong></span></a></h2><h3 id="速率限制-令牌桶算法实现" tabindex="-1"><a class="header-anchor" href="#速率限制-令牌桶算法实现"><span><strong>速率限制（令牌桶算法实现）</strong></span></a></h3><p>• <strong>Redis + Lua脚本实现</strong>：</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 令牌桶算法（每秒10个请求）  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">KEYS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]        </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 客户端IP或Token  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> limit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">tonumber</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">])  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> interval</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">tonumber</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">])  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> current</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;GET&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> current</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> and </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">tonumber</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">current</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) &gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">limit</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> then</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;INCR&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;EXPIRE&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">interval</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>• <strong>Spring Boot集成</strong>：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Bean</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> RateLimiter</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> rateLimiter</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">RedisConnectionFactory</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> factory) {  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RedisRateLimiter</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(factory</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // 10 req/s  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="输入校验与过滤" tabindex="-1"><a class="header-anchor" href="#输入校验与过滤"><span><strong>输入校验与过滤</strong></span></a></h3><ol><li><p><strong>防御SQL注入</strong>：<br> • <strong>MyBatis参数化查询</strong>：</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">select</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;getUser&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> resultType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;User&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    SELECT * FROM users WHERE id = #{id} </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">&lt;!-- 安全 --&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    &lt;!-- ❌ 错误示例：SELECT * FROM users WHERE id = \${id} --&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">select</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>• <strong>JPA预编译</strong>：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Query</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;SELECT u FROM User u WHERE u.name = :name&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">User</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> findByName</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Param</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;name&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> name)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>防御XSS（JSON响应转义）</strong>：<br> • <strong>Spring Boot配置</strong>：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Bean</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> HttpMessageConverters</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> httpMessageConverters</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">() {  </span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Jackson2ObjectMapperBuilder</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> builder </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Jackson2ObjectMapperBuilder</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    builder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">featuresToEnable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">JsonGenerator</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Feature</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">ESCAPE_NON_ASCII</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> HttpMessageConverters</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> MappingJackson2HttpMessageConverter</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">builder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">build</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">))</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>• <strong>输出示例</strong>：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;content&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&lt;script&gt;alert(1)&lt;/script&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // 转义后 → &quot;content&quot;: &quot;&amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt;&quot;  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr><h2 id="企业级案例-电商支付api安全加固" tabindex="-1"><a class="header-anchor" href="#企业级案例-电商支付api安全加固"><span><strong>企业级案例：电商支付API安全加固</strong></span></a></h2><ol><li><strong>HTTPS配置</strong>：<br> • 全站强制TLS 1.3，启用HSTS头部（<code>Strict-Transport-Security: max-age=31536000</code>）。</li><li><strong>OAuth2.1接入</strong>：<br> • 支付接口使用<code>RS256</code>签名JWT，绑定客户端TLS证书指纹。</li><li><strong>限流策略</strong>：<br> • 用户级限流：10次/秒，IP级限流：100次/秒（防止爬虫刷单）。</li><li><strong>输入校验</strong>：<br> • 订单金额校验（&gt;0且≤账户余额）、商品ID白名单过滤。</li></ol><hr><h2 id="总结-2" tabindex="-1"><a class="header-anchor" href="#总结-2"><span><strong>总结</strong></span></a></h2><p>API安全需从传输层（HTTPS）、身份认证（OAuth2.1）、请求防护（限流/校验）三个维度综合防御。Let’s Encrypt与Nginx的TLS 1.3配置保障通信安全，OAuth2.1的PKCE机制和JWT绑定提升认证可靠性，输入校验与限流策略则直接拦截恶意攻击。企业应根据业务场景选择合适方案，并通过自动化工具持续监控安全状态。</p><h1 id="五、性能优化与高并发场景实战-1" tabindex="-1"><a class="header-anchor" href="#五、性能优化与高并发场景实战-1"><span>五、性能优化与高并发场景实战</span></a></h1><hr><h2 id="_1-连接管理优化" tabindex="-1"><a class="header-anchor" href="#_1-连接管理优化"><span><strong>1. 连接管理优化</strong></span></a></h2><h3 id="tcp参数调优" tabindex="-1"><a class="header-anchor" href="#tcp参数调优"><span><strong>TCP参数调优</strong></span></a></h3><p>• <strong>Keep-Alive超时</strong>：</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Nginx配置（单位：秒）  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">keepalive_timeout </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">30</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;     </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 连接保持30秒  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">keepalive_requests </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 单个连接最多处理1000个请求</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>• <strong>优化效果</strong>：减少TCP握手次数，降低延迟（提升吞吐量20%~30%）。<br> • <strong>最大连接数</strong>：</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">worker_processes </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">auto;  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">worker_connections </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10240</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 每个Worker进程处理10240个连接</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>• <strong>公式</strong>：最大并发连接数 = <code>worker_processes * worker_connections</code>。</p><hr><h3 id="http-2服务端配置" tabindex="-1"><a class="header-anchor" href="#http-2服务端配置"><span><strong>HTTP/2服务端配置</strong></span></a></h3><p>• <strong>最大并发流（Max Concurrent Streams）</strong>：</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">http2_max_concurrent_streams </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 单个连接允许128个并发流</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>• <strong>场景</strong>：高并发API接口（如实时消息推送）。<br> • <strong>流窗口大小（Stream Window Size）</strong>：</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">http2_stream_window_size</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 512k</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 提升窗口大小减少ACK等待</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>• <strong>影响</strong>：提升大文件传输效率（如视频分片---</p><h2 id="_2-缓存策略设计" tabindex="-1"><a class="header-anchor" href="#_2-缓存策略设计"><span><strong>2. 缓存策略设计</strong></span></a></h2><h3 id="客户端缓存" tabindex="-1"><a class="header-anchor" href="#客户端缓存"><span><strong>客户端缓存</strong></span></a></h3><p>• <strong>Cache-Control策略</strong>：</p><div class="language-http line-numbers-mode" data-highlighter="shiki" data-ext="http" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Cache-Control</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> max-age=3600, public  # 缓存1小时，允许CDN和浏览器缓存</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>• <strong>指令详解</strong>：<br> ◦ <code>no-store</code>：禁止缓存（敏感数据）。<br> ◦ <code>must-revalidate</code>：过期后必须回源验证。<br> • <strong>ETag验证</strong>：</p><div class="language-http line-numbers-mode" data-highlighter="shiki" data-ext="http" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ETag</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;6273b-dqwe-9f0e5396f5c00&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">If-None-Match</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;6273b-dqwe-9f0e5396f5c00&quot;  # 客户端携带ETag，304 Not Modified时复用缓存</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="cdn缓存规则" tabindex="-1"><a class="header-anchor" href="#cdn缓存规则"><span><strong>CDN缓存规则</strong></span></a></h3><p>• <strong>边缘节点缓存</strong>：<br> • 静态资源（如图片、JS/CSS）缓存7天。<br> • 动态API（如商品详情）缓存5秒（<code>Cache-Control: max-age=5</code>）。<br> • <strong>刷新机制</strong>：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 强制刷新CDN缓存  </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">curl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -X</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> POST</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;https://api.cdn.com/purge?url=https://example.com/product/123&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="服务端缓存-redis" tabindex="-1"><a class="header-anchor" href="#服务端缓存-redis"><span><strong>服务端缓存（Redis）</strong></span></a></h3><p>• <strong>热点数据缓存</strong>：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 商品详情缓存逻辑（Spring Boot + RedisTemplate）  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Product</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getProduct</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> id) {  </span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> key </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;product:&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Product</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> product </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> redisTemplate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">opsForValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(key);</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (product </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">        product </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> db</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;SELECT * FROM products WHERE id = ?&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, id);</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        redisTemplate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">opsForValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(key, product, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">30</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">TimeUnit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">MINUTES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> product</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>• <strong>缓存击穿防御</strong>：<br> • <strong>互斥锁</strong>：Redisson分布式锁防止大量请求穿透到数据库。<br> • <strong>逻辑过期</strong>：缓存永不过期，后台异步更新数据。</p><hr><h2 id="_3-高并发场景设计" tabindex="-1"><a class="header-anchor" href="#_3-高并发场景设计"><span><strong>3. 高并发场景设计</strong></span></a></h2><h3 id="异步处理-非阻塞io" tabindex="-1"><a class="header-anchor" href="#异步处理-非阻塞io"><span><strong>异步处理（非阻塞IO）</strong></span></a></h3><p>• <strong>Netty核心模型</strong>：<br> • <strong>Boss线程组</strong>：接收连接（1~2个线程）。<br> • <strong>Worker线程组</strong>：处理I/O事件（CPU核心数×2）。<br> • <strong>业务线程池</strong>：执行耗时操作（如数据库查询）。<br> • <strong>配置示例</strong>：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">EventLoopGroup</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> bossGroup </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> NioEventLoopGroup</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">EventLoopGroup</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> workerGroup </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> NioEventLoopGroup</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ServerBootstrap</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> bootstrap </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ServerBootstrap</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">bootstrap</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">group</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(bossGroup, workerGroup)</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">         .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">channel</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">NioServerSocketChannel</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">         .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">childHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ChannelInitializer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">SocketChannel</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;() {  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">             @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">             protected</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> initChannel</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">SocketChannel</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> ch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                 ch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pipeline</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addLast</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> HttpServerCodec</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                 ch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pipeline</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addLast</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> HttpObjectAggregator</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">65536</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">));  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                 ch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pipeline</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addLast</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> BusinessHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">             }  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">         });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="completablefuture编排" tabindex="-1"><a class="header-anchor" href="#completablefuture编排"><span><strong>CompletableFuture编排</strong></span></a></h3><p>• <strong>订单支付异步化</strong>：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> CompletableFuture</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">Order</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> payAsync</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Order</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> order) {  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> CompletableFuture</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">supplyAsync</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        checkBalance</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">order</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getUserId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">order</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getAmount</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 异步校验余额  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> paymentService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pay</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(order);                   </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 异步支付  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }, executor).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">exceptionally</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ex </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;支付失败&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, ex);  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    });</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="降级与熔断-sentinel" tabindex="-1"><a class="header-anchor" href="#降级与熔断-sentinel"><span><strong>降级与熔断（Sentinel）</strong></span></a></h3><p>• <strong>动态规则配置</strong>：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 定义资源名  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">SentinelResource</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;queryOrder&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> fallback</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;fallbackMethod&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Order</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> queryOrder</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> orderId) {  </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 数据库查询逻辑  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 降级方法  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Order</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> fallbackMethod</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> orderId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Throwable</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> ex) {  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> cache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(orderId);</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // 返回缓存数据  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>• <strong>熔断策略</strong>：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// QPS超过100触发熔断  </span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">List</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">FlowRule</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> rules </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ArrayList</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">FlowRule</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> rule </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> FlowRule</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">rule</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setResource</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;queryOrder&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">rule</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setGrade</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">RuleConstant</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">FLOW_GRADE_QPS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">rule</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setCount</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">rules</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(rule);</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">FlowRuleManager</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">loadRules</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(rules);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_4-企业级案例-电商秒杀系统" tabindex="-1"><a class="header-anchor" href="#_4-企业级案例-电商秒杀系统"><span><strong>4. 企业级案例：电商秒杀系统</strong></span></a></h2><h3 id="架构设计" tabindex="-1"><a class="header-anchor" href="#架构设计"><span><strong>架构设计</strong></span></a></h3><ol><li><strong>流量削峰</strong>：<br> • <strong>队列缓冲</strong>：请求写入RabbitMQ，异步处理订单。<br> • <strong>令牌桶限流</strong>：每秒放行1000个请求，其余返回“活动太火爆”。</li><li><strong>库存扣减</strong>：<br> • <strong>Redis预扣减</strong>：Lua脚本保证原子性。<div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;GET&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;stock&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) &gt;= </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> then</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;DECR&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;stock&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>降级策略</strong>：<br> • <strong>熔断规则</strong>：QPS超过阈值时返回兜底页面（静态HTML）。<br> • <strong>服务隔离</strong>：秒杀服务独立部署，避免影响主站。</li></ol><h3 id="性能数据" tabindex="-1"><a class="header-anchor" href="#性能数据"><span><strong>性能数据</strong></span></a></h3><table><thead><tr><th><strong>优化手段</strong></th><th>延迟（ms）</th><th>吞吐量（req/s）</th></tr></thead><tbody><tr><td>原始方案（同步）</td><td>350</td><td>1,200</td></tr><tr><td>异步+Redis预扣减</td><td>85</td><td>8,500</td></tr><tr><td>队列削峰+限流</td><td>120</td><td>12,000</td></tr></tbody></table><hr><h2 id="总结-3" tabindex="-1"><a class="header-anchor" href="#总结-3"><span><strong>总结</strong></span></a></h2><p>性能优化需从连接管理、缓存设计、异步处理、熔断降级四个维度切入：</p><ol><li><strong>连接管理</strong>：TCP参数调优与HTTP/2配置降低网络开销。</li><li><strong>缓存策略</strong>：客户端缓存减少请求数，服务端缓存降低DB压力。</li><li><strong>异步编排</strong>：Netty非阻塞IO提升吞吐量，CompletableFuture解耦耗时操作。</li><li><strong>熔断降级</strong>：Sentinel动态规则保障核心业务可用性。<br> 企业应根据场景（如秒杀、实时推送）选择合适方案，并通过压测验证效果。</li></ol><h1 id="六、常见问题与面试题精选-1" tabindex="-1"><a class="header-anchor" href="#六、常见问题与面试题精选-1"><span><strong>六、常见问题与面试题精选</strong></span></a></h1><hr><h2 id="高频面试题" tabindex="-1"><a class="header-anchor" href="#高频面试题"><span><strong>高频面试题</strong></span></a></h2><h4 id="_1-restful和rpc的区别是什么-各自适用什么场景" tabindex="-1"><a class="header-anchor" href="#_1-restful和rpc的区别是什么-各自适用什么场景"><span><strong>1. RESTful和RPC的区别是什么？各自适用什么场景？</strong></span></a></h4><p>• <strong>核心区别</strong>：<br> • <strong>REST</strong>：以资源为中心，使用标准HTTP方法（GET/POST等），通过URI标识资源，强调无状态和统一接口。<br> • <strong>RPC</strong>：以动作为中心，通过自定义方法调用（如<code>userService.getUser(id)</code>），通常基于二进制协议（如gRPC）。<br> • ****：<br> • <strong>REST</strong>：跨平台、松耦合的开放API（如电商商品查询）。<br> • <strong>RPC</strong>：内部服务通信，追求高性能和强类型（如支付服务调用）。<br> • <strong>示例</strong>：<br> • REST：<code>GET /users/123</code> 获取用户信息。<br> • RPC：<code>PaymentService.pay(orderId, amount)</code>。</p><hr><h2 id="_2-如何设计一个符合hateoas的api-举例说明" tabindex="-1"><a class="header-anchor" href="#_2-如何设计一个符合hateoas的api-举例说明"><span><strong>2. 如何设计一个符合HATEOAS的API？举例说明</strong></span></a></h2><p>• <strong>设计步骤</strong>：</p><ol><li>在响应中嵌入<code>_links</code>字段，描述关联资源。</li><li>使用标准关系名（如<code>self</code>、<code>next</code>、<code>prev</code>）。<br> • <strong>示例</strong>：</li></ol><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;order_id&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">456</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;status&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;PAID&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;_links&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;self&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;href&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/orders/456&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> },  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;payment&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;href&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/orders/456/payment&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> },  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;cancel&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;href&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/orders/456&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;method&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;DELETE&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>• <strong>适用场景</strong>：订单状态流转、分页导航。</p><hr><h2 id="_3-http-2多路复用如何解决队头阻塞-quic协议的优势是什么" tabindex="-1"><a class="header-anchor" href="#_3-http-2多路复用如何解决队头阻塞-quic协议的优势是什么"><span><strong>3. HTTP/2多路复用如何解决队头阻塞？QUIC协议的优势是什么？</strong></span></a></h2><p>• <strong>HTTP/2多路复用</strong>：<br> • <strong>问题</strong>：HTTP/1.1同一TCP连接中，前序请求延迟阻塞后续请求。<br> • <strong>解决</strong>：将请求拆分为二进制帧，通过流（Stream）标识符并行传输。<br> • <strong>效果</strong>：单个连接可处理数百个并发请求，降低延迟。<br> • <strong>QUIC协议优势</strong>：<br> • <strong>基于UDP</strong>：绕过TCP队头阻塞，流之间独立传输。<br> • <strong>0-RTT握手</strong>：重连时无需重新握手，提升弱网性能。<br> • <strong>连接迁移</strong>：IP变化时无需重建连接（如Wi-Fi切4G）。</p><hr><h2 id="_4-如何防御jwt令牌被盗用" tabindex="-1"><a class="header-anchor" href="#_4-如何防御jwt令牌被盗用"><span><strong>4. 如何防御JWT令牌被盗用？</strong></span></a></h2><p>• <strong>防御方案</strong>：</p><ol><li><strong>HTTPS加密</strong>：防止中间人窃听。</li><li><strong>短期令牌</strong>：设置较短过期时间（如15分钟）。</li><li><strong>Token绑定</strong>：将JWT与客户端指纹（如IP、TLS证书）绑定。</li><li><strong>黑名单机制</strong>：注销令牌时记录至Redis，验证时检查黑名单。<br> • <strong>代码示例</strong>（Token绑定）：</li></ol><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// JWT Claims中添加客户端指纹  </span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> fingerprint </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> sha256</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getRemoteAddr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> userAgent  </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">claims</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;fp&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, fingerprint);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="实战场景题" tabindex="-1"><a class="header-anchor" href="#实战场景题"><span><strong>实战场景题</strong></span></a></h2><h4 id="_1-设计一个支持版本控制的用户管理api-包含分页和过滤条件" tabindex="-1"><a class="header-anchor" href="#_1-设计一个支持版本控制的用户管理api-包含分页和过滤条件"><span><strong>1. 设计一个支持版本控制的用户管理API（包含分页和过滤条件）</strong></span></a></h4><p>• <strong>URI设计</strong>：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span># 版本控制（URL路径）  </span></span>
<span class="line"><span>GET /v1/users?role=admin&amp;page=2&amp;size=20  </span></span>
<span class="line"><span></span></span>
<span class="line"><span># 过滤与分页  </span></span>
<span class="line"><span>GET /v1/users?name=John&amp;age=30&amp;sort=created_at,desc</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>• <strong>响应示例</strong>：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;data&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: [  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;id&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;name&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;John&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> },  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;id&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;name&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Alice&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  ],  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;_links&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;next&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;href&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/v1/users?page=3&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> },  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;prev&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;href&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/v1/users?page=1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>• <strong>版本控制方案</strong>：Header方式（<code>Accept: application/vnd.myapi.v1+json</code>）。</p><hr><h4 id="_2-优化一个慢查询的订单列表接口-全链路分析" tabindex="-1"><a class="header-anchor" href="#_2-优化一个慢查询的订单列表接口-全链路分析"><span><strong>2. 优化一个慢查询的订单列表接口（全链路分析）</strong></span></a></h4><p>• <strong>分析步骤</strong>：</p><ol><li><strong>HTTP层</strong>：检查是否启用HTTP/2，开启GZIP压缩减少传输体积。</li><li><strong>缓存层</strong>：Redis缓存热门查询结果（如<code>/orders?user_id=123</code>）。</li><li><strong>数据库层</strong>：<br> ◦ <strong>索引优化</strong>：为<code>user_id</code>和<code>created_at</code>添加联合索引。<br> ◦ <strong>分页优化</strong>：避免<code>OFFSET</code>，改用<code>WHERE id &gt; last_id LIMIT 20</code>。</li><li><strong>SQL重构</strong>：<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 原始慢查询  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> orders </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> user_id</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">123</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ORDER BY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> created_at </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DESC</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> LIMIT</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 20</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> OFFSET </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 优化后  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> orders </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> user_id</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">123</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AND</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1000</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ORDER BY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> created_at </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DESC</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> LIMIT</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 20</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr><h2 id="陷阱题" tabindex="-1"><a class="header-anchor" href="#陷阱题"><span><strong>陷阱题</strong></span></a></h2><h4 id="_1-为什么http-1-1的管线化-pipelining-在实践中很少被使用" tabindex="-1"><a class="header-anchor" href="#_1-为什么http-1-1的管线化-pipelining-在实践中很少被使用"><span><strong>1. 为什么HTTP/1.1的管线化（Pipelining）在实践中很少被使用？</strong></span></a></h4><p>• <strong>根本原因</strong>：<br> • <strong>队头阻塞未解决</strong>：服务器必须按请求顺序返回响应，若首个请求延迟，后续响应全部阻塞。<br> • <strong>浏览器兼容性差</strong>：Chrome/Firefox默认禁用，仅部分场景（如资源加载）有限支持。<br> • <strong>替代方案</strong>：HTTP/2多路复用彻底解决该问题。</p><h4 id="_2-在restful-api中-为什么put被定义为幂等而post不是" tabindex="-1"><a class="header-anchor" href="#_2-在restful-api中-为什么put被定义为幂等而post不是"><span><strong>2. 在RESTful API中，为什么PUT被定义为幂等而POST不是？</strong></span></a></h4><p>• <strong>幂等性定义</strong>：多次相同请求对资源状态的影响一致。<br> • <strong>PUT</strong>：替换资源（如<code>PUT /users/123</code>更新用户信息），重复调用结果不变。<br> • <strong>POST</strong>：创建资源（如<code>POST /users</code>每次生成新用户），重复调用产生多个资源。<br> • <strong>示例</strong>：<br> • PUT：多次更新用户昵称，最终结果与单次一致。<br> • POST：多次提交订单，订单记录。</p><hr><h2 id="总结-4" tabindex="-1"><a class="header-anchor" href="#总结-4"><span><strong>总结</strong></span></a></h2><p>掌握RESTful设计与HTTP协议原理是后端开发的核心能力，面试中需结合技术细节与实战案例，展现对高并发、安全、性能优化的深度理解。回答陷阱题时，需直指问题本质（如HTTP/1.1管线化缺陷），避免泛泛而谈。</p>`,266)]))}const p=i(h,[["render",e]]),d=JSON.parse('{"path":"/1.%E5%AD%A6%E4%B9%A0%E7%AF%87/4.Web%20%E5%BC%80%E5%8F%91%E4%B8%8E%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/1.HTTP%E5%8D%8F%E8%AE%AE%E4%B8%8ERESTful%E8%AE%BE%E8%AE%A1.html","title":"1.HTTP协议与RESTful设计","lang":"en-US","frontmatter":{"title":"1.HTTP协议与RESTful设计"},"git":{},"readingTime":{"minutes":22.8,"words":6841},"filePathRelative":"1.学习篇/4.Web 开发与网络编程/1.HTTP协议与RESTful设计.md"}');export{p as comp,d as data};
