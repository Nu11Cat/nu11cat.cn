---
title: 高并发和性能优化
topic: fang12306
---

## 一、项目背景和整体架构

**可能问题：**

1. 为什么选择做这个项目？难点和价值在哪里？
   - **注意事项：** 强调高并发、余票一致性、高可用、可扩展；突出不是普通CRUD。
2. 系统架构是怎样的？画一下架构图。
   - **注意事项：** 描述分层架构：用户层 → 网关 → 微服务 → 数据层；提及关键技术栈。
3. 系统能支持多大QPS？做了哪些优化？
   - **注意事项：** 分前端、网关、应用、数据层说明：静态化页面、限流、异步、缓存、分库分表。
4. 为什么选择微服务/单体？服务拆分原则是什么？
   - **注意事项：** 高内聚低耦合，按业务边界拆分（用户、票务、订单、支付、通知服务）。
5. 系统模块有哪些？每个模块的职责是什么？
   - **注意事项：** 用户模块、票务模块、订单模块、支付模块、网关、批处理等。
6. 数据库和缓存选型理由是什么？
   - **注意事项：** MySQL关系型存储，Redis缓存热点数据，保证查询性能和高并发。

------

## 二、核心功能实现：余票查询与扣减

**可能问题：**

1. 如何保证不会超卖？
   - **注意事项：** 悲观锁、乐观锁、Redis+Lua脚本三种方案，高并发推荐Redis+MQ异步持久化。
2. 余票数据如何存储和查询？为什么？
   - **注意事项：** 分席别字段存储、分库分表，复杂查询用缓存或异步计算。
3. Redis缓存和数据库如何保证一致性？
   - **注意事项：** 延迟双删策略、Binlog异步更新，强调最终一致性。
4. 订单状态如何管理？
   - **注意事项：** 订单表设计状态字段（未支付、已支付、已取消、退票中），配合延迟队列实现超时取消。
5. 支付和退票如何处理？
   - **注意事项：** 异步更新库存、MQ通知，保证最终一致性。
6. 如何防止重复提交订单？
   - **注意事项：** 接口幂等设计、唯一ID、分布式锁。
7. 边界情况如何处理？例如库存为0时、用户超时未支付等。
   - **注意事项：** 提到异常处理机制和延迟队列。

------

## 三、高并发和性能优化

**可能问题：**

1. 如何处理瞬时高并发请求（秒杀场景）？
   - **注意事项：** 流量削峰（MQ异步）、请求过滤（缓存/静态页面）、限流熔断。
2. 消息队列用在哪些场景？如何保证消息不丢失？
   - **注意事项：** 下单异步、支付超时处理；生产者确认、Broker持久化、手动ACK。
3. 系统性能瓶颈可能出在哪里？如何优化？
   - **注意事项：** 数据库（索引优化、分库分表、读写分离）、缓存热点、线程池/异步化。
4. 压测结果如何体现？有哪些优化方向？
   - **注意事项：** 单开“压测与性能分析”，记录QPS、响应时间、瓶颈点和改进方案。
5. 数据库锁竞争如何解决？
   - **注意事项：** 使用乐观锁或细粒度锁，减少行锁争用。
6. 如何应对秒杀场景下库存抢光的瞬时高峰？
   - **注意事项：** 排队队列、Redis原子扣减、热点缓存预减库存。
7. 多线程或异步处理在哪些场景用到？
   - **注意事项：** 下单异步、邮件通知、定时任务（Quartz）。

------

## 四、分布式与微服务

**可能问题：**

1. 用户登录状态如何管理？
   - **注意事项：** JWT或Redis Session，实现分布式共享。
2. 服务拆分原则是什么？
   - **注意事项：** 高内聚低耦合，按业务边界拆分。
3. 分布式事务如何保证？
   - **注意事项：** 最终一致性（MQ可靠消息）或Seata AT/TCC模式。
4. 服务间通信是同步还是异步？为什么？
   - **注意事项：** 查询类可同步（REST/Feign），下单支付类异步（MQ），提高吞吐量。
5. 服务注册与发现用哪种组件？有什么作用？
   - **注意事项：** Nacos/Eureka，实现服务自动注册和调用。
6. 配置中心如何管理微服务配置？
   - **注意事项：** Nacos/Spring Cloud Config，方便集中管理和热更新。
7. 服务降级和熔断如何设计？
   - **注意事项：** Sentinel/Resilience4j，保证部分服务异常不影响整体系统。

------

## 五、异常与边界场景

**可能问题：**

1. 如何处理重复提交订单？
   - **注意事项：** 接口幂等、唯一ID、Redis分布式锁。
2. 用户抢票失败或支付失败如何处理？
   - **注意事项：** 延迟队列、异步补偿、通知用户。
3. 网络延迟或中断时，如何保证数据一致性？
   - **注意事项：** MQ重试机制、幂等处理、事务补偿。
4. 如何处理库存为0的情况？
   - **注意事项：** 提前拦截请求、缓存标记、队列排队处理。
5. 异常日志和监控如何设计？
   - **注意事项：** AOP日志收集、分布式链路追踪、Prometheus+Grafana告警。

------

## 六、安全与防护

**可能问题：**

1. 如何防刷票或机器人？
   - **注意事项：** 验证码、频率限制、拦截器、行为分析。
2. 数据安全和接口安全怎么保证？
   - **注意事项：** 密码加密（BCrypt）、JWT鉴权、防CSRF/XSS。
3. 用户权限和操作权限如何控制？
   - **注意事项：** RBAC角色管理、接口鉴权拦截器。
4. 系统如何防止恶意并发请求？
   - **注意事项：** 限流（漏桶/令牌桶算法）、请求签名校验。

------

## 七、系统扩展性与反思

**可能问题：**

1. 项目有哪些可优化的地方？
   - **注意事项：** 弹性计算、缓存优化、微服务拆分更细、监控告警完善。
2. 遇到的最大挑战是什么？怎么解决的？
   - **注意事项：** 准备具体例子，突出问题分析和解决能力。
3. 如果未来业务量再增长，系统如何扩展？
   - **注意事项：** 服务水平扩展、数据库分片、缓存预热、消息队列调节流量。
4. 你最自豪的技术亮点是什么？
   - **注意事项：** Redis秒杀、分布式锁、MQ可靠消息等，结合实际实现讲清楚。

------

💡 **总结建议：**

- 深入掌握1-2个重点（Redis秒杀、分布式锁、MQ异步）
- 逻辑清晰、分模块回答
- 诚实说明未实现部分，并提出工业化方案
- 面试官往往会沿着你熟悉的技术点深入问































