---
title: 中间件/模块配置
topic: fang12306
---

### Redis

```properties
#Redis数据库
##连接地址
spring.data.redis.host=r-uf6ljbcdaxobsifyctpd.redis.rds.aliyuncs.com
##连接端口
spring.data.redis.port=6379
##访问密码
spring.data.redis.password=Redis000

#Spring Cache
##Spring Cache 缓存类型
spring.cache.type=redis
##是否使用统一前缀，避免 key 冲突
spring.cache.redis.use-key-prefix=true
##缓存 key 前缀
spring.cache.redis.key-prefix=train_cache_
##是否缓存空值，避免缓存穿透
spring.cache.redis.cache-null-values=true
##默认缓存过期时间
spring.cache.redis.time-to-live=60s
```

### RocketMQ

```properties
#RocketMQ NameServer 地址（多个用分号分隔），生产环境推荐集群部署
rocketmq.name-server=http://localhost:9876
#生产者分组名称，用于标识一类生产者，同一业务逻辑的生产者建议用固定 group。
rocketmq.producer.group=default
```

### Seata

Seata 的注册中心配置和 Seata Server 的 `application.yml` 必须保持一致。

`seata.tx-service-group` 必须在 Nacos 配置文件中配置映射

```properties
# seata注册中心，要和seata server的application.yml配置保持一致
##注册中心类型
seata.registry.type=nacos
##Seata Server 名称
seata.registry.nacos.application=seata-server
##Nacos 地址
seata.registry.nacos.server-addr=127.0.0.1:8848
##Nacos 分组
seata.registry.nacos.group=SEATA_GROUP
##命名空间
seata.registry.nacos.namespace=e0ac609b-ff99-4b1f-8f85-caaec475d91f
## 默认的用户名密码
seata.registry.nacos.username=nacos
seata.registry.nacos.password=nacos

# seata配置中心，要和seata server的application.yml配置保持一致
##配置中心类型
seata.config.type=nacos
##
seata.config.nacos.server-addr=127.0.0.1:8848
##
seata.config.nacos.group=SEATA_GROUP
##
seata.config.nacos.namespace=e0ac609b-ff99-4b1f-8f85-caaec475d91f
##Seata 配置文件 ID
seata.config.nacos.dataId=seataServer.properties
##
seata.config.nacos.username=nacos
seata.config.nacos.password=nacos

#事务分组名称
seata.tx-service-group=train-group
```

### Sentinel

Sentinel 默认从本地加载规则，这里通过 `Nacos` 持久化规则，方便统一管理

```properties
# sentinel控台
##应用和 Sentinel 控制台的通信端口
spring.cloud.sentinel.transport.port=8719
##Sentinel 控制台地址
spring.cloud.sentinel.transport.dashboard=localhost:8080

# sentinel注册配置于nacos
##流控规则存储在 Nacos 地址
spring.cloud.sentinel.datasource.flow.nacos.serverAddr=127.0.0.1:8848
##
spring.cloud.sentinel.datasource.flow.nacos.namespace=e0ac609b-ff99-4b1f-8f85-caaec475d91f
##Nacos 中存储流控规则的 逻辑分组
spring.cloud.sentinel.datasource.flow.nacos.groupId=DEFAULT_GROUP
##Nacos 中存储流控规则的 DataId
spring.cloud.sentinel.datasource.flow.nacos.dataId=sentinel-business-flow
##规则类型
spring.cloud.sentinel.datasource.flow.nacos.ruleType=flow
```

### Nacos

一方面做配置中心（统一管理配置文件），另一方面做注册中心（服务发现和治理）

```properties
# 注册中心应用名
spring.application.name=business

# 启动环境，nacos会根据环境读不同的配置dataId：business-dev.properties
spring.profiles.active=dev

# nacos server配置中心地址
spring.cloud.nacos.config.server-addr=127.0.0.1:8848
# 配置中心文件后缀，默认properties
spring.cloud.nacos.config.file-extension=properties
# 配置中心命名空间
#spring.cloud.nacos.config.namespace=train
spring.cloud.nacos.config.namespace=e0ac609b-ff99-4b1f-8f85-caaec475d91f
# nacos server注册中心地址
spring.cloud.nacos.discovery.server-addr=127.0.0.1:8848
#服务发现命名空间
#spring.cloud.nacos.discovery.namespace=train
spring.cloud.nacos.discovery.namespace=e0ac609b-ff99-4b1f-8f85-caaec475d91f
```

### MySQL

```properties
# 数据库连接
## 数据库地址，包含字符编码、时区和自动重连选项
spring.datasource.url=jdbc:mysql://localhost:3306/train-business?characterEncoding=UTF8&autoReconnect=true&serverTimezone=Asia/Shanghai
## 数据库用户名密码
spring.datasource.username=train
spring.datasource.password=123456
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
```

### MyBatis

```properties
# mybatis xml路径，保证 MyBatis 能扫描到对应 SQL 映射文件
mybatis.mapper-locations=classpath:/mapper/**/*.xml
# 对 Mapper 层开启 trace 级别日志，用于调试 SQL 执行情况
logging.level.cn.nu11cat.train.business.mapper=trace
```

### Gateway网关

```properties
# 路由转发
## id：路由标识，便于管理和调试。
## uri：负载均衡访问服务，使用 lb:// 表示通过注册中心发现对应服务。
## predicates：路由匹配规则，这里根据请求路径进行匹配，例如 /member/** 转发到 member 模块。
## http://127.0.0.1:xxxx用于本地调试直连模块,不经过注册中心

# 路由转发，将/member/...的请求转发了member模块
spring.cloud.gateway.routes[0].id=member
#spring.cloud.gateway.routes[0].uri=http://127.0.0.1:8001
spring.cloud.gateway.routes[0].uri=lb://member
spring.cloud.gateway.routes[0].predicates[0]=Path=/member/**

spring.cloud.gateway.routes[1].id=business
#spring.cloud.gateway.routes[1].uri=http://127.0.0.1:8002
spring.cloud.gateway.routes[1].uri=lb://business
spring.cloud.gateway.routes[1].predicates[0]=Path=/business/**

spring.cloud.gateway.routes[2].id=batch
#spring.cloud.gateway.routes[2].uri=http://127.0.0.1:8003
spring.cloud.gateway.routes[2].uri=lb://batch
spring.cloud.gateway.routes[2].predicates[0]=Path=/batch/**

```

```properties
# 跨域（CORS）配置

# 允许请求来源
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedOriginPatterns=*
# 允许携带的头信息
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedHeaders=*
# 允许的请求方式
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedMethods=*
# 是否允许携带cookie
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowCredentials=true
# 跨域检测的有效期，会发起一个OPTION请求
spring.cloud.gateway.globalcors.cors-configurations.[/**].maxAge=3600
```

### 业务模块

```properties
# 服务端口与上下文路径
server.port=8002
server.servlet.context-path=/business
# 服务名称,用于注册中心注册服务的标识
spring.application.name=business
```

