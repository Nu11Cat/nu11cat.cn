---
title: 全局/模块配置
topic: fang12306
---

## train-member模块

```properties
# 应用服务 WEB 访问端口
### 配置端口
server.port=8001    
### 设置应用的上下文路径为 /member，所有请求需以此路径开头。方便做路由转发
server.servlet.context-path=/member

# 数据库连接
spring.datasource.url=jdbc:mysql://localhost:3306/train-member?characterEncoding=UTF8&autoReconnect=true&serverTimezone=Asia/Shanghai
spring.datasource.username=train
spring.datasource.password=123456
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# mybatis xml路径
mybatis.mapper-locations=classpath:/mapper/**/*.xml
logging.level.cn.nu11cat.train.member.mapper=trace

test.nacos=Member
```

## gateway网关模块

添加依赖

```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-gateway</artifactId>
</dependency>
```

```properties
server.port=8000

# 路由转发，将/member/...的请求转发了member模块
spring.cloud.gateway.routes[0].id=member
#spring.cloud.gateway.routes[0].uri=http://127.0.0.1:8001
spring.cloud.gateway.routes[0].uri=lb://member
spring.cloud.gateway.routes[0].predicates[0]=Path=/member/**

# 路由转发，将/business/...的请求转发了business模块
spring.cloud.gateway.routes[1].id=business
#spring.cloud.gateway.routes[1].uri=http://127.0.0.1:8002
spring.cloud.gateway.routes[1].uri=lb://business
spring.cloud.gateway.routes[1].predicates[0]=Path=/business/**

# 路由转发，将/batch/...的请求转发了batch模块
spring.cloud.gateway.routes[2].id=batch
#spring.cloud.gateway.routes[2].uri=http://127.0.0.1:8003
spring.cloud.gateway.routes[2].uri=lb://batch
spring.cloud.gateway.routes[2].predicates[0]=Path=/batch/**

# 允许请求来源
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedOriginPatterns=*
# 允许携带的头信息
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedHeaders=*
# 允许的请求方式
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedMethods=*
# 是否允许携带cookie
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowCredentials=true
# 跨域检测的有效期，会发起一个OPTION请求
spring.cloud.gateway.globalcors.cors-configurations.[/**].maxAge=3600
```

## common模块

其他模块引入common作为依赖：

共同依赖添加到common的pom.xml然后其他模块添加：

```xml
<dependency>
    <groupId>cn.nullcat</groupId>
    <artifactId>common</artifactId>
</dependency>
```

默认读取resource/config，且优先级高于其他模块



## 模块共同配置

resources添加logback-spring.xml修改路径生成日志文件

启动类添加：

```java
private static final Logger LOG = LoggerFactory.getLogger(MemberApplication.class);

public static void main(String[] args) {
    SpringApplication app = new SpringApplication(MemberApplication.class);
    Environment env = app.run(args).getEnvironment();
    LOG.info("启动成功！！");
    LOG.info("测试地址: \thttp://127.0.0.1:{}{}/hello", env.getProperty("server.port"), env.getProperty("server.servlet.context-path"));
}
```

